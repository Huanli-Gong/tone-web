(self.webpackChunktone_front=self.webpackChunktone_front||[]).push([[1237],{95779:function(Ee,cn,t){"use strict";t.d(cn,{Z:function(){return An}});var h=t(45972),Pe=t(22374),ge={icon:function(sn,ze){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:sn}},{tag:"path",attrs:{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm192 396c0 4.4-3.6 8-8 8H544v152c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V544H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h152V328c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v152h152c4.4 0 8 3.6 8 8v48z",fill:ze}},{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z",fill:sn}}]}},name:"plus-circle",theme:"twotone"},s=ge,Re=t(25078),n=function(sn,ze){return Pe.createElement(Re.Z,(0,h.Z)((0,h.Z)({},sn),{},{ref:ze,icon:s}))};n.displayName="PlusCircleTwoTone";var An=Pe.forwardRef(n)},66503:function(Ee){Ee.exports={table_question_tooltip:"table_question_tooltip___2k4VQ"}},19137:function(Ee){Ee.exports={filter:"filter___1IKYx",confirm:"confirm___3RbBO",domain:"domain___1-UgM"}},40483:function(Ee){Ee.exports={warp:"warp___3sqbf",selectCascader:"selectCascader___ei33u"}},24480:function(Ee){Ee.exports={warp:"warp___1vm-z",tree:"tree___2UOGt"}},44461:function(Ee){Ee.exports={warp:"warp___KB6l1",pagination:"pagination___3bije",hidden:"hidden___3iAk1"}},94293:function(Ee){Ee.exports={warp:"warp___31IgT",pagination:"pagination___21nhK",hidden:"hidden___2DJ9Y",row:"row___LOziI",tag_popover_style:"tag_popover_style___17NS3",btn_style:"btn_style___QUzyN"}},80873:function(Ee,cn,t){"use strict";t.d(cn,{f:function(){return Vn}});var h=t(57359),Pe=t(34423),ge=t(20418),s=t(79625),Re=t(96584),n=t(488),An=t(22374),K=t(66503),sn=t.n(K),ze=t(74066),pn=t(52454),ne=["desc","title"],Vn=function(Le){var mn=Le.desc,Gn=Le.title,me=(0,n.Z)(Le,ne);return(0,pn.jsxs)(Pe.Z,{children:[(0,pn.jsx)("span",{style:{color:"rgba(0, 0, 0, 0.85)"},children:Gn}),(0,pn.jsx)(Re.Z,(0,ge.Z)((0,ge.Z)({overlayClassName:sn().table_question_tooltip,placement:"bottomLeft",arrowPointAtCenter:!0},me),{},{title:mn,color:"#fff",children:(0,pn.jsx)(ze.Z,{style:{color:"rgba(0, 0, 0, 0.65)"}})}))]})}},15122:function(Ee,cn,t){"use strict";var h=t(46721),Pe=t(94867),ge=t(8281),s=t(58591),Re=t(57359),n=t(34423),An=t(88966),K=t(11048),sn=t(39190),ze=t(22374),pn=t(19137),ne=t.n(pn),Vn=t(39935),F=t(22812),Le=t(52454),mn=function(me){var tt=me.list,ln=me.confirm,rt=me.onConfirm,ke=me.roleType,_=(0,F.YB)(),N=_.formatMessage,dn=(0,ze.useState)(),r=(0,sn.Z)(dn,2),$e=r[0],Tn=r[1],kn=function(Yn){Tn(Yn.target.value)};return(0,Le.jsxs)("div",{className:ne().filter,children:[(0,Le.jsx)(K.ZP.Group,{onChange:kn,value:$e,children:(0,Le.jsx)(n.Z,{direction:"vertical",children:tt.map(function(e){return(0,Le.jsx)(K.ZP,{className:ne().domain,value:e.id,children:ke==="role"?(0,Vn.u)(e.name,N):e.name},e.id)})})}),(0,Le.jsx)(s.Z,{style:{margin:"10px 0"}}),(0,Le.jsxs)("div",{className:ne().confirm,children:[(0,Le.jsx)(Pe.Z,{size:"small",type:"link",style:{border:"none"},onClick:function(){ln==null||ln(),rt($e)},children:(0,Le.jsx)(F._H,{id:"operation.ok"})}),(0,Le.jsx)(Pe.Z,{size:"small",type:"text",onClick:function(){ln==null||ln(),Tn(void 0),rt(void 0)},children:(0,Le.jsx)(F._H,{id:"operation.reset"})})]})]})};cn.Z=mn},90395:function(Ee,cn,t){"use strict";t.r(cn),t.d(cn,{default:function(){return Rr}});var h=t(39190),Pe=t(54905),ge=t(90087),s=t(22374),Re=t(24812),n=t(22812),An=t(14320),K=t(53479),sn=t(67515),ze=t(41083),pn=t(46721),ne=t(94867),Vn=t(31650),F=t(25100),Le=t(51937),mn=t(34516),Gn=t(57359),me=t(34423),tt=t(79625),ln=t(96584),rt=t(81138),ke=t(96146),_=t(35832),N=t(32326),dn=t(26388),r=t(20418),$e=t(31784),Tn=t(74066),kn=t(46601),e=t(52454),Yn=function(k){var P=k.name,Z=k.formatMessage;return P=="cloud"?(0,e.jsx)("div",{children:Z({id:"device.cloud"})}):P=="cloud_efficiency"?(0,e.jsx)("div",{children:Z({id:"device.cloud_efficiency"})}):P=="cloud_ssd"?(0,e.jsx)("div",{children:Z({id:"device.cloud_ssd"})}):P=="cloud_essd"?(0,e.jsx)("div",{children:Z({id:"device.cloud_essd"})}):(0,e.jsx)("div",{children:"-"})},at=function(k,P){var Z={cloud:P({id:"device.cloud"}),cloud_efficiency:P({id:"device.cloud_efficiency"}),cloud_ssd:P({id:"device.cloud_ssd"}),cloud_essd:P({id:"device.cloud_essd"})};return Z[k]},it=function(k){var P,Z;return k[k.length-1]!=="latest"?k[k.length-1]:"".concat((P=k[1].props)===null||P===void 0?void 0:P.children,":").concat((Z=k[2].props)===null||Z===void 0?void 0:Z.children,":latest")},st=Yn,Zt=t(44851),C=t.n(Zt),te=t(55704),ue=t(94649),rn=t(12590),U=t(22911),In=t(27787),xt=t(76123),Gr=t(88018),_t=t(58414),Yr=t(67448),kt=t(47548),Qr=t(90846),jt=t(56511),Jr=t(39693),Qn=t(1518),Xr=t(13998),lt=t(76784),qr=t(88966),Mn=t(11048),ea=t(70772),v=t(6701),na=t(20693),hn=t(3278),dt=t(2605),ta=t(65790),V=t(17187),ra=t(69230),on=t(33821),q=t(75667),It=t(57286),Jn=t(526),re=t(39935),qt=t(95779),Mt=t(45972),er={icon:function(k,P){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:k}},{tag:"path",attrs:{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm192 396c0 4.4-3.6 8-8 8H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h368c4.4 0 8 3.6 8 8v48z",fill:P}},{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z",fill:k}}]}},name:"minus-circle",theme:"twotone"},nr=er,tr=t(25078),Ht=function(k,P){return s.createElement(tr.Z,(0,Mt.Z)((0,Mt.Z)({},k),{},{ref:P,icon:nr}))};Ht.displayName="MinusCircleTwoTone";var rr=s.forwardRef(Ht),ar=t(40483),Fn=t.n(ar),ir=t(53919),Dt=t(8476),yt=t(80873),sr=t(94870),ot=on.Z.Option,Ot=[{value:"aliyun_eci",label:"aliyun_eci",isLeaf:!1},{value:"aliyun_ecs",label:"aliyun_ecs",isLeaf:!1}],lr=function(k){return Object.prototype.toString.call(k)==="[object Array]"},dr=function(k){return Object.prototype.toString.call(k)==="[object Object]"},or=function(k){var P=[{param_key:"",param_value:""}];return lr(k)&&JSON.stringify(k)==="[]"||dr(k)&&JSON.stringify(k)==="{}"?P:k},ur=function(k){var P=k.onRef,Z=k.is_instance,ae=k.onSuccess,R=k.type,de=(0,n.YB)(),a=de.formatMessage,G=(0,n.tT)("disclaimer"),Je=G.openModal,ye=G.handleDisclaimerOpen,Ie=(0,Re.UO)(),ie=Ie.ws_id,Ce=V.Z.useForm(),Ae=(0,h.Z)(Ce,1),Q=Ae[0],We=(0,s.useState)({list:[],isQuery:""}),De=(0,h.Z)(We,2),Te=De[0],Fe=De[1],Ke=(0,s.useState)(Ot),Me=(0,h.Z)(Ke,2),Be=Me[0],Ne=Me[1],se=(0,s.useState)(!1),he=(0,h.Z)(se,2),Ze=he[0],fe=he[1],Ue=(0,s.useState)(!1),Ve=(0,h.Z)(Ue,2),J=Ve[0],O=Ve[1],E=(0,s.useState)([]),an=(0,h.Z)(E,2),H=an[0],S=an[1],o=(0,s.useState)([]),w=(0,h.Z)(o,2),z=w[0],X=w[1],He=(0,s.useState)([]),W=(0,h.Z)(He,2),_n=W[0],xe=W[1],Dn=(0,s.useState)(!1),On=(0,h.Z)(Dn,2),Xe=On[0],jn=On[1],En=(0,s.useState)([]),c=(0,h.Z)(En,2),ve=c[0],un=c[1],Ge=(0,s.useState)([]),yn=(0,h.Z)(Ge,2),Cn=yn[0],fn=yn[1],Kn=(0,s.useState)(!0),gn=(0,h.Z)(Kn,2),qe=gn[0],I=gn[1],zn=(0,s.useState)({}),Pn=(0,h.Z)(zn,2),_e=Pn[0],Sn=Pn[1],Wn=(0,s.useState)({validate:!0,meg:""}),Bn=(0,h.Z)(Wn,2),Rn=Bn[0],wn=Bn[1],Xn=(0,s.useState)(!0),Nn=(0,h.Z)(Xn,2),Ln=Nn[0],Zn=Nn[1],x=(0,s.useState)(""),d=(0,h.Z)(x,2),i=d[0],M=d[1],L=(0,s.useState)(!1),Se=(0,h.Z)(L,2),ee=Se[0],g=Se[1],m=(0,s.useState)(!0),j=(0,h.Z)(m,2),A=j[0],Y=j[1],en=(0,s.useState)(),ce=(0,h.Z)(en,2),vn=ce[0],qn=ce[1],$n=function(){var y=(0,N.Z)((0,_.Z)().mark(function f(l){var b,p,u,T,$,oe,D,je,nn,Ye,Oe;return(0,_.Z)().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,(0,q.L0)({cluster_id:l});case 2:if(B.t0=B.sent,B.t0){B.next=5;break}B.t0={};case 5:b=B.t0,p=b.code,u=b.data,T=u===void 0?[]:u,p===200&&!!T.length?($=T[T.length-1].test_server,oe=$===void 0?{}:$,D=oe.manufacturer,je=oe.ak_id,nn=oe.region,Ye=oe.zone,je&&D&&nn&&Ye&&(Y(!1),M(D),jn(!0),Oe={ak_id:je,id:D,region:nn,zone:Ye},Z?Promise.all([mt(Oe),pt(Oe)]).then(function(){fe(!1),I(!1)}):Promise.all([mt(Oe),ft(Oe),et(Oe),vt(Oe)]).then(function(){fe(!1),I(!1)}),Q.setFieldsValue({manufacturer:[D,je],region:[nn,Ye]}))):Y(!0);case 10:case"end":return B.stop()}},f)}));return function(l){return y.apply(this,arguments)}}(),ft=function(){var y=(0,N.Z)((0,_.Z)().mark(function f(l){var b,p;return(0,_.Z)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,(0,q.BS)(l);case 2:b=T.sent,p=b.data,S(p||[]),(!p||p.length===0)&&Fr();case 6:case"end":return T.stop()}},f)}));return function(l){return y.apply(this,arguments)}}(),et=function(){var y=(0,N.Z)((0,_.Z)().mark(function f(l){var b,p,u;return(0,_.Z)().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,(0,q.iB)(l);case 2:b=$.sent,p=b.data,u=p===void 0?[]:p,X(u);case 6:case"end":return $.stop()}},f)}));return function(l){return y.apply(this,arguments)}}(),vt=function(){var y=(0,N.Z)((0,_.Z)().mark(function f(l){var b,p,u,T,$;return(0,_.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,(0,q.F$)(l);case 2:b=D.sent,p=b.data,u=p.slice(0),T=u.some(function(je){return je.value==="cloud_efficiency"}),$=[{title:"\u9AD8\u6548\u4E91\u76D8",value:"cloud_efficiency"}],T||(u=u.concat($)),fn(u||[]);case 9:case"end":return D.stop()}},f)}));return function(l){return y.apply(this,arguments)}}(),pt=function(){var y=(0,N.Z)((0,_.Z)().mark(function f(l){var b,p;return(0,_.Z)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,(0,q.Ti)(l);case 2:b=T.sent,p=b.data,xe(p||[]);case 5:case"end":return T.stop()}},f)}));return function(l){return y.apply(this,arguments)}}(),Lr=function(){var y=(0,N.Z)((0,_.Z)().mark(function f(l){var b,p,u,T;return(0,_.Z)().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return b=l[l.length-1],oe.next=3,(0,q.mN)({ak_id:b.ak_id,region:b.value});case 3:p=oe.sent,u=p.data,T=p.code,T===200?(b.children=u&&u.map(function(D){return{label:(0,Jn.Px)(D.id),value:D.id}}),un((0,dt.Z)(ve))):setTimeout(function(){b.children=[],un((0,dt.Z)(ve))},500);case 7:case"end":return oe.stop()}},f)}));return function(l){return y.apply(this,arguments)}}(),$r=function(){var y=(0,N.Z)((0,_.Z)().mark(function f(l){var b,p,u,T,$;return(0,_.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return b=l[l.length-1],D.next=3,(0,q.aB)({ws_id:ie,provider:b.value});case 3:p=D.sent,u=p.code,T=p.data,$=p.msg,u===200?(b.children=T&&T.map(function(je){return{label:je.name,value:je.id}}),Ne((0,dt.Z)(Be))):(setTimeout(function(){b.children=[],Ne((0,dt.Z)(Be))},500),wn({validate:!1,meg:$||a({id:"device.no.compliant.AK"})}),Q.setFieldsValue({manufacturer:void 0}));case 8:case"end":return D.stop()}},f)}));return function(l){return y.apply(this,arguments)}}(),bt={instance_type:void 0,instance_type_one:void 0,instance_type_two:void 0,storage_type:void 0,storage_size:40,storage_number:0,system_disk_category:void 0,system_disk_size:40},Ar=function(){Q.setFieldsValue((0,r.Z)((0,r.Z)({},bt),{},{region:void 0,image:void 0}))},zt=function(){Q.setFieldsValue((0,r.Z)((0,r.Z)({},bt),{},{image:void 0}))},Fr=function(){Q.setFieldsValue((0,r.Z)({},bt))},Kr=function(){var y=(0,N.Z)((0,_.Z)().mark(function f(l,b){var p,u,T,$,oe,D,je,nn,Ye,Oe;return(0,_.Z)().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(A){B.next=6;break}I(!0),zt(),l&&l.length?(p=l[0],M(p),fe(!0),u=Q.getFieldValue("region"),T={ak_id:l[1],region:u[0],zone:u[1]},Z?Promise.all([pt(T)]).then(function(){fe(!1),I(!1)}):Promise.all([ft(T),et(T),vt(T)]).then(function(){fe(!1),I(!1)})):(S([]),xe([]),X([]),fn([])),B.next=26;break;case 6:if(I(!0),Ar(),!(l&&l.length)){B.next=24;break}return B.next=11,(0,q.Yh)({ak_id:l[1]});case 11:$=B.sent,oe=$.code,D=$.data,je=D===void 0?[]:D,nn=$.msg,Ye=[],oe===200?(Ye=je==null?void 0:je.map(function(Qe){return{value:Qe.id,label:(0,Jn.Px)(Qe.id),ak_id:l[1],isLeaf:!1}}),wn({validate:!0,meg:""})):wn({validate:!1,meg:nn||a({id:"device.no.compliant.AK"})}),un(Ye),Zn(!!Ye.length),Oe=l[0],M(Oe.value),B.next=26;break;case 24:wn({validate:!0,meg:""}),un([]);case 26:case"end":return B.stop()}},f)}));return function(l,b){return y.apply(this,arguments)}}(),mt=function(){var y=(0,N.Z)((0,_.Z)().mark(function f(l){var b,p,u,T,$,oe,D,je,nn,Ye,Oe;return(0,_.Z)().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return fe(!0),B.next=3,(0,q.aB)({ws_id:ie,provider:l.id});case 3:return b=B.sent,p=b.data,u=p===void 0?[]:p,B.next=8,(0,q.Yh)({ak_id:l.ak_id});case 8:return T=B.sent,$=T.data,oe=$===void 0?[]:$,B.next=13,(0,q.mN)({ak_id:l.ak_id,region:l.region});case 13:D=B.sent,je=D.data,nn=je===void 0?[]:je,Ye=oe.map(function(Qe){return Qe.id==l.region?{value:Qe.id,label:(0,Jn.Px)(Qe.id),ak_id:l.ak_id,isLeaf:!1,children:nn.map(function(xn){return{label:xn.id,value:xn.id}})}:{value:Qe.id,label:(0,Jn.Px)(Qe.id),ak_id:l.ak_id,isLeaf:!1}}),Oe=Ot.map(function(Qe){return Qe.value===l.id?{value:l.id,label:l.id,isLeaf:!1,children:u.map(function(xn){return{label:xn.name,value:xn.id}})}:Qe}),Ne(Oe),un(Ye),fe(!1);case 21:case"end":return B.stop()}},f)}));return function(l){return y.apply(this,arguments)}}(),zr=function(f,l){if(Array.isArray(l)&&l.length){var b={ak_id:l[0].ak_id,region:f[0],zone:f[1]};fe(!0),xe([]),X([]),S([]),fn([]),Q.setFieldsValue({image:void 0,instance_id:void 0,instance_type:void 0,storage_type:void 0,system_disk_category:void 0}),jn(!0),Z?Promise.all([pt(b)]).then(function(){fe(!1),I(!1)}):Promise.all([ft(b),et(b),vt(b)]).then(function(){fe(!1),I(!1)})}else zt()},Wr=function(f){var l=Q.getFieldValue("region"),b=Q.getFieldValue("manufacturer"),p={ak_id:b[1],region:l[0],zone:l[1],instance_type:f};et(p)},Br=function(f){qn(f),Sn({}),R==="cluster"&&$n(f),O(!0),jn(!1),xe([]),X([]),S([]),un([]),fn([]),Fe((0,r.Z)((0,r.Z)({},Te),{},{isQuery:"add",list:[]})),Q.resetFields()};(0,s.useImperativeHandle)(P,function(){return{newMachine:function(f){Br(f)},editMachine:function(f){Nr(f)}}});var Nr=function(f){var l;Y(!0),qn(f.cluster_id),Sn(f),jn(!0),O(!0);var b=f.tag_list.map(function(D){return D.id});Fe((0,r.Z)((0,r.Z)({},Te),{},{isQuery:"edit",list:b}));var p=(0,r.Z)({},f);p.extra_param=or(p.extra_param),p.tags=((l=p.tag_list)===null||l===void 0?void 0:l.map(function(D){return D.id}))||[],p.is_instance=p.is_instance?1:0,p.manufacturer=[p.manufacturer,p.ak_id],p.region=[p.region,p.zone],p.kernel_install=p.kernel_install?1:0,M(f.manufacturer);var u={ak_id:p.ak_id,region:p.region[0],zone:p.region[1],id:p.manufacturer[0]};if(p.ak_name=="aliyun_eci"){var T=p.instance_type,$=T.indexOf("C"),oe=T.indexOf("G");p.instance_type_one=Number(T.substring(0,$)),p.instance_type_two=Number(T.substring($+1,oe))}Z?Promise.all([mt(u),pt(u)]).then(function(){fe(!1),I(!1)}):Promise.all([mt(u),ft(u),et(u),vt(u)]).then(function(){fe(!1),I(!1)}),Q.setFieldsValue(p)};(0,s.useEffect)(function(){if(Object.keys(_e).length&&_e.image&&z.length){var y=z.filter(function($){return $.id===_e.image});if(i==="aliyun_eci"){var f=y.length?y[0].platform:"",l=f?[f,_e.image]:void 0;Q.setFieldsValue({image:l})}else if(y.length){var b=y[0].owner_alias,p=y[0].platform,u=y[0].os_name,T=b?[(0,re.Wj)(b,a),p,u,_e.image]:void 0;Q.setFieldsValue({image:T})}}},[z]);var Wt=function(){var y=(0,N.Z)((0,_.Z)().mark(function f(l){var b,p,u,T,$,oe,D,je,nn,Ye,Oe,Un,B,Qe,xn,Tt,ht,Ut,Vt,Gt,gt,nt,Yt,bn,Qt,Jt,Xt;return(0,_.Z)().wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:if(g(!0),p=(b=l.extra_param)===null||b===void 0?void 0:b.filter(function(tn){return tn.param_key}),u=(0,r.Z)((0,r.Z)({},l),{},{ws_id:ie,is_instance:Z,extra_param:p}),l.hasOwnProperty("manufacturer")&&(u.manufacturer=l==null?void 0:l.manufacturer[0],u.ak_id=l.manufacturer[1],u.region=l.region[0],u.zone=l.region[1]),l.hasOwnProperty("instance_id")&&(T=l.instance_id.label,u.instance_id=l.instance_id.value,u.name=T.indexOf(" / ")>-1?T.split(" / ")[1]:T),i==="aliyun_eci"?u.instance_type="".concat(l.instance_type_one,"C").concat(l.instance_type_two,"G"):u.instance_type=l.instance_type,l.hasOwnProperty("image")&&l.image.length?i==="aliyun_eci"?(u.image=l.image[1],je=(0,re.Eu)(z,"platform")||[],nn=je.find(function(tn){return tn.value==l.image[0]})||{},Ye=($=nn.children)===null||$===void 0?void 0:$.find(function(tn){return tn.value==l.image[1]}),u.image_name=(oe=Ye.label)===null||oe===void 0||(D=oe.props)===null||D===void 0?void 0:D.children):l.image[3]==="latest"?(Oe="".concat(l.image[1],":").concat(l.image[2],":").concat(l.image[3]),u.image=Oe,u.image_name=Oe):l.image.indexOf(":latest")>0?(u.image=l.image,u.image_name=l.image):(u.image=l.image[3],ht=(0,re.We)(z,"owner_alias","platform","os_name")||[],Ut=(ht==null?void 0:ht.find(function(tn){return tn.value==l.image[0]}))||{},Vt=((Un=Ut.children)===null||Un===void 0?void 0:Un.find(function(tn){return tn.value==l.image[1]}))||{},Gt=((B=Vt.children)===null||B===void 0?void 0:B.find(function(tn){return tn.value==l.image[2]}))||{},gt=(Qe=Gt.children)===null||Qe===void 0?void 0:Qe.find(function(tn){return tn.value==l.image[3]}),u.image_name=gt==null||(xn=gt.label)===null||xn===void 0||(Tt=xn.props)===null||Tt===void 0?void 0:Tt.children):u.image=void 0,u.description=l.description||"",u.cluster_id=vn,nt=_e.id,Yt=_e.machineId,R!=="cluster"){pe.next=23;break}if(!nt){pe.next=17;break}return pe.next=14,(0,q.oz)(Yt,(0,r.Z)({},u));case 14:pe.t0=pe.sent,pe.next=20;break;case 17:return pe.next=19,(0,q.MH)((0,r.Z)({},u));case 19:pe.t0=pe.sent;case 20:bn=pe.t0,pe.next=33;break;case 23:if(!nt){pe.next=29;break}return pe.next=26,(0,q.cm)(nt,(0,r.Z)({},u));case 26:pe.t1=pe.sent,pe.next=32;break;case 29:return pe.next=31,(0,q.X6)((0,r.Z)({},u));case 31:pe.t1=pe.sent;case 32:bn=pe.t1;case 33:bn.code===200?(ke.default.success(a({id:"operation.success"})),R==="cluster"?ae({parentId:vn}):ae(u.is_instance||Z,nt),O(!1)):bn.code===201?(Qt=bn.msg,Jt=bn.link_msg,Xt=(0,e.jsx)("span",{dangerouslySetInnerHTML:{__html:Qt.replace(Jt,'<a href="/system/user" target="_blank">$&</a>')}}),ke.default.warning(Xt)):(0,re.EV)(bn.code,bn.msg),g(!1);case 35:case"end":return pe.stop()}},f)}));return function(l){return y.apply(this,arguments)}}(),Bt=function(){Q.validateFields().then(function(f){var l=f.extra_param||[];if(l.length){var b=l.map(function(u){return u.param_key}),p=new Set(b);p.size==b.length?Wt(f):(ke.default.warn("\u6269\u5C55\u5B57\u6BB5\u91CD\u540D\uFF0C\u8BF7\u4FEE\u6539\u540E\u63D0\u4EA4!!!"),Q.scrollToField("extra_param"))}else Wt(f)})},Ur=(0,s.useCallback)(function(y){y&&Bt()},[vn,z]),Nt=function(){Zn(!0),M(""),Sn({}),O(!1),g(!1)},Vr=(0,s.useMemo)(function(){return _e&&_e.state==="Occupied"},[_e]);return(0,e.jsxs)(_t.Z,{maskClosable:!1,keyboard:!1,title:(0,e.jsx)(n._H,{id:_e.id?Z?"device.device.edit":"device.config.edit":Z?"device.add.btn":"device.config.btn"}),width:724,onClose:Nt,open:J,bodyStyle:{paddingBottom:80},destroyOnClose:!0,footer:(0,e.jsx)("div",{style:{textAlign:"right"},children:(0,e.jsxs)(me.Z,{children:[(0,e.jsx)(ne.Z,{onClick:Nt,children:(0,e.jsx)(n._H,{id:"operation.cancel"})}),(0,e.jsx)(ne.Z,{onClick:_e.id?Bt:ye,type:"primary",loading:ee,children:(0,e.jsx)(n._H,{id:"operation.ok"})})]})}),children:[(0,e.jsx)(kt.Z,{spinning:Ze,children:(0,e.jsx)(V.Z,{layout:"vertical",form:Q,initialValues:{instance_type_one:1,instance_type_two:1,system_disk_size:40,storage_size:40,storage_number:0,release_rule:1,kernel_install:1,bandwidth:10,storage_type:"cloud_efficiency",extra_param:[{param_key:"",param_value:""}]},children:(0,e.jsxs)(K.Z,{gutter:16,children:[Z?null:(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{name:"name",label:(0,e.jsx)(n._H,{id:"device.name"}),validateTrigger:"onBlur",rules:[{required:!0,message:a({id:"device.name.message"})},function(){return{validator:function(){var y=(0,N.Z)((0,_.Z)().mark(function l(b,p){var u,T,$;return(0,_.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(!p){D.next=12;break}return u={is_instance:0,name:p,ws_id:ie},T=_e.id?(0,r.Z)((0,r.Z)({},u),{},{cloud_server_id:_e.id}):(0,r.Z)({},u),D.next=5,(0,q.x1)(T);case 5:if(D.t0=D.sent,D.t0){D.next=8;break}D.t0={};case 8:if($=D.t0,$.code!==200){D.next=11;break}return D.abrupt("return",Promise.resolve());case 11:return D.abrupt("return",Promise.reject($.msg||a({id:"validator.failed"})));case 12:case"end":return D.stop()}},l)}));function f(l,b){return y.apply(this,arguments)}return f}()}},{pattern:/^[A-Za-z][A-Za-z0-9\._-]{1,32}$/,message:a({id:"device.name.message"})}],children:(0,e.jsx)(hn.Z,{autoComplete:"off",placeholder:a({id:"please.enter"})})})}),Z?null:(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{name:"release_rule",label:(0,e.jsx)(n._H,{id:"device.release_rule"}),rules:[{required:!0,message:a({id:"please.select"})}],children:(0,e.jsxs)(Mn.ZP.Group,{children:[(0,e.jsx)(Mn.ZP,{value:0,children:(0,e.jsx)(n._H,{id:"operation.not.release"})}),(0,e.jsx)(Mn.ZP,{value:1,children:(0,e.jsx)(n._H,{id:"operation.release"})}),(0,e.jsx)(Mn.ZP,{value:2,children:(0,e.jsx)(yt.f,{title:a({id:"device.failed.save"}),desc:a({id:"device.failed.save.24h"})})})]})})}),!_e.id||!Z?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{name:"manufacturer",label:(0,e.jsx)(n._H,{id:"device.manufacturer/ak"}),validateStatus:Rn.validate?"":"error",help:Rn.validate?void 0:Rn.meg,rules:[{required:!0,message:a({id:"please.select"})}],children:(0,e.jsx)(lt.Z,{disabled:R==="cluster"&&!A,options:Be,loadData:$r,onChange:Kr,dropdownMenuColumnStyle:{width:165},dropdownClassName:Fn().selectCascader})})}):null,i===""?null:!_e.id||!Z?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:"Region/Zone",name:"region",validateStatus:Ln?"":"error",help:Ln?void 0:a({id:"device.region/zone"}),rules:[{required:!0,message:a({id:"please.select"})}],children:(0,e.jsx)(lt.Z,{disabled:(ve==null?void 0:ve.length)===0||R==="cluster"&&!A,options:ve,loadData:Lr,onChange:zr,dropdownMenuColumnStyle:{width:165},dropdownClassName:Fn().selectCascader})})}):null,Xe&&!_e.id&&Z?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.own.server"}),name:"instance_id",rules:[{required:!0,message:a({id:"please.select"})}],children:(0,e.jsx)(on.Z,{showSearch:!0,optionFilterProp:"children",placeholder:a({id:"please.select"}),labelInValue:!0,disabled:_n.length==0,filterOption:function(f,l){return l.children.toLowerCase().indexOf(f.toLowerCase())>=0},children:_n.map(function(y,f){return(0,e.jsx)(ot,{value:y.id,children:y.ip?"".concat(y.ip," / ").concat(y.name):y.name},f)})})})}):null,Xe?Z?null:(0,e.jsx)(e.Fragment,{children:i==="aliyun_eci"?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsxs)(K.Z,{children:[(0,e.jsxs)(v.Z,{span:8,style:{display:"flex",alignItems:"flex-start"},children:[(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.instance_type"}),name:"instance_type_one",rules:[{required:!0,message:a({id:"please.enter"})}],children:(0,e.jsx)(Qn.Z,{min:1,style:{width:70},placeholder:a({id:"device.spec.size"}),disabled:qe||z.length===0})}),(0,e.jsx)("span",{style:{marginTop:"30px",background:"#fafafa",padding:"4px 10px",border:"1px solid #d9d9d9",borderLeft:"none"},children:"C"})]}),(0,e.jsxs)(v.Z,{span:16,style:{display:"flex",alignItems:"flex-start",paddingLeft:6},children:[(0,e.jsx)(V.Z.Item,{label:"",name:"instance_type_two",rules:[{required:!0,message:a({id:"please.enter"})}],children:(0,e.jsx)(Qn.Z,{min:1,style:{width:70,marginTop:30},placeholder:a({id:"device.spec.size"}),disabled:qe||z.length===0})}),(0,e.jsx)("span",{style:{marginTop:"30px",background:"#fafafa",padding:"4px 10px",border:"1px solid #d9d9d9",borderLeft:"none"},children:"G"})]})]})}):(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.instance_type"}),name:"instance_type",rules:[{required:!0,message:a({id:"please.select"})}],children:(0,e.jsx)(on.Z,{disabled:qe||z.length===0,showSearch:!0,placeholder:a({id:"please.select"}),optionFilterProp:"children",filterOption:function(f,l){return l.children.toLowerCase().indexOf(f.toLowerCase())>=0},onSelect:Wr,children:H==null?void 0:H.map(function(y,f){return(0,e.jsx)(ot,{value:y.Value,children:y.Value},f)})})})})}):null,Xe?Z?null:i==="aliyun_eci"?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.image"}),name:"image",rules:[{required:!0,message:a({id:"please.select"})}],children:(0,e.jsx)(lt.Z,{placeholder:a({id:"please.select"}),disabled:z.length===0,options:(0,re.Eu)(z,"platform"),displayRender:it,dropdownMatchSelectWidth:!0,dropdownClassName:Fn().selectCascader})})}):(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.image"}),name:"image",rules:[{required:!0,message:a({id:"please.select"})}],children:(0,e.jsx)(lt.Z,{placeholder:a({id:"please.select"}),disabled:z.length===0,options:(0,re.We)(z,"owner_alias","platform","os_name"),displayRender:it,dropdownMenuColumnStyle:{width:(724-48)/4},dropdownClassName:Fn().selectCascader})})}):null,Xe&&i!=="aliyun_eci"&&!Z?(0,e.jsx)(v.Z,{span:8,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.system.disk"}),name:"system_disk_category",rules:[{required:!0,message:a({id:"please.select"})}],children:Cn.length==0?(0,e.jsx)(on.Z,{placeholder:a({id:"device.resource.shortage"}),disabled:!0}):(0,e.jsx)(on.Z,{placeholder:a({id:"please.select"}),disabled:qe,children:Cn.map(function(y,f){return(0,e.jsx)(ot,{value:y.value,children:y.title},f)})})})}):null,Xe&&i!=="aliyun_eci"&&!Z?(0,e.jsxs)(v.Z,{span:4,style:{display:"flex",alignItems:"flex-start"},children:[(0,e.jsx)(V.Z.Item,{name:"system_disk_size",label:" ",rules:[{required:!1,message:a({id:"please.select"})}],children:(0,e.jsx)(Qn.Z,{placeholder:a({id:"device.spec.size"}),style:{width:70},min:20,max:500,disabled:qe||z.length===0})}),(0,e.jsx)("span",{style:{marginTop:"30px",background:"#fafafa",padding:"4px 10px",border:"1px solid #d9d9d9",borderLeft:"none"},children:"G"})]}):null,Xe&&i!=="aliyun_eci"&&!Z?(0,e.jsx)(v.Z,{span:4,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.storage_type"}),name:"storage_type",children:Cn.length==0?(0,e.jsx)(on.Z,{placeholder:a({id:"device.resource.shortage"}),disabled:!0}):(0,e.jsx)(on.Z,{placeholder:a({id:"please.select"}),disabled:qe,children:Cn.map(function(y,f){return(0,e.jsx)(ot,{value:y.value,children:y.title},f)})})})}):null,Xe&&i!=="aliyun_eci"&&!Z?(0,e.jsxs)(v.Z,{span:4,style:{display:"flex",alignItems:"flex-start"},children:[(0,e.jsx)(V.Z.Item,{name:"storage_size",label:" ",rules:[{required:!1,message:a({id:"please.enter"})}],children:(0,e.jsx)(Qn.Z,{placeholder:a({id:"device.spec.size"}),style:{width:70},min:20,max:500,disabled:qe||z.length===0})}),(0,e.jsx)("span",{style:{marginTop:"30px",background:"#fafafa",padding:"4px 10px",border:"1px solid #d9d9d9",borderLeft:"none"},children:"G"})]}):null,Xe&&i!=="aliyun_eci"&&!Z?(0,e.jsxs)(v.Z,{span:4,style:{display:"flex",alignItems:"flex-start"},children:[(0,e.jsx)(V.Z.Item,{name:"storage_number",label:" ",rules:[{required:!1,message:a({id:"please.enter"})}],children:(0,e.jsx)(Qn.Z,{placeholder:a({id:"device.quantity"}),style:{width:70},min:0,max:16,disabled:qe||z.length===0})}),(0,e.jsx)("span",{style:{marginTop:"30px",background:"#fafafa",padding:"4px 10px",border:"1px solid #d9d9d9",borderLeft:"none"},children:(0,e.jsx)(n._H,{id:"device.one"})})]}):null,Z?null:(0,e.jsx)(v.Z,{span:12,className:Fn().warp,children:(0,e.jsx)(V.Z.Item,{name:"bandwidth",label:(0,e.jsx)(n._H,{id:"device.bandwidth"}),rules:[{required:!0,message:a({id:"please.enter"})}],children:(0,e.jsx)(hn.Z,{type:"number",min:10,style:{width:"100%"},addonAfter:"Mbit/s",placeholder:a({id:"please.enter"})})})}),Z?null:(0,e.jsx)(v.Z,{span:24,className:Fn().warp,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(yt.f,{title:a({id:"device.extended.fields"}),desc:a({id:"device.aliyun.params"})}),labelAlign:"left",style:{marginBottom:0},children:(0,e.jsx)(V.Z.List,{name:"extra_param",children:function(f,l){var b=l.add,p=l.remove;return f.map(function(u,T){return(0,e.jsxs)(K.Z,{gutter:20,style:{marginBottom:8},children:[(0,e.jsx)(v.Z,{span:11,children:(0,e.jsxs)(K.Z,{children:[(0,e.jsx)(v.Z,{span:4,style:{paddingTop:4},children:(0,e.jsx)("span",{children:"Key:"})}),(0,e.jsx)(v.Z,{span:20,children:(0,e.jsx)(V.Z.Item,{name:[u.name,"param_key"],children:(0,e.jsx)(hn.Z,{})})})]})}),(0,e.jsx)(v.Z,{span:11,children:(0,e.jsxs)(K.Z,{children:[(0,e.jsx)(v.Z,{span:4,style:{paddingTop:4},children:(0,e.jsx)("span",{children:"Value:"})}),(0,e.jsx)(v.Z,{span:20,children:(0,e.jsx)(V.Z.Item,{name:[u.name,"param_value"],children:(0,e.jsx)(hn.Z,{})})})]})}),(0,e.jsx)(v.Z,{span:2,style:{paddingTop:5},children:(0,e.jsxs)(me.Z,{children:[T===f.length-1&&(0,e.jsx)(qt.Z,{onClick:function(){b()},style:{cursor:"pointer"}}),f.length>1&&(0,e.jsx)(rr,{style:{cursor:"pointer"},twoToneColor:"#E02020",onClick:function(){return p(u.name)}})]})})]},u.key)})}})})}),(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(It.Z,{})}),R==="cluster"?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{name:"kernel_install",label:(0,e.jsx)(n._H,{id:"device.kernel_install"}),rules:[{required:!0,message:a({id:"please.select"})}],children:(0,e.jsxs)(Mn.ZP.Group,{children:[(0,e.jsx)(Mn.ZP,{value:1,children:(0,e.jsx)(n._H,{id:"operation.yes"})}),(0,e.jsx)(Mn.ZP,{value:0,children:(0,e.jsx)(n._H,{id:"operation.no"})})]})})}):null,R==="cluster"?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.var_name"}),name:"var_name",rules:[{required:!0,message:a({id:"placeholder.enter.device.var_name"})}],children:(0,e.jsx)(hn.Z,{autoComplete:"off",placeholder:a({id:"please.enter"})})})}):null,R==="cluster"&&!!Z?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{name:"private_ip",label:(0,e.jsx)(yt.f,{title:a({id:"device.private_ip"}),desc:a({id:"device.private_ip.desc"})}),children:(0,e.jsx)(hn.Z,{autoComplete:"off",placeholder:a({id:"please.enter"})})})}):null,R==="standalone"?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(Dt.Z,(0,r.Z)({},Te))}):null,(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.channel_type"}),name:"channel_type",initialValue:"toneagent",rules:[{required:!0,message:a({id:"device.channel_type.message"})}],children:(0,e.jsx)(ir.k,{disabled:"opensource"})})}),Z?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.usage.state"}),name:"state",hasFeedback:!0,rules:[{required:!0,message:a({id:"device.usage.state.message"})}],initialValue:"Available",children:(0,e.jsxs)(on.Z,{placeholder:a({id:"device.usage.state.message"}),disabled:Vr,children:[(0,e.jsx)(on.Z.Option,{value:"Available",children:(0,e.jsx)(jt.Z,{status:"success",text:"Available"})}),(0,e.jsx)(on.Z.Option,{value:"Reserved",children:(0,e.jsx)(jt.Z,{status:"default",text:"Reserved"})}),(0,e.jsx)(on.Z.Option,{value:"Unusable",children:(0,e.jsx)(jt.Z,{status:"default",text:"Unusable"})})]})})}):null,(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.description"}),name:"description",children:(0,e.jsx)(hn.Z.TextArea,{rows:3,placeholder:a({id:"please.enter"})})})})]})})}),Je&&(0,e.jsx)(sr.Z,{onOk:Ur})]})},Ct=ur,ut=t(6895),St=t(77033),aa=t(16832),Hn=t(69827),cr=t(94293),we=t.n(cr),fr=(0,s.forwardRef)(function(be,k){var P,Z=(0,n.YB)(),ae=Z.formatMessage,R=(0,s.useState)(),de=(0,h.Z)(R,2),a=de[0],G=de[1],Je=(0,s.useState)(),ye=(0,h.Z)(Je,2),Ie=ye[0],ie=ye[1],Ce=(0,s.useState)(!1),Ae=(0,h.Z)(Ce,2),Q=Ae[0],We=Ae[1],De=(0,s.useState)(!0),Te=(0,h.Z)(De,2),Fe=Te[0],Ke=Te[1],Me=(0,s.useState)(!1),Be=(0,h.Z)(Me,2),Ne=Be[0],se=Be[1],he=(0,s.useRef)(null),Ze=function(){var J=(0,N.Z)((0,_.Z)().mark(function O(E){var an,H,S;return(0,_.Z)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return Ke(!0),w.next=3,(0,St.vq)({ip:E.private_ip,channel_type:E.channel_type});case 3:an=w.sent,H=an.code,S=an.data,We(H===200?S:E.channel_state),Ke(!1);case 8:case"end":return w.stop()}},O)}));return function(E){return J.apply(this,arguments)}}();(0,s.useImperativeHandle)(k,function(){return{show:function(O,E){se(!0),ie(E),G(O),Ze(O)}}});var fe=function(){se(!1),G(null)},Ue=function(O){var E;(E=he.current)===null||E===void 0||E.show((0,r.Z)((0,r.Z)({},O),{},{detailData:[O==null?void 0:O.private_ip],radio_type:"cloudManage"}))},Ve=function(){};return(0,e.jsxs)(_t.Z,{maskClosable:!1,keyboard:!1,forceRender:!0,title:(0,e.jsx)(n._H,{id:"device.details"}),width:"510",open:Ne,onClose:fe,children:[(0,e.jsxs)(kt.Z,{spinning:Fe,children:[(0,e.jsxs)(Hn.Z.Content,{style:{marginBottom:30},children:[(0,e.jsx)(F.Z.Text,{strong:!0,children:(0,e.jsx)(n._H,{id:"device.hardware"})}),!!Ie&&(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.instance.id"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:a==null?void 0:a.instance_id})]}),!!Ie&&(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.ip.address"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:a==null?void 0:a.private_ip})]}),(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsx)(v.Z,{span:6,children:"Region/Zone:"}),(0,e.jsx)(v.Z,{span:18,children:a==null?void 0:a.region_zone})]}),(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.instance_type"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:a==null?void 0:a.instance_type})]}),(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.bandwidth"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:a==null?void 0:a.bandwidth})]}),(a==null?void 0:a.manufacturer)!=="aliyun_eci"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.system.disk"}),":"]}),(0,e.jsxs)(v.Z,{span:18,children:[at(a==null?void 0:a.system_disk_category,ae),"/",a==null?void 0:a.system_disk_size,"G"]})]}),(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.storage_type"}),":"]}),(0,e.jsxs)(v.Z,{span:18,children:[at(a==null?void 0:a.storage_type,ae),"/",a==null?void 0:a.storage_size,"G/",a==null?void 0:a.storage_number,"\u4E2A"]})]})]})]}),(0,e.jsxs)(Hn.Z.Content,{style:{marginBottom:30},children:[(0,e.jsx)(F.Z.Text,{strong:!0,children:(0,e.jsx)(n._H,{id:"device.software"})}),(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.image"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:a==null?void 0:a.image_name})]})]}),!!Ie&&(0,e.jsxs)(Hn.Z.Content,{style:{marginBottom:30},children:[(0,e.jsx)(F.Z.Text,{strong:!0,children:(0,e.jsx)(n._H,{id:"device.usage.state"})}),(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.server.state"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:a==null?void 0:a.real_state})]})]}),!!Ie&&(0,e.jsxs)(Hn.Z.Content,{style:{marginBottom:30},children:[(0,e.jsx)(F.Z.Text,{strong:!0,children:(0,e.jsx)(n._H,{id:"device.channel_type"})}),(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsx)(v.Z,{span:6,children:"Channel:"}),(0,e.jsxs)(v.Z,{span:18,children:[(0,e.jsx)("span",{children:a==null?void 0:a.channel_type}),(0,e.jsx)("span",{className:we().btn_style,onClick:function(){return Ue(a)},children:(0,e.jsx)(n._H,{id:"device.redeploy"})})]})]}),(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.state"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:Q==null?void 0:Q.toString()})]})]}),JSON.stringify(a==null?void 0:a.extra_param)!=="{}"&&(0,e.jsxs)(Hn.Z.Content,{style:{marginBottom:30},children:[(0,e.jsx)(F.Z.Text,{strong:!0,children:(0,e.jsx)(n._H,{id:"device.extended.fields"})}),a==null||(P=a.extra_param)===null||P===void 0?void 0:P.map(function(J,O){return J.param_key&&J.param_value!==""&&(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsx)(v.Z,{span:6}),(0,e.jsxs)(v.Z,{span:18,children:[J.param_key,":",J.param_value]})]},O)})]}),(0,e.jsxs)(Hn.Z.Content,{style:{marginBottom:30},children:[(0,e.jsx)(F.Z.Text,{strong:!0,children:(0,e.jsx)(n._H,{id:"device.scheduling.label"})}),(0,e.jsx)(K.Z,{style:{marginTop:10},children:(a==null?void 0:a.tag_list)&&(a==null?void 0:a.tag_list.map(function(J){return(0,e.jsx)(mn.Z,{color:J.tag_color,children:J.name},J.id)}))})]}),(0,e.jsxs)(Hn.Z.Content,{children:[(0,e.jsx)(F.Z.Text,{strong:!0,children:(0,e.jsx)(n._H,{id:"device.others.info"})}),(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.machine.name"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:a==null?void 0:a.name})]}),(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsx)(v.Z,{span:6,children:"Owner:"}),(0,e.jsx)(v.Z,{span:18,children:a==null?void 0:a.owner_name})]}),(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.creation_time"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:a==null?void 0:a.gmt_created})]}),(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.modify_time"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:a==null?void 0:a.gmt_modified})]}),(0,e.jsxs)(K.Z,{gutter:20,className:we().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.description"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:a==null?void 0:a.description})]})]})]}),(0,e.jsx)(te.Z,{ref:he,callback:Ve})]})}),vr=fr,pr=t(97207),mr=t.n(pr),Et=t(46444),Pt=t(42847),hr=t(15122),Rt=t(94376),Lt=t(76742),$t=t(79390),le=t(6130),ct=t(20905),At=t(91959),gr=[{value:"toneagent",label:"ToneAgent"}].map(function(be){return{id:be.value,name:be.label}}),Zr=function(be){var k=be.tab,P=(0,Re.TH)(),Z=P.query,ae=(0,n.YB)(),R=ae.formatMessage,de=(0,n.Kd)()==="en-US",a=(0,Re.UO)(),G=a.ws_id,Je=(0,n.md)(),ye=(0,s.useRef)(null),Ie=(0,s.useState)(Object.prototype.toString.call(Z==null?void 0:Z.is_instance)==="[object String]"?+(Z==null?void 0:Z.is_instance):0),ie=(0,h.Z)(Ie,2),Ce=ie[0],Ae=ie[1],Q=(0,s.useState)(!0),We=(0,h.Z)(Q,2),De=We[0],Te=We[1],Fe=(0,s.useState)(!1),Ke=(0,h.Z)(Fe,2),Me=Ke[0],Be=Ke[1],Ne=(0,s.useState)({}),se=(0,h.Z)(Ne,2),he=se[0],Ze=se[1],fe=(0,s.useState)(!1),Ue=(0,h.Z)(fe,2),Ve=Ue[0],J=Ue[1],O=(0,s.useState)(!1),E=(0,h.Z)(O,2),an=E[0],H=E[1],S=(0,s.useState)({}),o=(0,h.Z)(S,2),w=o[0],z=o[1],X=(0,s.useState)(!0),He=(0,h.Z)(X,2),W=He[0],_n=He[1],xe=(0,s.useRef)(),Dn=(0,s.useRef)(null),On=(0,s.useRef)(null),Xe={t:k,page_num:1,page_size:10,ws_id:G},jn=(0,s.useState)((0,r.Z)((0,r.Z)({},Xe),Z)),En=(0,h.Z)(jn,2),c=En[0],ve=En[1],un=(0,re.YM)(c),Ge=function(d){return{filterDropdown:function(M){var L=M.confirm;return(0,e.jsx)(rn.Z,{confirm:L,value:c[d],onConfirm:function(ee){var g;return ve((0,r.Z)((0,r.Z)({},c),{},(g={},(0,dn.Z)(g,d,ee),(0,dn.Z)(g,"page_num",1),g)))}})},onFilterDropdownVisibleChange:function(M){M&&_n(!W)},filterIcon:function(){return(0,e.jsx)($e.Z,{style:{color:c[d]?"#1890ff":void 0}})}}},yn=function(d,i){return{filterIcon:function(){return(0,e.jsx)($e.Z,{style:{color:c[d]?"#1890ff":void 0}})},filterDropdown:function(L){var Se=L.confirm;return(0,e.jsx)(Pt.Z,{list:i,value:c[d],confirm:Se,onConfirm:function(g){var m;return ve((0,r.Z)((0,r.Z)({},c),{},(m={},(0,dn.Z)(m,d,g),(0,dn.Z)(m,"page_num",1),m)))}})}}},Cn=function(d,i){return{filterIcon:function(){return(0,e.jsx)($e.Z,{style:{color:c[d]?"#1890ff":void 0}})},filterDropdown:function(L){var Se=L.confirm;return(0,e.jsx)(hr.Z,{list:i,value:c[d],confirm:Se,onConfirm:function(g){var m;return ve((0,r.Z)((0,r.Z)({},c),{},(m={},(0,dn.Z)(m,d,g),(0,dn.Z)(m,"page_num",1),m)))}})}}},fn=function(){var x=(0,N.Z)((0,_.Z)().mark(function d(){var i,M,L;return(0,_.Z)().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return i=c.name,M=(0,r.Z)((0,r.Z)({},c),{},{is_instance:Boolean(+Ce),server_conf:i}),n.m8.replace("/ws/".concat(G,"/device/cloud?").concat((0,ct.stringify)((0,r.Z)((0,r.Z)({},M),{},{is_instance:M.is_instance?1:0})))),Te(!0),ee.next=6,(0,q.$x)(M);case 6:L=ee.sent,Te(!1),L&&Ze(L);case 9:case"end":return ee.stop()}},d)}));return function(){return x.apply(this,arguments)}}(),Kn=function(){var x=(0,N.Z)((0,_.Z)().mark(function d(i){var M,L,Se;return(0,_.Z)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,(0,q.vu)({server_id:i.id,server_provider:"aliyun"});case 2:M=g.sent,L=M.code,Se=M.msg,L===200?(ke.default.success(R({id:"device.synchronization.state.success"})),fn()):(0,re.EV)(L,Se);case 6:case"end":return g.stop()}},d)}));return function(i){return x.apply(this,arguments)}}(),gn=(0,re.YM)(he),qe=function(d){var i={0:R({id:"operation.not.release"}),1:R({id:"operation.release"}),2:R({id:"device.failed.save"})};return i[d]||""},I=+Ce,zn=function(d){var i;(i=Dn.current)===null||i===void 0||i.show((0,r.Z)((0,r.Z)({},d),{},{detailData:[d.private_ip],radio_type:"cloudManage"}))},Pn=(0,s.useCallback)(function(x){xe.current.show(x)},[]),_e=function(){var x=(0,N.Z)((0,_.Z)().mark(function d(i){var M,L,Se;return(0,_.Z)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,(0,q.kA)({id:i});case 3:M=g.sent,L=M.code,Se=M.msg,L===200?ke.default.success(R({id:"operation.success"})):(0,re.EV)(L,Se),g.next=12;break;case 9:g.prev=9,g.t0=g.catch(0),console.log(g.t0);case 12:case"end":return g.stop()}},d,null,[[0,9]])}));return function(i){return x.apply(this,arguments)}}(),Sn=mr().debounce(function(){var x=(0,N.Z)((0,_.Z)().mark(function d(i,M){var L,Se,ee;return(0,_.Z)().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return Be(!0),L=un.current.page_size,Se={ws_id:G,is_release:M},m.next=5,(0,q.BG)(i,Se);case 5:ee=m.sent,ee.code==200?(ve((0,r.Z)((0,r.Z)({},c),{},{page_num:(0,re.NG)(un,gn),page_size:L})),ke.default.success(R({id:"operation.success"})),J(!1),H(!1)):((0,re.EV)(ee.code,ee.msg),setTimeout(function(){J(!1),H(!1)},300)),Be(!1);case 8:case"end":return m.stop()}},d)}));return function(d,i){return x.apply(this,arguments)}}(),300),Wn=function(){var x=(0,N.Z)((0,_.Z)().mark(function d(i,M){var L;return(0,_.Z)().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return z((0,r.Z)((0,r.Z)({},i),{},{is_release:M})),ee.next=3,(0,St.Z9)({server_id:i.id,run_mode:"standalone",server_provider:"aliyun"});case 3:L=ee.sent,L.data.length>0?J(!0):H(!0);case 5:case"end":return ee.stop()}},d)}));return function(i,M){return x.apply(this,arguments)}}(),Bn=function(){var x=(0,N.Z)((0,_.Z)().mark(function d(){var i;return(0,_.Z)().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,(0,re.MR)({name:w.name,id:w.id});case 2:i=L.sent,i&&window.open("/ws/".concat(G,"/refenerce/6/?pk=").concat(i));case 4:case"end":return L.stop()}},d)}));return function(){return x.apply(this,arguments)}}();(0,s.useEffect)(function(){fn()},[c]);var Rn=function(d){Ae(d),ve(Xe),n.m8.push("/ws/".concat(G,"/device/cloud?").concat((0,ct.stringify)((0,r.Z)((0,r.Z)({},Z),{},{is_instance:d}))))},wn=function(){var d;(d=ye.current)===null||d===void 0||d.newMachine(void 0)},Xn=function(d){var i;(i=ye.current)===null||i===void 0||i.editMachine(d)},Nn=function(d){I==d?fn():ve((0,r.Z)((0,r.Z)({},c),{},{is_instance:d}))},Ln=[(0,r.Z)((0,r.Z)({title:I?(0,e.jsx)(n._H,{id:"device.instance.name"}):(0,e.jsx)(n._H,{id:"device.config.name"}),dataIndex:"name",width:140,fixed:"left",ellipsis:{showTitle:!1}},Ge("name")),{},{render:function(d,i){return(0,e.jsx)(le.K,{ellipsis:{tooltip:i.name},children:(0,e.jsx)(C(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[(c==null?void 0:c.name)||""],autoEscape:!0,textToHighlight:i.name.toString()})})}}),!!I&&(0,r.Z)((0,r.Z)({title:"IP",dataIndex:"private_ip",width:140},Ge("private_ip")),{},{ellipsis:{showTitle:!1},render:function(d,i){return(0,e.jsx)(ue.Z,{val:d,param:i.id,provider:"aliyun",machine_pool:!0})}}),!!I&&(0,r.Z)((0,r.Z)({title:"SN",dataIndex:"sn"},Ge("sn")),{},{width:140,ellipsis:{showTitle:!1},render:function(d,i){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:i.sn})}}),!!I&&{title:"TSN",dataIndex:"tsn",width:140,ellipsis:{showTitle:!1},render:function(d,i){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:i.tsn})}},!!I&&(0,r.Z)((0,r.Z)({title:"InstanceId",dataIndex:"instance_id"},Ge("instance_id")),{},{width:140,ellipsis:{showTitle:!1},render:function(d,i){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:i.instance_id})}}),(0,r.Z)((0,r.Z)({title:(0,e.jsx)(n._H,{id:"device.manufacturer/ak"}),dataIndex:"manufacturer"},Ge("manufacturer_ak_name")),{},{width:160,ellipsis:{showTitle:!1},render:function(d,i){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:"".concat(i.manufacturer,"/").concat(i.ak_name)})}}),(0,r.Z)((0,r.Z)({title:"Region/Zone",width:160,dataIndex:"region"},Ge("region_zone")),{},{ellipsis:{showTitle:!1},render:function(d,i){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:"".concat(i.region,"/").concat(i.zone)})}}),(0,r.Z)((0,r.Z)({title:(0,e.jsx)(n._H,{id:"device.instance_type"}),width:de?160:110,dataIndex:"instance_type"},Ge("instance_type")),{},{ellipsis:{showTitle:!1},render:function(d,i){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:i.instance_type})}}),(0,r.Z)((0,r.Z)({title:(0,e.jsx)(n._H,{id:"device.image"}),dataIndex:"image"},Ge("image")),{},{width:160,ellipsis:{showTitle:!1},render:function(d,i){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:i.image})}}),(0,r.Z)((0,r.Z)({title:(0,e.jsx)(n._H,{id:"device.bandwidth"}),width:de?120:70},Ge("bandwidth")),{},{dataIndex:"bandwidth",ellipsis:{showTitle:!1},render:function(d){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:d})}}),(0,r.Z)((0,r.Z)({title:(0,e.jsx)(n._H,{id:"device.storage_type"})},yn("storage_type",[["cloud",R({id:"device.cloud"})],["cloud_efficiency",R({id:"device.cloud_efficiency"})],["cloud_ssd",R({id:"device.cloud_ssd"})],["cloud_essd",R({id:"device.cloud_essd"})]].map(function(x){return{id:x[0],name:x[1]}}))),{},{dataIndex:"storage_type",width:de?130:90,ellipsis:{showTitle:!1},render:function(d,i){return(0,e.jsx)(st,{name:i.storage_type,formatMessage:R})}}),(0,r.Z)((0,r.Z)({title:(0,e.jsx)(n._H,{id:"device.release_rule"}),align:"center"},Cn("release_rule",[{id:0,name:R({id:"operation.not.release"})},{id:1,name:R({id:"operation.release"})},{id:2,name:R({id:"device.failed.save"})}])),{},{dataIndex:"release_rule",width:de?150:110,ellipsis:{showTitle:!1},render:function(d,i){return qe(i.release_rule)}}),{title:(0,e.jsx)(n._H,{id:"device.console_conf"}),width:de?170:100,dataIndex:"console_conf",ellipsis:{showTitle:!1},render:function(d){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:d})}},{title:(0,e.jsx)(n._H,{id:"device.channel_type"}),width:100,ellipsis:{showTitle:!1},dataIndex:"channel_type",filterIcon:function(){return(0,e.jsx)($e.Z,{style:{color:c!=null&&c.channel_type?"#1890ff":void 0}})},filterDropdown:function(d){var i=d.confirm;return(0,e.jsx)(Pt.Z,{list:gr,value:c==null?void 0:c.channel_type,confirm:i,onConfirm:function(L){return ve((0,r.Z)((0,r.Z)({},c),{},{channel_type:L,page_num:1}))}})}},!!I&&{title:(0,e.jsxs)(me.Z,{children:[(0,e.jsx)(n._H,{id:"device.usage.state"}),(0,e.jsx)(ln.Z,{title:R({id:"device.usage.state.Tooltip"}),children:(0,e.jsx)(Tn.Z,{})})]}),dataIndex:"state",width:de?150:120,ellipsis:{showTitle:!1},render:function(d,i){return(0,ut.Ul)(d,i,G)},filterIcon:function(){return(0,e.jsx)($e.Z,{style:{color:c!=null&&c.state?"#1890ff":void 0}})},filterDropdown:function(d){var i=d.confirm;return(0,e.jsx)(Et.Z,{confirm:i,onConfirm:function(L){return ve((0,r.Z)((0,r.Z)({},c),{},{state:L,page_num:1}))},value:c==null?void 0:c.state,tabType:I,dataArr:["Available","Occupied","Broken","Reserved","Unusable"]})}},!!I&&{title:(0,e.jsxs)(me.Z,{children:[(0,e.jsx)(n._H,{id:"device.real_state"}),(0,e.jsx)(ln.Z,{title:R({id:"device.real_state.Tooltip"}),children:(0,e.jsx)(Tn.Z,{})})]}),width:de?150:120,ellipsis:{showTitle:!1},dataIndex:"real_state",render:function(d,i){return(0,ut.Ul)(d,i,G)},filterIcon:function(){return(0,e.jsx)($e.Z,{style:{color:c!=null&&c.real_state?"#1890ff":void 0}})},filterDropdown:function(d){var i=d.confirm;return(0,e.jsx)(Et.Z,{confirm:i,onConfirm:function(L){return ve((0,r.Z)((0,r.Z)({},c),{},{real_state:L,page_num:1}))},value:c==null?void 0:c.real_state,tabType:I,dataArr:["Online","Offline"]})}},{title:"Owner",width:120,dataIndex:"owner_name",ellipsis:{showTitle:!1},filterIcon:function(){return(0,e.jsx)($e.Z,{style:{color:c!=null&&c.owner?"#1890ff":void 0}})},filterDropdown:function(d){var i=d.confirm;return(0,e.jsx)(U.Z,{value:c==null?void 0:c.owner,confirm:i,onConfirm:function(L){ve((0,r.Z)((0,r.Z)({},c),{},{owner:L,page_num:1}))}})}},{title:(0,e.jsx)(n._H,{id:"device.tag"}),dataIndex:"tags",width:240,ellipsis:{showTitle:!1},filterIcon:function(){var d;return(0,e.jsx)($e.Z,{style:{color:c!=null&&c.tags&&(c==null||(d=c.tags)===null||d===void 0?void 0:d.length)>0?"#1890ff":void 0}})},filterDropdown:function(d){var i=d.confirm;return(0,e.jsx)(In.Z,{value:c==null?void 0:c.tags,ws_id:G,run_mode:"standalone",autoFocus:W,confirm:i,onConfirm:function(L){ve((0,r.Z)((0,r.Z)({},c),{},{tags:L,page_num:1}))}})},render:function(d,i){return(0,e.jsx)(Rt.Z,{list:i.tag_list.map(function(M){return(0,e.jsx)(mn.Z,{color:M.tag_color,children:M.name},(0,At.Z)())})})}},(0,r.Z)((0,r.Z)({title:(0,e.jsx)(n._H,{id:"device.description"}),width:140,dataIndex:"description"},Ge("description")),{},{ellipsis:{showTitle:!1},render:function(d,i){return(0,e.jsx)(le.K,{ellipsis:{tooltip:i.description},children:(0,e.jsx)(C(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[(c==null?void 0:c.description)||""],autoEscape:!0,textToHighlight:i.description?i.description.toString():"-"})})}}),{title:(0,e.jsx)(n._H,{id:"Table.columns.operation"}),fixed:"right",valueType:"option",key:"operation",width:I?de?440:360:230,ellipsis:{showTitle:!1},render:function(d,i){return(0,e.jsxs)(me.Z,{children:[(0,e.jsx)(F.Z.Link,{onClick:function(){return On.current.show(i,I)},children:(0,e.jsx)(n._H,{id:"operation.detail"})}),(0,e.jsx)(n.Nv,{accessible:Je.WsMemberOperateSelf(i.owner),fallback:(0,e.jsxs)(me.Z,{onClick:function(){return(0,re.WR)()},children:[!!I&&(0,e.jsx)(F.Z.Link,{children:(0,e.jsx)(n._H,{id:"device.synchronization.state"})}),(0,e.jsx)(F.Z.Link,{children:(0,e.jsx)(n._H,{id:"operation.edit"})}),!!I&&(0,e.jsx)(F.Z.Link,{children:(0,e.jsx)(n._H,{id:"device.deploy"})}),!!I&&(0,e.jsx)(F.Z.Link,{children:(0,e.jsx)(n._H,{id:"operation.delete"})}),(0,e.jsx)(F.Z.Link,{children:I?(0,e.jsx)(n._H,{id:"operation.release"}):(0,e.jsx)(n._H,{id:"operation.delete"})})]}),children:(0,e.jsxs)(me.Z,{children:[!!I&&(0,e.jsx)(F.Z.Link,{onClick:function(){return Kn(i)},children:(0,e.jsx)(n._H,{id:"device.synchronization.state"})}),(0,e.jsx)(F.Z.Link,{onClick:function(){return Xn(i)},children:(0,e.jsx)(n._H,{id:"operation.edit"})}),!!I&&(0,e.jsx)(F.Z.Link,{onClick:function(){return zn(i)},children:(0,e.jsx)(n._H,{id:"device.deploy"})}),!!I&&(0,e.jsx)(F.Z.Link,{onClick:function(){return Wn((0,r.Z)({},i),!1)},children:(0,e.jsx)(n._H,{id:"operation.delete"})}),(0,e.jsx)(F.Z.Link,{onClick:function(){return Wn((0,r.Z)({},i),!!I)},children:I?(0,e.jsx)(n._H,{id:"operation.release"}):(0,e.jsx)(n._H,{id:"operation.delete"})})]})}),!!I&&(0,e.jsx)(F.Z.Link,{onClick:function(){return _e(i.id)},children:(0,e.jsx)(n._H,{id:"operation.sync.name"})}),(0,e.jsx)(F.Z.Link,{onClick:function(){return Pn(i.id)},children:(0,e.jsx)(n._H,{id:"operation.log"})})]})}}],Zn=w[I?"private_ip":"name"];return(0,e.jsxs)("div",{className:we().warp,children:[(0,e.jsxs)(ge.Z,{type:"card",onTabClick:Rn,activeKey:Ce+"",tabBarExtraContent:(0,e.jsx)(ne.Z,{type:"primary",onClick:wn,children:I?(0,e.jsx)(n._H,{id:"device.add.server.instance"}):(0,e.jsx)(n._H,{id:"device.add.server.config"})}),children:[(0,e.jsx)(ge.Z.TabPane,{tab:(0,e.jsx)(n._H,{id:"device.server.config"})},0),(0,e.jsx)(ge.Z.TabPane,{tab:(0,e.jsx)(n._H,{id:"device.server.instance"})},1)]}),(0,e.jsx)($t.sL,{size:"small",loading:De,columns:Ln,refreshDeps:[I,G,Je,de,c],name:"ws-cloud-server-standalone-".concat(I?"setting":"server"),dataSource:he.data,rowKey:"id",pagination:!1}),(0,e.jsx)(Lt.Z,{total:he.total,pageSize:c==null?void 0:c.page_size,currentPage:c==null?void 0:c.page_num,onPageChange:function(d,i){ve((0,r.Z)((0,r.Z)({},c),{},{page_num:d,page_size:i}))}}),(0,e.jsx)(xt.Z,{ref:xe,operation_object:"machine_cloud_server"}),(0,e.jsx)(Ct,{onRef:ye,is_instance:I,onSuccess:Nn,type:"standalone"}),(0,e.jsx)(te.Z,{ref:Dn}),(0,e.jsx)(vr,{ref:On}),(0,e.jsxs)(ze.Z,{title:(0,e.jsx)("div",{children:(0,e.jsx)(n._H,{id:I?"delete.tips":"device.tips"})}),centered:!0,open:Ve,onCancel:function(){return J(!1)},footer:[(0,e.jsx)(ne.Z,{type:"danger",onClick:function(){return Sn(w.id,w.is_release)},loading:Me,children:(0,e.jsx)(n._H,{id:w.is_release?"operation.release":"operation.confirm.delete"})},"submit"),(0,e.jsx)(ne.Z,{onClick:function(){return J(!1)},children:(0,e.jsx)(n._H,{id:"operation.cancel"})},"back")],width:600,maskClosable:!1,children:[(0,e.jsxs)("div",{style:{color:"red",marginBottom:5},children:[(0,e.jsx)(kn.Z,{style:{marginRight:4}}),(0,e.jsx)(n._H,{id:"device.delete.tips"})]}),(0,e.jsx)("div",{style:{color:"#1890FF",cursor:"pointer"},onClick:Bn,children:(0,e.jsx)(n._H,{id:"view.quote.details"})})]}),(0,e.jsx)(ze.Z,{title:(0,e.jsx)("div",{children:(0,e.jsx)(n._H,{id:I?"device.tips":"delete.tips"})}),centered:!0,open:an,onCancel:function(){return H(!1)},footer:[(0,e.jsx)(ne.Z,{type:"danger",onClick:function(){return Sn(w.id,w.is_release)},loading:Me,children:!I||!w.is_release?(0,e.jsx)(n._H,{id:"operation.confirm.delete"}):(0,e.jsx)(n._H,{id:"operation.release"})},"submit"),(0,e.jsx)(ne.Z,{onClick:function(){return H(!1)},children:(0,e.jsx)(n._H,{id:"operation.cancel"})},"back")],width:"30%",children:(0,e.jsx)("div",{style:{color:"red",marginBottom:5},children:(0,e.jsxs)(K.Z,{align:"middle",children:[(0,e.jsx)(kn.Z,{style:{marginRight:4,verticalAlign:"middle"}}),(0,e.jsxs)("div",{children:[(!I||!w.is_release)&&!I?R({id:"device.delete.config"},{data:Zn}):null,(!I||!w.is_release)&&!!I?R({id:"device.delete.instance"},{data:Zn}):null,!(!I||!w.is_release)&&!I?R({id:"device.release.config"},{data:Zn}):null,!(!I||!w.is_release)&&!!I?R({id:"device.release.instance"},{data:Zn}):null]})]})})})]})},ia=t(11407),xr=t(41604),_r=t(44461),jr=t.n(_r),yr=t(48766),Cr=t(81343),sa=t(20632),Sr=t(71853),wr=t(488),Ft=t(5888),Kt=t(38755),br=t(24480),wt=t.n(br),Tr=["test_server"],kr=function(k){var P=(0,n.YB)(),Z=P.formatMessage,ae=(0,n.Kd)()==="en-US",R=(0,Re.UO)(),de=R.ws_id,a=k.cluster_id,G=k.width,Je=k.onRef,ye=k.size,Ie=k.top,ie=k.is_instance,Ce=(0,s.useState)(!1),Ae=(0,h.Z)(Ce,2),Q=Ae[0],We=Ae[1],De=(0,s.useState)([]),Te=(0,h.Z)(De,2),Fe=Te[0],Ke=Te[1],Me=(0,s.useRef)(null),Be=(0,n.md)(),Ne=(0,s.useRef)(),se=function(){var H=(0,N.Z)((0,_.Z)().mark(function S(){var o,w;return(0,_.Z)().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return We(!0),X.next=3,(0,q.L0)({cluster_id:a}).catch(function(){return We(!1)});case 3:if(X.t0=X.sent,X.t0){X.next=6;break}X.t0={};case 6:w=X.t0,w.data=(o=w.data)===null||o===void 0?void 0:o.map(function(He){return He.machineId=He.id,(0,r.Z)((0,r.Z)({},He),He.test_server)}),Array.isArray(w.data)?Ke(w.data):Ke([]),We(!1);case 10:case"end":return X.stop()}},S)}));return function(){return H.apply(this,arguments)}}(),he=function(){var H=(0,N.Z)((0,_.Z)().mark(function S(o){var w,z,X;return(0,_.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.prev=0,W.next=3,(0,q.kA)({id:o});case 3:w=W.sent,z=w.code,X=w.msg,z===200?ke.default.success(Z({id:"operation.success"})):(0,re.EV)(z,X),W.next=12;break;case 9:W.prev=9,W.t0=W.catch(0),console.log(W.t0);case 12:case"end":return W.stop()}},S,null,[[0,9]])}));return function(o){return H.apply(this,arguments)}}(),Ze=(0,s.useCallback)(function(H){Ne.current.show(H)},[]),fe=function(){var H=(0,N.Z)((0,_.Z)().mark(function S(o,w){var z,X,He,W;return(0,_.Z)().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:if(o.machineId){xe.next=2;break}return xe.abrupt("return");case 2:return z=o.test_server,X=(0,wr.Z)(o,Tr),He=w==="role"?(0,r.Z)((0,r.Z)((0,r.Z)({},z),X),{},{role:"local"}):(0,r.Z)((0,r.Z)((0,r.Z)({},z),X),{},{baseline_server:1}),xe.next=6,(0,q.oz)(o.machineId,He);case 6:W=xe.sent,W.code===200?(ke.default.success(Z({id:"operation.success"})),se()):(0,re.EV)(W.code,W.msg);case 8:case"end":return xe.stop()}},S)}));return function(o,w){return H.apply(this,arguments)}}(),Ue=function(S){var o={0:Z({id:"operation.not.release"}),1:Z({id:"operation.release"}),2:Z({id:"device.failed.save"})};return o[S]||""},Ve=function(){var H=(0,N.Z)((0,_.Z)().mark(function S(o){var w,z,X;return(0,_.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,(0,q.vu)({server_id:o.server_id,server_provider:"aliyun"});case 2:w=W.sent,z=w.code,X=w.msg,z===200?(ke.default.success(Z({id:"device.synchronization.state.success"})),se()):(0,re.EV)(z,X);case 6:case"end":return W.stop()}},S)}));return function(o){return H.apply(this,arguments)}}(),J=function(S){Me.current&&Me.current.editMachine((0,r.Z)((0,r.Z)({},S),{},{cluster_id:a}))},O=function(){var H=(0,N.Z)((0,_.Z)().mark(function S(o){var w,z,X;return(0,_.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,(0,q.XW)(o.machineId);case 2:w=W.sent,z=w.code,X=w.msg,z===200?(se(),ke.default.success(Z({id:"request.delete.success"}))):ke.default.success(X);case 6:case"end":return W.stop()}},S)}));return function(o){return H.apply(this,arguments)}}();(0,s.useImperativeHandle)(Je,function(){return{reload:function(){se()}}});var E=[{title:ie?(0,e.jsx)(n._H,{id:"device.server.instance"}):(0,e.jsx)(n._H,{id:"device.server.config"}),dataIndex:"name",width:160,fixed:"left",ellipsis:{showTitle:!1},render:function(S,o){return ie?(0,e.jsx)(ue.Z,{val:S,param:o.id,provider:"aliyun",machine_pool:!0}):(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:o.name})}},!!ie&&{title:"SN",dataIndex:"sn",width:150,ellipsis:{showTitle:!1},render:function(S,o){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:o.sn})}},!!ie&&{title:"TSN",dataIndex:"tsn",width:150,ellipsis:{showTitle:!1},render:function(S,o){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:o.tsn})}},!1,{title:(0,e.jsx)(n._H,{id:"device.manufacturer/ak"}),dataIndex:"manufacturer",width:120,ellipsis:{showTitle:!1},render:function(S,o){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:"".concat(o.manufacturer,"/").concat(o.ak_name)})}},{title:"Region/Zone",width:120,ellipsis:{showTitle:!1},dataIndex:"region",render:function(S,o){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:"".concat(o.region,"/").concat(o.zone)})}},{title:(0,e.jsx)(n._H,{id:"device.instance_type"}),dataIndex:"instance_type",width:120,ellipsis:{showTitle:!1},render:function(S,o){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:o.instance_type})}},{title:(0,e.jsx)(n._H,{id:"device.image"}),width:120,ellipsis:{showTitle:!1},dataIndex:"image",render:function(S,o){return(0,e.jsx)(le.K,{ellipsis:{tooltip:o.image},children:o.image_name})}},{title:(0,e.jsx)(n._H,{id:"device.bandwidth"}),width:100,dataIndex:"bandwidth"},{title:(0,e.jsx)(n._H,{id:"device.storage_type"}),dataIndex:"storage_type",ellipsis:{showTitle:!1},width:100,render:function(S,o){return(0,e.jsx)(st,{name:o.storage_type,formatMessage:Z})}},{title:(0,e.jsx)(n._H,{id:"device.console_conf"}),width:ae?170:100,ellipsis:{showTitle:!1},dataIndex:"console_conf",render:function(S,o){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:o.console_conf})}},{title:(0,e.jsx)(n._H,{id:"device.release_rule"}),dataIndex:"release_rule",width:ae?150:110,ellipsis:{showTitle:!1},render:function(S,o){return Ue(o.release_rule)}},{title:(0,e.jsx)(n._H,{id:"device.private_ip"}),width:160,ellipsis:{showTitle:!1},dataIndex:"private_ip",render:function(S,o){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:o.private_ip})}},{title:(0,e.jsx)(n._H,{id:"device.channel_type"}),dataIndex:"channel_type",width:100,ellipsis:{showTitle:!1},render:function(S,o){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:o.channel_type})}},{title:"Owner",width:100,ellipsis:{showTitle:!1},dataIndex:"owner_name",render:function(S,o){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:o.owner_name})}},{title:(0,e.jsx)(n._H,{id:"device.local.server"}),dataIndex:"role",width:120,align:"center",render:function(S,o){return o.role==="local"?(0,e.jsx)(Ft.Z,{style:{width:17.5,height:17.5,color:"#1890ff"}}):(0,e.jsx)(Kt.Z,{onClick:function(){return fe(o,"role")},style:{cursor:"pointer",width:17.5,height:17.5,color:"rgba(0,0,0,.1)"}})}},{title:(0,e.jsx)(n._H,{id:"device.baseline_server"}),dataIndex:"baseline_server",width:140,align:"center",render:function(S,o){return S?(0,e.jsx)(Ft.Z,{style:{width:17.5,height:17.5,color:"#1890ff"}}):(0,e.jsx)(Kt.Z,{onClick:function(){return fe(o,"baseline_server")},style:{cursor:"pointer",width:17.5,height:17.5,color:"rgba(0,0,0,.1)"}})}},{title:(0,e.jsx)(n._H,{id:"device.install.kernel"}),dataIndex:"kernel_install",width:120,render:function(S){return S?(0,e.jsx)(n._H,{id:"operation.yes"}):(0,e.jsx)(n._H,{id:"operation.no"})}},{title:(0,e.jsx)(n._H,{id:"device.var_name"}),dataIndex:"var_name",width:ae?170:110,ellipsis:{showTitle:!1}},!!ie&&{title:(0,e.jsx)(n._H,{id:"device.server.state"}),width:120,dataIndex:"state",ellipsis:{showTitle:!1},render:function(S,o){return(0,ut.Ul)(o.test_server.state,o.test_server,de)}},!!ie&&{title:(0,e.jsx)(n._H,{id:"device.real_state"}),width:160,dataIndex:"real_state",ellipsis:{showTitle:!1},render:function(S,o){return(0,ut.Ul)(o.test_server.real_state,o.test_server,de)}},{title:(0,e.jsx)(n._H,{id:"device.description"}),width:120,ellipsis:{showTitle:!1},dataIndex:"description",render:function(S,o){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},width:100,children:o.description})}},{title:(0,e.jsx)(n._H,{id:"Table.columns.operation"}),fixed:"right",valueType:"option",key:"operation",width:ae?300:260,render:function(S,o){return(0,e.jsxs)(me.Z,{children:[(0,e.jsx)(n.Nv,{accessible:Be.WsMemberOperateSelf(o.test_server.owner),fallback:(0,e.jsxs)(me.Z,{children:[!!ie&&(0,e.jsx)(F.Z.Link,{onClick:function(){return(0,re.WR)()},children:(0,e.jsx)(n._H,{id:"device.synchronization.state"})}),(0,e.jsx)(F.Z.Link,{onClick:function(){return(0,re.WR)()},children:(0,e.jsx)(n._H,{id:"operation.edit"})}),(0,e.jsx)(F.Z.Link,{onClick:function(){return(0,re.WR)()},children:(0,e.jsx)(n._H,{id:"operation.delete"})})]}),children:(0,e.jsxs)(me.Z,{children:[!!ie&&(0,e.jsx)(F.Z.Link,{onClick:function(){return Ve(o)},children:(0,e.jsx)(n._H,{id:"device.synchronization.state"})}),(0,e.jsx)(F.Z.Link,{onClick:function(){J(o)},children:(0,e.jsx)(n._H,{id:"operation.edit"})}),(0,e.jsx)(Sr.Z,{title:(0,e.jsx)(F.Z.Text,{type:"danger",children:Z({id:"delete.prompt"},{data:"(".concat(o.name,")")})}),placement:"topRight",okText:(0,e.jsx)(n._H,{id:"operation.cancel"}),cancelText:(0,e.jsx)(n._H,{id:"operation.confirm.delete"}),onCancel:function(){O(o)},overlayStyle:{width:"280px"},icon:(0,e.jsx)(kn.Z,{style:{color:"red"}}),children:(0,e.jsx)(F.Z.Link,{children:(0,e.jsx)(n._H,{id:"operation.delete"})})})]})}),!!ie&&(0,e.jsx)(F.Z.Link,{onClick:function(){return he(o.server_id)},children:(0,e.jsx)(n._H,{id:"operation.sync.name"})}),(0,e.jsx)(F.Z.Link,{onClick:function(){return Ze(o.id)},children:(0,e.jsx)(n._H,{id:"operation.log"})})]})}}];(0,s.useEffect)(function(){se()},[]);var an=function(){se()};return(0,e.jsxs)("div",{className:wt().warp,children:[(0,e.jsx)("div",{className:wt().tree,style:{backgroundSize:"40px ".concat(ye,"px"),height:Ie,backgroundPosition:"left center"}}),!!Fe.length&&(0,e.jsx)("div",{className:wt().tree,style:{backgroundSize:"40px ".concat(ye,"px"),height:ye*Fe.length+30,top:Ie}}),(0,e.jsx)($t.sL,{style:{width:G-79},loading:Q,scroll:{x:"100%"},columns:E,refreshDeps:[ie,de,ae],name:"ws-cloud-device-group",showHeader:!!Fe.length,dataSource:Fe,rowKey:"id",pagination:!1}),(0,e.jsx)(xt.Z,{ref:Ne,operation_object:"machine_cloud_server"}),(0,e.jsx)(Ct,{onRef:Me,is_instance:ie,onSuccess:an,type:"cluster",cluster_id:a})]})},Ir=kr,Mr=function(k){var P=k.outParam,Z=k.tagFlag,ae=k.is_instance,R=k.params,de=k.setParams,a=(0,n.YB)(),G=a.formatMessage,Je=(0,Re.UO)(),ye=Je.ws_id,Ie=V.Z.useForm(),ie=(0,h.Z)(Ie,1),Ce=ie[0],Ae=(0,s.useState)(!1),Q=(0,h.Z)(Ae,2),We=Q[0],De=Q[1],Te=(0,s.useState)({}),Fe=(0,h.Z)(Te,2),Ke=Fe[0],Me=Fe[1];(0,s.useEffect)(function(){Ce.resetFields(),JSON.stringify(P)!=="{}"&&setTimeout(function(){var se,he=((se=P.tag_list)===null||se===void 0?void 0:se.map(function(Ze){return Ze.id}))||[];Ce.setFieldsValue((0,r.Z)((0,r.Z)({},P),{},{tags:he}))},1)},[P]),(0,s.useEffect)(function(){JSON.stringify(Z)!=="{}"&&!!Z.isQuery.length&&De(!0)},[Z]);var Be=function(){var se=(0,N.Z)((0,_.Z)().mark(function he(Ze){var fe,Ue,Ve,J;return(0,_.Z)().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(JSON.stringify(P)==="{}"){E.next=15;break}return fe={description:Ze.description||"",tags:Ze.tags,emp_id:Ze.emp_id,name:Ze.name,ws_id:ye},E.next=4,(0,q.Tv)(P.id,fe);case 4:if(E.t0=E.sent,E.t0){E.next=7;break}E.t0={};case 7:if(Ue=E.t0,Ue.code!==200){E.next=13;break}return De(!1),ke.default.success(G({id:"operation.success"})),de((0,r.Z)((0,r.Z)({},R),{},{refresh:!R.refresh})),E.abrupt("return");case 13:return Me((0,r.Z)((0,r.Z)({},Ue),{},{error:!0})),E.abrupt("return");case 15:return Ve=(0,r.Z)((0,r.Z)({},Ze),{},{ws_id:ye,is_instance:String(ae)}),Ve.description=Ze.description||"",Ve.cluster_type="aliyun",E.next=20,(0,q.Rp)((0,r.Z)({},Ve));case 20:if(J=E.sent,J.code!==200){E.next=26;break}return De(!1),ke.default.success(G({id:"operation.success"})),de((0,r.Z)((0,r.Z)({},R),{},{page:1,refresh:!R.refresh})),E.abrupt("return");case 26:Me((0,r.Z)((0,r.Z)({},J),{},{error:!0}));case 27:case"end":return E.stop()}},he)}));return function(Ze){return se.apply(this,arguments)}}(),Ne=function(){Ce.validateFields().then(function(he){return Be(he)})};return(0,e.jsx)(_t.Z,{maskClosable:!1,keyboard:!1,title:JSON.stringify(P)!=="{}"?(0,e.jsx)(n._H,{id:"device.cluster.edit"}):(0,e.jsx)(n._H,{id:"device.cluster.btn"}),width:376,onClose:function(){return De(!1)},open:We,bodyStyle:{paddingBottom:80},footer:(0,e.jsxs)("div",{style:{textAlign:"right"},children:[(0,e.jsx)(ne.Z,{onClick:function(){return De(!1)},style:{marginRight:8},children:(0,e.jsx)(n._H,{id:"operation.cancel"})}),(0,e.jsx)(ne.Z,{type:"primary",onClick:function(){return Ne()},children:JSON.stringify(P)!=="{}"?(0,e.jsx)(n._H,{id:"operation.update"}):(0,e.jsx)(n._H,{id:"operation.ok"})})]}),children:(0,e.jsx)(V.Z,{layout:"vertical",form:Ce,children:(0,e.jsxs)(K.Z,{gutter:16,children:[(0,e.jsx)(v.Z,{span:24,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.cluster.name.s"}),name:"name",rules:[{required:!0,message:G({id:"device.cluster.name.s.message"})}],validateStatus:Ke.error?"error":void 0,help:Ke.msg==="cluster existed"?G({id:"device.cluster.name.s.existed"}):Ke.msg,children:(0,e.jsx)(hn.Z,{autoComplete:"off",placeholder:G({id:"please.enter"}),onChange:function(he){return Me({})}})})}),(0,e.jsx)(v.Z,{span:24,children:(0,e.jsx)(It.Z,{})}),(0,e.jsx)(v.Z,{span:24,children:(0,e.jsx)(Dt.Z,(0,r.Z)({},Z))}),(0,e.jsx)(v.Z,{span:24,children:(0,e.jsx)(V.Z.Item,{name:"description",label:(0,e.jsx)(n._H,{id:"device.description"}),children:(0,e.jsx)(hn.Z.TextArea,{rows:3,placeholder:G({id:"please.enter"})})})})]})})})},Hr=Mr,Dr=t(77740),Or=function(k){var P=k.tab,Z=(0,Re.TH)(),ae=Z.query,R=(0,n.YB)(),de=R.formatMessage,a=(0,Re.UO)(),G=a.ws_id,Je=V.Z.useForm(),ye=(0,h.Z)(Je,1),Ie=ye[0],ie=(0,n.md)(),Ce=(0,s.useRef)(null),Ae=(0,s.useRef)(null),Q=(0,s.useRef)(null),We=(0,s.useState)(Object.prototype.toString.call(ae==null?void 0:ae.is_instance)==="[object String]"?+(ae==null?void 0:ae.is_instance):0),De=(0,h.Z)(We,2),Te=De[0],Fe=De[1],Ke=(0,s.useState)(!1),Me=(0,h.Z)(Ke,2),Be=Me[0],Ne=Me[1],se=(0,s.useState)({}),he=(0,h.Z)(se,2),Ze=he[0],fe=he[1],Ue={t:P,refresh:!0,page_num:1,page_size:10,name:"",owner:"",tags:"",description:"",cluster_type:"aliyun",ws_id:G},Ve=(0,s.useState)((0,r.Z)((0,r.Z)({},Ue),ae)),J=(0,h.Z)(Ve,2),O=J[0],E=J[1],an=(0,s.useState)({list:[],isQuery:""}),H=(0,h.Z)(an,2),S=H[0],o=H[1],w=(0,s.useState)({}),z=(0,h.Z)(w,2),X=z[0],He=z[1],W=(0,s.useState)([]),_n=(0,h.Z)(W,2),xe=_n[0],Dn=_n[1],On=39,Xe=41,jn=(0,s.useState)(!1),En=(0,h.Z)(jn,2),c=En[0],ve=En[1],un=(0,s.useState)({}),Ge=(0,h.Z)(un,2),yn=Ge[0],Cn=Ge[1],fn=(0,s.useState)(!0),Kn=(0,h.Z)(fn,2),gn=Kn[0],qe=Kn[1],I=(0,s.useRef)(),zn=(0,s.useRef)(),Pn=(0,re.YM)(O),_e=(0,s.useCallback)(function(g){I.current.show(g)},[]),Sn=function(){var g=(0,N.Z)((0,_.Z)().mark(function m(){var j,A,Y=arguments;return(0,_.Z)().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return j=Y.length>0&&Y[0]!==void 0?Y[0]:{},Ne(!0),ce.next=4,(0,q.Sy)((0,r.Z)({},j));case 4:A=ce.sent,n.m8.replace("/ws/".concat(G,"/device/cloud?").concat((0,ct.stringify)((0,r.Z)((0,r.Z)({},j),{},{is_instance:j.is_instance?1:0})))),A&&fe(A),Ne(!1);case 8:case"end":return ce.stop()}},m)}));return function(){return g.apply(this,arguments)}}(),Wn=(0,re.YM)(Ze),Bn=function(){He({}),o((0,r.Z)((0,r.Z)({},S),{},{isQuery:"add",list:[]})),Ie.resetFields()};(0,s.useEffect)(function(){Sn((0,r.Z)((0,r.Z)({},O),{},{is_instance:+Te}))},[O,Te]);var Rn=(0,Jn.CR)(),wn=Rn.width,Xn=function(m){var j=m.tag_list.map(function(A){return A.id});o((0,r.Z)((0,r.Z)({},S),{},{isQuery:"edit",list:j})),He((0,r.Z)({},m))},Nn=function(){var g=(0,N.Z)((0,_.Z)().mark(function m(j){var A,Y;return(0,_.Z)().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return Cn(j),ce.next=3,(0,St.Z9)({server_id:j.id,run_mode:"cluster",server_provider:"aliyun"});case 3:A=ce.sent,A.data.length>0?ve(!0):(Y=zn.current)===null||Y===void 0||Y.show(j,"(".concat(j.name,")"));case 5:case"end":return ce.stop()}},m)}));return function(j){return g.apply(this,arguments)}}(),Ln=function(){var g=(0,N.Z)((0,_.Z)().mark(function m(j){var A,Y,en,ce,vn;return(0,_.Z)().wrap(function($n){for(;;)switch($n.prev=$n.next){case 0:return A={ws_id:G},Y=Pn.current.page_size,$n.next=4,(0,q.rc)(j,A);case 4:en=$n.sent,ce=en.code,vn=en.msg,ce===200?(ke.default.success(de({id:"operation.success"})),ve(!1),E((0,r.Z)((0,r.Z)({},O),{},{page_num:(0,re.NG)(Pn,Wn),page_size:Y}))):(0,re.EV)(ce,vn);case 8:case"end":return $n.stop()}},m)}));return function(j){return g.apply(this,arguments)}}(),Zn=function(){var g=(0,N.Z)((0,_.Z)().mark(function m(j,A){var Y,en;return(0,_.Z)().wrap(function(vn){for(;;)switch(vn.prev=vn.next){case 0:Y=A.id+"",en=j?xe.concat([Y]):xe.filter(function(qn){return qn!==Y}),Dn(en);case 3:case"end":return vn.stop()}},m)}));return function(j,A){return g.apply(this,arguments)}}(),x=function(m){Ce.current&&Ce.current.newMachine(m)},d=function(){var g=(0,N.Z)((0,_.Z)().mark(function m(){var j;return(0,_.Z)().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.next=2,(0,re.MR)({name:yn.name,id:yn.id});case 2:j=Y.sent,j&&window.open("/ws/".concat(G,"/refenerce/7/?pk=").concat(j));case 4:case"end":return Y.stop()}},m)}));return function(){return g.apply(this,arguments)}}(),i=function(m){var j=m.parentId;if(j&&xe.indexOf(j+"")<0){var A=xe.concat([j+""]);Dn(A)}Ae.current&&Ae.current.reload("add",{parentRowId:j})},M=function(m){return{filterDropdown:function(A){var Y=A.confirm;return(0,e.jsx)(rn.Z,{confirm:Y,onConfirm:function(ce){return E((0,r.Z)((0,r.Z)({},O),{},(0,dn.Z)({page_num:1},m,ce)))}})},onFilterDropdownVisibleChange:function(A){A&&qe(!gn)},filterIcon:function(){return(0,e.jsx)($e.Z,{style:{color:O[m]?"#1890ff":void 0}})}}},L=[(0,r.Z)((0,r.Z)({title:(0,e.jsx)(n._H,{id:"device.cluster.name"}),dataIndex:"name",width:150},M("name")),{},{render:function(m,j){return(0,e.jsx)(le.K,{ellipsis:{tooltip:j.name},children:(0,e.jsx)(C(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[O.name||""],autoEscape:!0,textToHighlight:j.name.toString()})})}}),{title:"Owner",dataIndex:"owner_name",width:150,filterIcon:function(){return(0,e.jsx)($e.Z,{style:{color:O.owner?"#1890ff":void 0}})},filterDropdown:function(m){var j=m.confirm;return(0,e.jsx)(U.Z,{autoFocus:gn,confirm:j,onConfirm:function(Y){E((0,r.Z)((0,r.Z)({},O),{},{page_num:1,owner:Y}))}})},onFilterDropdownVisibleChange:function(m){m&&qe(!gn)},render:function(m,j){return(0,e.jsx)(le.K,{ellipsis:{tooltip:!0},children:j.owner_name})}},{title:(0,e.jsx)(n._H,{id:"device.tag"}),dataIndex:"tag_list",ellipsis:{showTitle:!1},width:240,filterIcon:function(){return(0,e.jsx)($e.Z,{style:{color:O.tags&&O.tags.length>0?"#1890ff":void 0}})},filterDropdown:function(m){var j=m.confirm;return(0,e.jsx)(In.Z,{ws_id:G,run_mode:"cluster",autoFocus:gn,confirm:j,onConfirm:function(Y){E((0,r.Z)((0,r.Z)({},O),{},{page_num:1,tags:Y}))}})},render:function(m,j){return(0,e.jsx)(Rt.Z,{list:j.tag_list.map(function(A){return(0,e.jsx)(mn.Z,{color:A.tag_color,children:A.name},(0,At.Z)())})})}},(0,r.Z)((0,r.Z)({title:(0,e.jsx)(n._H,{id:"device.description"}),dataIndex:"description",width:300},M("description")),{},{render:function(m,j){return(0,e.jsx)(le.K,{ellipsis:{tooltip:j.description},children:(0,e.jsx)(C(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[O.description||""],autoEscape:!0,textToHighlight:j.description?j.description.toString():"-"})})}}),{title:(0,e.jsx)(n._H,{id:"Table.columns.operation"}),valueType:"option",dataIndex:"id",width:180,render:function(m,j){return(0,e.jsxs)(me.Z,{children:[(0,e.jsx)(ne.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){x(j.id)},children:(0,e.jsx)(n._H,{id:"operation.add"})}),(0,e.jsx)(n.Nv,{accessible:ie.WsMemberOperateSelf(j.owner),fallback:(0,e.jsxs)(me.Z,{children:[(0,e.jsx)(ne.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return(0,re.WR)()},children:(0,e.jsx)(n._H,{id:"operation.edit"})}),(0,e.jsx)(ne.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return(0,re.WR)()},children:(0,e.jsx)(n._H,{id:"operation.delete"})})]}),children:(0,e.jsxs)(me.Z,{children:[(0,e.jsx)(ne.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return Xn(j)},children:(0,e.jsx)(n._H,{id:"operation.edit"})}),(0,e.jsx)(ne.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return Nn(j)},children:(0,e.jsx)(n._H,{id:"operation.delete"})})]})}),(0,e.jsx)(ne.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return _e(j.id)},children:(0,e.jsx)(n._H,{id:"operation.log"})})]})}}],Se=function(m){Fe(m),E(Ue),n.m8.replace("/ws/".concat(G,"/device/cloud?").concat((0,ct.stringify)((0,r.Z)((0,r.Z)({},ae),{},{isInstance:m}))))},ee=+Te;return(0,e.jsxs)("div",{className:jr().warp,children:[(0,e.jsxs)(ge.Z,{type:"card",onTabClick:Se,activeKey:Te+"",tabBarExtraContent:(0,e.jsx)(ne.Z,{type:"primary",onClick:Bn,children:ee?(0,e.jsx)(n._H,{id:"device.add.cluster.instance"}):(0,e.jsx)(n._H,{id:"device.add.cluster.config"})}),children:[(0,e.jsx)(ge.Z.TabPane,{tab:(0,e.jsx)(n._H,{id:"device.cluster.config"})},0),(0,e.jsx)(ge.Z.TabPane,{tab:(0,e.jsx)(n._H,{id:"device.cluster.instance"})},1)]}),(0,e.jsx)(xr.Z,{size:"small",loading:Be,columns:L,dataSource:Ze.data,rowKey:function(m){return m.id+""},pagination:!1,expandable:{expandedRowRender:function(m){return(0,e.jsx)(Ir,{onRef:Ae,size:Xe,top:On,is_instance:ee,width:wn-200-68,cluster_id:m.id})},onExpand:function(m,j){Zn(m,j)},expandedRowKeys:xe,expandIcon:function(m){var j=m.expanded,A=m.onExpand,Y=m.record;return j?(0,e.jsx)(yr.Z,{onClick:function(ce){return A(Y,ce)}}):(0,e.jsx)(Cr.Z,{onClick:function(ce){return A(Y,ce)}})}}}),(0,e.jsx)(K.Z,{justify:"space-between",style:{padding:"16px 20px 0"},ref:Q,children:(0,e.jsx)(Lt.Z,{total:Ze.total,pageSize:O==null?void 0:O.page_size,currentPage:O==null?void 0:O.page_num,onPageChange:function(m,j){E((0,r.Z)((0,r.Z)({},O),{},{page_num:m,page_size:j}))}})}),(0,e.jsx)(Hr,{outParam:X,tagFlag:S,is_instance:ee,params:O,setParams:E}),(0,e.jsx)(xt.Z,{ref:I,operation_object:"machine_cluster_aliyun"}),(0,e.jsx)(Ct,{onRef:Ce,is_instance:ee,onSuccess:i,type:"cluster"}),(0,e.jsxs)(ze.Z,{title:(0,e.jsx)(n._H,{id:"delete.tips"}),centered:!0,open:c,onCancel:function(){return ve(!1)},footer:[(0,e.jsx)(ne.Z,{onClick:function(){return Ln(yn.id)},children:(0,e.jsx)(n._H,{id:"operation.confirm.delete"})},"submit"),(0,e.jsx)(ne.Z,{type:"primary",onClick:function(){return ve(!1)},children:(0,e.jsx)(n._H,{id:"operation.cancel"})},"back")],width:600,maskClosable:!1,children:[(0,e.jsxs)("div",{style:{color:"red",marginBottom:5},children:[(0,e.jsx)(kn.Z,{style:{marginRight:4}}),(0,e.jsx)(n._H,{id:"device.cluster.delete.tips"})]}),(0,e.jsx)("div",{style:{color:"#1890FF",cursor:"pointer"},onClick:d,children:(0,e.jsx)(n._H,{id:"view.quote.details"})})]}),(0,e.jsx)(Dr.Z,{ref:zn,onOk:function(m){var j=m.id;return Ln(j)}})]})},Er=(0,s.forwardRef)(Or),Pr=t(75073),Rr=function(){var be=(0,Re.UO)(),k=be.ws_id,P=(0,Re.TH)(),Z=P.query.t,ae=ge.Z.TabPane,R=(0,s.useState)(Z!=null?Z:"standalone"),de=(0,h.Z)(R,2),a=de[0],G=de[1],Je=(0,s.useState)(new Date().getTime()),ye=(0,h.Z)(Je,2),Ie=ye[0],ie=ye[1],Ce=function(Q){G(Q),ie(new Date().getTime()),n.m8.push("/ws/".concat(k,"/device/cloud?t=").concat(Q))};return(0,e.jsx)(Pr.mQ,{title:(0,e.jsxs)(ge.Z,{defaultActiveKey:"1",onTabClick:Ce,activeKey:a,children:[(0,e.jsx)(ae,{tab:(0,e.jsx)(n._H,{id:"standalone"})},"standalone"),(0,e.jsx)(ae,{tab:(0,e.jsx)(n._H,{id:"cluster"})},"cluster")]}),children:a==="standalone"?(0,e.jsx)(Zr,{tab:a},Ie):(0,e.jsx)(Er,{tab:a},Ie)})}},75667:function(Ee,cn,t){"use strict";t.d(cn,{$x:function(){return Re},X6:function(){return An},cm:function(){return sn},BG:function(){return pn},BS:function(){return mn},Ti:function(){return Gn},iB:function(){return me},F$:function(){return tt},x1:function(){return ln},Sy:function(){return ke},Rp:function(){return _},Tv:function(){return N},rc:function(){return dn},aB:function(){return r},Yh:function(){return $e},mN:function(){return Tn},L0:function(){return e},MH:function(){return Yn},oz:function(){return at},XW:function(){return it},vu:function(){return st},kA:function(){return Zt}});var h=t(35832),Pe=t(20418),ge=t(32326),s=t(22812);function Re(){return n.apply(this,arguments)}function n(){return n=(0,ge.Z)((0,h.Z)().mark(function C(){var te,ue=arguments;return(0,h.Z)().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return te=ue.length>0&&ue[0]!==void 0?ue[0]:{},U.abrupt("return",(0,s.WY)("/api/server/cloud_server/",{params:te}));case 2:case"end":return U.stop()}},C)})),n.apply(this,arguments)}function An(){return K.apply(this,arguments)}function K(){return K=(0,ge.Z)((0,h.Z)().mark(function C(){var te,ue=arguments;return(0,h.Z)().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return te=ue.length>0&&ue[0]!==void 0?ue[0]:{},U.abrupt("return",(0,s.WY)("/api/server/cloud_server/",{method:"POST",data:(0,Pe.Z)({},te)}));case 2:case"end":return U.stop()}},C)})),K.apply(this,arguments)}function sn(C){return ze.apply(this,arguments)}function ze(){return ze=(0,ge.Z)((0,h.Z)().mark(function C(te){var ue,rn=arguments;return(0,h.Z)().wrap(function(In){for(;;)switch(In.prev=In.next){case 0:return ue=rn.length>1&&rn[1]!==void 0?rn[1]:{},In.abrupt("return",(0,s.WY)("/api/server/cloud_server/detail/".concat(te,"/"),{method:"PUT",data:(0,Pe.Z)({},ue)}));case 2:case"end":return In.stop()}},C)})),ze.apply(this,arguments)}function pn(C,te){return ne.apply(this,arguments)}function ne(){return ne=(0,ge.Z)((0,h.Z)().mark(function C(te,ue){return(0,h.Z)().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.abrupt("return",(0,s.WY)("/api/server/cloud_server/detail/".concat(te,"/"),{method:"DELETE",data:(0,Pe.Z)({},ue)}));case 1:case"end":return U.stop()}},C)})),ne.apply(this,arguments)}function Vn(){return F.apply(this,arguments)}function F(){return F=_asyncToGenerator(_regeneratorRuntime().mark(function C(){var te,ue=arguments;return _regeneratorRuntime().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return te=ue.length>0&&ue[0]!==void 0?ue[0]:{},U.abrupt("return",request("/api/server/server_tag/",{params:te}));case 2:case"end":return U.stop()}},C)})),F.apply(this,arguments)}function Le(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return request("/api/auth/user/",{params:C})}function mn(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/cloud_server/instance_type/",{params:C})}function Gn(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/cloud_server/aliyun/",{params:C})}function me(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/cloud_server/image/",{params:C})}function tt(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/cloud_server/disk/categories/",{params:C})}function ln(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/check/cloud_name/",{params:C})}function rt(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return request("/api/server/check/var_name/",{method:"POST",data:_objectSpread({},C)})}function ke(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/test_cluster/",{params:C})}function _(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/test_cluster/",{method:"POST",data:(0,Pe.Z)({},C)})}function N(C,te){return(0,s.WY)("/api/server/test_cluster/detail/".concat(C,"/"),{method:"PUT",data:(0,Pe.Z)({},te)})}function dn(C,te){return(0,s.WY)("/api/server/test_cluster/detail/".concat(C,"/"),{method:"DELETE",data:te})}function r(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/cloud_ak/",{params:C})}function $e(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/cloud_server/region/",{params:C})}function Tn(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/cloud_server/zone/",{params:C})}function kn(C){return request("/api/server/test_cluster/cloud_type/".concat(C,"/"))}function e(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/test_cluster/cloud_server/",{params:C})}function Yn(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/test_cluster/cloud_server/",{method:"POST",data:(0,Pe.Z)({},C)})}function at(C){var te=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,s.WY)("/api/server/test_cluster/cloud_server/detail/".concat(C,"/"),{method:"PUT",data:(0,Pe.Z)({},te)})}function it(C){return(0,s.WY)("/api/server/test_cluster/cloud_server/detail/".concat(C,"/"),{method:"DELETE"})}var st=function(){var C=(0,ge.Z)((0,h.Z)().mark(function te(ue){return(0,h.Z)().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.abrupt("return",(0,s.WY)("/api/server/sync_state/",{method:"post",data:ue}));case 1:case"end":return U.stop()}},te)}));return function(ue){return C.apply(this,arguments)}}(),Zt=function(){var C=(0,ge.Z)((0,h.Z)().mark(function te(ue){return(0,h.Z)().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.abrupt("return",(0,s.WY)("/api/server/sync_cloud_server_info/",{params:ue}));case 1:case"end":return U.stop()}},te)}));return function(ue){return C.apply(this,arguments)}}()}}]);
