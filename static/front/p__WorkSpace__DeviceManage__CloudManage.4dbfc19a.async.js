(self.webpackChunktone_front=self.webpackChunktone_front||[]).push([[1237],{95779:function(De,pn,t){"use strict";t.d(pn,{Z:function(){return Rn}});var p=t(45972),Pe=t(22374),Ze={icon:function(dn,ze){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:dn}},{tag:"path",attrs:{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm192 396c0 4.4-3.6 8-8 8H544v152c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V544H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h152V328c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v152h152c4.4 0 8 3.6 8 8v48z",fill:ze}},{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z",fill:dn}}]}},name:"plus-circle",theme:"twotone"},s=Ze,Ke=t(25078),n=function(dn,ze){return Pe.createElement(Ke.Z,(0,p.Z)((0,p.Z)({},dn),{},{ref:ze,icon:s}))};n.displayName="PlusCircleTwoTone";var Rn=Pe.forwardRef(n)},66503:function(De){De.exports={table_question_tooltip:"table_question_tooltip___2k4VQ"}},19137:function(De){De.exports={filter:"filter___1IKYx",confirm:"confirm___3RbBO",domain:"domain___1-UgM"}},40483:function(De){De.exports={warp:"warp___3sqbf",selectCascader:"selectCascader___ei33u"}},24480:function(De){De.exports={warp:"warp___1vm-z",tree:"tree___2UOGt"}},44461:function(De){De.exports={warp:"warp___KB6l1",pagination:"pagination___3bije",hidden:"hidden___3iAk1"}},94293:function(De){De.exports={warp:"warp___31IgT",pagination:"pagination___21nhK",hidden:"hidden___2DJ9Y",row:"row___LOziI",tag_popover_style:"tag_popover_style___17NS3",btn_style:"btn_style___QUzyN"}},80873:function(De,pn,t){"use strict";t.d(pn,{f:function(){return Nn}});var p=t(57359),Pe=t(34423),Ze=t(20418),s=t(79625),Ke=t(96584),n=t(488),Rn=t(22374),$=t(66503),dn=t.n($),ze=t(74066),xn=t(52454),J=["desc","title"],Nn=function(Oe){var Zn=Oe.desc,Un=Oe.title,fe=(0,n.Z)(Oe,J);return(0,xn.jsxs)(Pe.Z,{children:[(0,xn.jsx)("span",{style:{color:"rgba(0, 0, 0, 0.85)"},children:Un}),(0,xn.jsx)(Ke.Z,(0,Ze.Z)((0,Ze.Z)({overlayClassName:dn().table_question_tooltip,placement:"bottomLeft",arrowPointAtCenter:!0},fe),{},{title:Zn,color:"#fff",children:(0,xn.jsx)(ze.Z,{style:{color:"rgba(0, 0, 0, 0.65)"}})}))]})}},15122:function(De,pn,t){"use strict";var p=t(46721),Pe=t(94867),Ze=t(8281),s=t(58591),Ke=t(57359),n=t(34423),Rn=t(88966),$=t(11048),dn=t(39190),ze=t(22374),xn=t(19137),J=t.n(xn),Nn=t(39935),K=t(22812),Oe=t(52454),Zn=function(fe){var qn=fe.list,on=fe.confirm,et=fe.onConfirm,Ee=fe.roleType,x=(0,K.YB)(),Y=x.formatMessage,un=(0,ze.useState)(),a=(0,dn.Z)(un,2),Re=a[0],bn=a[1],In=function(Vn){bn(Vn.target.value)};return(0,Oe.jsxs)("div",{className:J().filter,children:[(0,Oe.jsx)($.ZP.Group,{onChange:In,value:Re,children:(0,Oe.jsx)(n.Z,{direction:"vertical",children:qn.map(function(e){return(0,Oe.jsx)($.ZP,{className:J().domain,value:e.id,children:Ee==="role"?(0,Nn.u)(e.name,Y):e.name},e.id)})})}),(0,Oe.jsx)(s.Z,{style:{margin:"10px 0"}}),(0,Oe.jsxs)("div",{className:J().confirm,children:[(0,Oe.jsx)(Pe.Z,{size:"small",type:"link",style:{border:"none"},onClick:function(){on==null||on(),et(Re)},children:(0,Oe.jsx)(K._H,{id:"operation.ok"})}),(0,Oe.jsx)(Pe.Z,{size:"small",type:"text",onClick:function(){on==null||on(),bn(void 0),et(void 0)},children:(0,Oe.jsx)(K._H,{id:"operation.reset"})})]})]})};pn.Z=Zn},90395:function(De,pn,t){"use strict";t.r(pn),t.d(pn,{default:function(){return Pr}});var p=t(39190),Pe=t(54905),Ze=t(90087),s=t(22374),Ke=t(24812),n=t(22812),Rn=t(14320),$=t(53479),dn=t(67515),ze=t(12238),xn=t(46721),J=t(94867),Nn=t(31650),K=t(25100),Oe=t(51937),Zn=t(34516),Un=t(57359),fe=t(34423),qn=t(79625),on=t(96584),et=t(81138),Ee=t(96146),x=t(35832),Y=t(32326),un=t(26388),a=t(20418),Re=t(31784),bn=t(74066),In=t(46601),e=t(52454),Vn=function(j){var T=j.name,m=j.formatMessage;return T=="cloud"?(0,e.jsx)("div",{children:m({id:"device.cloud"})}):T=="cloud_efficiency"?(0,e.jsx)("div",{children:m({id:"device.cloud_efficiency"})}):T=="cloud_ssd"?(0,e.jsx)("div",{children:m({id:"device.cloud_ssd"})}):T=="cloud_essd"?(0,e.jsx)("div",{children:m({id:"device.cloud_essd"})}):(0,e.jsx)("div",{children:"-"})},nt=function(j,T){var m={cloud:T({id:"device.cloud"}),cloud_efficiency:T({id:"device.cloud_efficiency"}),cloud_ssd:T({id:"device.cloud_ssd"}),cloud_essd:T({id:"device.cloud_essd"})};return m[j]},tt=function(j){var T,m;return j[j.length-1]!=="latest"?j[j.length-1]:"".concat((T=j[1].props)===null||T===void 0?void 0:T.children,":").concat((m=j[2].props)===null||m===void 0?void 0:m.children,":latest")},rt=Vn,S=t(44851),ee=t.n(S),ve=t(55704),cn=t(94649),X=t(12590),Hn=t(22911),Ct=t(27787),pt=t(76123),Nr=t(88018),mt=t(58414),Ur=t(67448),St=t(47548),Vr=t(90846),ht=t(56511),Gr=t(39693),Gn=t(1518),Yr=t(13998),at=t(76784),Qr=t(88966),kn=t(11048),Jr=t(70772),v=t(6701),Xr=t(20693),_n=t(3278),it=t(2605),qr=t(65790),V=t(17187),ea=t(69230),fn=t(33821),ne=t(75667),wt=t(57286),Yn=t(526),ae=t(39935),Jt=t(95779),Tt=t(45972),Xt={icon:function(j,T){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:j}},{tag:"path",attrs:{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm192 396c0 4.4-3.6 8-8 8H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h368c4.4 0 8 3.6 8 8v48z",fill:T}},{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z",fill:j}}]}},name:"minus-circle",theme:"twotone"},qt=Xt,er=t(25078),bt=function(j,T){return s.createElement(er.Z,(0,Tt.Z)((0,Tt.Z)({},j),{},{ref:T,icon:qt}))};bt.displayName="MinusCircleTwoTone";var nr=s.forwardRef(bt),tr=t(40483),Ln=t.n(tr),rr=t(53919),It=t(8476),gt=t(80873),st=fn.Z.Option,Ht=[{value:"aliyun_eci",label:"aliyun_eci",isLeaf:!1},{value:"aliyun_ecs",label:"aliyun_ecs",isLeaf:!1}],ar=function(j){return Object.prototype.toString.call(j)==="[object Array]"},ir=function(j){return Object.prototype.toString.call(j)==="[object Object]"},sr=function(j){var T=[{param_key:"",param_value:""}];return ar(j)&&JSON.stringify(j)==="[]"||ir(j)&&JSON.stringify(j)==="{}"?T:j},lr=function(j){var T=j.onRef,m=j.is_instance,z=j.onSuccess,G=j.type,Te=(0,n.YB)(),r=Te.formatMessage,_e=(0,Ke.UO)(),Ce=_e.ws_id,We=V.Z.useForm(),Le=(0,p.Z)(We,1),E=Le[0],$e=(0,s.useState)({list:[],isQuery:""}),Qe=(0,p.Z)($e,2),Ie=Qe[0],Be=Qe[1],Se=(0,s.useState)(Ht),Je=(0,p.Z)(Se,2),be=Je[0],we=Je[1],Xe=(0,s.useState)(!1),Ne=(0,p.Z)(Xe,2),an=Ne[0],W=Ne[1],pe=(0,s.useState)(!1),je=(0,p.Z)(pe,2),qe=je[0],b=je[1],P=(0,s.useState)([]),B=(0,p.Z)(P,2),de=B[0],O=B[1],He=(0,s.useState)([]),sn=(0,p.Z)(He,2),ie=sn[0],ln=sn[1],I=(0,s.useState)([]),k=(0,p.Z)(I,2),o=k[0],H=k[1],he=(0,s.useState)(!1),q=(0,p.Z)(he,2),ue=q[0],re=q[1],$n=(0,s.useState)([]),Ae=(0,p.Z)($n,2),vn=Ae[0],en=Ae[1],An=(0,s.useState)([]),Fe=(0,p.Z)(An,2),mn=Fe[0],Cn=Fe[1],Dn=(0,s.useState)(!0),Pn=(0,p.Z)(Dn,2),Ue=Pn[0],Ve=Pn[1],D=(0,s.useState)({}),On=(0,p.Z)(D,2),ge=On[0],Sn=On[1],Fn=(0,s.useState)({validate:!0,meg:""}),Kn=(0,p.Z)(Fn,2),En=Kn[0],wn=Kn[1],Qn=(0,s.useState)(!0),zn=(0,p.Z)(Qn,2),Wn=zn[0],hn=zn[1],h=(0,s.useState)(""),d=(0,p.Z)(h,2),l=d[0],M=d[1],R=(0,s.useState)(!1),ke=(0,p.Z)(R,2),se=ke[0],oe=ke[1],y=(0,s.useState)(!0),_=(0,p.Z)(y,2),g=_[0],L=_[1],Q=(0,s.useState)(),nn=(0,p.Z)(Q,2),le=nn[0],jn=nn[1],dt=function(){var Z=(0,Y.Z)((0,x.Z)().mark(function c(i){var C,f,u,w,A,N,F,xe,tn,Ge,Me;return(0,x.Z)().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.next=2,(0,ne.L0)({cluster_id:i});case 2:if(U.t0=U.sent,U.t0){U.next=5;break}U.t0={};case 5:C=U.t0,f=C.code,u=C.data,w=u===void 0?[]:u,f===200&&!!w.length?(A=w[w.length-1].test_server,N=A===void 0?{}:A,F=N.manufacturer,xe=N.ak_id,tn=N.region,Ge=N.zone,xe&&F&&tn&&Ge&&(L(!1),M(F),re(!0),Me={ak_id:xe,id:F,region:tn,zone:Ge},m?Promise.all([ct(Me),ut(Me)]).then(function(){W(!1),Ve(!1)}):Promise.all([ct(Me),gn(Me),Jn(Me),ot(Me)]).then(function(){W(!1),Ve(!1)}),E.setFieldsValue({manufacturer:[F,xe],region:[tn,Ge]}))):L(!0);case 10:case"end":return U.stop()}},c)}));return function(i){return Z.apply(this,arguments)}}(),gn=function(){var Z=(0,Y.Z)((0,x.Z)().mark(function c(i){var C,f;return(0,x.Z)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,(0,ne.BS)(i);case 2:C=w.sent,f=C.data,O(f||[]),(!f||f.length===0)&&Lr();case 6:case"end":return w.stop()}},c)}));return function(i){return Z.apply(this,arguments)}}(),Jn=function(){var Z=(0,Y.Z)((0,x.Z)().mark(function c(i){var C,f,u;return(0,x.Z)().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,(0,ne.iB)(i);case 2:C=A.sent,f=C.data,u=f===void 0?[]:f,ln(u);case 6:case"end":return A.stop()}},c)}));return function(i){return Z.apply(this,arguments)}}(),ot=function(){var Z=(0,Y.Z)((0,x.Z)().mark(function c(i){var C,f,u,w,A;return(0,x.Z)().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,(0,ne.F$)(i);case 2:C=F.sent,f=C.data,u=f.slice(0),w=u.some(function(xe){return xe.value==="cloud_efficiency"}),A=[{title:"\u9AD8\u6548\u4E91\u76D8",value:"cloud_efficiency"}],w||(u=u.concat(A)),Cn(u||[]);case 9:case"end":return F.stop()}},c)}));return function(i){return Z.apply(this,arguments)}}(),ut=function(){var Z=(0,Y.Z)((0,x.Z)().mark(function c(i){var C,f;return(0,x.Z)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,(0,ne.Ti)(i);case 2:C=w.sent,f=C.data,H(f||[]);case 5:case"end":return w.stop()}},c)}));return function(i){return Z.apply(this,arguments)}}(),Or=function(){var Z=(0,Y.Z)((0,x.Z)().mark(function c(i){var C,f,u,w;return(0,x.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return C=i[i.length-1],N.next=3,(0,ne.mN)({ak_id:C.ak_id,region:C.value});case 3:f=N.sent,u=f.data,w=f.code,w===200?(C.children=u&&u.map(function(F){return{label:(0,Yn.Px)(F.id),value:F.id}}),en((0,it.Z)(vn))):setTimeout(function(){C.children=[],en((0,it.Z)(vn))},500);case 7:case"end":return N.stop()}},c)}));return function(i){return Z.apply(this,arguments)}}(),Er=function(){var Z=(0,Y.Z)((0,x.Z)().mark(function c(i){var C,f,u,w,A;return(0,x.Z)().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return C=i[i.length-1],F.next=3,(0,ne.aB)({ws_id:Ce,provider:C.value});case 3:f=F.sent,u=f.code,w=f.data,A=f.msg,u===200?(C.children=w&&w.map(function(xe){return{label:xe.name,value:xe.id}}),we((0,it.Z)(be))):(setTimeout(function(){C.children=[],we((0,it.Z)(be))},500),wn({validate:!1,meg:A||r({id:"device.no.compliant.AK"})}),E.setFieldsValue({manufacturer:void 0}));case 8:case"end":return F.stop()}},c)}));return function(i){return Z.apply(this,arguments)}}(),jt={instance_type:void 0,instance_type_one:void 0,instance_type_two:void 0,storage_type:void 0,storage_size:40,storage_number:0,system_disk_category:void 0,system_disk_size:40},Rr=function(){E.setFieldsValue((0,a.Z)((0,a.Z)({},jt),{},{region:void 0,image:void 0}))},Kt=function(){E.setFieldsValue((0,a.Z)((0,a.Z)({},jt),{},{image:void 0}))},Lr=function(){E.setFieldsValue((0,a.Z)({},jt))},$r=function(){var Z=(0,Y.Z)((0,x.Z)().mark(function c(i,C){var f,u,w,A,N,F,xe,tn,Ge,Me;return(0,x.Z)().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(g){U.next=6;break}Ve(!0),Kt(),i&&i.length?(f=i[0],M(f),W(!0),u=E.getFieldValue("region"),w={ak_id:i[1],region:u[0],zone:u[1]},m?Promise.all([ut(w)]).then(function(){W(!1),Ve(!1)}):Promise.all([gn(w),Jn(w),ot(w)]).then(function(){W(!1),Ve(!1)})):(O([]),H([]),ln([]),Cn([])),U.next=26;break;case 6:if(Ve(!0),Rr(),!(i&&i.length)){U.next=24;break}return U.next=11,(0,ne.Yh)({ak_id:i[1]});case 11:A=U.sent,N=A.code,F=A.data,xe=F===void 0?[]:F,tn=A.msg,Ge=[],N===200?(Ge=xe==null?void 0:xe.map(function(Ye){return{value:Ye.id,label:(0,Yn.Px)(Ye.id),ak_id:i[1],isLeaf:!1}}),wn({validate:!0,meg:""})):wn({validate:!1,meg:tn||r({id:"device.no.compliant.AK"})}),en(Ge),hn(!!Ge.length),Me=i[0],M(Me.value),U.next=26;break;case 24:wn({validate:!0,meg:""}),en([]);case 26:case"end":return U.stop()}},c)}));return function(i,C){return Z.apply(this,arguments)}}(),ct=function(){var Z=(0,Y.Z)((0,x.Z)().mark(function c(i){var C,f,u,w,A,N,F,xe,tn,Ge,Me;return(0,x.Z)().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return W(!0),U.next=3,(0,ne.aB)({ws_id:Ce,provider:i.id});case 3:return C=U.sent,f=C.data,u=f===void 0?[]:f,U.next=8,(0,ne.Yh)({ak_id:i.ak_id});case 8:return w=U.sent,A=w.data,N=A===void 0?[]:A,U.next=13,(0,ne.mN)({ak_id:i.ak_id,region:i.region});case 13:F=U.sent,xe=F.data,tn=xe===void 0?[]:xe,Ge=N.map(function(Ye){return Ye.id==i.region?{value:Ye.id,label:(0,Yn.Px)(Ye.id),ak_id:i.ak_id,isLeaf:!1,children:tn.map(function(yn){return{label:yn.id,value:yn.id}})}:{value:Ye.id,label:(0,Yn.Px)(Ye.id),ak_id:i.ak_id,isLeaf:!1}}),Me=Ht.map(function(Ye){return Ye.value===i.id?{value:i.id,label:i.id,isLeaf:!1,children:u.map(function(yn){return{label:yn.name,value:yn.id}})}:Ye}),we(Me),en(Ge),W(!1);case 21:case"end":return U.stop()}},c)}));return function(i){return Z.apply(this,arguments)}}(),Ar=function(c,i){if(Array.isArray(i)&&i.length){var C={ak_id:i[0].ak_id,region:c[0],zone:c[1]};W(!0),H([]),ln([]),O([]),Cn([]),E.setFieldsValue({image:void 0,instance_id:void 0,instance_type:void 0,storage_type:void 0,system_disk_category:void 0}),re(!0),m?Promise.all([ut(C)]).then(function(){W(!1),Ve(!1)}):Promise.all([gn(C),Jn(C),ot(C)]).then(function(){W(!1),Ve(!1)})}else Kt()},Fr=function(c){var i=E.getFieldValue("region"),C=E.getFieldValue("manufacturer"),f={ak_id:C[1],region:i[0],zone:i[1],instance_type:c};Jn(f)},Kr=function(c){jn(c),Sn({}),G==="cluster"&&dt(c),b(!0),re(!1),H([]),ln([]),O([]),en([]),Cn([]),Be((0,a.Z)((0,a.Z)({},Ie),{},{isQuery:"add",list:[]})),E.resetFields()};(0,s.useImperativeHandle)(T,function(){return{newMachine:function(c){Kr(c)},editMachine:function(c){zr(c)}}});var zr=function(c){var i;L(!0),jn(c.cluster_id),Sn(c),re(!0),b(!0);var C=c.tag_list.map(function(F){return F.id});Be((0,a.Z)((0,a.Z)({},Ie),{},{isQuery:"edit",list:C}));var f=(0,a.Z)({},c);f.extra_param=sr(f.extra_param),f.tags=((i=f.tag_list)===null||i===void 0?void 0:i.map(function(F){return F.id}))||[],f.is_instance=f.is_instance?1:0,f.manufacturer=[f.manufacturer,f.ak_id],f.region=[f.region,f.zone],f.kernel_install=f.kernel_install?1:0,M(c.manufacturer);var u={ak_id:f.ak_id,region:f.region[0],zone:f.region[1],id:f.manufacturer[0]};if(f.ak_name=="aliyun_eci"){var w=f.instance_type,A=w.indexOf("C"),N=w.indexOf("G");f.instance_type_one=Number(w.substring(0,A)),f.instance_type_two=Number(w.substring(A+1,N))}m?Promise.all([ct(u),ut(u)]).then(function(){W(!1),Ve(!1)}):Promise.all([ct(u),gn(u),Jn(u),ot(u)]).then(function(){W(!1),Ve(!1)}),E.setFieldsValue(f)};(0,s.useEffect)(function(){if(Object.keys(ge).length&&ge.image&&ie.length){var Z=ie.filter(function(A){return A.id===ge.image});if(l==="aliyun_eci"){var c=Z.length?Z[0].platform:"",i=c?[c,ge.image]:void 0;E.setFieldsValue({image:i})}else if(Z.length){var C=Z[0].owner_alias,f=Z[0].platform,u=Z[0].os_name,w=C?[(0,ae.Wj)(C,r),f,u,ge.image]:void 0;E.setFieldsValue({image:w})}}},[ie]);var zt=function(){var Z=(0,Y.Z)((0,x.Z)().mark(function c(i){var C,f,u,w,A,N,F,xe,tn,Ge,Me,Bn,U,Ye,yn,yt,ft,Bt,Nt,Ut,vt,Xn,Vt,Tn,Gt,Yt,Qt;return(0,x.Z)().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(oe(!0),f=(C=i.extra_param)===null||C===void 0?void 0:C.filter(function(rn){return rn.param_key}),u=(0,a.Z)((0,a.Z)({},i),{},{ws_id:Ce,is_instance:m,extra_param:f}),i.hasOwnProperty("manufacturer")&&(u.manufacturer=i==null?void 0:i.manufacturer[0],u.ak_id=i.manufacturer[1],u.region=i.region[0],u.zone=i.region[1]),i.hasOwnProperty("instance_id")&&(w=i.instance_id.label,u.instance_id=i.instance_id.value,u.name=w.indexOf(" / ")>-1?w.split(" / ")[1]:w),l==="aliyun_eci"?u.instance_type="".concat(i.instance_type_one,"C").concat(i.instance_type_two,"G"):u.instance_type=i.instance_type,i.hasOwnProperty("image")&&i.image.length?l==="aliyun_eci"?(u.image=i.image[1],xe=(0,ae.Eu)(ie,"platform")||[],tn=xe.find(function(rn){return rn.value==i.image[0]})||{},Ge=(A=tn.children)===null||A===void 0?void 0:A.find(function(rn){return rn.value==i.image[1]}),u.image_name=(N=Ge.label)===null||N===void 0||(F=N.props)===null||F===void 0?void 0:F.children):i.image[3]==="latest"?(Me="".concat(i.image[1],":").concat(i.image[2],":").concat(i.image[3]),u.image=Me,u.image_name=Me):i.image.indexOf(":latest")>0?(u.image=i.image,u.image_name=i.image):(u.image=i.image[3],ft=(0,ae.We)(ie,"owner_alias","platform","os_name")||[],Bt=(ft==null?void 0:ft.find(function(rn){return rn.value==i.image[0]}))||{},Nt=((Bn=Bt.children)===null||Bn===void 0?void 0:Bn.find(function(rn){return rn.value==i.image[1]}))||{},Ut=((U=Nt.children)===null||U===void 0?void 0:U.find(function(rn){return rn.value==i.image[2]}))||{},vt=(Ye=Ut.children)===null||Ye===void 0?void 0:Ye.find(function(rn){return rn.value==i.image[3]}),u.image_name=vt==null||(yn=vt.label)===null||yn===void 0||(yt=yn.props)===null||yt===void 0?void 0:yt.children):u.image=void 0,u.description=i.description||"",u.cluster_id=le,Xn=ge.id,Vt=ge.machineId,G!=="cluster"){ce.next=23;break}if(!Xn){ce.next=17;break}return ce.next=14,(0,ne.oz)(Vt,(0,a.Z)({},u));case 14:ce.t0=ce.sent,ce.next=20;break;case 17:return ce.next=19,(0,ne.MH)((0,a.Z)({},u));case 19:ce.t0=ce.sent;case 20:Tn=ce.t0,ce.next=33;break;case 23:if(!Xn){ce.next=29;break}return ce.next=26,(0,ne.cm)(Xn,(0,a.Z)({},u));case 26:ce.t1=ce.sent,ce.next=32;break;case 29:return ce.next=31,(0,ne.X6)((0,a.Z)({},u));case 31:ce.t1=ce.sent;case 32:Tn=ce.t1;case 33:Tn.code===200?(Ee.default.success(r({id:"operation.success"})),G==="cluster"?z({parentId:le}):z(u.is_instance||m,Xn),b(!1)):Tn.code===201?(Gt=Tn.msg,Yt=Tn.link_msg,Qt=(0,e.jsx)("span",{dangerouslySetInnerHTML:{__html:Gt.replace(Yt,'<a href="/system/user" target="_blank">$&</a>')}}),Ee.default.warning(Qt)):(0,ae.EV)(Tn.code,Tn.msg),oe(!1);case 35:case"end":return ce.stop()}},c)}));return function(i){return Z.apply(this,arguments)}}(),Wr=function(){E.validateFields().then(function(c){var i=c.extra_param||[];if(i.length){var C=i.map(function(u){return u.param_key}),f=new Set(C);f.size==C.length?zt(c):(Ee.default.warn("\u6269\u5C55\u5B57\u6BB5\u91CD\u540D\uFF0C\u8BF7\u4FEE\u6539\u540E\u63D0\u4EA4!!!"),E.scrollToField("extra_param"))}else zt(c)})},Wt=function(){hn(!0),M(""),Sn({}),b(!1),oe(!1)},Br=(0,s.useMemo)(function(){return ge&&ge.state==="Occupied"},[ge]);return(0,e.jsx)(mt.Z,{maskClosable:!1,keyboard:!1,title:(0,e.jsx)(n._H,{id:ge.id?m?"device.device.edit":"device.config.edit":m?"device.add.btn":"device.config.btn"}),width:724,onClose:Wt,open:qe,bodyStyle:{paddingBottom:80},destroyOnClose:!0,footer:(0,e.jsx)("div",{style:{textAlign:"right"},children:(0,e.jsxs)(fe.Z,{children:[(0,e.jsx)(J.Z,{onClick:Wt,children:(0,e.jsx)(n._H,{id:"operation.cancel"})}),(0,e.jsx)(J.Z,{onClick:function(){return Wr()},type:"primary",loading:se,children:(0,e.jsx)(n._H,{id:"operation.ok"})})]})}),children:(0,e.jsx)(St.Z,{spinning:an,children:(0,e.jsx)(V.Z,{layout:"vertical",form:E,initialValues:{instance_type_one:1,instance_type_two:1,system_disk_size:40,storage_size:40,storage_number:0,release_rule:1,kernel_install:1,bandwidth:10,storage_type:"cloud_efficiency",extra_param:[{param_key:"",param_value:""}]},children:(0,e.jsxs)($.Z,{gutter:16,children:[m?null:(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{name:"name",label:(0,e.jsx)(n._H,{id:"device.name"}),validateTrigger:"onBlur",rules:[{required:!0,validator:function(){var Z=(0,Y.Z)((0,x.Z)().mark(function i(C,f){var u,w;return(0,x.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(f){N.next=2;break}return N.abrupt("return",Promise.reject(r({id:"device.name.message"})));case 2:if(/^[A-Za-z][A-Za-z0-9\._-]{1,32}$/.test(f)){N.next=4;break}return N.abrupt("return",Promise.reject(r({id:"device.name.message"})));case 4:return u={is_instance:0,name:f,ws_id:Ce},w=ge.id?(0,a.Z)((0,a.Z)({},u),{},{cloud_server_id:ge.id}):(0,a.Z)({},u),(0,ne.x1)(w).then(function(F){if(F.code!==200)return Promise.reject(r({id:"validator.failed"}))}),N.abrupt("return",Promise.resolve());case 8:case"end":return N.stop()}},i)}));function c(i,C){return Z.apply(this,arguments)}return c}()}],children:(0,e.jsx)(_n.Z,{autoComplete:"off",placeholder:r({id:"please.enter"})})})}),m?null:(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{name:"release_rule",label:(0,e.jsx)(n._H,{id:"device.release_rule"}),rules:[{required:!0,message:r({id:"please.select"})}],children:(0,e.jsxs)(kn.ZP.Group,{children:[(0,e.jsx)(kn.ZP,{value:0,children:(0,e.jsx)(n._H,{id:"operation.not.release"})}),(0,e.jsx)(kn.ZP,{value:1,children:(0,e.jsx)(n._H,{id:"operation.release"})}),(0,e.jsx)(kn.ZP,{value:2,children:(0,e.jsx)(gt.f,{title:r({id:"device.failed.save"}),desc:r({id:"device.failed.save.24h"})})})]})})}),!ge.id||!m?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{name:"manufacturer",label:(0,e.jsx)(n._H,{id:"device.manufacturer/ak"}),validateStatus:En.validate?"":"error",help:En.validate?void 0:En.meg,rules:[{required:!0,message:r({id:"please.select"})}],children:(0,e.jsx)(at.Z,{disabled:G==="cluster"&&!g,options:be,loadData:Er,onChange:$r,dropdownMenuColumnStyle:{width:165},dropdownClassName:Ln().selectCascader})})}):null,l===""?null:!ge.id||!m?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:"Region/Zone",name:"region",validateStatus:Wn?"":"error",help:Wn?void 0:r({id:"device.region/zone"}),rules:[{required:!0,message:r({id:"please.select"})}],children:(0,e.jsx)(at.Z,{disabled:(vn==null?void 0:vn.length)===0||G==="cluster"&&!g,options:vn,loadData:Or,onChange:Ar,dropdownMenuColumnStyle:{width:165},dropdownClassName:Ln().selectCascader})})}):null,ue&&!ge.id&&m?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.own.server"}),name:"instance_id",rules:[{required:!0,message:r({id:"please.select"})}],children:(0,e.jsx)(fn.Z,{showSearch:!0,optionFilterProp:"children",placeholder:r({id:"please.select"}),labelInValue:!0,disabled:o.length==0,filterOption:function(c,i){return i.children.toLowerCase().indexOf(c.toLowerCase())>=0},children:o.map(function(Z,c){return(0,e.jsx)(st,{value:Z.id,children:Z.ip?"".concat(Z.ip," / ").concat(Z.name):Z.name},c)})})})}):null,ue?m?null:(0,e.jsx)(e.Fragment,{children:l==="aliyun_eci"?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsxs)($.Z,{children:[(0,e.jsxs)(v.Z,{span:8,style:{display:"flex",alignItems:"flex-start"},children:[(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.instance_type"}),name:"instance_type_one",rules:[{required:!0,message:r({id:"please.enter"})}],children:(0,e.jsx)(Gn.Z,{min:1,style:{width:70},placeholder:r({id:"device.spec.size"}),disabled:Ue||ie.length===0})}),(0,e.jsx)("span",{style:{marginTop:"30px",background:"#fafafa",padding:"4px 10px",border:"1px solid #d9d9d9",borderLeft:"none"},children:"C"})]}),(0,e.jsxs)(v.Z,{span:16,style:{display:"flex",alignItems:"flex-start",paddingLeft:6},children:[(0,e.jsx)(V.Z.Item,{label:"",name:"instance_type_two",rules:[{required:!0,message:r({id:"please.enter"})}],children:(0,e.jsx)(Gn.Z,{min:1,style:{width:70,marginTop:30},placeholder:r({id:"device.spec.size"}),disabled:Ue||ie.length===0})}),(0,e.jsx)("span",{style:{marginTop:"30px",background:"#fafafa",padding:"4px 10px",border:"1px solid #d9d9d9",borderLeft:"none"},children:"G"})]})]})}):(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.instance_type"}),name:"instance_type",rules:[{required:!0,message:r({id:"please.select"})}],children:(0,e.jsx)(fn.Z,{disabled:Ue||ie.length===0,showSearch:!0,placeholder:r({id:"please.select"}),optionFilterProp:"children",filterOption:function(c,i){return i.children.toLowerCase().indexOf(c.toLowerCase())>=0},onSelect:Fr,children:de==null?void 0:de.map(function(Z,c){return(0,e.jsx)(st,{value:Z.Value,children:Z.Value},c)})})})})}):null,ue?m?null:l==="aliyun_eci"?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.image"}),name:"image",rules:[{required:!0,message:r({id:"please.select"})}],children:(0,e.jsx)(at.Z,{placeholder:r({id:"please.select"}),disabled:ie.length===0,options:(0,ae.Eu)(ie,"platform"),displayRender:tt,dropdownMatchSelectWidth:!0,dropdownClassName:Ln().selectCascader})})}):(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.image"}),name:"image",rules:[{required:!0,message:r({id:"please.select"})}],children:(0,e.jsx)(at.Z,{placeholder:r({id:"please.select"}),disabled:ie.length===0,options:(0,ae.We)(ie,"owner_alias","platform","os_name"),displayRender:tt,dropdownMenuColumnStyle:{width:(724-48)/4},dropdownClassName:Ln().selectCascader})})}):null,ue&&l!=="aliyun_eci"&&!m?(0,e.jsx)(v.Z,{span:8,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.system.disk"}),name:"system_disk_category",rules:[{required:!0,message:r({id:"please.select"})}],children:mn.length==0?(0,e.jsx)(fn.Z,{placeholder:r({id:"device.resource.shortage"}),disabled:!0}):(0,e.jsx)(fn.Z,{placeholder:r({id:"please.select"}),disabled:Ue,children:mn.map(function(Z,c){return(0,e.jsx)(st,{value:Z.value,children:Z.title},c)})})})}):null,ue&&l!=="aliyun_eci"&&!m?(0,e.jsxs)(v.Z,{span:4,style:{display:"flex",alignItems:"flex-start"},children:[(0,e.jsx)(V.Z.Item,{name:"system_disk_size",label:" ",rules:[{required:!1,message:r({id:"please.select"})}],children:(0,e.jsx)(Gn.Z,{placeholder:r({id:"device.spec.size"}),style:{width:70},min:20,max:500,disabled:Ue||ie.length===0})}),(0,e.jsx)("span",{style:{marginTop:"30px",background:"#fafafa",padding:"4px 10px",border:"1px solid #d9d9d9",borderLeft:"none"},children:"G"})]}):null,ue&&l!=="aliyun_eci"&&!m?(0,e.jsx)(v.Z,{span:4,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.storage_type"}),name:"storage_type",children:mn.length==0?(0,e.jsx)(fn.Z,{placeholder:r({id:"device.resource.shortage"}),disabled:!0}):(0,e.jsx)(fn.Z,{placeholder:r({id:"please.select"}),disabled:Ue,children:mn.map(function(Z,c){return(0,e.jsx)(st,{value:Z.value,children:Z.title},c)})})})}):null,ue&&l!=="aliyun_eci"&&!m?(0,e.jsxs)(v.Z,{span:4,style:{display:"flex",alignItems:"flex-start"},children:[(0,e.jsx)(V.Z.Item,{name:"storage_size",label:" ",rules:[{required:!1,message:r({id:"please.enter"})}],children:(0,e.jsx)(Gn.Z,{placeholder:r({id:"device.spec.size"}),style:{width:70},min:20,max:500,disabled:Ue||ie.length===0})}),(0,e.jsx)("span",{style:{marginTop:"30px",background:"#fafafa",padding:"4px 10px",border:"1px solid #d9d9d9",borderLeft:"none"},children:"G"})]}):null,ue&&l!=="aliyun_eci"&&!m?(0,e.jsxs)(v.Z,{span:4,style:{display:"flex",alignItems:"flex-start"},children:[(0,e.jsx)(V.Z.Item,{name:"storage_number",label:" ",rules:[{required:!1,message:r({id:"please.enter"})}],children:(0,e.jsx)(Gn.Z,{placeholder:r({id:"device.quantity"}),style:{width:70},min:0,max:16,disabled:Ue||ie.length===0})}),(0,e.jsx)("span",{style:{marginTop:"30px",background:"#fafafa",padding:"4px 10px",border:"1px solid #d9d9d9",borderLeft:"none"},children:(0,e.jsx)(n._H,{id:"device.one"})})]}):null,m?null:(0,e.jsx)(v.Z,{span:12,className:Ln().warp,children:(0,e.jsx)(V.Z.Item,{name:"bandwidth",label:(0,e.jsx)(n._H,{id:"device.bandwidth"}),rules:[{required:!0,message:r({id:"please.enter"})}],children:(0,e.jsx)(_n.Z,{type:"number",min:10,style:{width:"100%"},addonAfter:"Mbit/s",placeholder:r({id:"please.enter"})})})}),m?null:(0,e.jsx)(v.Z,{span:24,className:Ln().warp,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(gt.f,{title:r({id:"device.extended.fields"}),desc:r({id:"device.aliyun.params"})}),labelAlign:"left",style:{marginBottom:0},children:(0,e.jsx)(V.Z.List,{name:"extra_param",children:function(c,i){var C=i.add,f=i.remove;return c.map(function(u,w){return(0,e.jsxs)($.Z,{gutter:20,style:{marginBottom:8},children:[(0,e.jsx)(v.Z,{span:11,children:(0,e.jsxs)($.Z,{children:[(0,e.jsx)(v.Z,{span:4,style:{paddingTop:4},children:(0,e.jsx)("span",{children:"Key:"})}),(0,e.jsx)(v.Z,{span:20,children:(0,e.jsx)(V.Z.Item,{name:[u.name,"param_key"],children:(0,e.jsx)(_n.Z,{})})})]})}),(0,e.jsx)(v.Z,{span:11,children:(0,e.jsxs)($.Z,{children:[(0,e.jsx)(v.Z,{span:4,style:{paddingTop:4},children:(0,e.jsx)("span",{children:"Value:"})}),(0,e.jsx)(v.Z,{span:20,children:(0,e.jsx)(V.Z.Item,{name:[u.name,"param_value"],children:(0,e.jsx)(_n.Z,{})})})]})}),(0,e.jsx)(v.Z,{span:2,style:{paddingTop:5},children:(0,e.jsxs)(fe.Z,{children:[w===c.length-1&&(0,e.jsx)(Jt.Z,{onClick:function(){C()},style:{cursor:"pointer"}}),c.length>1&&(0,e.jsx)(nr,{style:{cursor:"pointer"},twoToneColor:"#E02020",onClick:function(){return f(u.name)}})]})})]},u.key)})}})})}),(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(wt.Z,{})}),G==="cluster"?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{name:"kernel_install",label:(0,e.jsx)(n._H,{id:"device.kernel_install"}),rules:[{required:!0,message:r({id:"please.select"})}],children:(0,e.jsxs)(kn.ZP.Group,{children:[(0,e.jsx)(kn.ZP,{value:1,children:(0,e.jsx)(n._H,{id:"operation.yes"})}),(0,e.jsx)(kn.ZP,{value:0,children:(0,e.jsx)(n._H,{id:"operation.no"})})]})})}):null,G==="cluster"?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.var_name"}),name:"var_name",rules:[{required:!0,message:r({id:"placeholder.enter.device.var_name"})}],children:(0,e.jsx)(_n.Z,{autoComplete:"off",placeholder:r({id:"please.enter"})})})}):null,G==="cluster"&&!!m?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{name:"private_ip",label:(0,e.jsx)(gt.f,{title:r({id:"device.private_ip"}),desc:r({id:"device.private_ip.desc"})}),children:(0,e.jsx)(_n.Z,{autoComplete:"off",placeholder:r({id:"please.enter"})})})}):null,G==="standalone"?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(It.Z,(0,a.Z)({},Ie))}):null,(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.channel_type"}),name:"channel_type",initialValue:"toneagent",rules:[{required:!0,message:r({id:"device.channel_type.message"})}],children:(0,e.jsx)(rr.k,{disabled:"opensource"})})}),m?(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.usage.state"}),name:"state",hasFeedback:!0,rules:[{required:!0,message:r({id:"device.usage.state.message"})}],initialValue:"Available",children:(0,e.jsxs)(fn.Z,{placeholder:r({id:"device.usage.state.message"}),disabled:Br,children:[(0,e.jsx)(fn.Z.Option,{value:"Available",children:(0,e.jsx)(ht.Z,{status:"success",text:"Available"})}),(0,e.jsx)(fn.Z.Option,{value:"Reserved",children:(0,e.jsx)(ht.Z,{status:"default",text:"Reserved"})}),(0,e.jsx)(fn.Z.Option,{value:"Unusable",children:(0,e.jsx)(ht.Z,{status:"default",text:"Unusable"})})]})})}):null,(0,e.jsx)(v.Z,{span:12,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.description"}),name:"description",children:(0,e.jsx)(_n.Z.TextArea,{rows:3,placeholder:r({id:"please.enter"})})})})]})})})})},xt=lr,lt=t(6895),Zt=t(77033),na=t(16832),Mn=t(69827),dr=t(94293),ye=t.n(dr),or=(0,s.forwardRef)(function(me,j){var T,m=(0,n.YB)(),z=m.formatMessage,G=(0,s.useState)(),Te=(0,p.Z)(G,2),r=Te[0],_e=Te[1],Ce=(0,s.useState)(),We=(0,p.Z)(Ce,2),Le=We[0],E=We[1],$e=(0,s.useState)(!1),Qe=(0,p.Z)($e,2),Ie=Qe[0],Be=Qe[1],Se=(0,s.useState)(!0),Je=(0,p.Z)(Se,2),be=Je[0],we=Je[1],Xe=(0,s.useState)(!1),Ne=(0,p.Z)(Xe,2),an=Ne[0],W=Ne[1],pe=(0,s.useRef)(null),je=function(){var B=(0,Y.Z)((0,x.Z)().mark(function de(O){var He,sn,ie;return(0,x.Z)().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return we(!0),I.next=3,(0,Zt.vq)({ip:O.private_ip,channel_type:O.channel_type});case 3:He=I.sent,sn=He.code,ie=He.data,Be(sn===200?ie:O.channel_state),we(!1);case 8:case"end":return I.stop()}},de)}));return function(O){return B.apply(this,arguments)}}();(0,s.useImperativeHandle)(j,function(){return{show:function(de,O){W(!0),E(O),_e(de),je(de)}}});var qe=function(){W(!1),_e(null)},b=function(de){var O;(O=pe.current)===null||O===void 0||O.show((0,a.Z)((0,a.Z)({},de),{},{detailData:[de==null?void 0:de.private_ip],radio_type:"cloudManage"}))},P=function(){};return(0,e.jsxs)(mt.Z,{maskClosable:!1,keyboard:!1,forceRender:!0,title:(0,e.jsx)(n._H,{id:"device.details"}),width:"510",open:an,onClose:qe,children:[(0,e.jsxs)(St.Z,{spinning:be,children:[(0,e.jsxs)(Mn.Z.Content,{style:{marginBottom:30},children:[(0,e.jsx)(K.Z.Text,{strong:!0,children:(0,e.jsx)(n._H,{id:"device.hardware"})}),!!Le&&(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.instance.id"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:r==null?void 0:r.instance_id})]}),!!Le&&(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.ip.address"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:r==null?void 0:r.private_ip})]}),(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsx)(v.Z,{span:6,children:"Region/Zone:"}),(0,e.jsx)(v.Z,{span:18,children:r==null?void 0:r.region_zone})]}),(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.instance_type"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:r==null?void 0:r.instance_type})]}),(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.bandwidth"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:r==null?void 0:r.bandwidth})]}),(r==null?void 0:r.manufacturer)!=="aliyun_eci"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.system.disk"}),":"]}),(0,e.jsxs)(v.Z,{span:18,children:[nt(r==null?void 0:r.system_disk_category,z),"/",r==null?void 0:r.system_disk_size,"G"]})]}),(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.storage_type"}),":"]}),(0,e.jsxs)(v.Z,{span:18,children:[nt(r==null?void 0:r.storage_type,z),"/",r==null?void 0:r.storage_size,"G/",r==null?void 0:r.storage_number,"\u4E2A"]})]})]})]}),(0,e.jsxs)(Mn.Z.Content,{style:{marginBottom:30},children:[(0,e.jsx)(K.Z.Text,{strong:!0,children:(0,e.jsx)(n._H,{id:"device.software"})}),(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.image"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:r==null?void 0:r.image_name})]})]}),!!Le&&(0,e.jsxs)(Mn.Z.Content,{style:{marginBottom:30},children:[(0,e.jsx)(K.Z.Text,{strong:!0,children:(0,e.jsx)(n._H,{id:"device.usage.state"})}),(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.server.state"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:r==null?void 0:r.real_state})]})]}),!!Le&&(0,e.jsxs)(Mn.Z.Content,{style:{marginBottom:30},children:[(0,e.jsx)(K.Z.Text,{strong:!0,children:(0,e.jsx)(n._H,{id:"device.channel_type"})}),(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsx)(v.Z,{span:6,children:"Channel:"}),(0,e.jsxs)(v.Z,{span:18,children:[(0,e.jsx)("span",{children:r==null?void 0:r.channel_type}),(0,e.jsx)("span",{className:ye().btn_style,onClick:function(){return b(r)},children:(0,e.jsx)(n._H,{id:"device.redeploy"})})]})]}),(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.state"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:Ie==null?void 0:Ie.toString()})]})]}),JSON.stringify(r==null?void 0:r.extra_param)!=="{}"&&(0,e.jsxs)(Mn.Z.Content,{style:{marginBottom:30},children:[(0,e.jsx)(K.Z.Text,{strong:!0,children:(0,e.jsx)(n._H,{id:"device.extended.fields"})}),r==null||(T=r.extra_param)===null||T===void 0?void 0:T.map(function(B,de){return B.param_key&&B.param_value!==""&&(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsx)(v.Z,{span:6}),(0,e.jsxs)(v.Z,{span:18,children:[B.param_key,":",B.param_value]})]},de)})]}),(0,e.jsxs)(Mn.Z.Content,{style:{marginBottom:30},children:[(0,e.jsx)(K.Z.Text,{strong:!0,children:(0,e.jsx)(n._H,{id:"device.scheduling.label"})}),(0,e.jsx)($.Z,{style:{marginTop:10},children:(r==null?void 0:r.tag_list)&&(r==null?void 0:r.tag_list.map(function(B){return(0,e.jsx)(Zn.Z,{color:B.tag_color,children:B.name},B.id)}))})]}),(0,e.jsxs)(Mn.Z.Content,{children:[(0,e.jsx)(K.Z.Text,{strong:!0,children:(0,e.jsx)(n._H,{id:"device.others.info"})}),(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.machine.name"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:r==null?void 0:r.name})]}),(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsx)(v.Z,{span:6,children:"Owner:"}),(0,e.jsx)(v.Z,{span:18,children:r==null?void 0:r.owner_name})]}),(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.creation_time"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:r==null?void 0:r.gmt_created})]}),(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.modify_time"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:r==null?void 0:r.gmt_modified})]}),(0,e.jsxs)($.Z,{gutter:20,className:ye().row,children:[(0,e.jsxs)(v.Z,{span:6,children:[(0,e.jsx)(n._H,{id:"device.description"}),":"]}),(0,e.jsx)(v.Z,{span:18,children:r==null?void 0:r.description})]})]})]}),(0,e.jsx)(ve.Z,{ref:pe,callback:P})]})}),ur=or,cr=t(97207),fr=t.n(cr),kt=t(46444),Mt=t(42847),vr=t(15122),Dt=t(94376),Pt=t(76742),Ot=t(79390),te=t(6130),Et=t(20905),Rt=t(91959),pr=[{value:"toneagent",label:"ToneAgent"}].map(function(me){return{id:me.value,name:me.label}}),Lt={page_num:1,page_size:10},mr=function(){var me=(0,Ke.TH)(),j=me.pathname,T=me.query,m=(0,n.YB)(),z=m.formatMessage,G=(0,n.Kd)()==="en-US",Te=(0,Ke.UO)(),r=Te.ws_id,_e=(0,n.md)(),Ce=(0,s.useRef)(null),We=(0,s.useState)(Object.prototype.toString.call(T==null?void 0:T.isInstance)==="[object String]"?+(T==null?void 0:T.isInstance):0),Le=(0,p.Z)(We,2),E=Le[0],$e=Le[1],Qe=(0,s.useState)(!1),Ie=(0,p.Z)(Qe,2),Be=Ie[0],Se=Ie[1],Je=(0,s.useState)(!1),be=(0,p.Z)(Je,2),we=be[0],Xe=be[1],Ne=(0,s.useState)({}),an=(0,p.Z)(Ne,2),W=an[0],pe=an[1],je=(0,s.useState)(Lt),qe=(0,p.Z)(je,2),b=qe[0],P=qe[1],B=(0,s.useState)(!1),de=(0,p.Z)(B,2),O=de[0],He=de[1],sn=(0,s.useState)(!1),ie=(0,p.Z)(sn,2),ln=ie[0],I=ie[1],k=(0,s.useState)({}),o=(0,p.Z)(k,2),H=o[0],he=o[1],q=(0,s.useState)(!0),ue=(0,p.Z)(q,2),re=ue[0],$n=ue[1],Ae=(0,s.useRef)(),vn=(0,s.useRef)(null),en=(0,s.useRef)(null),An=(0,ae.YM)(b),Fe=function(d){return{filterDropdown:function(M){var R=M.confirm;return(0,e.jsx)(X.Z,{confirm:R,onConfirm:function(se){var oe;return P((0,a.Z)((0,a.Z)({},b),{},(oe={},(0,un.Z)(oe,d,se),(0,un.Z)(oe,"page_num",1),oe)))}})},onFilterDropdownVisibleChange:function(M){M&&$n(!re)},filterIcon:function(){return(0,e.jsx)(Re.Z,{style:{color:b[d]?"#1890ff":void 0}})}}},mn=function(d,l){return{filterIcon:function(){return(0,e.jsx)(Re.Z,{style:{color:b[d]?"#1890ff":void 0}})},filterDropdown:function(R){var ke=R.confirm;return(0,e.jsx)(Mt.Z,{list:l,confirm:ke,onConfirm:function(oe){var y;return P((0,a.Z)((0,a.Z)({},b),{},(y={},(0,un.Z)(y,d,oe),(0,un.Z)(y,"page_num",1),y)))}})}}},Cn=function(d,l){return{filterIcon:function(){return(0,e.jsx)(Re.Z,{style:{color:b[d]?"#1890ff":void 0}})},filterDropdown:function(R){var ke=R.confirm;return(0,e.jsx)(vr.Z,{list:l,confirm:ke,onConfirm:function(oe){var y;return P((0,a.Z)((0,a.Z)({},b),{},(y={},(0,un.Z)(y,d,oe),(0,un.Z)(y,"page_num",1),y)))}})}}},Dn=function(){var h=(0,Y.Z)((0,x.Z)().mark(function d(){var l,M,R;return(0,x.Z)().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return l=b.name,M=(0,a.Z)((0,a.Z)({},b),{},{is_instance:Boolean(+E),server_conf:l}),Se(!0),se.next=5,(0,ne.$x)((0,a.Z)((0,a.Z)({},M),{},{ws_id:r}));case 5:R=se.sent,R&&pe(R),Se(!1);case 8:case"end":return se.stop()}},d)}));return function(){return h.apply(this,arguments)}}(),Pn=function(){var h=(0,Y.Z)((0,x.Z)().mark(function d(l){var M,R,ke;return(0,x.Z)().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return oe.next=2,(0,ne.vu)({server_id:l.id,server_provider:"aliyun"});case 2:M=oe.sent,R=M.code,ke=M.msg,R===200?(Ee.default.success(z({id:"device.synchronization.state.success"})),Dn()):(0,ae.EV)(R,ke);case 6:case"end":return oe.stop()}},d)}));return function(l){return h.apply(this,arguments)}}(),Ue=(0,ae.YM)(W),Ve=function(d){var l={0:z({id:"operation.not.release"}),1:z({id:"operation.release"}),2:z({id:"device.failed.save"})};return l[d]||""},D=+E,On=function(d){var l;(l=vn.current)===null||l===void 0||l.show((0,a.Z)((0,a.Z)({},d),{},{detailData:[d.private_ip],radio_type:"cloudManage"}))},ge=(0,s.useCallback)(function(h){Ae.current.show(h)},[]),Sn=fr().debounce(function(){var h=(0,Y.Z)((0,x.Z)().mark(function d(l,M){var R,ke,se;return(0,x.Z)().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return Xe(!0),R=An.current.page_size,ke={ws_id:r,is_release:M},y.next=5,(0,ne.BG)(l,ke);case 5:se=y.sent,se.code==200?(P((0,a.Z)((0,a.Z)({},b),{},{page_num:(0,ae.NG)(An,Ue),page_size:R})),Ee.default.success(z({id:"operation.success"})),He(!1),I(!1)):((0,ae.EV)(se.code,se.msg),setTimeout(function(){He(!1),I(!1)},300)),Xe(!1);case 8:case"end":return y.stop()}},d)}));return function(d,l){return h.apply(this,arguments)}}(),300),Fn=function(){var h=(0,Y.Z)((0,x.Z)().mark(function d(l,M){var R;return(0,x.Z)().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return he((0,a.Z)((0,a.Z)({},l),{},{is_release:M})),se.next=3,(0,Zt.Z9)({server_id:l.id,run_mode:"standalone",server_provider:"aliyun"});case 3:R=se.sent,R.data.length>0?He(!0):I(!0);case 5:case"end":return se.stop()}},d)}));return function(l,M){return h.apply(this,arguments)}}(),Kn=function(){var h=(0,Y.Z)((0,x.Z)().mark(function d(){var l;return(0,x.Z)().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,(0,ae.MR)({name:H.name,id:H.id});case 2:l=R.sent,l&&window.open("/ws/".concat(r,"/refenerce/6/?pk=").concat(l));case 4:case"end":return R.stop()}},d)}));return function(){return h.apply(this,arguments)}}();(0,s.useEffect)(function(){Dn()},[b,E]);var En=function(d){$e(d),P(Lt),n.m8.replace("".concat(j,"?").concat((0,Et.stringify)((0,a.Z)((0,a.Z)({},T),{},{isInstance:d}))))},wn=function(){var d;(d=Ce.current)===null||d===void 0||d.newMachine(void 0)},Qn=function(d){var l;(l=Ce.current)===null||l===void 0||l.editMachine(d)},zn=function(d){D==d?Dn():P((0,a.Z)((0,a.Z)({},b),{},{is_instance:d}))},Wn=[(0,a.Z)((0,a.Z)({title:D?(0,e.jsx)(n._H,{id:"device.instance.name"}):(0,e.jsx)(n._H,{id:"device.config.name"}),dataIndex:"name",width:140,fixed:"left",ellipsis:{showTitle:!1}},Fe("name")),{},{render:function(d,l){return(0,e.jsx)(te.K,{ellipsis:{tooltip:l.name},children:(0,e.jsx)(ee(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[b.name||""],autoEscape:!0,textToHighlight:l.name.toString()})})}}),!!D&&(0,a.Z)((0,a.Z)({title:"IP",dataIndex:"private_ip",width:140},Fe("private_ip")),{},{ellipsis:{showTitle:!1},render:function(d,l){return(0,e.jsx)(cn.Z,{val:d,param:l.id,provider:"aliyun",machine_pool:!0})}}),!!D&&(0,a.Z)((0,a.Z)({title:"SN",dataIndex:"sn"},Fe("sn")),{},{width:140,ellipsis:{showTitle:!1},render:function(d,l){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:l.sn})}}),!!D&&{title:"TSN",dataIndex:"tsn",width:140,ellipsis:{showTitle:!1},render:function(d,l){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:l.tsn})}},!!D&&(0,a.Z)((0,a.Z)({title:"InstanceId",dataIndex:"instance_id"},Fe("instance_id")),{},{width:140,ellipsis:{showTitle:!1},render:function(d,l){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:l.instance_id})}}),(0,a.Z)((0,a.Z)({title:(0,e.jsx)(n._H,{id:"device.manufacturer/ak"}),dataIndex:"manufacturer"},Fe("manufacturer_ak_name")),{},{width:160,ellipsis:{showTitle:!1},render:function(d,l){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:"".concat(l.manufacturer,"/").concat(l.ak_name)})}}),(0,a.Z)((0,a.Z)({title:"Region/Zone",width:160,dataIndex:"region"},Fe("region_zone")),{},{ellipsis:{showTitle:!1},render:function(d,l){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:"".concat(l.region,"/").concat(l.zone)})}}),(0,a.Z)((0,a.Z)({title:(0,e.jsx)(n._H,{id:"device.instance_type"}),width:G?160:110,dataIndex:"instance_type"},Fe("instance_type")),{},{ellipsis:{showTitle:!1},render:function(d,l){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:l.instance_type})}}),(0,a.Z)((0,a.Z)({title:(0,e.jsx)(n._H,{id:"device.image"}),dataIndex:"image"},Fe("image")),{},{width:160,ellipsis:{showTitle:!1},render:function(d,l){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:l.image})}}),(0,a.Z)((0,a.Z)({title:(0,e.jsx)(n._H,{id:"device.bandwidth"}),width:G?120:70},Fe("bandwidth")),{},{dataIndex:"bandwidth",ellipsis:{showTitle:!1},render:function(d){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:d})}}),(0,a.Z)((0,a.Z)({title:(0,e.jsx)(n._H,{id:"device.storage_type"})},mn("storage_type",[["cloud",z({id:"device.cloud"})],["cloud_efficiency",z({id:"device.cloud_efficiency"})],["cloud_ssd",z({id:"device.cloud_ssd"})],["cloud_essd",z({id:"device.cloud_essd"})]].map(function(h){return{id:h[0],name:h[1]}}))),{},{dataIndex:"storage_type",width:G?130:90,ellipsis:{showTitle:!1},render:function(d,l){return(0,e.jsx)(rt,{name:l.storage_type,formatMessage:z})}}),(0,a.Z)((0,a.Z)({title:(0,e.jsx)(n._H,{id:"device.release_rule"}),align:"center"},Cn("release_rule",[{id:0,name:z({id:"operation.not.release"})},{id:1,name:z({id:"operation.release"})},{id:2,name:z({id:"device.failed.save"})}])),{},{dataIndex:"release_rule",width:G?150:110,ellipsis:{showTitle:!1},render:function(d,l){return Ve(l.release_rule)}}),{title:(0,e.jsx)(n._H,{id:"device.console_conf"}),width:G?170:100,dataIndex:"console_conf",ellipsis:{showTitle:!1},render:function(d){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:d})}},{title:(0,e.jsx)(n._H,{id:"device.channel_type"}),width:100,ellipsis:{showTitle:!1},dataIndex:"channel_type",filterIcon:function(){return(0,e.jsx)(Re.Z,{style:{color:b.channel_type?"#1890ff":void 0}})},filterDropdown:function(d){var l=d.confirm;return(0,e.jsx)(Mt.Z,{list:pr,confirm:l,onConfirm:function(R){return P((0,a.Z)((0,a.Z)({},b),{},{channel_type:R,page_num:1}))}})}},!!D&&{title:(0,e.jsxs)(fe.Z,{children:[(0,e.jsx)(n._H,{id:"device.usage.state"}),(0,e.jsx)(on.Z,{title:z({id:"device.usage.state.Tooltip"}),children:(0,e.jsx)(bn.Z,{})})]}),dataIndex:"state",width:G?150:120,ellipsis:{showTitle:!1},render:function(d,l){return(0,lt.Ul)(d,l,r)},filterIcon:function(){return(0,e.jsx)(Re.Z,{style:{color:b.state?"#1890ff":void 0}})},filterDropdown:function(d){var l=d.confirm;return(0,e.jsx)(kt.Z,{confirm:l,onConfirm:function(R){return P((0,a.Z)((0,a.Z)({},b),{},{state:R,page_num:1}))},stateVal:b.state,tabType:D,dataArr:["Available","Occupied","Broken","Reserved","Unusable"]})}},!!D&&{title:(0,e.jsxs)(fe.Z,{children:[(0,e.jsx)(n._H,{id:"device.real_state"}),(0,e.jsx)(on.Z,{title:z({id:"device.real_state.Tooltip"}),children:(0,e.jsx)(bn.Z,{})})]}),width:G?150:120,ellipsis:{showTitle:!1},dataIndex:"real_state",render:function(d,l){return(0,lt.Ul)(d,l,r)},filterIcon:function(){return(0,e.jsx)(Re.Z,{style:{color:b.real_state?"#1890ff":void 0}})},filterDropdown:function(d){var l=d.confirm;return(0,e.jsx)(kt.Z,{confirm:l,onConfirm:function(R){return P((0,a.Z)((0,a.Z)({},b),{},{real_state:R,page_num:1}))},stateVal:b.real_state,tabType:D,dataArr:["Online","Offline"]})}},{title:"Owner",width:120,dataIndex:"owner_name",ellipsis:{showTitle:!1},filterIcon:function(){return(0,e.jsx)(Re.Z,{style:{color:b.owner?"#1890ff":void 0}})},filterDropdown:function(d){var l=d.confirm;return(0,e.jsx)(Hn.Z,{confirm:l,onConfirm:function(R){P((0,a.Z)((0,a.Z)({},b),{},{owner:R,page_num:1}))}})}},{title:(0,e.jsx)(n._H,{id:"device.tag"}),dataIndex:"tags",width:240,ellipsis:{showTitle:!1},filterIcon:function(){var d;return(0,e.jsx)(Re.Z,{style:{color:b.tags&&((d=b.tags)===null||d===void 0?void 0:d.length)>0?"#1890ff":void 0}})},filterDropdown:function(d){var l=d.confirm;return(0,e.jsx)(Ct.Z,{ws_id:r,run_mode:"standalone",autoFocus:re,confirm:l,onConfirm:function(R){P((0,a.Z)((0,a.Z)({},b),{},{tags:R,page_num:1}))}})},render:function(d,l){return(0,e.jsx)(Dt.Z,{list:l.tag_list.map(function(M){return(0,e.jsx)(Zn.Z,{color:M.tag_color,children:M.name},(0,Rt.Z)())})})}},(0,a.Z)((0,a.Z)({title:(0,e.jsx)(n._H,{id:"device.description"}),width:140,dataIndex:"description"},Fe("description")),{},{ellipsis:{showTitle:!1},render:function(d,l){return(0,e.jsx)(te.K,{ellipsis:{tooltip:l.description},children:(0,e.jsx)(ee(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[b.description||""],autoEscape:!0,textToHighlight:l.description?l.description.toString():"-"})})}}),{title:(0,e.jsx)(n._H,{id:"Table.columns.operation"}),fixed:"right",valueType:"option",key:"operation",width:D?G?380:310:230,ellipsis:{showTitle:!1},render:function(d,l){return(0,e.jsxs)(fe.Z,{children:[(0,e.jsx)(K.Z.Link,{onClick:function(){return en.current.show(l,D)},children:(0,e.jsx)(n._H,{id:"operation.detail"})}),(0,e.jsx)(n.Nv,{accessible:_e.WsMemberOperateSelf(l.owner),fallback:(0,e.jsxs)(fe.Z,{onClick:function(){return(0,ae.WR)()},children:[!!D&&(0,e.jsx)(K.Z.Link,{children:(0,e.jsx)(n._H,{id:"device.synchronization.state"})}),(0,e.jsx)(K.Z.Link,{children:(0,e.jsx)(n._H,{id:"operation.edit"})}),!!D&&(0,e.jsx)(K.Z.Link,{children:(0,e.jsx)(n._H,{id:"device.deploy"})}),!!D&&(0,e.jsx)(K.Z.Link,{children:(0,e.jsx)(n._H,{id:"operation.delete"})}),(0,e.jsx)(K.Z.Link,{children:D?(0,e.jsx)(n._H,{id:"operation.release"}):(0,e.jsx)(n._H,{id:"operation.delete"})})]}),children:(0,e.jsxs)(fe.Z,{children:[!!D&&(0,e.jsx)(K.Z.Link,{onClick:function(){return Pn(l)},children:(0,e.jsx)(n._H,{id:"device.synchronization.state"})}),(0,e.jsx)(K.Z.Link,{onClick:function(){return Qn(l)},children:(0,e.jsx)(n._H,{id:"operation.edit"})}),!!D&&(0,e.jsx)(K.Z.Link,{onClick:function(){return On(l)},children:(0,e.jsx)(n._H,{id:"device.deploy"})}),!!D&&(0,e.jsx)(K.Z.Link,{onClick:function(){return Fn((0,a.Z)({},l),!1)},children:(0,e.jsx)(n._H,{id:"operation.delete"})}),(0,e.jsx)(K.Z.Link,{onClick:function(){return Fn((0,a.Z)({},l),!!D)},children:D?(0,e.jsx)(n._H,{id:"operation.release"}):(0,e.jsx)(n._H,{id:"operation.delete"})})]})}),(0,e.jsx)(K.Z.Link,{onClick:function(){return ge(l.id)},children:(0,e.jsx)(n._H,{id:"operation.log"})})]})}}],hn=H[D?"private_ip":"name"];return(0,e.jsxs)("div",{className:ye().warp,children:[(0,e.jsxs)(Ze.Z,{type:"card",onTabClick:En,activeKey:E+"",tabBarExtraContent:(0,e.jsx)(J.Z,{type:"primary",onClick:wn,children:D?(0,e.jsx)(n._H,{id:"device.add.server.instance"}):(0,e.jsx)(n._H,{id:"device.add.server.config"})}),children:[(0,e.jsx)(Ze.Z.TabPane,{tab:(0,e.jsx)(n._H,{id:"device.server.config"})},0),(0,e.jsx)(Ze.Z.TabPane,{tab:(0,e.jsx)(n._H,{id:"device.server.instance"})},1)]}),(0,e.jsx)(Ot.sL,{size:"small",loading:Be,columns:Wn,refreshDeps:[D,r,_e,G,b],name:"ws-server-cloud-standalone-".concat(D?"setting":"server"),dataSource:W.data,rowKey:"id",pagination:!1}),(0,e.jsx)(Pt.Z,{total:W.total,pageSize:b.page_size,currentPage:b.page_num,onPageChange:function(d,l){P((0,a.Z)((0,a.Z)({},b),{},{page_num:d,page_size:l}))}}),(0,e.jsx)(pt.Z,{ref:Ae,operation_object:"machine_cloud_server"}),(0,e.jsx)(xt,{onRef:Ce,is_instance:D,onSuccess:zn,type:"standalone"}),(0,e.jsx)(ve.Z,{ref:vn}),(0,e.jsx)(ur,{ref:en}),(0,e.jsxs)(ze.Z,{title:(0,e.jsx)("div",{children:(0,e.jsx)(n._H,{id:D?"delete.tips":"device.tips"})}),centered:!0,open:O,onCancel:function(){return He(!1)},footer:[(0,e.jsx)(J.Z,{type:"danger",onClick:function(){return Sn(H.id,H.is_release)},loading:we,children:(0,e.jsx)(n._H,{id:H.is_release?"operation.release":"operation.confirm.delete"})},"submit"),(0,e.jsx)(J.Z,{onClick:function(){return He(!1)},children:(0,e.jsx)(n._H,{id:"operation.cancel"})},"back")],width:600,maskClosable:!1,children:[(0,e.jsxs)("div",{style:{color:"red",marginBottom:5},children:[(0,e.jsx)(In.Z,{style:{marginRight:4}}),(0,e.jsx)(n._H,{id:"device.delete.tips"})]}),(0,e.jsx)("div",{style:{color:"#1890FF",cursor:"pointer"},onClick:Kn,children:(0,e.jsx)(n._H,{id:"view.quote.details"})})]}),(0,e.jsx)(ze.Z,{title:(0,e.jsx)("div",{children:(0,e.jsx)(n._H,{id:D?"device.tips":"delete.tips"})}),centered:!0,open:ln,onCancel:function(){return I(!1)},footer:[(0,e.jsx)(J.Z,{type:"danger",onClick:function(){return Sn(H.id,H.is_release)},loading:we,children:!D||!H.is_release?(0,e.jsx)(n._H,{id:"operation.confirm.delete"}):(0,e.jsx)(n._H,{id:"operation.release"})},"submit"),(0,e.jsx)(J.Z,{onClick:function(){return I(!1)},children:(0,e.jsx)(n._H,{id:"operation.cancel"})},"back")],width:"30%",children:(0,e.jsx)("div",{style:{color:"red",marginBottom:5},children:(0,e.jsxs)($.Z,{align:"middle",children:[(0,e.jsx)(In.Z,{style:{marginRight:4,verticalAlign:"middle"}}),(0,e.jsxs)("div",{children:[(!D||!H.is_release)&&!D?z({id:"device.delete.config"},{data:hn}):null,(!D||!H.is_release)&&!!D?z({id:"device.delete.instance"},{data:hn}):null,!(!D||!H.is_release)&&!D?z({id:"device.release.config"},{data:hn}):null,!(!D||!H.is_release)&&!!D?z({id:"device.release.instance"},{data:hn}):null]})]})})})]})},ta=t(11407),hr=t(68077),gr=t(44461),xr=t.n(gr),Zr=t(48766),_r=t(81343),ra=t(20632),jr=t(71853),yr=t(488),$t=t(5888),At=t(38755),Cr=t(24480),_t=t.n(Cr),Sr=["test_server"],wr=function(j){var T=(0,n.YB)(),m=T.formatMessage,z=(0,n.Kd)()==="en-US",G=(0,Ke.UO)(),Te=G.ws_id,r=j.cluster_id,_e=j.width,Ce=j.onRef,We=j.size,Le=j.top,E=j.is_instance,$e=(0,s.useState)(!1),Qe=(0,p.Z)($e,2),Ie=Qe[0],Be=Qe[1],Se=(0,s.useState)([]),Je=(0,p.Z)(Se,2),be=Je[0],we=Je[1],Xe=(0,s.useState)(),Ne=(0,p.Z)(Xe,2),an=Ne[0],W=Ne[1],pe=(0,s.useRef)(null),je=(0,n.md)(),qe=(0,s.useRef)(),b=function(){var I=(0,Y.Z)((0,x.Z)().mark(function k(){var o,H;return(0,x.Z)().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return Be(!0),q.next=3,(0,ne.L0)({cluster_id:r});case 3:if(q.t0=q.sent,q.t0){q.next=6;break}q.t0={};case 6:H=q.t0,H.data=(o=H.data)===null||o===void 0?void 0:o.map(function(ue){return ue.machineId=ue.id,(0,a.Z)((0,a.Z)({},ue),ue.test_server)}),Array.isArray(H.data)?we(H.data):we([]),Be(!1);case 10:case"end":return q.stop()}},k)}));return function(){return I.apply(this,arguments)}}(),P=(0,s.useCallback)(function(I){qe.current.show(I)},[]),B=function(){var I=(0,Y.Z)((0,x.Z)().mark(function k(o,H){var he,q,ue,re;return(0,x.Z)().wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:if(o.machineId){Ae.next=2;break}return Ae.abrupt("return");case 2:return he=o.test_server,q=(0,yr.Z)(o,Sr),ue=H==="role"?(0,a.Z)((0,a.Z)((0,a.Z)({},he),q),{},{role:"local"}):(0,a.Z)((0,a.Z)((0,a.Z)({},he),q),{},{baseline_server:1}),Ae.next=6,(0,ne.oz)(o.machineId,ue);case 6:re=Ae.sent,re.code===200?(Ee.default.success(m({id:"operation.success"})),b()):(0,ae.EV)(re.code,re.msg);case 8:case"end":return Ae.stop()}},k)}));return function(o,H){return I.apply(this,arguments)}}(),de=function(k){var o={0:m({id:"operation.not.release"}),1:m({id:"operation.release"}),2:m({id:"device.failed.save"})};return o[k]||""},O=function(){var I=(0,Y.Z)((0,x.Z)().mark(function k(o){var H,he,q;return(0,x.Z)().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return re.next=2,(0,ne.vu)({server_id:o.server_id,server_provider:"aliyun"});case 2:H=re.sent,he=H.code,q=H.msg,he===200?(Ee.default.success(m({id:"device.synchronization.state.success"})),b()):(0,ae.EV)(he,q);case 6:case"end":return re.stop()}},k)}));return function(o){return I.apply(this,arguments)}}(),He=function(k){pe.current&&pe.current.editMachine((0,a.Z)((0,a.Z)({},k),{},{cluster_id:r}))},sn=function(){var I=(0,Y.Z)((0,x.Z)().mark(function k(o){var H,he,q;return(0,x.Z)().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return re.next=2,(0,ne.XW)(o.machineId);case 2:H=re.sent,he=H.code,q=H.msg,he===200?(b(),Ee.default.success(m({id:"request.delete.success"}))):Ee.default.success(q);case 6:case"end":return re.stop()}},k)}));return function(o){return I.apply(this,arguments)}}();(0,s.useEffect)(function(){b()},[an]),(0,s.useImperativeHandle)(Ce,function(){return{reload:function(){W(new Date().getTime())}}});var ie=[{title:E?(0,e.jsx)(n._H,{id:"device.server.instance"}):(0,e.jsx)(n._H,{id:"device.server.config"}),dataIndex:"name",width:160,fixed:"left",ellipsis:{showTitle:!1},render:function(k,o){return E?(0,e.jsx)(cn.Z,{val:k,param:o.id,provider:"aliyun",machine_pool:!0}):(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:o.name})}},!!E&&{title:"SN",dataIndex:"sn",width:150,ellipsis:{showTitle:!1},render:function(k,o){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:o.sn})}},!!E&&{title:"TSN",dataIndex:"tsn",width:150,ellipsis:{showTitle:!1},render:function(k,o){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:o.tsn})}},!1,{title:(0,e.jsx)(n._H,{id:"device.manufacturer/ak"}),dataIndex:"manufacturer",width:120,ellipsis:{showTitle:!1},render:function(k,o){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:"".concat(o.manufacturer,"/").concat(o.ak_name)})}},{title:"Region/Zone",width:120,ellipsis:{showTitle:!1},dataIndex:"region",render:function(k,o){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:"".concat(o.region,"/").concat(o.zone)})}},{title:(0,e.jsx)(n._H,{id:"device.instance_type"}),dataIndex:"instance_type",width:120,ellipsis:{showTitle:!1},render:function(k,o){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:o.instance_type})}},{title:(0,e.jsx)(n._H,{id:"device.image"}),width:120,ellipsis:{showTitle:!1},dataIndex:"image",render:function(k,o){return(0,e.jsx)(te.K,{ellipsis:{tooltip:o.image},children:o.image_name})}},{title:(0,e.jsx)(n._H,{id:"device.bandwidth"}),width:100,dataIndex:"bandwidth"},{title:(0,e.jsx)(n._H,{id:"device.storage_type"}),dataIndex:"storage_type",ellipsis:{showTitle:!1},width:100,render:function(k,o){return(0,e.jsx)(rt,{name:o.storage_type,formatMessage:m})}},{title:(0,e.jsx)(n._H,{id:"device.console_conf"}),width:z?170:100,ellipsis:{showTitle:!1},dataIndex:"console_conf",render:function(k,o){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:o.console_conf})}},{title:(0,e.jsx)(n._H,{id:"device.release_rule"}),dataIndex:"release_rule",width:z?150:110,ellipsis:{showTitle:!1},render:function(k,o){return de(o.release_rule)}},{title:(0,e.jsx)(n._H,{id:"device.private_ip"}),width:160,ellipsis:{showTitle:!1},dataIndex:"private_ip",render:function(k,o){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:o.private_ip})}},{title:(0,e.jsx)(n._H,{id:"device.channel_type"}),dataIndex:"channel_type",width:100,ellipsis:{showTitle:!1},render:function(k,o){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:o.channel_type})}},{title:"Owner",width:100,ellipsis:{showTitle:!1},dataIndex:"owner_name",render:function(k,o){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:o.owner_name})}},{title:(0,e.jsx)(n._H,{id:"device.local.server"}),dataIndex:"role",width:120,align:"center",render:function(k,o){return o.role==="local"?(0,e.jsx)($t.Z,{style:{width:17.5,height:17.5,color:"#1890ff"}}):(0,e.jsx)(At.Z,{onClick:function(){return B(o,"role")},style:{cursor:"pointer",width:17.5,height:17.5,color:"rgba(0,0,0,.1)"}})}},{title:(0,e.jsx)(n._H,{id:"device.baseline_server"}),dataIndex:"baseline_server",width:140,align:"center",render:function(k,o){return k?(0,e.jsx)($t.Z,{style:{width:17.5,height:17.5,color:"#1890ff"}}):(0,e.jsx)(At.Z,{onClick:function(){return B(o,"baseline_server")},style:{cursor:"pointer",width:17.5,height:17.5,color:"rgba(0,0,0,.1)"}})}},{title:(0,e.jsx)(n._H,{id:"device.install.kernel"}),dataIndex:"kernel_install",width:120,render:function(k){return k?(0,e.jsx)(n._H,{id:"operation.yes"}):(0,e.jsx)(n._H,{id:"operation.no"})}},{title:(0,e.jsx)(n._H,{id:"device.var_name"}),dataIndex:"var_name",width:z?170:110,ellipsis:{showTitle:!1}},!!E&&{title:(0,e.jsx)(n._H,{id:"device.server.state"}),width:120,dataIndex:"state",ellipsis:{showTitle:!1},render:function(k,o){return(0,lt.Ul)(o.test_server.state,o.test_server,Te)}},!!E&&{title:(0,e.jsx)(n._H,{id:"device.real_state"}),width:160,dataIndex:"real_state",ellipsis:{showTitle:!1},render:function(k,o){return(0,lt.Ul)(o.test_server.real_state,o.test_server,Te)}},{title:(0,e.jsx)(n._H,{id:"device.description"}),width:120,ellipsis:{showTitle:!1},dataIndex:"description",render:function(k,o){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},width:100,children:o.description})}},{title:(0,e.jsx)(n._H,{id:"Table.columns.operation"}),fixed:"right",valueType:"option",key:"operation",width:222,render:function(k,o){return(0,e.jsxs)(fe.Z,{children:[(0,e.jsx)(n.Nv,{accessible:je.WsMemberOperateSelf(o.test_server.owner),fallback:(0,e.jsxs)(fe.Z,{children:[!!E&&(0,e.jsx)(K.Z.Link,{onClick:function(){return(0,ae.WR)()},children:(0,e.jsx)(n._H,{id:"device.synchronization.state"})}),(0,e.jsx)(K.Z.Link,{onClick:function(){return(0,ae.WR)()},children:(0,e.jsx)(n._H,{id:"operation.edit"})}),(0,e.jsx)(K.Z.Link,{onClick:function(){return(0,ae.WR)()},children:(0,e.jsx)(n._H,{id:"operation.delete"})})]}),children:(0,e.jsxs)(fe.Z,{children:[!!E&&(0,e.jsx)(K.Z.Link,{onClick:function(){return O(o)},children:(0,e.jsx)(n._H,{id:"device.synchronization.state"})}),(0,e.jsx)(K.Z.Link,{onClick:function(){He(o)},children:(0,e.jsx)(n._H,{id:"operation.edit"})}),(0,e.jsx)(jr.Z,{title:(0,e.jsx)(K.Z.Text,{type:"danger",children:m({id:"delete.prompt"},{data:"(".concat(o.name,")")})}),placement:"topRight",okText:(0,e.jsx)(n._H,{id:"operation.cancel"}),cancelText:(0,e.jsx)(n._H,{id:"operation.confirm.delete"}),onCancel:function(){sn(o)},overlayStyle:{width:"280px"},icon:(0,e.jsx)(In.Z,{style:{color:"red"}}),children:(0,e.jsx)(K.Z.Link,{children:(0,e.jsx)(n._H,{id:"operation.delete"})})})]})}),(0,e.jsx)(K.Z.Link,{onClick:function(){return P(o.id)},children:(0,e.jsx)(n._H,{id:"operation.log"})})]})}}],ln=function(){W(new Date().getTime())};return(0,e.jsxs)("div",{className:_t().warp,children:[(0,e.jsx)("div",{className:_t().tree,style:{backgroundSize:"40px ".concat(We,"px"),height:Le,backgroundPosition:"left center"}}),!!be.length&&(0,e.jsx)("div",{className:_t().tree,style:{backgroundSize:"40px ".concat(We,"px"),height:We*be.length+30,top:Le}}),(0,e.jsx)(Ot.sL,{style:{width:_e-79},loading:Ie,scroll:{x:"100%"},columns:ie,refreshDeps:[E,Te,z],name:"ws-device-cloud-group",showHeader:!!be.length,dataSource:be,rowKey:"id",pagination:!1}),(0,e.jsx)(pt.Z,{ref:qe,operation_object:"machine_cloud_server"}),(0,e.jsx)(xt,{onRef:pe,is_instance:E,onSuccess:ln,type:"cluster",cluster_id:r})]})},Tr=wr,br=function(j){var T=j.outParam,m=j.tagFlag,z=j.is_instance,G=j.params,Te=j.setParams,r=(0,n.YB)(),_e=r.formatMessage,Ce=(0,Ke.UO)(),We=Ce.ws_id,Le=V.Z.useForm(),E=(0,p.Z)(Le,1),$e=E[0],Qe=(0,s.useState)(!1),Ie=(0,p.Z)(Qe,2),Be=Ie[0],Se=Ie[1],Je=(0,s.useState)({}),be=(0,p.Z)(Je,2),we=be[0],Xe=be[1];(0,s.useEffect)(function(){$e.resetFields(),JSON.stringify(T)!=="{}"&&setTimeout(function(){var W,pe=((W=T.tag_list)===null||W===void 0?void 0:W.map(function(je){return je.id}))||[];$e.setFieldsValue((0,a.Z)((0,a.Z)({},T),{},{tags:pe}))},1)},[T]),(0,s.useEffect)(function(){JSON.stringify(m)!=="{}"&&!!m.isQuery.length&&Se(!0)},[m]);var Ne=function(){var W=(0,Y.Z)((0,x.Z)().mark(function pe(je){var qe,b,P,B;return(0,x.Z)().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(JSON.stringify(T)==="{}"){O.next=15;break}return qe={description:je.description||"",tags:je.tags,emp_id:je.emp_id,name:je.name,ws_id:We},O.next=4,(0,ne.Tv)(T.id,qe);case 4:if(O.t0=O.sent,O.t0){O.next=7;break}O.t0={};case 7:if(b=O.t0,b.code!==200){O.next=13;break}return Se(!1),Ee.default.success(_e({id:"operation.success"})),Te((0,a.Z)((0,a.Z)({},G),{},{refresh:!G.refresh})),O.abrupt("return");case 13:return Xe((0,a.Z)((0,a.Z)({},b),{},{error:!0})),O.abrupt("return");case 15:return P=(0,a.Z)((0,a.Z)({},je),{},{ws_id:We,is_instance:String(z)}),P.description=je.description||"",P.cluster_type="aliyun",O.next=20,(0,ne.Rp)((0,a.Z)({},P));case 20:if(B=O.sent,B.code!==200){O.next=26;break}return Se(!1),Ee.default.success(_e({id:"operation.success"})),Te((0,a.Z)((0,a.Z)({},G),{},{page:1,refresh:!G.refresh})),O.abrupt("return");case 26:Xe((0,a.Z)((0,a.Z)({},B),{},{error:!0}));case 27:case"end":return O.stop()}},pe)}));return function(je){return W.apply(this,arguments)}}(),an=function(){$e.validateFields().then(function(pe){return Ne(pe)})};return(0,e.jsx)(mt.Z,{maskClosable:!1,keyboard:!1,title:JSON.stringify(T)!=="{}"?(0,e.jsx)(n._H,{id:"device.cluster.edit"}):(0,e.jsx)(n._H,{id:"device.cluster.btn"}),width:376,onClose:function(){return Se(!1)},open:Be,bodyStyle:{paddingBottom:80},footer:(0,e.jsxs)("div",{style:{textAlign:"right"},children:[(0,e.jsx)(J.Z,{onClick:function(){return Se(!1)},style:{marginRight:8},children:(0,e.jsx)(n._H,{id:"operation.cancel"})}),(0,e.jsx)(J.Z,{type:"primary",onClick:function(){return an()},children:JSON.stringify(T)!=="{}"?(0,e.jsx)(n._H,{id:"operation.update"}):(0,e.jsx)(n._H,{id:"operation.ok"})})]}),children:(0,e.jsx)(V.Z,{layout:"vertical",form:$e,children:(0,e.jsxs)($.Z,{gutter:16,children:[(0,e.jsx)(v.Z,{span:24,children:(0,e.jsx)(V.Z.Item,{label:(0,e.jsx)(n._H,{id:"device.cluster.name.s"}),name:"name",rules:[{required:!0,message:_e({id:"device.cluster.name.s.message"})}],validateStatus:we.error?"error":void 0,help:we.msg==="cluster existed"?_e({id:"device.cluster.name.s.existed"}):we.msg,children:(0,e.jsx)(_n.Z,{autoComplete:"off",placeholder:_e({id:"please.enter"}),onChange:function(pe){return Xe({})}})})}),(0,e.jsx)(v.Z,{span:24,children:(0,e.jsx)(wt.Z,{})}),(0,e.jsx)(v.Z,{span:24,children:(0,e.jsx)(It.Z,(0,a.Z)({},m))}),(0,e.jsx)(v.Z,{span:24,children:(0,e.jsx)(V.Z.Item,{name:"description",label:(0,e.jsx)(n._H,{id:"device.description"}),children:(0,e.jsx)(_n.Z.TextArea,{rows:3,placeholder:_e({id:"please.enter"})})})})]})})})},Ir=br,Hr=t(77740),Ft={refresh:!0,page_num:1,page_size:10,name:"",owner:"",tags:"",description:"",is_instance:0},kr=function(){var j=(0,Ke.TH)(),T=j.pathname,m=j.query,z=(0,n.YB)(),G=z.formatMessage,Te=(0,Ke.UO)(),r=Te.ws_id,_e=V.Z.useForm(),Ce=(0,p.Z)(_e,1),We=Ce[0],Le=(0,n.md)(),E=(0,s.useRef)(null),$e=(0,s.useRef)(null),Qe=(0,s.useRef)(null),Ie=(0,s.useState)(Object.prototype.toString.call(m==null?void 0:m.isInstance)==="[object String]"?+(m==null?void 0:m.isInstance):0),Be=(0,p.Z)(Ie,2),Se=Be[0],Je=Be[1],be=(0,s.useState)(!1),we=(0,p.Z)(be,2),Xe=we[0],Ne=we[1],an=(0,s.useState)({}),W=(0,p.Z)(an,2),pe=W[0],je=W[1],qe=(0,s.useState)(Ft),b=(0,p.Z)(qe,2),P=b[0],B=b[1],de=(0,s.useState)({list:[],isQuery:""}),O=(0,p.Z)(de,2),He=O[0],sn=O[1],ie=(0,s.useState)({}),ln=(0,p.Z)(ie,2),I=ln[0],k=ln[1],o=(0,s.useState)([]),H=(0,p.Z)(o,2),he=H[0],q=H[1],ue=39,re=41,$n=(0,s.useState)(!1),Ae=(0,p.Z)($n,2),vn=Ae[0],en=Ae[1],An=(0,s.useState)({}),Fe=(0,p.Z)(An,2),mn=Fe[0],Cn=Fe[1],Dn=(0,s.useState)(!0),Pn=(0,p.Z)(Dn,2),Ue=Pn[0],Ve=Pn[1],D=(0,s.useRef)(),On=(0,s.useRef)(),ge=(0,ae.YM)(P),Sn=(0,s.useCallback)(function(y){D.current.show(y)},[]),Fn=function(){var y=(0,Y.Z)((0,x.Z)().mark(function _(){var g,L,Q=arguments;return(0,x.Z)().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:return g=Q.length>0&&Q[0]!==void 0?Q[0]:{},Ne(!0),le.next=4,(0,ne.Sy)((0,a.Z)({},g));case 4:L=le.sent,L&&je(L),Ne(!1);case 7:case"end":return le.stop()}},_)}));return function(){return y.apply(this,arguments)}}(),Kn=(0,ae.YM)(pe),En=function(){k({}),sn((0,a.Z)((0,a.Z)({},He),{},{isQuery:"add",list:[]})),We.resetFields()};(0,s.useEffect)(function(){Fn((0,a.Z)((0,a.Z)({},P),{},{cluster_type:"aliyun",is_instance:+Se,ws_id:r}))},[P,Se]);var wn=(0,Yn.CR)(),Qn=wn.width,zn=function(_){var g=_.tag_list.map(function(L){return L.id});sn((0,a.Z)((0,a.Z)({},He),{},{isQuery:"edit",list:g})),k((0,a.Z)({},_))},Wn=function(){var y=(0,Y.Z)((0,x.Z)().mark(function _(g){var L,Q;return(0,x.Z)().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:return Cn(g),le.next=3,(0,Zt.Z9)({server_id:g.id,run_mode:"cluster",server_provider:"aliyun"});case 3:L=le.sent,L.data.length>0?en(!0):(Q=On.current)===null||Q===void 0||Q.show(g,"(".concat(g.name,")"));case 5:case"end":return le.stop()}},_)}));return function(g){return y.apply(this,arguments)}}(),hn=function(){var y=(0,Y.Z)((0,x.Z)().mark(function _(g){var L,Q,nn,le,jn;return(0,x.Z)().wrap(function(gn){for(;;)switch(gn.prev=gn.next){case 0:return L={ws_id:r},Q=ge.current.page_size,gn.next=4,(0,ne.rc)(g,L);case 4:nn=gn.sent,le=nn.code,jn=nn.msg,le===200?(Ee.default.success(G({id:"operation.success"})),en(!1),B((0,a.Z)((0,a.Z)({},P),{},{page_num:(0,ae.NG)(ge,Kn),page_size:Q}))):(0,ae.EV)(le,jn);case 8:case"end":return gn.stop()}},_)}));return function(g){return y.apply(this,arguments)}}(),h=function(){var y=(0,Y.Z)((0,x.Z)().mark(function _(g,L){var Q,nn;return(0,x.Z)().wrap(function(jn){for(;;)switch(jn.prev=jn.next){case 0:Q=L.id+"",nn=g?he.concat([Q]):he.filter(function(dt){return dt!==Q}),q(nn);case 3:case"end":return jn.stop()}},_)}));return function(g,L){return y.apply(this,arguments)}}(),d=function(_){E.current&&E.current.newMachine(_)},l=function(){var y=(0,Y.Z)((0,x.Z)().mark(function _(){var g;return(0,x.Z)().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return Q.next=2,(0,ae.MR)({name:mn.name,id:mn.id});case 2:g=Q.sent,g&&window.open("/ws/".concat(r,"/refenerce/7/?pk=").concat(g));case 4:case"end":return Q.stop()}},_)}));return function(){return y.apply(this,arguments)}}(),M=function(_){var g=_.parentId;if(g&&he.indexOf(g+"")<0){var L=he.concat([g+""]);q(L)}$e.current&&$e.current.reload("add",{parentRowId:g})},R=function(_){return{filterDropdown:function(L){var Q=L.confirm;return(0,e.jsx)(X.Z,{confirm:Q,onConfirm:function(le){return B((0,a.Z)((0,a.Z)({},P),{},(0,un.Z)({page_num:1},_,le)))}})},onFilterDropdownVisibleChange:function(L){L&&Ve(!Ue)},filterIcon:function(){return(0,e.jsx)(Re.Z,{style:{color:P[_]?"#1890ff":void 0}})}}},ke=[(0,a.Z)((0,a.Z)({title:(0,e.jsx)(n._H,{id:"device.cluster.name"}),dataIndex:"name",width:150},R("name")),{},{render:function(_,g){return(0,e.jsx)(te.K,{ellipsis:{tooltip:g.name},children:(0,e.jsx)(ee(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[P.name||""],autoEscape:!0,textToHighlight:g.name.toString()})})}}),{title:"Owner",dataIndex:"owner_name",width:150,filterIcon:function(){return(0,e.jsx)(Re.Z,{style:{color:P.owner?"#1890ff":void 0}})},filterDropdown:function(_){var g=_.confirm;return(0,e.jsx)(Hn.Z,{autoFocus:Ue,confirm:g,onConfirm:function(Q){B((0,a.Z)((0,a.Z)({},P),{},{page_num:1,owner:Q}))}})},onFilterDropdownVisibleChange:function(_){_&&Ve(!Ue)},render:function(_,g){return(0,e.jsx)(te.K,{ellipsis:{tooltip:!0},children:g.owner_name})}},{title:(0,e.jsx)(n._H,{id:"device.tag"}),dataIndex:"tag_list",ellipsis:{showTitle:!1},width:240,filterIcon:function(){return(0,e.jsx)(Re.Z,{style:{color:P.tags&&P.tags.length>0?"#1890ff":void 0}})},filterDropdown:function(_){var g=_.confirm;return(0,e.jsx)(Ct.Z,{ws_id:r,run_mode:"cluster",autoFocus:Ue,confirm:g,onConfirm:function(Q){B((0,a.Z)((0,a.Z)({},P),{},{page_num:1,tags:Q}))}})},render:function(_,g){return(0,e.jsx)(Dt.Z,{list:g.tag_list.map(function(L){return(0,e.jsx)(Zn.Z,{color:L.tag_color,children:L.name},(0,Rt.Z)())})})}},(0,a.Z)((0,a.Z)({title:(0,e.jsx)(n._H,{id:"device.description"}),dataIndex:"description",width:300},R("description")),{},{render:function(_,g){return(0,e.jsx)(te.K,{ellipsis:{tooltip:g.description},children:(0,e.jsx)(ee(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[P.description||""],autoEscape:!0,textToHighlight:g.description?g.description.toString():"-"})})}}),{title:(0,e.jsx)(n._H,{id:"Table.columns.operation"}),valueType:"option",dataIndex:"id",width:180,render:function(_,g){return(0,e.jsxs)(fe.Z,{children:[(0,e.jsx)(J.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){d(g.id)},children:(0,e.jsx)(n._H,{id:"operation.add"})}),(0,e.jsx)(n.Nv,{accessible:Le.WsMemberOperateSelf(g.owner),fallback:(0,e.jsxs)(fe.Z,{children:[(0,e.jsx)(J.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return(0,ae.WR)()},children:(0,e.jsx)(n._H,{id:"operation.edit"})}),(0,e.jsx)(J.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return(0,ae.WR)()},children:(0,e.jsx)(n._H,{id:"operation.delete"})})]}),children:(0,e.jsxs)(fe.Z,{children:[(0,e.jsx)(J.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return zn(g)},children:(0,e.jsx)(n._H,{id:"operation.edit"})}),(0,e.jsx)(J.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return Wn(g)},children:(0,e.jsx)(n._H,{id:"operation.delete"})})]})}),(0,e.jsx)(J.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return Sn(g.id)},children:(0,e.jsx)(n._H,{id:"operation.log"})})]})}}],se=function(_){Je(_),B(Ft),n.m8.replace("".concat(T,"?").concat((0,Et.stringify)((0,a.Z)((0,a.Z)({},m),{},{isInstance:_}))))},oe=+Se;return(0,e.jsxs)("div",{className:xr().warp,children:[(0,e.jsxs)(Ze.Z,{type:"card",onTabClick:se,activeKey:Se+"",tabBarExtraContent:(0,e.jsx)(J.Z,{type:"primary",onClick:En,children:oe?(0,e.jsx)(n._H,{id:"device.add.cluster.instance"}):(0,e.jsx)(n._H,{id:"device.add.cluster.config"})}),children:[(0,e.jsx)(Ze.Z.TabPane,{tab:(0,e.jsx)(n._H,{id:"device.cluster.config"})},0),(0,e.jsx)(Ze.Z.TabPane,{tab:(0,e.jsx)(n._H,{id:"device.cluster.instance"})},1)]}),(0,e.jsx)(hr.Z,{size:"small",loading:Xe,columns:ke,dataSource:pe.data,rowKey:function(_){return _.id+""},pagination:!1,expandable:{expandedRowRender:function(_){return(0,e.jsx)(Tr,{onRef:$e,size:re,top:ue,is_instance:oe,width:Qn-200-68,cluster_id:_.id})},onExpand:function(_,g){h(_,g)},expandedRowKeys:he,expandIcon:function(_){var g=_.expanded,L=_.onExpand,Q=_.record;return g?(0,e.jsx)(Zr.Z,{onClick:function(le){return L(Q,le)}}):(0,e.jsx)(_r.Z,{onClick:function(le){return L(Q,le)}})}}}),(0,e.jsx)($.Z,{justify:"space-between",style:{padding:"16px 20px 0"},ref:Qe,children:(0,e.jsx)(Pt.Z,{total:pe.total,pageSize:P.page_size,currentPage:P.page_num,onPageChange:function(_,g){B((0,a.Z)((0,a.Z)({},P),{},{page_num:_,page_size:g}))}})}),(0,e.jsx)(Ir,{outParam:I,tagFlag:He,is_instance:oe,params:P,setParams:B}),(0,e.jsx)(pt.Z,{ref:D,operation_object:"machine_cluster_aliyun"}),(0,e.jsx)(xt,{onRef:E,is_instance:oe,onSuccess:M,type:"cluster"}),(0,e.jsxs)(ze.Z,{title:(0,e.jsx)(n._H,{id:"delete.tips"}),centered:!0,open:vn,onCancel:function(){return en(!1)},footer:[(0,e.jsx)(J.Z,{onClick:function(){return hn(mn.id)},children:(0,e.jsx)(n._H,{id:"operation.confirm.delete"})},"submit"),(0,e.jsx)(J.Z,{type:"primary",onClick:function(){return en(!1)},children:(0,e.jsx)(n._H,{id:"operation.cancel"})},"back")],width:600,maskClosable:!1,children:[(0,e.jsxs)("div",{style:{color:"red",marginBottom:5},children:[(0,e.jsx)(In.Z,{style:{marginRight:4}}),(0,e.jsx)(n._H,{id:"device.cluster.delete.tips"})]}),(0,e.jsx)("div",{style:{color:"#1890FF",cursor:"pointer"},onClick:l,children:(0,e.jsx)(n._H,{id:"view.quote.details"})})]}),(0,e.jsx)(Hr.Z,{ref:On,onOk:function(_){var g=_.id;return hn(g)}})]})},Mr=(0,s.forwardRef)(kr),Dr=t(75073),Pr=function(){var me=(0,Ke.TH)(),j=me.pathname,T=me.query.t,m=Ze.Z.TabPane,z=(0,s.useState)(T!=null?T:"standalone"),G=(0,p.Z)(z,2),Te=G[0],r=G[1],_e=(0,s.useCallback)(function(Ce){r(Ce),n.m8.replace("".concat(j,"?t=").concat(Ce))},[j]);return(0,e.jsx)(Dr.mQ,{title:(0,e.jsxs)(Ze.Z,{defaultActiveKey:"1",onTabClick:_e,activeKey:Te,children:[(0,e.jsx)(m,{tab:(0,e.jsx)(n._H,{id:"standalone"})},"standalone"),(0,e.jsx)(m,{tab:(0,e.jsx)(n._H,{id:"cluster"})},"cluster")]}),children:Te==="standalone"?(0,e.jsx)(mr,{}):(0,e.jsx)(Mr,{})})}},75667:function(De,pn,t){"use strict";t.d(pn,{$x:function(){return Ke},X6:function(){return Rn},cm:function(){return dn},BG:function(){return xn},BS:function(){return Zn},Ti:function(){return Un},iB:function(){return fe},F$:function(){return qn},x1:function(){return on},Sy:function(){return Ee},Rp:function(){return x},Tv:function(){return Y},rc:function(){return un},aB:function(){return a},Yh:function(){return Re},mN:function(){return bn},L0:function(){return e},MH:function(){return Vn},oz:function(){return nt},XW:function(){return tt},vu:function(){return rt}});var p=t(35832),Pe=t(20418),Ze=t(32326),s=t(22812);function Ke(){return n.apply(this,arguments)}function n(){return n=(0,Ze.Z)((0,p.Z)().mark(function S(){var ee,ve=arguments;return(0,p.Z)().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return ee=ve.length>0&&ve[0]!==void 0?ve[0]:{},X.abrupt("return",(0,s.WY)("/api/server/cloud_server/",{params:ee}));case 2:case"end":return X.stop()}},S)})),n.apply(this,arguments)}function Rn(){return $.apply(this,arguments)}function $(){return $=(0,Ze.Z)((0,p.Z)().mark(function S(){var ee,ve=arguments;return(0,p.Z)().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return ee=ve.length>0&&ve[0]!==void 0?ve[0]:{},X.abrupt("return",(0,s.WY)("/api/server/cloud_server/",{method:"POST",data:(0,Pe.Z)({},ee)}));case 2:case"end":return X.stop()}},S)})),$.apply(this,arguments)}function dn(S){return ze.apply(this,arguments)}function ze(){return ze=(0,Ze.Z)((0,p.Z)().mark(function S(ee){var ve,cn=arguments;return(0,p.Z)().wrap(function(Hn){for(;;)switch(Hn.prev=Hn.next){case 0:return ve=cn.length>1&&cn[1]!==void 0?cn[1]:{},Hn.abrupt("return",(0,s.WY)("/api/server/cloud_server/detail/".concat(ee,"/"),{method:"PUT",data:(0,Pe.Z)({},ve)}));case 2:case"end":return Hn.stop()}},S)})),ze.apply(this,arguments)}function xn(S,ee){return J.apply(this,arguments)}function J(){return J=(0,Ze.Z)((0,p.Z)().mark(function S(ee,ve){return(0,p.Z)().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return X.abrupt("return",(0,s.WY)("/api/server/cloud_server/detail/".concat(ee,"/"),{method:"DELETE",data:(0,Pe.Z)({},ve)}));case 1:case"end":return X.stop()}},S)})),J.apply(this,arguments)}function Nn(){return K.apply(this,arguments)}function K(){return K=_asyncToGenerator(_regeneratorRuntime().mark(function S(){var ee,ve=arguments;return _regeneratorRuntime().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return ee=ve.length>0&&ve[0]!==void 0?ve[0]:{},X.abrupt("return",request("/api/server/server_tag/",{params:ee}));case 2:case"end":return X.stop()}},S)})),K.apply(this,arguments)}function Oe(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return request("/api/auth/user/",{params:S})}function Zn(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/cloud_server/instance_type/",{params:S})}function Un(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/cloud_server/aliyun/",{params:S})}function fe(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/cloud_server/image/",{params:S})}function qn(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/cloud_server/disk/categories/",{params:S})}function on(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/check/cloud_name/",{params:S})}function et(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return request("/api/server/check/var_name/",{method:"POST",data:_objectSpread({},S)})}function Ee(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/test_cluster/",{params:S})}function x(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/test_cluster/",{method:"POST",data:(0,Pe.Z)({},S)})}function Y(S,ee){return(0,s.WY)("/api/server/test_cluster/detail/".concat(S,"/"),{method:"PUT",data:(0,Pe.Z)({},ee)})}function un(S,ee){return(0,s.WY)("/api/server/test_cluster/detail/".concat(S,"/"),{method:"DELETE",data:ee})}function a(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/cloud_ak/",{params:S})}function Re(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/cloud_server/region/",{params:S})}function bn(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/cloud_server/zone/",{params:S})}function In(S){return request("/api/server/test_cluster/cloud_type/".concat(S,"/"))}function e(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/test_cluster/cloud_server/",{params:S})}function Vn(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,s.WY)("/api/server/test_cluster/cloud_server/",{method:"POST",data:(0,Pe.Z)({},S)})}function nt(S){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,s.WY)("/api/server/test_cluster/cloud_server/detail/".concat(S,"/"),{method:"PUT",data:(0,Pe.Z)({},ee)})}function tt(S){return(0,s.WY)("/api/server/test_cluster/cloud_server/detail/".concat(S,"/"),{method:"DELETE"})}var rt=function(){var S=(0,Ze.Z)((0,p.Z)().mark(function ee(ve){return(0,p.Z)().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return X.abrupt("return",(0,s.WY)("/api/server/sync_state/",{method:"post",data:ve}));case 1:case"end":return X.stop()}},ee)}));return function(ve){return S.apply(this,arguments)}}()}}]);
