(self.webpackChunktone_front=self.webpackChunktone_front||[]).push([[9083,2485],{76613:function(pe,X,a){"use strict";a.d(X,{Z:function(){return xe}});var Y=a(45972),U=a(22374),te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},P=te,ge=a(25078),Q=function(ae,A){return U.createElement(ge.Z,(0,Y.Z)((0,Y.Z)({},ae),{},{ref:A,icon:P}))};Q.displayName="MinusCircleOutlined";var xe=U.forwardRef(Q)},99193:function(pe,X,a){"use strict";a.d(X,{Z:function(){return xe}});var Y=a(45972),U=a(22374),te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M890.5 755.3L537.9 269.2c-12.8-17.6-39-17.6-51.7 0L133.5 755.3A8 8 0 00140 768h75c5.1 0 9.9-2.5 12.9-6.6L512 369.8l284.1 391.6c3 4.1 7.8 6.6 12.9 6.6h75c6.5 0 10.3-7.4 6.5-12.7z"}}]},name:"up",theme:"outlined"},P=te,ge=a(25078),Q=function(ae,A){return U.createElement(ge.Z,(0,Y.Z)((0,Y.Z)({},ae),{},{ref:A,icon:P}))};Q.displayName="UpOutlined";var xe=U.forwardRef(Q)},79756:function(pe){pe.exports={suite:"suite___18kgg",spinWrapper:"spinWrapper___17EdH",nav:"nav___3Ls6P",bar:"bar___2Pxqj",title:"title___2N2r_",remove:"remove___1mY09",batch:"batch___3KKK_",info:"info___2RGDG",var:"var___FaJBX",action:"action___3XoLG",column_outter:"column_outter___38ySl",conf_table:"conf_table___1WoTS",suite_table_loading:"suite_table_loading___8OeYB",batch_setting_table_bar:"batch_setting_table_bar___gNpdm",suite_drawer:"suite_drawer___3WpmF",case_drawer:"case_drawer___3clkU",drawer_padding:"drawer_padding___1jhA-",case_form:"case_form___1gwse",suite_form:"suite_form___RGHI0",serverItemUnchecked:"serverItemUnchecked___lvVQl",btn_style:"btn_style___3zR_3"}},93354:function(pe,X,a){"use strict";a.d(X,{Zu:function(){return P},ge:function(){return Q}});var Y=a(35832),U=a(32326),te=a(22812),P=function(){var z=(0,U.Z)((0,Y.Z)().mark(function G(je){return(0,Y.Z)().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return se.abrupt("return",(0,te.WY)("/api/case/workspace/case/",{params:je}));case 1:case"end":return se.stop()}},G)}));return function(je){return z.apply(this,arguments)}}(),ge=null;function Q(){return(0,te.WY)("/api/case/test_domain/")}function xe(z){return request("/api/server/server_tag/",{params:z})}function Ze(z){return request("/api/server/test_server/channel/check/",{params:z})}function ae(z){return request("/api/server/test_cluster/",{params:z})}function A(z){return request("/api/server/cloud_server/",{params:z})}function ye(z){return request("/api/server/test_cluster/",{params:z})}},21446:function(pe,X,a){"use strict";a.r(X),a.d(X,{default:function(){return $t}});var Y=a(67448),U=a(47548),te=a(46721),P=a(94867),ge=a(67515),Q=a(12238),xe=a(81138),Ze=a(96146),ae=a(64974),A=a(35832),ye=a(32326),z=a(20693),G=a(3278),je=a(40204),Ue=a(10724),se=a(8281),We=a(58591),Yt=a(70772),ie=a(6701),Qt=a(88966),$e=a(11048),O=a(39190),Vt=a(57359),D=a(34423),Jt=a(14320),W=a(53479),Xt=a(38519),Ye=a(16416),qt=a(31650),V=a(25100),o=a(20418),m=a(22374),u=a(22812),Qe=a(72882),xt=a(13598),Zt=a(526),en=a(88018),yt=a(58414),tn=a(64510),lt=a(87445),nn=a(68501),jt=a(98501),Ct=a(99193),St=a(66304),ct=a(24812),_t=a(93354),kt=a(53933),Rt=a(79756),wt=a.n(Rt),e=a(52454),Tt=function(g,x){var h=(0,u.YB)(),f=h.formatMessage,k=(0,ct.UO)(),d=k.ws_id,R=g.onOk,w=g.perfKeys,y=g.funcKeys,I=(0,m.useState)(!1),b=(0,O.Z)(I,2),_=b[0],p=b[1],c=(0,m.useState)(null),v=(0,O.Z)(c,2),C=v[0],E=v[1],B=(0,m.useState)(!1),$=(0,O.Z)(B,2),le=$[0],K=$[1],S=(0,m.useState)([]),N=(0,O.Z)(S,2),Ce=N[0],Se=N[1],Pe=(0,m.useState)([]),ce=(0,O.Z)(Pe,2),Ee=ce[0],De=ce[1],Xe=(0,m.useState)(""),_e=(0,O.Z)(Xe,2),de=_e[0],Fe=_e[1],qe=(0,m.useState)(""),ke=(0,O.Z)(qe,2),Me=ke[0],He=ke[1],Ne=(0,m.useState)(!1),Ae=(0,O.Z)(Ne,2),ue=Ae[0],ze=Ae[1],et=(0,m.useState)(""),Be=(0,O.Z)(et,2),fe=Be[0],tt=Be[1],nt=(0,m.useState)([]),Re=(0,O.Z)(nt,2),Ge=Re[0],we=Re[1],rt=(0,u.QT)(function(){return(0,kt.ge)({ws_id:d,page_size:100})},{initialData:[]}),at=rt.data,he=(0,u.QT)(function(n){return(0,_t.Zu)(n)},{initialData:[],manual:!0}),q=he.data,Ke=he.loading,ve=he.run,st=(0,m.useMemo)(function(){return q.reduce(function(n,t,r){var s=0,i=t.test_case_list.reduce(function(j,T,F){var L="".concat(r,"-").concat(F),Z=!1,ee=!1;if(!Ee.includes(T.id)){var re=fe==="performance"?w.includes(T.id):y.includes(T.id);re&&s++,Z=re,ee=re}return j.concat((0,o.Z)((0,o.Z)({},T),{},{parentId:t.id,key:L,title:T.name,disableCheckbox:Z,disabled:ee}))},[]);return n.concat((0,o.Z)((0,o.Z)({},t),{},{key:t.id+"",title:t.name,children:i,checkable:s!==t.test_case_list.length}))},[])},[q,fe,w,y,Ee]),me=function(t){Fe(t),ve({domain:t,ws_id:d,test_type:fe,name:Me,page_size:100})},it=function(t){He(t),ve({domain:de,ws_id:d,test_type:fe,name:t,page_size:100}).then(function(r){if(r.length)for(var s=0;s<r.length;s++)if(r[s].name.indexOf(t)===-1){var i=[];i.push(r[s].id+""),we(i)}else we([""])})},ot=function(t){we(t)},Le=function(t){Se(t)};(0,m.useImperativeHandle)(x,function(){return{show:function(t,r,s){t&&E({source:t,rowkey:r,testType:s});var i=s==="func_item"?"functional":"performance";tt(i),p(!0),ve({domain:de,ws_id:d,test_type:i,name:Me,page_size:100}).then(function(j){var T=[],F=t.list.reduce(function(ee,re){return ee.concat(re.case_source.reduce(function(gt,Ie){return gt.concat(Ie.test_conf_id)},[]))},[]);De(F);for(var L=0;L<j.length;L++)for(var Z=0;Z<j[L].test_case_list.length;Z++)F.includes(j[L].test_case_list[Z].id)&&T.push("".concat(L,"-").concat(Z));Se(T)})}}});var Te=(0,m.useCallback)(function(){p(!1),E(null),Fe(""),He(""),Se([]),ze(!1),De([])},[]),l=function(){if(!le){K(!0);var t=q.reduce(function(r,s,i){var j=s.test_case_list.reduce(function(T,F,L){var Z=Ce.findIndex(function(ee){return ee==="".concat(i,"-").concat(L)});return Z>-1?T.concat({test_conf_id:F.id,test_conf_name:F.name}):T},[]);return j.length>0?r.concat({test_suite_id:s.id,suite_show_name:s.name,case_source:j}):r},[]);R((0,o.Z)((0,o.Z)({},C),{},{result:t})),Te(),K(!1)}};return(0,e.jsx)(yt.Z,{maskClosable:!1,keyboard:!1,footer:(0,e.jsx)("div",{style:{textAlign:"right"},children:(0,e.jsxs)(D.Z,{children:[(0,e.jsx)(P.Z,{onClick:Te,children:(0,e.jsx)(u._H,{id:"operation.cancel"})}),(0,e.jsx)(P.Z,{type:"primary",onClick:l,children:(0,e.jsx)(u._H,{id:"operation.ok"})})]})}),visible:_,destroyOnClose:!0,width:634,title:(0,e.jsx)(u._H,{id:"report.case.list"}),onClose:Te,children:(0,e.jsxs)(U.Z,{spinning:Ke,style:{width:"100%",height:"100%"},children:[(0,e.jsx)(G.Z.Search,{placeholder:f({id:"please.enter"}),onSearch:function(t){return it(t.replace(/\s+/g,""))},style:{width:420}}),(0,e.jsxs)("div",{style:{position:"relative",paddingTop:"16px",display:"flex"},children:[(0,e.jsxs)("div",{className:wt().nav,children:[(0,e.jsx)(u._H,{id:"report.domain"}),"\uFF1A"]}),(0,e.jsxs)("div",{style:{width:500},children:[(0,e.jsx)(P.Z,{type:de===""?"primary":"ghost",size:"small",style:{marginRight:8,marginBottom:8,border:"none"},onClick:function(){return me("")},children:(0,e.jsx)(u._H,{id:"report.all.s"})}),at.map(function(n,t){if(!(!ue&&t>6))return n.id==de?(0,e.jsx)(P.Z,{type:"primary",size:"small",style:{marginRight:8,marginBottom:8},onClick:function(){return me(n.id)},children:n.name},n.id):(0,e.jsx)(P.Z,{type:"ghost",size:"small",style:{border:"none",marginRight:8,marginBottom:8},onClick:function(){return me(n.id)},children:n.name},n.id)})]}),(0,e.jsx)(P.Z,{type:"link",size:"small",style:{position:"absolute",right:0},onClick:function(){return ze(!ue)},icon:ue?(0,e.jsx)(Ct.Z,{}):(0,e.jsx)(St.Z,{}),children:ue?(0,e.jsx)(u._H,{id:"operation.collapse"}):(0,e.jsx)(u._H,{id:"operation.expand"})})]}),(0,e.jsx)(jt.Z,{treeData:st,checkedKeys:Ce,onExpand:ot,expandedKeys:Ge,checkable:!0,onCheck:Le}),q.length===0&&(0,e.jsx)("div",{style:{height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,e.jsx)(lt.Z,{image:lt.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsx)(u._H,{id:"no.use.case"})})})]})})},It=(0,m.memo)((0,m.forwardRef)(Tt)),Ve=a(53160),M=a(20312),Ot=a(39935),dt=(0,m.createContext)(null),oe=function(){return(0,m.useContext)(dt)},bt=a(15621),rn=a(89963),Oe=a(70077),H=a(4992),Pt=a(54217),Et=function(g){var x=g.route,h=(0,ct.UO)(),f=h.ws_id,k=oe(),d=k.dataSource,R=k.bodyWidth;return(0,e.jsx)(H.hi,{children:(0,e.jsxs)(Oe.Z,{children:[(0,e.jsx)(Oe.Z.Item,{children:(0,e.jsx)(Pt.rU,{to:"/ws/".concat(f,"/test_report?t=template"),children:(0,e.jsx)(u._H,{id:"report.template"})})}),x.name==="TemplateCreate"?(0,e.jsx)(Oe.Z.Item,{children:(0,e.jsx)(u._H,{id:"menu.Workspace.TestReport.TemplateCreate"})}):(0,e.jsx)(Oe.Z.Item,{children:(0,e.jsx)("span",{children:(0,e.jsx)(V.Z.Text,{ellipsis:!0,style:{width:R-134},children:d.name})})})]})})},Dt=(0,m.memo)(Et),ne=a(91959),Ft=a(488),ut=a(38733),ft=a(98141),Mt=a(93329),Ht=function(g){var x=g.onOk,h=g.title,f=g.style,k=g.icon,d=g.width,R=m.useState(!1),w=(0,O.Z)(R,2),y=w[0],I=w[1],b=m.useState(h),_=(0,O.Z)(b,2),p=_[0],c=_[1],v=function(){I(!0)},C=function(){I(!1),c(h)},E=function(){C()},B=function(S){var N=S.target;c(N.value)},$=function(){x(p),C()},le=function(){return k};return d<=0?(0,e.jsx)(e.Fragment,{}):y?(0,e.jsxs)(W.Z,{children:[k&&(0,e.jsx)("span",{style:{marginRight:8},children:(0,e.jsx)(le,{})}),(0,e.jsx)(G.Z,{value:p||"",size:"small",onChange:B,style:{width:d-120,marginRight:8}}),(0,e.jsxs)(D.Z,{children:[(0,e.jsx)(P.Z,{size:"small",onClick:E,children:(0,e.jsx)(u._H,{id:"operation.cancel"})}),(0,e.jsx)(P.Z,{size:"small",type:"primary",onClick:$,children:(0,e.jsx)(u._H,{id:"operation.ok"})})]})]}):(0,e.jsxs)(W.Z,{children:[k&&(0,e.jsx)("span",{style:{marginRight:8},children:(0,e.jsx)(le,{})}),(0,e.jsxs)("div",{style:{width:d-20},children:[(0,e.jsx)("span",{style:(0,o.Z)((0,o.Z)({},f),{},{marginRight:8,wordBreak:"break-all"}),children:h||"-"}),(0,e.jsx)(Mt.Z,{onClick:v})]})]})},Je=Ht,ht=a(53770),vt=a(76613),mt=a(46120),Nt=function(g){var x=g.source,h=g.dataItem,f=oe(),k=f.handleFieldChange,d=f.hanldeRemoveField,R=f.handleRemoveSuiteField,w=f.hanldeChangeSuiteName,y=f.suiteSelectRef,I=f.contrl,b=(0,m.useRef)(),_=(0,ut.F)(b);return(0,e.jsxs)(H.Rh,{id:"".concat(h,"-").concat(x.rowkey),children:[(0,e.jsx)(H.sZ,{span:24,ref:b,children:(0,e.jsx)(W.Z,{justify:"space-between",children:(0,e.jsxs)(u.Nv,{accessible:I,fallback:(0,e.jsxs)(D.Z,{align:"center",children:[(0,e.jsx)(mt.r,{style:{transform:"translate(0px, 2px)"}}),(0,e.jsx)(V.Z.Text,{strong:!0,style:{width:_-80,display:"inline-block"},children:x.name})]}),children:[(0,m.createElement)(Je,(0,o.Z)((0,o.Z)({},x),{},{icon:(0,e.jsx)(mt.r,{style:{transform:"translate(0px, 2px)"}}),key:x.rowkey,title:x.name,width:_-80,onOk:function(c){return k(c,"name",x.rowkey,h)}})),(0,e.jsx)("span",{onClick:function(){return d(x.rowkey,h)},children:(0,e.jsx)(ht.Z,{})})]})})}),(0,e.jsxs)(ie.Z,{span:24,style:{padding:"10px 16px 16px"},children:[(0,e.jsx)(u.Nv,{accessible:I,children:(0,e.jsx)(W.Z,{children:(0,e.jsx)(P.Z,{type:"primary",ghost:!0,onClick:function(){return y.current.show(x,x.rowkey,h)},children:(0,e.jsx)(u._H,{id:"report.select.case"})})})}),(0,e.jsx)(W.Z,{children:x.list.map(function(p){var c;return(0,e.jsxs)(H.i0,{span:24,children:[(0,e.jsx)(H.TV,{justify:"space-between",children:(0,e.jsxs)(u.Nv,{accessible:I,fallback:(0,e.jsx)("span",{children:p.suite_show_name}),children:[(0,m.createElement)(Je,(0,o.Z)((0,o.Z)({},p),{},{title:p.suite_show_name,key:p.rowkey,width:_-100,onOk:function(C){return w(p.test_suite_id,h,x.rowkey,C)}})),(0,e.jsx)(vt.Z,{onClick:function(){return R(p,h,!0)}})]})}),(0,e.jsx)(W.Z,{children:(c=p.case_source)===null||c===void 0?void 0:c.map(function(v,C){return(0,e.jsx)(H.JZ,{span:24,len:p.case_source.length-1,idx:C,children:(0,e.jsxs)(W.Z,{justify:"space-between",align:"middle",children:[(0,e.jsx)(V.Z.Text,{children:v.test_conf_name}),(0,e.jsx)(u.Nv,{accessible:I,children:(0,e.jsx)(vt.Z,{onClick:function(){return R(v,h,!1)}})})]})},C)})})]},p.rowkey)})})]})]})},pt=Nt,At=["dataItem","conf","source"],zt=function(g){var x=g.dataItem,h=g.conf,f=g.source,k=(0,Ft.Z)(g,At),d=oe(),R=d.handleFieldChange,w=d.hanldeRemoveField,y=d.handleGroupAddTestItem,I=d.contrl,b=(0,m.useRef)(),_=(0,ut.F)(b);return(0,e.jsxs)(H.ZA,{id:"".concat(x,"-").concat(f.rowkey),children:[(0,e.jsx)(ie.Z,{span:24,children:(0,e.jsx)(H.pF,{justify:"space-between",ref:b,children:(0,e.jsxs)(u.Nv,{accessible:I,fallback:(0,e.jsxs)(D.Z,{align:"center",children:[(0,e.jsx)(ft.r,{style:{transform:"translate(0px, 1px)"}}),(0,e.jsx)(V.Z.Text,{strong:!0,children:f.name})]}),children:[(0,m.createElement)(Je,(0,o.Z)((0,o.Z)({},f),{},{key:f.rowkey,icon:(0,e.jsx)(ft.r,{}),title:f.name,width:_-80,onOk:function(c){return R(c,"name",f.rowkey,x)}})),(0,e.jsx)("span",{onClick:function(){return w(f.rowkey,x)},children:(0,e.jsx)(ht.Z,{})})]})})}),(0,e.jsxs)(ie.Z,{span:24,style:{padding:16},children:[f.list.map(function(p){return(0,e.jsx)(pt,(0,o.Z)((0,o.Z)({source:p},k),{},{conf:h,dataItem:x}),p.rowkey)}),(0,e.jsxs)(u.Nv,{accessible:I,children:[(0,e.jsx)(We.Z,{style:{margin:"12px 0"}}),(0,e.jsx)(W.Z,{children:(0,e.jsx)("span",{onClick:function(){return y(f.rowkey,x)},children:(0,e.jsx)(V.Z.Link,{children:(0,e.jsxs)(D.Z,{children:[(0,e.jsx)(Qe.Z,{}),(0,e.jsx)(u._H,{id:"report.test.item"})]})})})})]})]})]})},Bt=(0,m.memo)(zt),Gt=a(41335),be={need_test_suite_description:!0,need_test_env:!0,need_test_description:!0,need_test_conclusion:!0,show_type:"list",test_data:!1},Kt=function(g){var x=g.testType,h=(0,u.YB)(),f=h.formatMessage,k=oe(),d=k.dataSource,R=k.setDataSource,w=k.contrl,y={name:"performance",testRadioName:"need_perf_data",dataItem:"perf_item",conf:"perf_conf"};x!=="performance"&&(y={name:"functional",testRadioName:"need_func_data",dataItem:"func_item",conf:"func_conf"});var I=function(v){R((0,M.ZP)(d,function(C){C[v]=d[v].concat({name:f({id:"report.test.item.num"},{data:"".concat(d[v].length-0+1)}),rowkey:(0,ne.Z)(),list:[{test_suite_id:null,suite_show_name:"suite",case_source:[],rowkey:(0,ne.Z)()}]})}))},b=function(v){R((0,M.ZP)(d,function(C){C[v]=d[v].concat({name:"".concat(f({id:"report.test.group"})).concat(d[v].length-0+1),list:[],is_group:!0,rowkey:(0,ne.Z)()})}))},_=function(v,C){R((0,M.ZP)(d,function(E){E[v]=C}))},p=function(v,C,E){R((0,M.ZP)(d,function(B){var $=(0,o.Z)({},d[E]);$[C]=v,B[E]=$}))};return(0,e.jsxs)(Ue.Z,{id:y.dataItem,style:{marginTop:20},bodyStyle:{padding:"12px 20px"},children:[(0,e.jsx)(W.Z,{children:(0,e.jsx)(Ye.Z,{checked:d[y.testRadioName],disabled:!w,onChange:function(v){var C=v.target;return _(y.testRadioName,C.checked)},children:(0,e.jsx)(V.Z.Text,{strong:!0,style:{fontSize:16},children:(0,e.jsx)(u._H,{id:"report.".concat(y.name,".test.data")})})})}),d[y.testRadioName]&&(0,e.jsxs)(W.Z,{style:{paddingLeft:24},children:[y.name!=="functional"&&(0,e.jsx)(ie.Z,{span:24,style:{background:"rgba(0,0,0,0.03)",padding:14,marginTop:12},children:(0,e.jsx)(D.Z,{direction:"vertical",style:{width:"100%"},children:(0,e.jsxs)(D.Z,{direction:"vertical",style:{width:"100%"},children:[(0,e.jsx)(D.Z,{children:(0,e.jsx)(V.Z.Text,{children:(0,e.jsx)(u._H,{id:"report.basic.information"})})}),(0,e.jsx)(D.Z,{style:{width:"100%"},children:[[f({id:"report.test_env"}),"need_test_env"],[f({id:"report.test.description"}),"need_test_description"],[f({id:"report.test.conclusion"}),"need_test_conclusion"]].map(function(c){var v=(0,O.Z)(c,3),C=v[0],E=v[1],B=v[2];return(0,e.jsx)(Lt,{field:y.conf,title:C,name:E,text:B},E)})}),(0,e.jsxs)("div",{style:{display:"flex"},children:[(0,e.jsx)("div",{style:{marginRight:12},children:(0,e.jsx)(u._H,{id:"report.data.view.style"})}),(0,e.jsx)("div",{children:(0,e.jsxs)($e.ZP.Group,{disabled:!w,value:d[y.conf].show_type,onChange:function(v){var C=v.target;return p(C.value,"show_type",y.conf)},children:[(0,e.jsx)($e.ZP,{value:"list",children:(0,e.jsx)(u._H,{id:"report.list.view"})}),(0,e.jsx)($e.ZP,{value:"chart",children:(0,e.jsx)(u._H,{id:"report.chart.view"})})]})})]})]})})}),(0,e.jsx)(ie.Z,{span:24,children:d[y.dataItem].map(function(c){return c.is_group?(0,e.jsx)(Bt,(0,o.Z)((0,o.Z)({},y),{},{source:c}),c.rowkey):(0,e.jsx)(pt,(0,o.Z)((0,o.Z)({},y),{},{source:c}),c.rowkey)})}),(0,e.jsx)(We.Z,{style:{margin:"12px 0"}}),(0,e.jsxs)(ie.Z,{span:24,children:[(0,e.jsx)("span",{onClick:function(){return I(y.dataItem)},children:(0,e.jsx)(V.Z.Link,{children:(0,e.jsxs)(D.Z,{children:[(0,e.jsx)(Qe.Z,{}),(0,e.jsx)(u._H,{id:"report.test.item"})]})})}),(0,e.jsx)(We.Z,{type:"vertical"}),(0,e.jsx)("span",{onClick:function(){return b(y.dataItem)},children:(0,e.jsx)(V.Z.Link,{children:(0,e.jsxs)(D.Z,{children:[(0,e.jsx)(Qe.Z,{}),(0,e.jsx)(u._H,{id:"report.test.group"})]})})})]})]})]})},Lt=function(g){var x=g.field,h=g.name,f=g.title,k=g.text,d=(0,u.YB)(),R=d.formatMessage,w=oe(),y=w.dataSource,I=w.setDataSource,b=w.contrl,_=function(c,v,C){I((0,M.ZP)(y,function(E){var B=(0,o.Z)({},y[C]);B[v]=c,E[C]=B}))};return(0,e.jsxs)(D.Z,{direction:"vertical",style:{width:"100%"},children:[(0,e.jsx)(Ye.Z,{disabled:!b,onChange:function(c){var v=c.target;return _(v.checked,h,x)},checked:y[x][h],children:f}),k&&(0,e.jsx)(G.Z.TextArea,{allowClear:!0,placeholder:R({id:"please.enter"}),value:y[x][k],autoSize:{minRows:3,maxRows:3},disabled:!y[x][h],onChange:function(c){var v=c.target;_(v.value,k,x)}})]})},Ut=function(g){var x=(0,u.YB)(),h=x.formatMessage,f=g.name,k=g.title,d=g.desc,R=oe(),w=R.dataSource,y=R.setDataSource,I=R.contrl,b=function(p,c){y((0,M.ZP)(w,function(v){v[p]=c}))};return(0,e.jsxs)(D.Z,{direction:"vertical",style:{width:"100%",background:"#fff",padding:20},children:[(0,e.jsx)(Ye.Z,(0,o.Z)((0,o.Z)({},g),{},{id:f,disabled:!I,onChange:function(p){var c=p.target;return b(f,c.checked)},checked:w[f],children:k})),d&&(0,e.jsx)(G.Z.TextArea,{placeholder:h({id:"please.enter"}),allowClear:!0,disabled:!w[f],value:w[d],onChange:function(p){var c=p.target;b(d,c.value)},autoSize:{minRows:3,maxRows:6}})]})},Wt=function(g){var x=(0,u.YB)(),h=x.formatMessage,f=g.route,k=g.match.params,d=k.ws_id,R=k.temp_id,w=(0,u.md)(),y=(0,m.useState)(!1),I=(0,O.Z)(y,2),b=I[0],_=I[1],p=m.useState(!1),c=(0,O.Z)(p,2),v=c[0],C=c[1],E=(0,Zt.CR)(),B=E.height,$=(0,m.useRef)(),le=(0,m.useState)({ws_id:d,name:"",is_default:!1,need_test_background:!0,need_test_method:!0,need_test_summary:!0,need_test_conclusion:!0,need_test_env:!0,need_env_description:!0,need_func_data:!0,need_perf_data:!0,description:"",perf_conf:be,func_conf:be,perf_item:[],func_item:[]}),K=(0,O.Z)(le,2),S=K[0],N=K[1],Ce=function l(n){return n.reduce(function(t,r){return r.is_group?r.list.length>0?t.concat(l(r.list)):t:r.list&&r.list.length>0?t.concat(r.list.reduce(function(s,i){return s.concat(i.case_source.map(function(j){return j.test_conf_id}))},[])):t},[])},Se=(0,m.useState)(w.WsMemberOperateSelf()),Pe=(0,O.Z)(Se,2),ce=Pe[0],Ee=Pe[1],De=(0,m.useMemo)(function(){return Ce(S.perf_item)},[S]),Xe=(0,m.useMemo)(function(){return Ce(S.func_item)},[S]),_e=function l(n){return n.map(function(t){return t.list?(0,o.Z)((0,o.Z)({},t),{},{rowkey:(0,ne.Z)(),list:l(t.list)}):(0,o.Z)((0,o.Z)({},t),{},{rowkey:(0,ne.Z)()})})},de=function(){var l=(0,ye.Z)((0,A.Z)().mark(function n(){var t,r,s,i,j,T,F;return(0,A.Z)().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return _(!0),Z.next=3,(0,Ve.Q)({ws_id:d,id:R});case 3:t=Z.sent,r=t.data,s=r.perf_item,i=r.func_item,j=r.perf_conf,T=r.func_conf,Ee(w.WsMemberOperateSelf(r.creator)),F={func_conf:T||be,perf_conf:j||be,perf_item:_e(s),func_item:_e(i)},document.title="".concat(r.name," - T-One"),N(Object.assign(r,F)),_(!1);case 11:case"end":return Z.stop()}},n)}));return function(){return l.apply(this,arguments)}}();(0,m.useEffect)(function(){return f.name==="TemplateEdit"?de():(document.title="".concat(h({id:"report.create.report.template"})," - T-One"),_(!1)),function(){_(!0)}},[f.name]);var Fe=function(n,t,r,s){return(0,M.ZP)(n,function(i){i.list=n.list.map(function(j){return!j.is_group&&j.rowkey===t?(0,M.ZP)(j,function(T){T[r]=s}):j})})},qe=function(n,t,r,s){return n.rowkey===t?(0,M.ZP)(n,function(i){i[r]=s}):n.is_group?Fe(n,t,r,s):n},ke=function(n,t,r,s){N((0,M.ZP)(S,function(i){i[s]=S[s].map(function(j){return qe(j,r,t,n)})}))},Me=function l(n,t){return n.reduce(function(r,s){return s.rowkey===t?r:s.is_group?r.concat((0,o.Z)((0,o.Z)({},s),{},{list:l(s.list,t)})):r.concat(s)},[])},He=function(n,t){N((0,M.ZP)(S,function(r){r[t]=Me(S[t],n)}))},Ne=function(n,t){var r=n.list.length;return{name:h({id:"report.test.item.num"},{data:"".concat(t+1,"-").concat(r+1)}),rowkey:(0,ne.Z)(),list:[{test_suite_id:null,suite_show_name:"suite",case_source:[],rowkey:(0,ne.Z)()}]}},Ae=function l(n,t){return n.reduce(function(r,s,i){return s.rowkey===t?s.is_group?r.concat((0,o.Z)((0,o.Z)({},s),{},{list:s.list.concat(Ne(s,i))})):r.concat(Ne(s,i)):s.is_group?r.concat((0,o.Z)((0,o.Z)({},s),{},{list:l(s.list,t)})):r.concat(s)},[])},ue=function(n,t){N((0,M.ZP)(S,function(r){r[t]=Ae(S[t],n)}))},ze=function l(n,t,r,s,i){return"test_suite_id"in n&&n.test_suite_id===i?(0,o.Z)((0,o.Z)({},n),{},{suite_show_name:s}):n.list&&n.list.length>0?(0,o.Z)((0,o.Z)({},n),{},{list:n.list.map(function(j){return l(j,t,r,s,i)})}):n},et=function(n,t,r,s){N((0,M.ZP)(S,function(i){i[t]=S[t].map(function(j){return ze(j,t,r,s,n)})}))},Be=function l(n,t,r){if("test_suite_id"in n){if(t)return n.test_suite_id===r.test_suite_id?void 0:n;var s=n.case_source.filter(function(i){return r.test_conf_id!==i.test_conf_id});return s.length>0?(0,o.Z)((0,o.Z)({},n),{},{case_source:s}):void 0}return(0,o.Z)((0,o.Z)({},n),{},{list:n.list.reduce(function(i,j){var T=l(j,t,r);return T?i.concat(T):i},[])})},fe=function(n,t,r){N((0,M.ZP)(S,function(s){s[t]=S[t].map(function(i){return Be(i,r,n)})}))},tt=function(n){var t=n.result,r=n.rowkey,s=n.testType;return ke(t,"list",r,s)},nt=function(n){for(var t={},r=0,s=n.length;r<s;r++){var i=n[r].name;if(t[i])throw h({id:"report.please.check"});t[i]=i}},Re=function l(n){nt(n);var t=n.reduce(function(r,s){var i=s.list;return"test_suite_id"in s?s.case_source.length===0?r:r.concat(s):i&&i.length>0?r.concat((0,o.Z)((0,o.Z)({},s),{},{list:l(i)})):r.concat(s)},[]);return t},Ge=function(){var l=(0,ye.Z)((0,A.Z)().mark(function n(t){var r;return(0,A.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(_(!0),f.name!=="TemplateEdit"){i.next=7;break}return i.next=4,(0,Ve.$A)((0,o.Z)({ws_id:d,id:R},t));case 4:i.t0=i.sent,i.next=10;break;case 7:return i.next=9,(0,Ve.s)(t);case 9:i.t0=i.sent;case 10:r=i.t0,r.code===200?u.m8.push("/ws/".concat(d,"/test_report?t=template")):(0,Ot.EV)(r.code,r.message),_(!1);case 13:case"end":return i.stop()}},n)}));return function(t){return l.apply(this,arguments)}}(),we=function l(n){var t=(0,ae.Z)(n),r;try{for(t.s();!(r=t.n()).done;){var s=r.value,i=s.is_group,j=s.list;if(i){var T=l(j);if(T)return!0}else if(j.length>0)return!0}}catch(F){t.e(F)}finally{t.f()}return!1},rt=function(){var l=(0,ye.Z)((0,A.Z)().mark(function n(){var t,r,s,i,j,T,F;return(0,A.Z)().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(!b){Z.next=2;break}return Z.abrupt("return");case 2:if(t=S.perf_item,r=S.func_item,s=S.name,s){Z.next=5;break}return Z.abrupt("return",Ze.default.warning(h({id:"report.template.cannot.be.empty"})));case 5:return Z.prev=5,Z.next=8,Re(t);case 8:return i=Z.sent,Z.next=11,Re(r);case 11:if(j=Z.sent,T=we(i.concat(j)),F=(0,o.Z)((0,o.Z)({},S),{},{perf_item:i,func_item:j}),!T){Z.next=16;break}return Z.abrupt("return",Ge(F));case 16:Q.Z.confirm({title:h({id:"report.template.confirm.title",defaultMessage:"\u63D0\u793A"}),centered:!0,content:h({id:"report.template.confirm.content",defaultMessage:"\u6D4B\u8BD5\u9879\u7F3A\u5C11\u7528\u4F8B\uFF0C\u662F\u5426\u7EE7\u7EED\u4FDD\u5B58\uFF1F"}),icon:(0,e.jsx)(xt.Z,{}),onOk:function(){return(0,ye.Z)((0,A.Z)().mark(function re(){return(0,A.Z)().wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:Ge(F);case 1:case"end":return Ie.stop()}},re)}))()},onCancel:function(){_(!1)}}),Z.next=23;break;case 19:Z.prev=19,Z.t0=Z.catch(5),Ze.default.warning(Z.t0),_(!1);case 23:case"end":return Z.stop()}},n,null,[[5,19]])}));return function(){return l.apply(this,arguments)}}(),at=(0,m.useState)(!1),he=(0,O.Z)(at,2),q=he[0],Ke=he[1],ve=function(n,t){return N((0,M.ZP)(S,function(r){r[n]=t}))},st=(0,m.useState)(1200),me=(0,O.Z)(st,2),it=me[0],ot=me[1],Le=(0,m.useRef)(null),Te=function(){return ot(Le.current.offsetWidth)};return(0,m.useEffect)(function(){var l=document.getElementById("report-body-container"),n={attributes:!0,childList:!0,subtree:!0},t=new MutationObserver(Te);return t.observe(l,n),function(){t.disconnect()}},[]),(0,e.jsxs)(dt.Provider,{value:{dataSource:S,setDataSource:N,collapsed:q,setCollapsed:Ke,contrl:ce,bodyWidth:it,handleFieldChange:ke,hanldeRemoveField:He,handleRemoveSuiteField:fe,hanldeChangeSuiteName:et,handleGroupAddTestItem:ue,suiteSelectRef:$},children:[(0,e.jsx)(U.Z,{spinning:b,children:(0,e.jsxs)(H.ec,{height:B-50,children:[(0,e.jsx)(bt.Z,{dataSource:S,setDataSource:N,collapsed:q,setCollapsed:Ke,contrl:ce}),(0,e.jsx)(H._r,{id:"report-body-container",collapsed:q,children:(0,e.jsxs)(H.YC,{ref:Le,children:[(0,e.jsx)(Dt,(0,o.Z)({},g)),(0,e.jsx)(H.EU,{children:(0,e.jsxs)(D.Z,{direction:"vertical",style:{width:"100%"},children:[(0,e.jsx)(G.Z,{style:{width:"100%"},placeholder:h({id:"report.name.input"}),value:S.name,onChange:function(n){var t=n.target;return ve("name",t.value)}}),(0,e.jsx)(G.Z.TextArea,{onChange:function(n){var t=n.target;return ve("description",t.value)},style:{width:"100%"},value:S.description,autoSize:{minRows:3,maxRows:6},placeholder:h({id:"report.description.textArea"})})]})}),(0,e.jsx)(D.Z,{direction:"vertical",style:{width:"100%",marginTop:20},size:20,children:[[h({id:"report.test.background"}),"need_test_background","background_desc"],[h({id:"report.test.method"}),"need_test_method","test_method_desc"],[h({id:"report.test.conclusion"}),"need_test_conclusion","test_conclusion_desc"],["Summary","need_test_summary"],[h({id:"report.env.description"}),"need_env_description","env_description_desc"],[h({id:"report.server.env"}),"need_test_env"]].map(function(l){var n=(0,O.Z)(l,3),t=n[0],r=n[1],s=n[2];return(0,e.jsx)(Ut,{title:t,name:r,desc:s},r)})}),(0,e.jsxs)("div",{style:{padding:20,background:"#fff",marginTop:20},children:[(0,e.jsx)(H.vU,{id:"test_data",children:(0,e.jsx)(u._H,{id:"report.test.data"})}),["performance","functional"].map(function(l){return(0,e.jsx)(Kt,{testType:l},l)})]})]})}),(0,e.jsx)(H.NF,{justify:"end",align:"middle",children:(0,e.jsxs)(D.Z,{children:[(0,e.jsx)(P.Z,{onClick:function(){return C(!0)},children:(0,e.jsx)(u._H,{id:"operation.preview"})}),!S.is_default&&(0,e.jsx)(u.Nv,{accessible:ce,children:(0,e.jsx)(P.Z,{type:"primary",onClick:rt,children:f.name==="TemplateEdit"?(0,e.jsx)(u._H,{id:"report.update.report.template"}):(0,e.jsx)(u._H,{id:"report.save.report.template"})})})]})}),(0,e.jsx)(It,{perfKeys:De,funcKeys:Xe,ref:$,onOk:tt})]})}),v&&(0,e.jsx)("div",{style:{position:"fixed",left:0,right:0,bottom:0,top:0,zIndex:9999},children:(0,e.jsx)(Gt.default,(0,o.Z)((0,o.Z)({},g),{},{dataSet:S,setIsPreview:C}))})]})},$t=Wt}}]);
