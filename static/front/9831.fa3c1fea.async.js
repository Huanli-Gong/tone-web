(self.webpackChunktone_front=self.webpackChunktone_front||[]).push([[9831],{76613:function(nn,an,t){"use strict";t.d(an,{Z:function(){return Pn}});var bn=t(45972),lt=t(22374),Ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},Dt=Ht,wt=t(25078),Ke=function(mt,$){return lt.createElement(wt.Z,(0,bn.Z)((0,bn.Z)({},mt),{},{ref:$,icon:Dt}))};Ke.displayName="MinusCircleOutlined";var Pn=lt.forwardRef(Ke)},26081:function(nn){nn.exports={DeployModal_root:"DeployModal_root___1OL4b",Alert:"Alert___1ubcT"}},11467:function(nn){nn.exports={selection_table_thead:"selection_table_thead___mpj1J",selection_Checkbox:"selection_Checkbox___17qhJ",nav:"nav___2jNVy",domainList_Tab:"domainList_Tab___4ttRV",selection_table_tbody:"selection_table_tbody___1Rb5n",selection_table_row:"selection_table_row___FUw8w",col:"col___1UQIe",otherCol:"otherCol___gChIN"}},79756:function(nn){nn.exports={suite:"suite___18kgg",spinWrapper:"spinWrapper___17EdH",nav:"nav___3Ls6P",bar:"bar___2Pxqj",title:"title___2N2r_",remove:"remove___1mY09",batch:"batch___3KKK_",info:"info___2RGDG",var:"var___FaJBX",action:"action___3XoLG",column_outter:"column_outter___38ySl",conf_table:"conf_table___1WoTS",suite_table_loading:"suite_table_loading___8OeYB",batch_setting_table_bar:"batch_setting_table_bar___gNpdm",suite_drawer:"suite_drawer___3WpmF",case_drawer:"case_drawer___3clkU",drawer_padding:"drawer_padding___1jhA-",case_form:"case_form___1gwse",suite_form:"suite_form___RGHI0",serverItemUnchecked:"serverItemUnchecked___lvVQl",btn_style:"btn_style___3zR_3"}},50690:function(nn){nn.exports={not_logged_in:"not_logged_in___2rKJq",page_header:"page_header___33Sss",page_title:"page_title___cha7I",page_tags:"page_tags___3tZ3g",page_dec:"page_dec___1dqBn",page_preview_nav:"page_preview_nav___3I8Rg",page_body_content:"page_body_content___-zdqi",page_body:"page_body___2M3UY",yaml_copy_link:"yaml_copy_link___3TKWX",yaml_transform_icon:"yaml_transform_icon___CeuId",page_body_title:"page_body_title___7Eq27",form_row:"form_row___3-KTb",page_body_nav:"page_body_nav___K_Ncj",options_bar:"options_bar___ijZBk",yaml_container:"yaml_container___tENuh",yaml_operate:"yaml_operate___2wHTK",job_search_inp:"job_search_inp___g03ny",template_popover:"template_popover___dHPLz",template_popover_hide_content:"template_popover_hide_content___vl_rd",template_item:"template_item___292Qu"}},55704:function(nn,an,t){"use strict";t.d(an,{Z:function(){return k}});var bn=t(67515),lt=t(41083),Ht=t(67448),Dt=t(47548),wt=t(69230),Ke=t(33821),Pn=t(13059),Y=t(53676),mt=t(88966),$=t(11048),kt=t(20693),I=t(3278),mn=t(53374),P=t(61674),rn=t(79625),W=t(96584),we=t(35832),f=t(81138),xe=t(96146),r=t(32326),n=t(65790),d=t(17187),O=t(39190),re=t(22374),Et=t(74066),w=t(22812),sn=t(51937),ce=t(34516),o=t(52454),zt=(0,re.forwardRef)(function(L,Ge){var le=L||{},fe=le.onChange,e=le.dataSource,V=e===void 0?[]:e,nt=le.delCallback;function ln(E,on){if(E.preventDefault(),V&&Array.isArray(V)){var te=V.filter(function(Be){return Be.id!==on}),Tt=te.map(function(Be){return Be.id});fe(Tt),nt(te)}}return(0,o.jsx)("div",{ref:Ge,children:V.map(function(E){return(0,o.jsx)(ce.Z,{closable:!(V&&V.length===1),onClose:function(te){return ln(te,E.id)},children:E.ip},E.id)})})}),s=t(77033),Jt=t(26081),ut=t.n(Jt),a=t(97207),k=(0,re.forwardRef)(function(L,Ge){var le,fe,e=(0,w.YB)(),V=e.formatMessage,nt=d.Z.useForm(),ln=(0,O.Z)(nt,1),E=ln[0],on=(0,re.useState)(!1),te=(0,O.Z)(on,2),Tt=te[0],Be=te[1],Le=(0,re.useState)(""),Dn=(0,O.Z)(Le,2),pt=Dn[0],En=Dn[1],pn=(0,re.useState)(""),Mn=(0,O.Z)(pn,2),wn=Mn[0],ee=Mn[1],Te=(0,re.useState)(!1),It=(0,O.Z)(Te,2),Kt=It[0],_n=It[1],Zn=(0,re.useState)([]),_t=(0,O.Z)(Zn,2),hn=_t[0],bt=_t[1],Bt=(0,re.useState)([]),Gt=(0,O.Z)(Bt,2),Hn=Gt[0],dn=Gt[1],at=(0,re.useState)("common"),Ye=(0,O.Z)(at,2),N=Ye[0],Xe=Ye[1],Zt=(0,re.useState)({}),Cn=(0,O.Z)(Zt,2),ct=Cn[0],xt=Cn[1],Lt=(0,re.useState)("x86_64"),Ln=(0,O.Z)(Lt,2),kn=Ln[0],Bn=Ln[1],Ie=(0,re.useMemo)(function(){return["openanolis","opensource"].includes("opensource")},[]),$e=function(){dn([]),Xe("common"),xt({}),_n(!1)},Ce=function(){var ht=(0,r.Z)((0,we.Z)().mark(function Ae(ft){var Yt,un,In,Pt,Kn;return(0,we.Z)().wrap(function(Qt){for(;;)switch(Qt.prev=Qt.next){case 0:return Qt.prev=0,Qt.next=3,(0,s.un)({arch:ft});case 3:Yt=Qt.sent,un=Yt.code,In=Yt.msg,Pt=Yt.data,Kn=Pt===void 0?[]:Pt,un===200?(0,a.isString)(Kn)?bt([]):bt(Kn):xe.default.error(In||V({id:"device.failed.to.request.version"})),Qt.next=13;break;case 11:Qt.prev=11,Qt.t0=Qt.catch(0);case 13:case"end":return Qt.stop()}},Ae,null,[[0,11]])}));return function(ft){return ht.apply(this,arguments)}}();(0,re.useImperativeHandle)(Ge,function(){return{show:function(Ae){var ft=Ae.detailData,Yt=Ae.radio_type,un=Ae.instance_id;if(_n(!0),ee(Yt),Ie){E.setFieldsValue({instance_id:un});return}var In=ft.map(function(Pt){return{ip:Pt,id:Pt}});dn(In),E.setFieldsValue({ips:ft})}}});var Qe=function(Ae){dn(Ae)},Rt=function(Ae){Xe(Ae.target.value)},qe=function(){E.validateFields().then(function(){var Ae=(0,r.Z)((0,we.Z)().mark(function ft(Yt){var un,In,Pt,Kn,Vn,Qt;return(0,we.Z)().wrap(function($n){for(;;)switch($n.prev=$n.next){case 0:return Be(!0),En(V({id:"device.deploying"})),$n.next=4,(0,s.Ty)(Yt);case 4:un=$n.sent,In=un.code,Pt=un.msg,Kn=un.data,Vn=Kn===void 0?{}:Kn,In===200?(Qt=Vn.fail_servers)!==null&&Qt!==void 0&&Qt.length?xt(Vn):(xe.default.success(V({id:"device.deploy.finish"})),E.resetFields(),$e(),L.callback(Vn)):xe.default.error(Pt||V({id:"device.deploy.failed"})),Be(!1),En("");case 12:case"end":return $n.stop()}},ft)}));return function(ft){return Ae.apply(this,arguments)}}()).catch(function(){Be(!1),En("")})},gn=function(){Tt||(E.resetFields(),$e())},Tn=function(){var Ae=ct.success_servers,ft=Ae===void 0?[]:Ae,Yt=ct.fail_servers,un=Yt===void 0?[]:Yt,In=ft==null?void 0:ft.map(function(Pt){return Pt.ip}).join(" / ");return(0,o.jsxs)("div",{children:[ft!=null&&ft.length?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{style:{color:"#1890FF"},children:In}),"\xA0",(0,o.jsx)(w._H,{id:"device.deploy.success"}),"\uFF1B\xA0"]}):null,un==null?void 0:un.map(function(Pt){return(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{style:{color:"#F5222D"},children:Pt&&Pt.ip}),"\xA0",(0,o.jsx)(w._H,{id:"device.deploy.failed"}),"\xA0",(0,o.jsx)(W.Z,{placement:"bottomLeft",title:Pt&&Pt.msg,children:(0,o.jsx)("a",{children:(0,o.jsx)(w._H,{id:"view.details"})})})]},Pt.ip)})]})},yt=function(){xt({})},jn=function(){return Ie?"active":wn==="cloudManage"?"passive":"active"};return(0,re.useEffect)(function(){Kt&&Ce(kn)},[Kt,kn]),(0,o.jsx)("div",{children:(0,o.jsx)(lt.Z,{className:ut().DeployModal_root,title:V({id:"agent.deploy.btn"}),open:Kt,maskClosable:!1,width:460,confirmLoading:Tt,closable:!Tt,onOk:qe,onCancel:gn,children:(0,o.jsxs)(Dt.Z,{tip:pt,spinning:Tt,children:[(le=ct.success_servers)!==null&&le!==void 0&&le.length||(fe=ct.fail_servers)!==null&&fe!==void 0&&fe.length?(0,o.jsx)("div",{className:ut().Alert,children:(0,o.jsx)(P.Z,{message:Tn(),type:"info",showIcon:!0,closable:!0,onClose:yt})}):null,(0,o.jsxs)(d.Z,{form:E,layout:"vertical",initialValues:{channel:"common",mode:jn(),user:"root",arch:"x86_64"},children:[!Ie&&(0,o.jsx)(d.Z.Item,{label:"IP",name:"ips",rules:[{required:!0,message:V({id:"DeployModal.ids.message"})}],children:(0,o.jsx)(zt,{dataSource:Hn,delCallback:Qe})}),Ie&&(0,o.jsx)(d.Z.Item,{label:"InstanceID",name:"instance_id",children:(0,o.jsx)(I.Z,{disabled:!0})}),!Ie&&(0,o.jsx)(d.Z.Item,{label:(0,o.jsx)(w._H,{id:"device.deploy.mode"}),name:"channel",children:(0,o.jsxs)($.ZP.Group,{onChange:Rt,children:[(0,o.jsx)($.ZP,{value:"common",children:(0,o.jsx)(w._H,{id:"device.deploy.mode.common"})}),!Ie&&wn!=="cloudManage"&&(0,o.jsx)($.ZP,{value:null,children:V({id:"device.deploy.mode.self_agent"},{data:null})})]})}),(0,o.jsx)(d.Z.Item,{label:"Mode",name:"mode",children:(0,o.jsxs)($.ZP.Group,{children:[(0,o.jsxs)($.ZP,{value:"active",children:["active",(0,o.jsx)(Y.Z,{placement:"topLeft",content:(0,o.jsx)(w._H,{id:"device.mode.active"}),children:(0,o.jsx)(Et.Z,{style:{opacity:.65,marginLeft:2}})})]}),(0,o.jsxs)($.ZP,{value:"passive",children:["passive",(0,o.jsx)(Y.Z,{placement:"topLeft",content:(0,o.jsx)(w._H,{id:"device.mode.passive"}),children:(0,o.jsx)(Et.Z,{style:{opacity:.65,marginLeft:2}})})]})]})}),(0,o.jsx)(d.Z.Item,{label:"arch",name:"arch",required:!0,children:(0,o.jsxs)(Ke.Z,{onSelect:function(Ae){return Bn(Ae)},children:[(0,o.jsx)(Ke.Z.Option,{value:"x86_64",children:"x86_64"}),(0,o.jsx)(Ke.Z.Option,{value:"aarch64",children:"aarch64"})]})}),(0,o.jsx)(d.Z.Item,{label:(0,o.jsx)(w._H,{id:"agent.modal.Version"}),name:"version",rules:[{required:!0,message:V({id:"please.select"})}],children:(0,o.jsx)(Ke.Z,{placeholder:V({id:"please.select"}),showSearch:!0,optionFilterProp:"children",filterOption:function(Ae,ft){return ft.children.toLowerCase().indexOf(Ae.toLowerCase())>=0},children:hn==null?void 0:hn.map(function(ht){return(0,o.jsx)(Ke.Z.Option,{value:ht.version,children:ht.version},ht.id)})})}),!Ie&&N==="common"&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(d.Z.Item,{label:"User",name:"user",rules:[{required:!1,max:20,message:V({id:"device.user.message"})}],children:(0,o.jsx)(I.Z,{placeholder:V({id:"please.enter"}),autoComplete:"off"})}),(0,o.jsx)(d.Z.Item,{label:"Password",name:"password",children:(0,o.jsx)(I.Z.Password,{placeholder:V({id:"please.enter"})})})]})]})]})})})})},60798:function(nn,an,t){"use strict";var bn=t(69230),lt=t(33821),Ht=t(20693),Dt=t(3278),wt=t(20418),Ke=t(35832),Pn=t(32326),Y=t(65790),mt=t(17187),$=t(39190),kt=t(22374),I=t(24895),mn=t.n(I),P=t(22812),rn=t(24812),W=t(75841),we=t(97207),f=t.n(we),xe=t(52454);an.Z=function(r){var n=r.contrl,d=r.disabled,O=d===void 0?!1:d,re=r.callBackProjectId,Et=r.onRef,w=Et===void 0?null:Et,sn=r.template,ce=sn===void 0?{}:sn,o=r.test_type,zt=o===void 0?"":o,s=r.business_type,Jt=s===void 0?"":s,ut=r.baselineListDataRef,a=r.projectListDataRef,k=(0,P.YB)(),L=k.formatMessage,Ge=mt.Z.useForm(),le=(0,$.Z)(Ge,1),fe=le[0],e=(0,rn.UO)(),V=e.ws_id,nt=kt.useState([]),ln=(0,$.Z)(nt,2),E=ln[0],on=ln[1],te={page_num:1,page_size:20,ws_id:V,search:"",tab:"all",test_type:zt},Tt=(0,P.QT)(function(){return(0,W.YK)({ws_id:V,page_size:500})},{manual:!0,initialData:[]}),Be=Tt.data,Le=Tt.run,Dn=(0,P.QT)(function(){return(0,W.bU)({ws_id:V,test_type:zt,page_size:500})},{manual:!0,initialData:[]}),pt=Dn.data,En=Dn.run,pn=function(){var ee=(0,Pn.Z)((0,Ke.Z)().mark(function Te(It){var Kt,_n;return(0,Ke.Z)().wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:return _t.next=2,(0,W.NQ)(It);case 2:Kt=_t.sent,_n=Kt.data,on(_n);case 5:case"end":return _t.stop()}},Te)}));return function(It){return ee.apply(this,arguments)}}();(0,kt.useEffect)(function(){"baseline"in n&&En(),"project"in n&&Le(),"baseline_job"in n&&pn(te)},[n,O]),(0,kt.useImperativeHandle)(w,function(){return{form:fe,reset:function(){fe.resetFields()},setVal:function(Te){fe.setFieldsValue(Te)}}}),kt.useEffect(function(){if(a&&(a.current=Be),ut&&(ut.current=pt),JSON.stringify(ce)!=="{}"){var ee=ce.project,Te=ce.baseline,It=ce.project_id,Kt=ce.baseline_id,_n=ce.baseline_job,Zn=ce.baseline_job_id,_t=ee||It,hn=Te||Kt,bt=_n||Zn;if(_t&&Be.length>0){var Bt=Be.findIndex(function(dn){return dn.id===_t});fe.setFieldsValue({project:~Bt?_t:void 0})}if(hn&&pt.length>0){var Gt=pt.findIndex(function(dn){return dn.id===hn});fe.setFieldsValue({baseline:~Gt?hn:void 0})}if(bt&&E.length>0){var Hn=E.findIndex(function(dn){return dn.id===bt});fe.setFieldsValue({baseline_job_id:~Hn?bt:void 0})}}},[Be,pt,E,ce]),(0,kt.useEffect)(function(){if(JSON.stringify(ce)!=="{}"){var ee=ce.baseline_id;fe.setFieldsValue((0,wt.Z)((0,wt.Z)({},ce),{},{baseline_id:ee}))}return function(){fe.resetFields()}},[ce]),(0,kt.useEffect)(function(){if(Be.length>0){if(!fe.getFieldValue("project")){var ee=Be.filter(function(Te){return Te.is_default})[0];ee&&fe.setFieldsValue({project:ee.id})}re(Be[0].id)}},[Be]);var Mn=function(Te){re(Te)},wn=(0,we.debounce)(function(ee){pn((0,wt.Z)((0,wt.Z)({},te),{},{search:ee}))},500);return(0,xe.jsxs)(mt.Z,{colon:!1,layout:"horizontal",size:"small",labelCol:{span:5},wrapperCol:{span:14},style:{width:"100%"},name:"basic",form:fe,className:mn().job_test_form,children:["job_name"in n&&(0,xe.jsx)(mt.Z.Item,{name:"name",label:n.job_name.alias||(0,xe.jsx)(P._H,{id:"job.form.".concat(n.job_name.name)}),rules:[{pattern:/^[A-Za-z0-9\{}\._-]+$/g,message:L({id:"job.form.job_name.message"},{date:"{date}"})},{max:128,message:L({id:"job.form.job_name.limit.message"})}],children:(0,xe.jsx)(Dt.Z,{autoComplete:"off",title:L({id:"job.form.job_name.message"},{date:"{date}"}),placeholder:L({id:"job.form.job_name.message"},{date:"{date}"}),disabled:O})}),"project"in n&&(0,xe.jsx)(mt.Z.Item,{name:"project",label:n.project.alias||(0,xe.jsx)(P._H,{id:"job.form.".concat(n.project.name)}),children:(0,xe.jsx)(lt.Z,{allowClear:!0,getPopupContainer:function(Te){return Te.parentNode},showSearch:!0,disabled:O,placeholder:L({id:"job.form.project.placeholder"}),onSelect:Mn,filterOption:function(Te,It){return It.label.indexOf(Te)>=0},options:Be.map(function(ee){return{label:"".concat(ee.name,"(").concat(ee.product_name,")"),value:ee.id}})})}),(["functional","performance"].includes(zt)||["functional","performance"].includes(Jt))&&"baseline"in n&&(0,xe.jsx)(mt.Z.Item,{name:"baseline",label:n.baseline.alias||(0,xe.jsx)(P._H,{id:"job.form.".concat(n.baseline.name)}),children:(0,xe.jsx)(lt.Z,{allowClear:!0,getPopupContainer:function(Te){return Te.parentNode},showSearch:!0,disabled:O,placeholder:L({id:"job.form.baseline.placeholder"}),filterOption:function(Te,It){return It.label.indexOf(Te)>=0},options:pt.map(function(ee){return{label:ee.name,value:ee.id}})})}),"baseline_job"in n&&(0,xe.jsx)(mt.Z.Item,{name:"baseline_job_id",label:n.baseline_job.alias||(0,xe.jsx)(P._H,{id:"job.form.".concat(n.baseline_job.name)}),children:(0,xe.jsx)(lt.Z,{allowClear:!0,showSearch:!0,getPopupContainer:function(Te){return Te.parentNode},placeholder:L({id:"job.form.baseline_job_id.placeholder"}),onSearch:wn,disabled:O,filterOption:!1,options:E.map(function(ee){return{label:"#".concat(ee.id," ").concat(ee.name),value:ee.id}})})})]})}},22686:function(nn,an,t){"use strict";var bn=t(20693),lt=t(3278),Ht=t(14320),Dt=t(53479),wt=t(70772),Ke=t(6701),Pn=t(69230),Y=t(33821),mt=t(88966),$=t(11048),kt=t(488),I=t(20418),mn=t(65790),P=t(17187),rn=t(39190),W=t(22374),we=t(24895),f=t.n(we),xe=t(14582),r=t(96211),n=t(78938),d=t(39854),O=t(86323),re=t(526),Et=t(40896),w=t(22812),sn=t(24812),ce=t(97207),o=t.n(ce),zt=t(39935),s=t(52454),Jt=["branch","kernel_packages"];an.Z=function(ut){var a=ut.contrl,k=ut.disabled,L=k===void 0?!1:k,Ge=ut.envErrorFlag,le=ut.project_id,fe=ut.onRef,e=fe===void 0?null:fe,V=ut.template,nt=V===void 0?{}:V,ln=(0,w.YB)(),E=ln.formatMessage,on=(0,sn.UO)(),te=on.ws_id,Tt=P.Z.useForm(),Be=(0,rn.Z)(Tt,1),Le=Be[0],Dn=(0,W.useState)(!1),pt=(0,rn.Z)(Dn,2),En=pt[0],pn=pt[1],Mn=(0,W.useState)(!1),wn=(0,rn.Z)(Mn,2),ee=wn[0],Te=wn[1],It=(0,W.useState)(!1),Kt=(0,rn.Z)(It,2),_n=Kt[0],Zn=Kt[1],_t=(0,W.useState)("no"),hn=(0,rn.Z)(_t,2),bt=hn[0],Bt=hn[1],Gt=function(N){Bt(N.target.value),!L&&Le.resetFields(["kernel_packages","kernel_version","scripts"])};(0,W.useImperativeHandle)(e,function(){return{form:Le,reset:function(){Le.resetFields(),pn(!1),Te(!1),Zn(!1),Bt("no")},setVal:function(N){var Xe=N.rpm_info,Zt=N.script_info,Cn=N.kernel_version,ct=N.kernel_info,xt=N.build_pkg_info;Xe=Xe||[{pos:"before",rpm:""}],Zt=Zt||[{pos:"before",script:""}],Le.resetFields();var Lt="no";if(ct&&o().get(ct,"kernel_packages")&&Cn){Lt="install_push",Le.setFieldsValue((0,I.Z)((0,I.Z)({},N),{},{kernel_install:Lt,rpm_info:Xe,script_info:Zt})),Bt(Lt);return}if(ct&&o().get(ct,"kernel_packages")&&!Cn){Lt="install_un_push",Le.setFieldsValue((0,I.Z)((0,I.Z)({},N),{},{kernel_install:Lt,rpm_info:Xe,script_info:Zt})),Bt(Lt);return}if(xt&&o().get(xt,"code_repo")&&o().get(xt,"code_branch")&&o().get(xt,"cpu_arch")){Lt="install_build_kernel",Le.setFieldsValue((0,I.Z)((0,I.Z)({},N),{},{kernel_install:Lt,rpm_info:Xe,script_info:Zt})),Bt(Lt);return}Le.setFieldsValue((0,I.Z)((0,I.Z)({},N),{},{kernel_install:Lt,rpm_info:Xe,script_info:Zt})),Bt(Lt)}}}),(0,W.useEffect)(function(){Ge&&Le.scrollToField("env_info")},[Ge]);var Hn=(0,w.QT)(function(){return(0,xe.ZP)({enable:"True"})}),dn=Hn.data;(0,W.useEffect)(function(){if(JSON.stringify(nt)!=="{}"){var Ye=nt.monitor_info,N=nt.need_reboot,Xe=nt.rpm_info,Zt=nt.script_info,Cn=nt.env_info,ct=nt.kernel_info,xt=nt.kernel_version,Lt=nt.iclone_info,Ln=nt.build_pkg_info,kn=Lt||{},Bn=kn.os,Ie=Bn===void 0?"":Bn,$e=kn.app_name,Ce=$e===void 0?"":$e,Qe=ct||{},Rt=Qe.branch,qe=Qe.kernel_packages,gn=(0,kt.Z)(Qe,Jt),Tn=!1;(Ie||Ce)&&(Tn=!0,pn(Tn));var yt=Ln&&JSON.stringify(Ln)!=="{}";xt&&Bt("install_push"),!xt&&!yt&&qe&&Bt(qe.length>0?"install_un_push":"no"),yt&&Bt("install_build_kernel"),Te(N);var jn=!1;Ye&&Ye.length>0&&(Zn(!0),jn=!0);var ht=Cn?(0,re.xX)(Cn):"",Ae=o().isArray(Ye)?Ye.map(function(ft){var Yt={monitor_type:ft.monitor_type};return o().get(ft,"monitor_type")==="custom_machine"&&(Yt.server=ft.server_input),Yt}):[];Le.setFieldsValue((0,I.Z)((0,I.Z)({monitor_info:Ye&&Ye.length>0?Ae:[{monitor_type:"case_machine",server:""}],rpm_info:Xe&&Xe.length>0?Xe:[{pos:"before",rpm:""}],script_info:Zt&&Zt.length>0?Zt:[{pos:"before",script:""}],need_reboot:N,env_info:ht,reclone_contrl:Tn,os:Ie,app_name:Ce,moniter_contrl:jn,kernel_version:xt,kernel_packages:qe},gn),Ln))}},[nt,dn]);var at=function(N){var Xe=N.target;Te(Xe.value)};return(0,W.useEffect)(function(){Le.setFieldsValue({kernel_install:bt})},[bt]),(0,s.jsxs)(P.Z,{colon:!1,layout:"horizontal",size:"small",labelCol:{span:5},wrapperCol:{span:14},style:{width:"100%"},name:"env",form:Le,className:f().job_test_form,initialValues:{rpm_info:[{pos:"before",rpm:""}],script_info:[{pos:"before",script:""}],monitor_info:[{monitor_type:"case_machine",server:""}],need_reboot:!1,hotfix_install:!0,scripts:[{pos:"before",script:""}],kernel_install:"no"},children:["reclone"in a&&(0,s.jsx)(P.Z.Item,{label:a.reclone.alias||(0,s.jsx)(w._H,{id:"job.form.".concat(a.reclone.name)}),name:"reclone_contrl",initialValue:!1,children:(0,s.jsxs)($.ZP.Group,{disabled:L,onChange:function(N){var Xe=N.target;return pn(Xe.value)},children:[(0,s.jsx)($.ZP,{value:!0,children:(0,s.jsx)(w._H,{id:"operation.yes"})}),(0,s.jsx)($.ZP,{value:!1,children:(0,s.jsx)(w._H,{id:"operation.no"})})]})}),En&&(0,s.jsxs)(P.Z.Item,{label:" ",children:[(0,s.jsx)(P.Z.Item,{label:(0,s.jsx)(w._H,{id:"job.form.physical.machine"}),children:(0,s.jsxs)(Dt.Z,{gutter:10,children:[(0,s.jsx)(Ke.Z,{span:12,children:(0,s.jsx)(P.Z.Item,{name:"os",noStyle:!0,children:(0,s.jsxs)(Y.Z,{getPopupContainer:function(N){return N.parentNode},placeholder:(0,s.jsx)(w._H,{id:"job.form.iclone.os"}),disabled:L,children:[(0,s.jsx)(Y.Z.Option,{value:"AliOS7U2-4.9-x86-64",children:"AliOS7U2-4.9-x86-64"}),(0,s.jsx)(Y.Z.Option,{value:"AliOS7U2-aarch64",children:"AliOS7U2-aarch64"}),(0,s.jsx)(Y.Z.Option,{value:"AliOS7U2-x86-64",children:"AliOS7U2-x86-64"})]})})}),(0,s.jsx)(Ke.Z,{span:12,children:(0,s.jsx)(P.Z.Item,{name:"app_name",noStyle:!0,children:(0,s.jsxs)(Y.Z,{getPopupContainer:function(N){return N.parentNode},placeholder:(0,s.jsx)(w._H,{id:"job.form.iclone.template"}),disabled:L,children:[(0,s.jsx)(Y.Z.Option,{value:"baseos_server",children:"baseos_server"}),(0,s.jsx)(Y.Z.Option,{value:"app_server",children:"app_server"})]})})})]})}),(0,s.jsx)(P.Z.Item,{name:"vm",label:(0,s.jsx)(w._H,{id:"job.form.vm"}),children:(0,s.jsx)(Y.Z,{getPopupContainer:function(N){return N.parentNode},placeholder:(0,s.jsx)(w._H,{id:"job.form.vm.config"}),disabled:L})})]}),"kernel_install"in a&&(0,s.jsx)(P.Z.Item,{label:a.kernel_install.alias||(0,s.jsx)(w._H,{id:"job.form.".concat(a.kernel_install.name)}),name:"kernel_install",children:(0,s.jsxs)($.ZP.Group,{value:bt,disabled:L,onChange:Gt,children:[(0,s.jsx)($.ZP,{value:"no",children:(0,s.jsx)(w._H,{id:"job.form.uninstall"})}),(0,s.jsx)($.ZP,{value:"install_push",children:(0,s.jsx)(w._H,{id:"job.form.install_push"})}),(0,s.jsx)($.ZP,{value:"install_un_push",children:(0,s.jsx)(w._H,{id:"job.form.install_un_push"})}),(0,s.jsx)($.ZP,{value:"install_build_kernel",children:(0,s.jsx)(w._H,{id:"job.form.install_build_kernel"})})]})}),bt==="install_push"&&(0,s.jsx)(r.Z,{form:Le,kernel:bt,kernelList:dn,disabled:L,needScriptList:!zt.lU.includes(te)}),bt==="install_un_push"&&(0,s.jsx)(n.Z,{disabled:L,form:Le,needScriptList:!zt.lU.includes(te)}),bt==="install_build_kernel"&&(0,s.jsx)(d.Z,{disabled:L,form:Le,project_id:le}),"reboot"in a&&(0,s.jsx)(P.Z.Item,{label:a.reboot.alias||(0,s.jsx)(w._H,{id:"job.form.".concat(a.reboot.name)}),name:"need_reboot",children:(0,s.jsxs)($.ZP.Group,{disabled:L,onChange:at,children:[(0,s.jsx)($.ZP,{value:!0,children:(0,s.jsx)(w._H,{id:"operation.yes"})}),(0,s.jsx)($.ZP,{value:!1,children:(0,s.jsx)(w._H,{id:"operation.no"})})]})}),"global_variable"in a&&(0,s.jsx)(P.Z.Item,{label:a.global_variable.alias||(0,s.jsx)(w._H,{id:"job.form.".concat(a.global_variable.name)}),children:(0,s.jsx)(P.Z.Item,{name:"env_info",rules:[function(){return{validator:function(N,Xe){if(Xe){var Zt=/^(\w+=((('[^']+'|"[^"]+")|.+)(\n)))*\w+=(('[^']+'|"[^"]+")|.+)$/;return Zt.test(Xe)?Promise.resolve():Promise.reject(E({id:"job.form.env_info.placeholder"}))}else return Promise.resolve()}}}],children:(0,s.jsx)(lt.Z.TextArea,{disabled:L,placeholder:E({id:"job.form.env_info.placeholder"})})})}),"rpm"in a&&(0,s.jsx)(O.Z,{form:Le,label:a.rpm.alias||(0,s.jsx)(w._H,{id:"job.form.".concat(a.rpm.name)}),listName:"rpm_info",textName:"rpm",radioName:"pos",buttonText:E({id:"job.form.rpm.buttonText"}),placeholder:E({id:"job.form.rpm.placeholder"}),buttonShow:ee,disabled:L}),"script"in a&&(0,s.jsx)(O.Z,{form:Le,label:a.script.alias||(0,s.jsx)(w._H,{id:"job.form.".concat(a.script.name)}),listName:"script_info",textName:"script",radioName:"pos",buttonText:E({id:"job.form.script.buttonText"}),placeholder:E({id:"job.form.script.placeholder"}),buttonShow:ee,disabled:L}),"monitor"in a&&(0,s.jsx)(P.Z.Item,{label:a.monitor.alias||(0,s.jsx)(w._H,{id:"job.form.".concat(a.monitor.name,".config")}),name:"moniter_contrl",initialValue:!1,children:(0,s.jsxs)($.ZP.Group,{disabled:L,onChange:function(N){var Xe=N.target;Zn(Xe.value),Xe&&Le.setFieldsValue((0,I.Z)((0,I.Z)({},Le.getFieldsValue()),{},{monitor_info:[{monitor_type:"case_machine",server:""}]}))},children:[(0,s.jsx)($.ZP,{value:!0,children:(0,s.jsx)(w._H,{id:"operation.yes"})}),(0,s.jsx)($.ZP,{value:!1,children:(0,s.jsx)(w._H,{id:"operation.no"})})]})}),_n&&(0,s.jsx)(Et.Z,{disabled:L,formComponent:Le,template:nt})]})}},48451:function(nn,an,t){"use strict";t.d(an,{Z:function(){return ut}});var bn=t(39693),lt=t(20693),Ht=t(3278),Dt=t(20418),wt=t(35832),Ke=t(32326),Pn=t(65790),Y=t(17187),mt=t(39190),$=t(69230),kt=t(33821),I=t(22374),mn=t(24895),P=t.n(mn),rn=t(12568),W=t(6895),we=t(13059),f=t(53676),xe=t(41428),r=t(74066),n=t(97939),d=t(52454),O,re=(0,n.ZP)(r.Z)(O||(O=(0,xe.Z)([`
	color: rgba(0, 0, 0, 0.65);
	cursor: pointer;
	position: absolute;
	right: -22px;
	top: 5px;
`]))),Et=function(k){var L=k.contextNode,Ge=k.placement,le=Ge===void 0?"top":Ge,fe=k.style,e=fe===void 0?{}:fe;return(0,d.jsx)(f.Z,{placement:le,overlayStyle:{zIndex:1e4},content:L,color:"#fff",children:(0,d.jsx)(re,{style:e})})},w=Et,sn=t(75841),ce=t(22812),o=t(24812),zt=t(97207),s=t.n(zt),Jt=kt.Z.Option,ut=function(a){var k=a.contrl,L=a.disabled,Ge=L===void 0?!1:L,le=a.onRef,fe=le===void 0?null:le,e=a.template,V=e===void 0?{}:e,nt=a.isReset,ln=a.tagsDataRef,E=a.reportTemplateDataRef,on=(0,ce.YB)(),te=on.formatMessage,Tt=(0,o.UO)(),Be=Tt.ws_id,Le=Y.Z.useForm(),Dn=(0,mt.Z)(Le,1),pt=Dn[0],En=(0,I.useState)([]),pn=(0,mt.Z)(En,2),Mn=pn[0],wn=pn[1],ee=I.useState(),Te=(0,mt.Z)(ee,2),It=Te[0],Kt=Te[1],_n=(0,I.useState)([]),Zn=(0,mt.Z)(_n,2),_t=Zn[0],hn=Zn[1],bt=(0,I.useState)({}),Bt=(0,mt.Z)(bt,2),Gt=Bt[0],Hn=Bt[1],dn=(0,I.useState)(""),at=(0,mt.Z)(dn,2),Ye=at[0],N=at[1],Xe=(0,I.useState)(!1),Zt=(0,mt.Z)(Xe,2),Cn=Zt[0],ct=Zt[1];(0,I.useImperativeHandle)(fe,function(){return{form:pt,reset:function(){pt.resetFields()},setVal:function($e){var Ce=/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i,Qe=s().get($e,"callback_api")||"",Rt=Ce.test(Qe);ct(Qe&&!Rt),Kt(s().get($e,"report_name")||""),N(Qe),pt.setFieldsValue($e)}}});var xt=function(){var Ie=(0,Ke.Z)((0,wt.Z)().mark(function $e(){var Ce,Qe;return(0,wt.Z)().wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:return qe.next=2,(0,rn.oG)({ws_id:Be,page_size:500});case 2:Ce=qe.sent,Qe=Ce.data,ln&&(ln.current=Qe),wn(Qe);case 6:case"end":return qe.stop()}},$e)}));return function(){return Ie.apply(this,arguments)}}(),Lt=function(){var Ie=(0,Ke.Z)((0,wt.Z)().mark(function $e(){var Ce,Qe,Rt,qe,gn;return(0,wt.Z)().wrap(function(yt){for(;;)switch(yt.prev=yt.next){case 0:return yt.prev=0,yt.next=3,(0,sn.MD)({ws_id:Be,page_size:99999});case 3:Ce=yt.sent,Qe=Ce.code,Rt=Ce.data,Qe===200&&(qe=s().isArray(Rt)?Rt:[],gn=s().find(qe,{is_default:!0}),E&&(E.current=qe),hn(qe),Hn(gn)),yt.next=12;break;case 9:yt.prev=9,yt.t0=yt.catch(0),console.log(yt.t0);case 12:case"end":return yt.stop()}},$e,null,[[0,9]])}));return function(){return Ie.apply(this,arguments)}}();(0,I.useEffect)(function(){Lt(),xt()},[]),(0,I.useEffect)(function(){nt&&(Kt(""),N(""))},[nt]),(0,I.useEffect)(function(){if(JSON.stringify(V)!=="{}"){var Ie,$e,Ce,Qe=V.cleanup_info,Rt=V.tags,qe=V.notice_info,gn=V.report_name,Tn=V.callback_api,yt=V.job_timeout,jn=V.report_template||V.report_template_id;if(s().isArray(qe)&&qe.forEach(function(Ae){Ie=Ae.subject,Ae.type==="email"&&($e=Ae.to),Ae.type==="ding"&&(Ce=Ae.to)}),s().isArray(_t)){var ht=s().find(_t,["id",jn]);jn=s().get(ht,"id")}pt.setFieldsValue({cleanup_info:Qe,tags:Rt,notice_subject:Ie,email:$e,ding_token:Ce,report_template:jn,report_name:gn,callback_api:Tn,job_timeout:yt}),Kt(gn),N(Tn)}},[Gt,_t,V]);var Ln=function($e){var Ce=$e.target.value,Qe=s().cloneDeep(pt.getFieldsValue()),Rt=s().get(Qe,"report_template")||s().get(Gt,"id");pt.setFieldsValue((0,Dt.Z)((0,Dt.Z)({},Qe),{},{report_name:Ce,report_template:Rt})),Kt(Ce)},kn=function($e){var Ce=$e.target.value;N(Ce);var Qe=s().cloneDeep(pt.getFieldsValue());pt.setFieldsValue((0,Dt.Z)((0,Dt.Z)({},Qe),{},{callback_api:Ce}));var Rt=/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i,qe=Rt.test(Ce);ct(Ce&&!qe)},Bn=function(){return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{children:(0,d.jsx)(ce._H,{id:"job.form.callback_api.tips"})}),(0,d.jsx)("span",{className:P().create_doc,onClick:function(){return window.open("/help_doc/17")},children:(0,d.jsx)(ce._H,{id:"job.form.callback_api.help.document"})})]})};return(0,d.jsxs)(Y.Z,{colon:!1,layout:"horizontal",size:"small",labelCol:{span:5},wrapperCol:{span:14},style:{width:"100%"},name:"more",form:pt,className:P().job_test_form,children:["cleanup"in k&&(0,d.jsx)(Y.Z.Item,{name:"cleanup_info",label:k.cleanup.alias||(0,d.jsx)(ce._H,{id:"job.form.".concat(k.cleanup.name)}),children:(0,d.jsx)(Ht.Z.TextArea,{disabled:Ge,placeholder:te({id:"job.form.cleanup_info.placeholder"})})}),"job_tag"in k&&(0,d.jsx)(W.OT,{tags:Mn,label:k.job_tag.alias||(0,d.jsx)(ce._H,{id:"job.form.".concat(k.job_tag.name)}),disabled:Ge}),"notice_subject"in k&&(0,d.jsx)(Y.Z.Item,{name:"notice_subject",label:k.notice_subject.alias||(0,d.jsx)(ce._H,{id:"job.form.".concat(k.notice_subject.name)}),children:(0,d.jsx)(Ht.Z,{autoComplete:"off",disabled:Ge,placeholder:te({id:"job.form.notice_subject.placeholder"},{date:"{date}"})})}),"email_notice"in k&&(0,d.jsx)(Y.Z.Item,{name:"email",label:k.email_notice.alias||(0,d.jsx)(ce._H,{id:"job.form.".concat(k.email_notice.name)}),rules:[function(){return{validator:function($e,Ce){var Qe=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(Ce){var Rt=Ce.split(/,|，|\n|\s/g),qe=Rt.filter(function(gn){return!Qe.test(gn)});return qe.length===0?Promise.resolve():Promise.reject(te({id:"job.form.email.validator"}))}else return Promise.resolve()}}}],children:(0,d.jsx)(Ht.Z,{autoComplete:"off",disabled:Ge,placeholder:te({id:"job.form.email.placeholder"})})}),"ding_notice"in k&&(0,d.jsx)(Y.Z.Item,{name:"ding_token",label:k.ding_notice.alias||(0,d.jsx)(ce._H,{id:"job.form.".concat(k.ding_notice.name)}),children:(0,d.jsx)(Ht.Z,{autoComplete:"off",disabled:Ge,placeholder:te({id:"job.form.ding_token.placeholder"})})}),"report"in k&&(0,d.jsxs)(Y.Z.Item,{label:k.report.alias||te({id:"job.form.report.label"}),name:"report_name",children:[(0,d.jsx)(Ht.Z,{value:It||void 0,onChange:Ln,autoComplete:"off",disabled:Ge,placeholder:te({id:"job.form.report.placeholder"},{job_name:"{job_name}",report_seq_id:"{report_seq_id}"})}),(0,d.jsx)(w,{contextNode:(0,d.jsxs)("div",{children:[(0,d.jsx)(ce._H,{id:"job.form.report.tips"}),(0,d.jsx)("p",{style:{marginBottom:0},children:"{date} {job_name} {job_id} {product_version}"})]})})]}),It&&"report"in k&&(0,d.jsx)(Y.Z.Item,{name:"report_template",label:k.report.alias||te({id:"job.form.report_template.label"}),children:(0,d.jsx)(kt.Z,{showSearch:!0,disabled:Ge,placeholder:te({id:"job.form.report_template.placeholder"}),optionFilterProp:"children",filterOption:function($e,Ce){return Ce.children.toLowerCase().indexOf($e.toLowerCase())>=0},children:_t.map(function(Ie){return(0,d.jsx)(Jt,{value:Ie.id,children:Ie.name},Ie.id)})})}),"callback_api"in k&&(0,d.jsxs)(Y.Z.Item,{name:"callback_api",label:k.callback_api.alias||te({id:"job.form.callback_api.label"}),validateStatus:Cn&&"error"||void 0,help:Cn&&te({id:"job.form.callback_api.help"}),children:[(0,d.jsx)(Ht.Z,{value:Ye,onChange:kn,autoComplete:"off",disabled:Ge,placeholder:te({id:"job.form.callback_api.placeholder"})}),(0,d.jsx)(w,{contextNode:(0,d.jsxs)("div",{children:[(0,d.jsx)(ce._H,{id:"job.form.callback_api.icons"}),(0,d.jsx)("p",{style:{marginBottom:0},children:Bn()})]})})]}),!1]})}},19208:function(nn,an,t){"use strict";t.d(an,{Z:function(){return xa}});var bn=t(67448),lt=t(47548),Ht=t(40204),Dt=t(10724),wt=t(64510),Ke=t(87445),Pn=t(53374),Y=t(61674),mt=t(57359),$=t(34423),kt=t(90846),I=t(56511),mn=t(31650),P=t(25100),rn=t(46721),W=t(94867),we=t(35832),f=t(20418),xe=t(32326),r=t(39190),n=t(22374),d=t(97207),O=t.n(d),re=t(88018),Et=t(58414),w=t(68501),sn=t(98501),ce=t(38519),o=t(16416),zt=t(20693),s=t(3278),Jt=t(99193),ut=t(66304),a=t(22812),k=t(24812),L=t(93354),Ge=t(11467),le=t.n(Ge),fe=t(91959),e=t(52454),V=function(l){var i=l.testType,h=l.onRef,_=l.handleSelect,v=l.control,K=l.treeData,g=K===void 0?[]:K,ge=l.loading,ye=(0,a.YB)(),ve=ye.formatMessage,Fe=s.Z.Search,z=(0,k.UO)(),Re=z.ws_id,Pe=(0,a.md)(),se=(0,n.useState)(!1),D=(0,r.Z)(se,2),H=D[0],q=D[1],je=(0,n.useState)(!1),Q=(0,r.Z)(je,2),Ue=Q[0],ne=Q[1],y=(0,n.useState)(!1),rt=(0,r.Z)(y,2),We=rt[0],J=rt[1],Ct=(0,n.useState)([]),St=(0,r.Z)(Ct,2),et=St[0],tt=St[1],At=(0,n.useState)(!1),gt=(0,r.Z)(At,2),X=gt[0],B=gt[1],m=(0,n.useState)(""),C=(0,r.Z)(m,2),j=C[0],Me=C[1],oe=n.useState(""),de=(0,r.Z)(oe,2),jt=de[0],ot=de[1],Xt=function(M){return~M.domain_name_list.indexOf(j)&&~M.name.toLowerCase().indexOf(jt.toLowerCase())},qt=n.useMemo(function(){return g.map(function(G){return(0,f.Z)((0,f.Z)({},G),{},{rowkey:(0,fe.Z)()})})},[g]),vn=n.useMemo(function(){return qt.reduce(function(G,M){var be=M.test_case_list,me=M.rowkey;return G.concat(me,be.map(function(pe){return pe.id}))},[])},[qt,jt,j]),cn=n.useMemo(function(){return qt.reduce(function(G,M){var be=M.test_case_list,me=M.rowkey;return Xt(M)?G.concat(me,be.map(function(pe){return pe.id})):G},[])},[qt,j,jt]),Se=function(M){var be=M.slice().sort().join(",");be&&be===vn.slice().sort().join(",")?(ne(!1),J(!0)):M&&M.length?(ne(!0),J(!1)):(ne(!1),J(!1))},ie=function(M){Me(M)},st=(0,a.QT)(L.ge,{initialData:[]}),Oe=st.data;(0,n.useImperativeHandle)(h,function(){return{openDrawer:function(M){var be=M.test_config,me=[];g.forEach(function(pe){var Sn=be.findIndex(function(An){var Rn=An.id;return Rn===pe.id});if(Sn>-1){var On=[];pe.test_case_list.forEach(function(An){var Rn=be[Sn].test_case_list.findIndex(function(it){var Fn=it.id;return Fn===An.id});Rn>-1&&On.push(An.id)}),On.length&&On.length===pe.test_case_list.length&&me.push(pe.id),On.length&&me.push.apply(me,On)}}),Se(me),tt(me),q(!0)}}});var De=function(M){tt(M),Se(M)},xn=function(M){var be=M.target;J(be.checked),tt(be.checked?vn:[])},en=function(){q(!1),tt([]),Me(""),ot("")},tn=function(){var M=(0,d.cloneDeep)(g),be=M.filter(function(me){if(me.test_case_list=me.children.filter(function(pe){if(et.indexOf(pe.id)>-1)return pe.setup_info="",pe.cleanup_info="",pe.need_reboot=!1,pe.console=void 0,pe.monitor_info=[{items:void 0,servers:void 0}],pe.priority=10,pe.server_object_id=void 0,pe.ip=pe.ip||"\u968F\u673A",pe.env_info=pe.var?JSON.parse(pe.var).length>0?JSON.parse(pe.var):[]:[],pe}),delete me.children,me.test_case_list.length>0)return me.need_reboot=!1,me.priority=10,me.console=void 0,me.monitor_info=[{items:void 0,servers:void 0}],me.setup_info="",me.cleanup_info="",me});_(be),en()},yn=n.useMemo(function(){return qt.map(function(G){return{key:G.rowkey,title:G.name,children:G.test_case_list.map(function(M){return(0,f.Z)((0,f.Z)({},M),{},{key:M.id,title:M.name,selectable:!1,style:{display:Xt(G)?void 0:"none"}})}),style:{display:Xt(G)?void 0:"none"},selectable:!1,checkable:G.test_case_list.length!==0}})},[qt,j,jt]);return(0,e.jsx)(Et.Z,{maskClosable:!1,keyboard:!1,className:le().suite,title:(0,e.jsx)(a._H,{id:"select.suite.drawer.title"}),width:634,forceRender:!0,destroyOnClose:!0,onClose:function(){return q(!1)},open:H,bodyStyle:{paddingBottom:80},footer:(0,e.jsxs)("div",{style:{textAlign:"right",padding:"0 8px"},children:[(0,e.jsx)(o.Z,{disabled:ge,indeterminate:Ue,onChange:xn,checked:We,style:{float:"left"},children:(0,e.jsx)(a._H,{id:"select.suite.drawer.checkbox"})}),(0,e.jsx)(W.Z,{onClick:en,style:{marginRight:8},children:(0,e.jsx)(a._H,{id:"operation.cancel"})}),(0,e.jsx)(W.Z,{onClick:tn,type:"primary",children:(0,e.jsx)(a._H,{id:"operation.ok"})})]}),children:(0,e.jsxs)(lt.Z,{spinning:ge,wrapperClassName:le().spinWrapper,children:[(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,e.jsx)(Fe,{onChange:function(M){var be,me=M.target;return ot(me==null||(be=me.value)===null||be===void 0?void 0:be.replace(/\s+/g,""))},placeholder:ve({id:"select.suite.search.placeholder"}),value:jt,allowClear:!0,style:{marginBottom:12}}),v.includes("domain")&&(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{style:{position:"relative",display:"flex"},children:[(0,e.jsx)("div",{className:le().nav,children:(0,e.jsx)(a._H,{id:"select.suite.domain"})}),(0,e.jsxs)("div",{className:le().domainList_Tab,children:[(0,e.jsx)(W.Z,{className:le().domain_all,size:"small",type:j===""?"primary":"ghost",onClick:function(){return ie("")},children:(0,e.jsx)(a._H,{id:"select.suite.all.btn"})}),Oe.map(function(G,M){if(!(!X&&M>6))return(0,e.jsx)(W.Z,{type:G.name==j?"primary":"ghost",size:"small",style:(0,f.Z)({marginRight:8,marginBottom:8,boxShadow:"none"},G.name===j?{}:{border:"none"}),onClick:function(){return ie(G.name)},children:G.name},G.id)})]}),(0,e.jsx)(W.Z,{type:"link",size:"small",onClick:function(){return B(!X)},icon:X?(0,e.jsx)(Jt.Z,{}):(0,e.jsx)(ut.Z,{}),style:{position:"absolute",right:0},children:ve(X?{id:"operation.collapse"}:{id:"operation.expand"})})]})})]}),cn!=null&&cn.length?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:le().selection_table_thead,children:[(0,e.jsx)("div",{style:{width:200},children:"Test Suite"}),(0,e.jsx)("div",{children:(0,e.jsx)(a._H,{id:"select.suite.business.name"})})]}),(0,e.jsx)(sn.Z,{className:le().selection_table_tbody,checkedKeys:et,checkable:!0,onCheck:De,titleRender:function(M){var be=M||{},me=be.title,pe=be.children,Sn=be.business_name;return(0,e.jsxs)("div",{className:le().selection_table_row,children:[(0,e.jsx)("div",{className:le().col,style:{width:pe?200:"100%"},children:me||null}),(0,e.jsx)("div",{className:le().otherCol,children:Sn||(pe?"-":null)})]},M.id)},treeData:yn})]}):(0,e.jsxs)("div",{style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[(0,e.jsx)(Ke.Z,{image:Ke.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsx)(a._H,{id:"select.suite.no.case"})}),(0,e.jsx)(a.Nv,{accessible:Pe.WsMemberOperateSelf(),children:(0,e.jsx)(P.Z.Link,{target:"_blank",href:i?"/ws/".concat(Re,"/test_suite?test_type=").concat(i):"/ws/".concat(Re,"/test_suite"),children:(0,e.jsx)(W.Z,{type:"primary",children:(0,e.jsx)(a._H,{id:"select.suite.add.case"})})})})]})]})})},nt=V,ln=t(79756),E=t.n(ln),on=t(14320),te=t(53479),Tt=t(41428),Be=t(97939),Le,Dn=Be.ZP.div(Le||(Le=(0,Tt.Z)([`
    width: 100%;
    `,`
`])),function(T){var l=T.expanded;return l?"":"height: 32px; overflow: hidden;"}),pt=function(l){var i=l.dataSource,h=l.onChange,_=l.active,v=n.useRef(null),K=n.useRef(null),g=n.useState(!1),ge=(0,r.Z)(g,2),ye=ge[0],ve=ge[1],Fe=n.useState(!1),z=(0,r.Z)(Fe,2),Re=z[0],Pe=z[1],se=n.useCallback(function(D){for(var H=0,q=D.length;H<q;H++){var je=D[H];if(je.intersectionRatio===0)return Pe(!0)}},[]);return n.useEffect(function(){var D=new IntersectionObserver(se,{root:K.current});if(K.current){var H=K.current.childNodes;H.forEach(function(q){return D.observe(q)})}return function(){D.disconnect()}},[]),(0,e.jsxs)(te.Z,{style:{display:"flex",flexFlow:"row nowrap"},children:[(0,e.jsx)("div",{ref:v,children:(0,e.jsx)(P.Z.Text,{strong:!0,children:(0,e.jsx)(a._H,{id:"select.suite.domain"})})}),(0,e.jsx)("div",{style:{flex:1},children:(0,e.jsx)(Dn,{expanded:ye,ref:K,children:[{name:"",id:""}].concat(i||[]).map(function(D){var H={onClick:function(){h==null||h(D.name==="\u5168\u90E8"?"":D.name)},size:"small",style:{marginBottom:8,marginRight:8,border:"none",boxShadow:"none",transition:"none"},type:_===D.name?"primary":"ghost"};return(0,e.jsx)(W.Z,(0,f.Z)((0,f.Z)({},H),{},{children:D.name||(0,e.jsx)(a._H,{id:"all"})}),D.id)})})}),Re&&(0,e.jsx)(P.Z.Link,{style:{userSelect:"none"},children:ye?(0,e.jsxs)($.Z,{style:{cursor:"pointer"},onClick:function(){return ve(!1)},children:[(0,e.jsx)(Jt.Z,{}),(0,e.jsx)(P.Z.Link,{children:(0,e.jsx)(a._H,{id:"operation.collapse"})})]}):(0,e.jsxs)($.Z,{style:{cursor:"pointer"},onClick:function(){return ve(!0)},children:[(0,e.jsx)(ut.Z,{}),(0,e.jsx)(P.Z.Link,{children:(0,e.jsx)(a._H,{id:"operation.expand"})})]})})]})},En=pt,pn=function(l){var i=l.testType,h=l.onRef,_=l.handleSelect,v=l.control,K=l.treeData,g=K===void 0?[]:K,ge=l.loading,ye=(0,a.YB)(),ve=ye.formatMessage,Fe=(0,k.UO)(),z=Fe.ws_id,Re=s.Z.Search,Pe=(0,n.useState)(!1),se=(0,r.Z)(Pe,2),D=se[0],H=se[1],q=(0,a.md)(),je=(0,n.useState)([]),Q=(0,r.Z)(je,2),Ue=Q[0],ne=Q[1],y=(0,n.useState)(!1),rt=(0,r.Z)(y,2),We=rt[0],J=rt[1],Ct=(0,n.useState)(""),St=(0,r.Z)(Ct,2),et=St[0],tt=St[1],At=n.useState(""),gt=(0,r.Z)(At,2),X=gt[0],B=gt[1],m=function(ie){return~ie.domain_name_list.indexOf(et)&&~ie.name.toLowerCase().indexOf(X.toLowerCase())},C=n.useMemo(function(){return g.map(function(Se){return(0,f.Z)((0,f.Z)({},Se),{},{rowkey:(0,fe.Z)()})})},[g]),j=n.useMemo(function(){return C.reduce(function(Se,ie){var st=ie.test_case_list,Oe=ie.rowkey;return Se.concat(Oe,st.map(function(De){return De.id}))},[])},[C,X,et]),Me=n.useMemo(function(){return C.reduce(function(Se,ie){var st=ie.test_case_list,Oe=ie.rowkey;return m(ie)?Se.concat(Oe,st.map(function(De){return De.id})):Se},[])},[C,et,X]),oe=function(ie){J(ie.slice().sort().join(",")&&ie.slice().sort().join(",")==j.slice().sort().join(","))},de=(0,a.QT)(L.ge,{initialData:[]}),jt=de.data;(0,n.useImperativeHandle)(h,function(){return{openDrawer:function(ie){var st=ie.test_config,Oe=g.reduce(function(De,xn){var en=st.findIndex(function(tn){var yn=tn.id;return yn===xn.id});return~en?De.concat(xn.test_case_list.reduce(function(tn,yn){var G=st[en].test_case_list.findIndex(function(M){var be=M.id;return be===yn.id});return~G?tn.concat(yn.id):tn},[])):De},[]);oe(Oe),ne(Oe),H(!0)}}});var ot=function(ie){ne(ie),oe(ie)},Xt=function(ie){var st=ie.target;J(st.checked),ne(st.checked?j:[])},qt=function(){H(!1),ne([]),tt(""),B("")},vn=function(){var ie=(0,d.cloneDeep)(g),st=ie.filter(function(Oe){if(Oe.test_case_list=Oe.children.filter(function(De){if(Ue.indexOf(De.id)>-1)return De.setup_info="",De.cleanup_info="",De.need_reboot=!1,De.console=void 0,De.monitor_info=[{items:void 0,servers:void 0}],De.priority=10,De.server_object_id=void 0,De.ip=De.ip||"\u968F\u673A",De.env_info=De.var?JSON.parse(De.var).length>0?JSON.parse(De.var):[]:[],De}),delete Oe.children,Oe.test_case_list.length>0)return Oe.need_reboot=!1,Oe.priority=10,Oe.console=void 0,Oe.monitor_info=[{items:void 0,servers:void 0}],Oe.setup_info="",Oe.cleanup_info="",Oe});_(st),qt()},cn=n.useMemo(function(){return C.map(function(Se){return{key:Se.rowkey,title:Se.name,children:Se.test_case_list.map(function(ie){return{key:ie.id,title:ie.name,selectable:!1,style:{display:m(Se)?void 0:"none"}}}),style:{display:m(Se)?void 0:"none"},selectable:!1,checkable:Se.test_case_list.length>0}})},[et,X,C]);return(0,e.jsx)(Et.Z,{maskClosable:!1,keyboard:!1,className:E().suite,title:(0,e.jsx)(a._H,{id:"select.suite.drawer.title"}),width:634,forceRender:!0,destroyOnClose:!0,onClose:function(){return H(!1)},open:D,bodyStyle:{paddingBottom:80},footer:(0,e.jsxs)("div",{style:{textAlign:"right",padding:"0 8px"},children:[!!j.length&&(0,e.jsx)(o.Z,{onChange:Xt,checked:We,disabled:ge,style:{float:"left"},children:(0,e.jsx)(a._H,{id:"select.suite.drawer.checkbox"})}),(0,e.jsx)(W.Z,{onClick:qt,style:{marginRight:8},children:(0,e.jsx)(a._H,{id:"operation.cancel"})}),(0,e.jsx)(W.Z,{onClick:vn,type:"primary",children:(0,e.jsx)(a._H,{id:"operation.ok"})})]}),children:(0,e.jsxs)(lt.Z,{spinning:ge,wrapperClassName:E().spinWrapper,children:[(0,e.jsx)(Re,{placeholder:ve({id:"please.enter"}),onChange:function(ie){var st=ie.target;return B(st.value.replace(/\s+/g,""))},value:X,allowClear:!0}),(0,e.jsx)("div",{style:{marginTop:16},children:v.indexOf("domain")>-1&&(0,e.jsx)(En,{active:et,onChange:tt,dataSource:jt})}),!!(g!=null&&g.length)&&(0,e.jsx)(sn.Z,{style:{marginTop:8},checkedKeys:Ue,checkable:!0,onCheck:ot,treeData:cn}),((g==null?void 0:g.length)===0||Me.length===0)&&(0,e.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[(0,e.jsx)(Ke.Z,{image:Ke.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsx)(a._H,{id:"select.suite.no.case"})}),(0,e.jsx)(a.Nv,{accessible:q.WsMemberOperateSelf(),children:(0,e.jsx)(P.Z.Link,{target:"_blank",href:i?"/ws/".concat(z,"/test_suite?test_type=").concat(i):"/ws/".concat(z,"/test_suite"),children:(0,e.jsx)(W.Z,{type:"primary",children:(0,e.jsx)(a._H,{id:"select.suite.add.case"})})})})]})]})})},Mn=pn,wn=t(11407),ee=t(41604),Te=t(79625),It=t(96584),Kt=t(76740),_n=t(83396),Zn=t(51937),_t=t(34516),hn=t(39693),bt=t(1518),Bt=t(88966),Gt=t(11048),Hn=t(488),dn=t(65790),at=t(17187),Ye=(0,n.createContext)(null),N=t(33705),Xe=t(70772),Zt=t(6701),Cn=t(69230),ct=t(33821),xt=t(70991),Lt=t(8281),Ln=t(58591),kn=function(l){var i=l.menu,h=l.uri,_=(0,a.md)();return(0,e.jsxs)($.Z,{direction:"vertical",style:{width:"100%"},size:0,children:[i,(0,e.jsxs)(a.Nv,{accessible:_.IsSysTestAdmin(),fallback:(0,e.jsx)(e.Fragment,{}),children:[(0,e.jsx)(Ln.Z,{style:{margin:0}}),(0,e.jsx)(te.Z,{justify:"center",align:"middle",style:{height:30},children:(0,e.jsx)(P.Z.Link,{target:"_blank",href:h,style:{width:"100%",textAlign:"center"},children:"\u53BB\u914D\u7F6E"})})]})]})},Bn=kn,Ie=t(23101);function $e(T,l,i){i===void 0&&(i={});var h=(0,n.useRef)();h.current=l,(0,n.useEffect)(function(){var _=(0,Ie.n)(i.target,window);if(!!_.addEventListener){var v=function(g){return h.current&&h.current(g)};return _.addEventListener(T,v,{capture:i.capture,once:i.once,passive:i.passive}),function(){_.removeEventListener(T,v,{capture:i.capture})}}},[T,i.target,i.capture,i.once,i.passive])}var Ce=$e;function Qe(){return!!(typeof window!="undefined"&&window.document&&window.document.createElement)}var Rt=function(T,l){var i=typeof Symbol=="function"&&T[Symbol.iterator];if(!i)return T;var h=i.call(T),_,v=[],K;try{for(;(l===void 0||l-- >0)&&!(_=h.next()).done;)v.push(_.value)}catch(g){K={error:g}}finally{try{_&&!_.done&&(i=h.return)&&i.call(h)}finally{if(K)throw K.error}}return v},qe=function(){return Qe()?document.visibilityState:"visible"};function gn(){var T=Rt((0,n.useState)(function(){return qe()}),2),l=T[0],i=T[1];return Ce("visibilitychange",function(){i(qe())},{target:function(){return document}}),l}var Tn=gn,yt=function(l){return new Map([["Available","success"],["Occupied","error"],["Reserved","warning"]]).get(l)||void 0},jn=function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],h=l==null?void 0:l.map(function(_){var v=_.id;return v});return i==null?void 0:i.reduce(function(_,v){return h.includes(v.id)?_:_.concat(v)},[]).concat(l)},ht=function(l){var i=(0,a.YB)(),h=i.formatMessage,_=l.serverObjectType,v=l.run_mode,K=l.server_type,g=l.serverList,ge=(0,k.UO)(),ye=ge.ws_id,ve=(0,n.useContext)(Ye),Fe=ve.setServerList,z=100,Re=(0,n.useState)(!0),Pe=(0,r.Z)(Re,2),se=Pe[0],D=Pe[1],H=(0,n.useState)(1),q=(0,r.Z)(H,2),je=q[0],Q=q[1],Ue=n.useState(!1),ne=(0,r.Z)(Ue,2),y=ne[0],rt=ne[1],We=function(){var B=(0,xe.Z)((0,we.Z)().mark(function m(){var C,j,Me,oe,de=arguments;return(0,we.Z)().wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return C=de.length>0&&de[0]!==void 0?de[0]:1,ot.next=3,(0,xt.fp)({ws_id:ye,state:["Available","Occupied","Reserved"],page_num:C,page_size:z});case 3:j=ot.sent,Me=j.data,oe=j.code,oe===200&&Me&&Fe(function(Xt){return jn(Xt,Me)});case 7:case"end":return ot.stop()}},m)}));return function(){return B.apply(this,arguments)}}(),J=function(){var B=(0,xe.Z)((0,we.Z)().mark(function m(){var C,j,Me,oe,de=arguments;return(0,we.Z)().wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return C=de.length>0&&de[0]!==void 0?de[0]:1,ot.next=3,(0,xt.Y_)({cluster_type:"aligroup",ws_id:ye,page_num:C,page_size:z});case 3:j=ot.sent,Me=j.data,oe=j.code,oe===200&&Me&&Fe(function(Xt){return jn(Xt,Me)});case 7:case"end":return ot.stop()}},m)}));return function(){return B.apply(this,arguments)}}(),Ct=function(){var B=(0,xe.Z)((0,we.Z)().mark(function m(){var C,j,Me;return(0,we.Z)().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return de.next=2,(0,xt.CR)({ws_id:ye,no_page:!0,is_instance:_==="instance",state:["Available","Occupied","Reserved"]});case 2:C=de.sent,j=C.data,Me=C.code,Me===200&&j&&Fe(function(jt){return jn(jt,j)});case 6:case"end":return de.stop()}},m)}));return function(){return B.apply(this,arguments)}}(),St=function(){var B=(0,xe.Z)((0,we.Z)().mark(function m(){var C,j,Me;return(0,we.Z)().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return de.next=2,(0,xt.aN)({cluster_type:"aliyun",ws_id:ye,no_page:!0});case 2:C=de.sent,j=C.data,Me=C.code,Me===200&&j&&Fe(function(jt){return jn(jt,j)});case 6:case"end":return de.stop()}},m)}));return function(){return B.apply(this,arguments)}}(),et=function(){var B=(0,xe.Z)((0,we.Z)().mark(function m(){var C,j=arguments;return(0,we.Z)().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(C=j.length>0&&j[0]!==void 0?j[0]:1,D(!0),K!=="aligroup"){oe.next=12;break}if(v!=="cluster"){oe.next=8;break}return oe.next=6,J(C);case 6:oe.next=10;break;case 8:return oe.next=10,We(C);case 10:oe.next=19;break;case 12:if(v!=="cluster"){oe.next=17;break}return oe.next=15,St();case 15:oe.next=19;break;case 17:return oe.next=19,Ct();case 19:D(!1);case 20:case"end":return oe.stop()}},m)}));return function(){return B.apply(this,arguments)}}();(0,n.useEffect)(function(){return _!=="ip"&&_!=="server_tag_id"&&(et(1),Q(1)),function(){rt(!1)}},[_]);var tt=Tn();n.useEffect(function(){tt==="hidden"&&rt(!0),y&&tt==="visible"&&(et(1),Q(1))},[tt]);var At=function(m){var C=m.target;if(K==="aligroup"){var j=C.clientHeight,Me=C.scrollHeight,oe=C.scrollTop;if(j+oe===Me){var de=je+1;Q(de),et(de)}}},gt=(0,n.useMemo)(function(){switch(_){case"server_object_id":return h({id:"select.suite.server_object_id.message"});case"instance":return h({id:"select.suite.instance.message"});case"setting":return h({id:"select.suite.setting.message"});default:return""}},[_]),X=(0,n.useMemo)(function(){var B=[];return _==="server_object_id"&&(v==="standalone"?B=g.map(function(m){var C=m.ip||m.sn;return{value:m.id,label:(0,e.jsxs)(P.Z.Text,{ellipsis:{tooltip:C},children:[(0,e.jsx)(I.Z,{status:yt(m.state),style:{marginRight:8}}),C]}),search_key:C}}):B=g.map(function(m){return{value:m.id,label:m.name,search_key:m.name}})),_==="instance"&&(B=g.filter(function(m){return m.is_instance}).map(function(m){var C=m.private_ip,j=C?"".concat(C," / ").concat(m.instance_name):m.instance_name;return{value:m.id,label:(0,e.jsxs)(P.Z.Text,{ellipsis:{tooltip:j},children:[(0,e.jsx)(I.Z,{style:{marginRight:8},status:yt(m.state)}),j]}),search_key:j}})),_==="setting"&&(B=g.filter(function(m){return!m.is_instance}).map(function(m){return{value:m.id,label:(0,e.jsx)(P.Z.Text,{ellipsis:{tooltip:!0},children:m.template_name}),search_key:m.template_name}})),B},[g,_,v]);return["ip","server_tag_id"].includes(_)?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)(at.Z.Item,{noStyle:!0,children:(0,e.jsx)(at.Z.Item,{name:"server_object_id",rules:[{required:!0,message:gt}],children:(0,e.jsx)(ct.Z,{allowClear:!0,style:{width:"100%"},placeholder:gt,dropdownMatchSelectWidth:340,showSearch:!0,loading:se,onPopupScroll:At,popupClassName:"job_select_drop_cls",dropdownRender:function(m){return(0,e.jsx)(Bn,{menu:m,uri:"/ws/".concat(ye,"/device/").concat(K==="aliyun"?"cloud":"group","?t=").concat(v,"&isInstance=").concat(_==="instance"?1:0)})},optionFilterProp:"children",filterOption:function(m,C){var j;return((j=C==null?void 0:C.search_key)!==null&&j!==void 0?j:"").toLowerCase().includes(m.toLowerCase())},options:X})})})},Ae=ht,ft=function(l){var i=(0,a.YB)(),h=i.formatMessage,_=l.run_mode,v=l.server_type,K=l.serverObjectType,g=l.tagList,ge=(0,k.UO)(),ye=ge.ws_id,ve=(0,n.useContext)(Ye),Fe=ve.setTagList,z=100,Re=(0,n.useState)(1),Pe=(0,r.Z)(Re,2),se=Pe[0],D=Pe[1],H=(0,n.useState)(!0),q=(0,r.Z)(H,2),je=q[0],Q=q[1],Ue=function(){var y=(0,xe.Z)((0,we.Z)().mark(function rt(){var We,J,Ct,St,et=arguments;return(0,we.Z)().wrap(function(At){for(;;)switch(At.prev=At.next){case 0:return We=et.length>0&&et[0]!==void 0?et[0]:1,Q(!0),At.next=4,(0,xt.yM)({ws_id:ye,run_mode:_,page_num:We,run_environment:v,page_size:z});case 4:J=At.sent,Ct=J.data,St=J.code,St===200&&Ct&&Fe(function(gt){return Ct.reduce(function(X,B){var m=gt.map(function(C){var j=C.id;return j});return m.includes(B.id)?X:X.concat(B)},[])}),Q(!1);case 9:case"end":return At.stop()}},rt)}));return function(){return y.apply(this,arguments)}}();(0,n.useEffect)(function(){K==="server_tag_id"&&(Fe([]),Ue(1),D(1))},[K]);var ne=function(rt){var We=rt.target,J=We.clientHeight,Ct=We.scrollHeight,St=We.scrollTop;if(J+St===Ct){var et=se+1;D(et),Ue(et)}};return(0,e.jsx)(at.Z.Item,{name:"server_tag_id",rules:[{required:!0,message:h({id:"select.suite.server_tag_id.message"})}],children:(0,e.jsx)(ct.Z,{placeholder:(0,e.jsx)(a._H,{id:"select.suite.server_tag_id.message"}),style:{width:"100%"},allowClear:!0,filterOption:function(rt,We){var J;return((J=We==null?void 0:We.name)!==null&&J!==void 0?J:"").toLowerCase().includes(rt.toLowerCase())},tagRender:N.lR,mode:"multiple",loading:je,onPopupScroll:ne,options:g==null?void 0:g.map(function(y){return{value:y.id,label:(0,e.jsx)(_t.Z,{color:y.tag_color,children:y.name}),name:y.name}})})})},Yt=ft,un=t(55704),In=t(53919),Pt=function(l){var i=(0,a.YB)(),h=i.formatMessage,_=l.mask,v=l.multipInfo,K=l.form,g=(0,n.useContext)(Ye),ge=g.setMask,ye=g.setLoading,ve=(0,n.useRef)(null),Fe=function(se){var D;(D=ve.current)===null||D===void 0||D.show((0,f.Z)((0,f.Z)({},se),{},{detailData:(se==null?void 0:se.errors)||[]}))},z=function(se){var D=se.success_servers,H=D===void 0?[]:D,q=H==null?void 0:H.map(function(je){return je.ip});q!=null&&q.length&&K.setFieldsValue({custom_ip:q[0]})},Re=function(se){var D,H=se.data,q=se.channelType;return(0,e.jsxs)("span",{children:[(0,e.jsx)("span",{children:(D=H.msg)===null||D===void 0?void 0:D.join("")}),!1]})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(at.Z.Item,{name:"custom_channel",style:{width:"100%"},rules:_?[]:[{required:!0,message:h({id:"select.suite.custom_channel"})}],children:(0,e.jsx)(In.k,{style:{width:"100%"},placeholder:v.selfServer?h({id:"select.suite.multiple.values"}):h({id:"select.suite.agent.select"}),onChange:function(se){ge(!1),se&&K.validate}})}),(0,e.jsx)(at.Z.Item,{name:"custom_ip",style:{width:"100%"},validateTrigger:["onBlur"],rules:[{required:!0,message:h({id:"select.suite.custom_ip"})},{validator:function(se,D){return(0,xe.Z)((0,we.Z)().mark(function H(){var q,je,Q,Ue;return(0,we.Z)().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(D){y.next=2;break}return y.abrupt("return",Promise.resolve(h({id:"select.suite.custom_ip"})));case 2:if(q=K.getFieldValue("custom_channel"),q){y.next=5;break}return y.abrupt("return",Promise.reject(h({id:"select.suite.custom_channel"})));case 5:return ye(!0),y.next=8,(0,xt.oO)({ip:D,channel_type:q});case 8:if(y.t0=y.sent,y.t0){y.next=11;break}y.t0={};case 11:if(je=y.t0,Q=je.code,Ue=je.msg,Q===200){y.next=17;break}return ye(!1),y.abrupt("return",Promise.reject((0,e.jsx)(Re,{data:{msg:Ue,errors:[D]},channelType:q})));case 17:return Promise.resolve(),ye(!1),y.abrupt("return");case 20:case"end":return y.stop()}},H)}))()}}],children:(0,e.jsx)(s.Z,{allowClear:!0,placeholder:v.selfServer?h({id:"select.suite.multiple.values"}):"".concat(h({id:"select.suite.enter.ip"})).concat(""),autoComplete:"off"})}),(0,e.jsx)(un.Z,{ref:ve,callback:z})]})},Kn=Pt,Vn=(0,n.memo)(function(T){var l=(0,a.YB)(),i=l.formatMessage,h=T.batch,_=T.server_type,v=T.run_mode,K=T.form,g=T.serverType,ge=T.serverObjectType,ye=T.mask,ve=T.multipInfo,Fe=(0,n.useContext)(Ye),z=Fe.setServerObjectType,Re=Fe.setServerType,Pe=Fe.setMask,se=Fe.settingType,D=Fe.setServerList,H=Fe.setTagList,q=(0,n.useCallback)(function(Ue){var ne=Ue.target;Re(ne.value),D([])},[]),je=(0,n.useCallback)(function(Ue){D([]),H([]),z(Ue),Pe(!1),K.setFieldsValue({server_object_id:void 0})},[]),Q=function(ne){Pe(!1),ne==="pool"?(Re("pool"),z("ip")):Re("custom")};return(0,e.jsxs)(e.Fragment,{children:[!ye&&(0,e.jsx)(at.Z.Item,{label:se==="suite"?(0,e.jsx)(N.fD,{title:i({id:"select.suite.the.server"}),desc:i({id:"select.suite.the.server.desc"})}):i({id:"select.suite.the.server"}),className:"drawer_padding",children:(0,e.jsxs)(Gt.ZP.Group,{value:g,onChange:q,children:[(0,e.jsx)(Gt.ZP,{value:"pool",children:(0,e.jsx)(a._H,{id:"select.suite.the.server.pool"})}),_!=="aliyun"&&v==="standalone"&&(0,e.jsx)(Gt.ZP,{value:"custom",children:(0,e.jsx)(a._H,{id:"select.suite.self.owned.server"})})]})}),ye&&h&&(0,e.jsxs)(at.Z.Item,{className:"drawer_padding",label:(0,e.jsx)(a._H,{id:"select.suite.the.server"}),children:[(0,e.jsxs)("label",{className:"ant-radio-wrapper",onClick:function(){return Q("pool")},children:[(0,e.jsx)("span",{className:"ant-radio ant-radio-checked",children:(0,e.jsx)("span",{className:"ant-radio-inner ".concat(ve.serverPool?"":E().serverItemUncheckeds),style:{borderColor:"#d9d9d9"}})}),(0,e.jsx)("span",{children:(0,e.jsx)(a._H,{id:"select.suite.the.server.pool"})})]}),_!=="aliyun"&&v==="standalone"&&(0,e.jsxs)("label",{className:"ant-radio-wrapper",onClick:function(){return Q("self")},children:[(0,e.jsx)("span",{className:"ant-radio ant-radio-checked",children:(0,e.jsx)("span",{className:"ant-radio-inner ".concat(ve.selfServer?"":E().serverItemUnchecked),style:{borderColor:"#d9d9d9"}})}),(0,e.jsx)("span",{children:(0,e.jsx)(a._H,{id:"select.suite.self.owned.server"})})]})]}),(0,e.jsx)(te.Z,{style:{marginBottom:8},className:"drawer_padding",gutter:8,children:g==="pool"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Zt.Z,{span:10,children:(0,e.jsxs)(ct.Z,{style:{width:"100%"},value:ge,onChange:je,placeholder:i({id:"select.suite.multiple.values"}),children:[(0,e.jsx)(ct.Z.Option,{value:"ip",children:(0,e.jsx)(a._H,{id:"select.suite.random"})}),_==="aliyun"&&v==="standalone"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ct.Z.Option,{value:"instance",title:i({id:"select.suite.instance"}),children:(0,e.jsx)(a._H,{id:"select.suite.instance"})}),(0,e.jsx)(ct.Z.Option,{value:"setting",title:i({id:"select.suite.setting"}),children:(0,e.jsx)(a._H,{id:"select.suite.setting"})})]}):(0,e.jsx)(ct.Z.Option,{value:"server_object_id",children:(0,e.jsx)(a._H,{id:"select.suite.server_object_id"})}),(0,e.jsx)(ct.Z.Option,{value:"server_tag_id",children:(0,e.jsx)(a._H,{id:"select.suite.server_tag_id"})})]})}),(0,e.jsxs)(Zt.Z,{span:14,children:[(ge==="ip"||!ge)&&(0,e.jsx)(s.Z,{title:i({id:"select.suite.randomly.schedule"}),style:{width:"100%"},autoComplete:"off",disabled:!0,placeholder:i({id:"select.suite.randomly.schedule"})}),ge&&ge!=="ip"&&ge!=="server_tag_id"&&(0,e.jsx)(Ae,(0,f.Z)({},T)),ge==="server_tag_id"&&(0,e.jsx)(Yt,(0,f.Z)({},T))]})]}):(0,e.jsx)(Kn,(0,f.Z)({},T))}),(0,e.jsx)(at.Z.Item,{name:"timeout",label:i({id:"select.suite.timeout"}),className:"drawer_padding",children:(0,e.jsx)(bt.Z,{formatter:N.zW,style:{width:"100%"},min:0,step:1,placeholder:ve!=null&&ve.timeout?i({id:"select.suite.multiple.values"}):i({id:"select.suite.please.enter"})})}),(0,e.jsx)(at.Z.Item,{name:"repeat",label:(0,e.jsx)(N.fD,{title:"Repeat",desc:"".concat(i(se==="suite"?{id:"select.suite.repeat.tootip1"}:{id:"select.suite.repeat.tootip2"}))}),className:"drawer_padding",children:(0,e.jsx)(bt.Z,{style:{width:"100%"},min:1,step:1,formatter:N.zW,max:1e4,placeholder:i({id:ve.repeat?"select.suite.multiple.values":"please.enter"})})}),se==="suite"&&(0,e.jsx)("div",{style:{height:8,background:"rgba(0,0,0,0.03)",width:"100%",marginBottom:8}})]})}),Qt=["custom_channel","custom_ip","server_object_id","server_tag_id","repeat","timeout"],Xn,$n,qn,sa=(0,Be.ZP)(Et.Z)(Xn||(Xn=(0,Tt.Z)([`
    .ant-form-item {
        margin-bottom: 8px;
    }
    .ant-drawer-body {
        padding: 0;
    }
    .ant-form {
        padding: 13px 0;
    }
    .ant-drawer-header {
        padding: 16px 14px 8px;
    }
    .drawer_padding {
        padding-left: 20px;
        padding-right: 20px;
    }
`]))),ia=Be.ZP.div($n||($n=(0,Tt.Z)([`
    font-size: 12px;
    color: rgba(0,0,0,.65);
    margin-top: 4px;
    margin-right: 14px;
    word-wrap: break-word;
    word-break: break-all;
    overflow: hidden;
`]))),la=Be.ZP.div(qn||(qn=(0,Tt.Z)([`
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-variant: tabular-nums;
    list-style: none;
    font-feature-settings: 'tnum', "tnum";
    position: relative;
    display: inline-block;
    min-width: 0;
    padding: 4px 11px;
    color: rgba(0, 0, 0, 0.85);
    font-size: 14px;
    line-height: 1.5715;
    background-image: none;
    border: 1px solid #d9d9d9;
    border-radius: 2px;
    transition: all 0.3s;
    color: rgba(0, 0, 0, 0.25);
    background-color: #f5f5f5;
    cursor: not-allowed;
    opacity: 1;
    width: 159px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
`]))),oa=function(l,i){var h,_=(0,a.YB)(),v=_.formatMessage,K=(0,k.UO)(),g=K.ws_id,ge=l.contrl,ye=l.checked,ve=l.server_type,Fe=l.test_type,z=l.run_mode,Re=l.onDataSourceChange,Pe=l.testSuiteData,se=l.onOk,D=(0,n.useState)("pool"),H=(0,r.Z)(D,2),q=H[0],je=H[1],Q=(0,n.useState)("ip"),Ue=(0,r.Z)(Q,2),ne=Ue[0],y=Ue[1],rt=(0,n.useState)(null),We=(0,r.Z)(rt,2),J=We[0],Ct=We[1],St=at.Z.useForm(),et=(0,r.Z)(St,1),tt=et[0],At=(0,n.useState)(void 0),gt=(0,r.Z)(At,2),X=gt[0],B=gt[1],m=(0,n.useState)(!1),C=(0,r.Z)(m,2),j=C[0],Me=C[1],oe=(0,n.useState)(!0),de=(0,r.Z)(oe,2),jt=de[0],ot=de[1],Xt=(0,n.useState)(!1),qt=(0,r.Z)(Xt,2),vn=qt[0],cn=qt[1],Se=(0,n.useState)(!1),ie=(0,r.Z)(Se,2),st=ie[0],Oe=ie[1],De=(0,n.useState)(!1),xn=(0,r.Z)(De,2),en=xn[0],tn=xn[1],yn=(0,n.useState)([]),G=(0,r.Z)(yn,2),M=G[0],be=G[1],me=(0,n.useState)([]),pe=(0,r.Z)(me,2),Sn=pe[0],On=pe[1],An=(0,n.useState)(null),Rn=(0,r.Z)(An,2),it=Rn[0],Fn=Rn[1],zn=(0,n.useState)(null),Jn=(0,r.Z)(zn,2),Ve=Jn[0],ae=Jn[1],U=(0,n.useMemo)(function(){return(0,N.O6)(it)},[it]),$t=(0,n.useMemo)(function(){return(0,N.O6)(Ve)},[Ve,it]),Ft=function(x){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,F={},A=function He(Je){var Ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Je.reduce(function(ue,Ze){return Object.keys(Ze).forEach(function(he){var ke=Ze[he];he==="test_case_list"?F=He(ke,F):he in ue?O().isArray(ke)?ue[he].push(ke):ue[he]=ue[he].concat(ke):ue[he]=[ke]}),ue},Ee)},R=function(Je){return Object.keys(Je).reduce(function(Ee,ue){if(ue==="server_tag_id"&&JSON.stringify(Je[ue])!=="[]"){var Ze=Je[ue].reduce(function(ke,vt){return JSON.stringify(vt)!=="[]"?ke.concat(vt.toString()):ke},[]),he=Ze;Ze.length>0&&(he=O().uniq(Ze).map(function(ke){return ke.split(",").map(function(vt){return Number(vt)})})),Ee[ue]=he}else Ee[ue]=O().uniq(Je[ue]).reduce(function(ke,vt){return O().isArray(vt)?(JSON.stringify(vt)==="[]"||ke.push(vt),ke):vt!=null&&vt!==""?ke.concat(vt):ke},[]);return Ee},{})},_e=A(x),Ne=R(_e);if(p){var ze=R(F);return{suiteMultip:Ne,caseMultip:ze}}return{suiteMultip:Ne}},Ut=function(x){var p=x.server_object_id,F=x.server_tag_id,A=x.ip,R=x.is_instance,_e=x.customer_server,Ne=location.search.indexOf("inheriting_machine")!==-1;if(O().isNull(A)){y("ip");return}if(_e&&JSON.stringify(_e)!=="{}"){var ze=_e.custom_ip,He=_e.custom_channel;ze&&He&&(y("ip"),je("custom"));return}if(Ne&&A){ve==="aliyun"&&z==="standalone"?(R===0&&y("setting"),R===1&&y("instance")):y("server_object_id");return}if(Array.isArray(F)&&F.length||p){je("pool"),p&&(ve==="aliyun"&&z==="standalone"?(R===0&&y("setting"),R===1&&y("instance")):y("server_object_id")),O().isEmpty(F)||y("server_tag_id");return}y("ip")},Ot=function(x){var p=Object.keys(x).reduce(function(F,A){var R=x[A];return A==="env_info"&&R&&R.length===0?(F[A]=new Array(1).fill({val:"",name:""}),F):(R&&R.length===0||R&&R.length>1||(F[A]=R&&R[0]),F)},{});return p.custom_ip&&p.custom_channel?p:(0,f.Z)((0,f.Z)({},p),{},{custom_ip:null,custom_channel:null})};(0,n.useEffect)(function(){if(X){var Z={repeat:Fe==="performance"?3:1,need_reboot:!1,setup_info:"",cleanup_info:"",console:!0,priority:10,timeout:3600};if(j)if(J==="suite"){var x=Ft(X,!0),p=x.suiteMultip,F=x.caseMultip;Fn(F),ae(p);var A=Ot(F),R=Ot(p),_e=A.custom_channel,Ne=A.custom_ip,ze=A.ip,He=A.server_object_id,Je=A.server_tag_id,Ee=A.repeat,ue=A.timeout,Ze={custom_channel:_e,custom_ip:Ne,ip:ze,server_object_id:He,server_tag_id:Je,repeat:Ee,timeout:ue};Ut(Ze),tt.setFieldsValue((0,f.Z)((0,f.Z)({},R),Ze))}else{var he=Ft(X),ke=he.suiteMultip;Fn(ke);var vt=Ot(ke),Gn=vt.env_info;(!Gn||Gn.length===0)&&(vt.env_info=new Array(1).fill({val:"",name:""})),Oe(!0),tt.setFieldsValue(vt)}else{var Yn=(0,f.Z)((0,f.Z)({},Z),X);X.console==null&&(Yn.console=!0);var Qn=X.env_info;Qn&&Qn.length===0&&(Yn.env_info=new Array(1).fill({val:"",name:""}),Oe(!0)),Ut(Yn),tt.setFieldsValue(Yn)}}},[j,X,ve,J]),(0,n.useImperativeHandle)(i,function(){return{show:function(x,p){Ct(x);var F=O().isArray(p);cn(!0),B(p),Me(F),ot(!1)}}});var Wt=(0,n.useCallback)(function(){tt.resetFields(),cn(!1),B(null),Me(!1),ot(!0),Oe(!1),Fn(null),ae(null),be([]),On([]),tn(!1),je("pool"),y("ip"),Ct("case")},[]),dt=function(x){for(var p="",F=0,A=M.length;F<A;F++){var R=M[F];if(R.id===x){ne==="server_object_id"&&(p=z==="cluster"?R.name:R.ip||R.sn),ne==="instance"&&(p=R.private_ip?R.private_ip:R.instance_name),ne==="setting"&&(p=R.template_name);break}}return p},Mt=function(x){return x.reduce(function(p,F,A){for(var R=Sn.length,_e=0;_e<R;_e++)if(Sn[_e].id===F)return p+="".concat(Sn[_e].name).concat(A+1<x.length?",":"");return""},"")},Vt=function(){return q==="custom"},fn=function(){return!Vt()&&ne==="server_tag_id"},Nt=function(){return!Vt()&&ne&&ne!=="server_tag_id"&&ne!=="ip"},Nn=function(){return!Vt()&&ne==="ip"},Wn=function(x){return Object.prototype.toString.call(x)},S=(0,n.useCallback)(function(Z){var x=Wn(Z);if(x==="[object Array]"&&JSON.stringify(Z)!=="[]"){var p=Z.reduce(function(F,A){var R=Wn(A);if(JSON.stringify(A)!=="{}"&&R==="[object Object]"){var _e=Object.keys(A).reduce(function(Ne,ze){var He=A[ze];return He!=null&&He!==""&&(Ne[ze]=He),Ne},{});return JSON.stringify(_e)!=="{}"?F.concat(_e):F}return F},[]);return p.length>0?p:void 0}},[]),c=function(x,p){var F=p.custom_channel,A=p.custom_ip,R=p.server_object_id,_e=p.server_tag_id,Ne=null;Vt()?F&&A&&(Ne=A):(Nn()&&(Ne="\u968F\u673A"),Nt()&&(Ne=dt(R)),fn()&&(Ne=Mt(_e)));var ze=void 0;ne==="instance"&&(ze=1),ne==="setting"&&(ze=0);var He=(0,f.Z)((0,f.Z)({},p),{},{ip:Ne,is_instance:ze}),Je=(0,f.Z)((0,f.Z)({},x),Object.keys(He).reduce(function(ue,Ze){var he=He[Ze];if(Ze==="env_info"){var ke=S(he);return ue[Ze]=ke||x[Ze],ue}return ue[Ze]=he!=null?he:x[Ze],ue},{})),Ee=(0,f.Z)((0,f.Z)({},Je),{},{custom_channel:null,custom_ip:null,customer_server:null,server_object_id:null,server_tag_id:[]});return en?Je:Vt()?(0,f.Z)((0,f.Z)({},Ee),{},{customer_server:{custom_channel:F,custom_ip:A},custom_channel:F,custom_ip:A}):fn()?(0,f.Z)((0,f.Z)({},Ee),{},{server_tag_id:_e}):Nt()?(0,f.Z)((0,f.Z)({},Ee),{},{server_object_id:R}):Ee},u=function(){tt.validateFields().then(function(x){var p=(0,f.Z)({},x),F=p.custom_channel,A=p.custom_ip,R=p.server_object_id,_e=p.server_tag_id,Ne=p.repeat,ze=p.timeout,He=(0,Hn.Z)(p,Qt),Je={custom_channel:F,custom_ip:A,server_object_id:R,server_tag_id:_e,repeat:Ne,timeout:ze},Ee=j?X.map(function(Ze){return Ze.id}):[X.id],ue=[];J==="suite"?j?ue=Pe.reduce(function(Ze,he){return Ze.concat(Ee.includes(he.id)?(0,f.Z)((0,f.Z)((0,f.Z)({},he),He),{},{test_case_list:he.test_case_list.reduce(function(ke,vt){return ke.concat(c(vt,Je))},[])}):he)},[]):ue=Pe.map(function(Ze){return Ze.id===X.id?(0,f.Z)((0,f.Z)({},Ze),He):Ze}):ue=Pe.reduce(function(Ze,he){return Ze.concat((0,f.Z)((0,f.Z)({},he),{},{test_case_list:he.test_case_list.reduce(function(ke,vt){return ke.concat(Ee.includes(vt.id)?c(vt,x):vt)},[])}))},[]),Re(ue,z),Wt(),se()}).catch(function(x){return console.log(x)})},b=(0,n.useMemo)(function(){if(j&&it){var Z=it.ip,x=it.custom_ip,p=it.repeat,F=it.server_tag_id,A=it.server_object_id,R=it.is_instance,_e=it.timeout,Ne=A?A.length:0,ze=F?F.length:0,He=x?x.length:0,Je=Array.isArray(Z)?Z.filter(function(Ze){return Ze==="\u968F\u673A"}):[],Ee=Ne+ze+Je.length>1,ue=He>1;return(ue||Ee)&&tn(!0),!Ee&&!ue&&(je("pool"),Ne===1&&(y("server_object_id"),ve==="aliyun"&&(R&&R.length===1&&z==="standalone"?y(R[0]===1?"instance":"setting"):y("server_object_id"))),ze===1&&y("server_tag_id"),He===1&&je("custom"),Je.length===1&&y("ip")),!Ee&&ue&&je("custom"),Ne+ze+Je.length>=1&&He>=1&&(tn(!0),je("pool"),y("ip"),ue=!0,Ee=!0),Ee&&y(null),{serverPool:Ee,selfServer:ue,repeat:p.length>1,server_tag_id:ze>1,server_object_id:Ne>1,random:Je.length>1,timeout:_e.length>1,setup_info:J==="suite"?Ve.setup_info.length>1:it.setup_info.length>1,cleanup_info:J==="suite"?Ve.cleanup_info.length>1:it.cleanup_info.length>1}}return{serverPool:!1,selfServer:!1,repeat:!1,cleanup_info:!1,setup_info:!1,timeout:!1}},[it,j,ve,J,Ve,z]);return(0,e.jsx)(sa,{maskClosable:!1,keyboard:!1,title:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"".concat(v(j?{id:"select.suite.batch.config"}:{id:"select.suite.config"})," ").concat(J==="suite"?"Suite":"Conf")}),!j&&(0,e.jsx)(ia,{children:X==null?void 0:X.title})]}),width:376,forceRender:!0,destroyOnClose:!0,onClose:Wt,open:vn,bodyStyle:{paddingBottom:80,overflowX:"hidden"},footer:(0,e.jsxs)("div",{style:{textAlign:"right",padding:"0 8px"},children:[(0,e.jsx)(W.Z,{onClick:Wt,style:{marginRight:8},children:(0,e.jsx)(a._H,{id:"operation.cancel"})}),(0,e.jsx)(W.Z,{onClick:u,type:"primary",children:(0,e.jsx)(a._H,{id:"operation.ok"})})]}),children:(0,e.jsx)(lt.Z,{spinning:jt,children:(0,e.jsx)(Ye.Provider,{value:{setLoading:ot,setServerList:be,setTagList:On,setServerType:je,setServerObjectType:y,setMask:tn,settingType:J},children:(0,e.jsxs)(at.Z,{layout:"vertical",form:tt,scrollToFirstError:!0,children:[(J==="suite"&&$t||U)&&(0,e.jsx)("div",{style:{padding:"0 20px 8px"},children:(0,e.jsx)(Y.Z,{message:(0,e.jsx)(a._H,{id:"select.suite.vertical.message"}),type:"warning",showIcon:!0,style:{fontSize:12,padding:"5px 10px"}})}),(j||J==="case")&&(0,e.jsx)(Vn,(0,f.Z)((0,f.Z)({},l),{},{form:tt,dataSource:X,visible:vn,multipInfo:b,loading:jt,serverList:M,tagList:Sn,serverType:q,serverObjectType:ne,mask:en,batch:j})),ge.includes("variable")&&ye&&J==="case"&&(0,e.jsx)(at.Z.Item,{label:(0,e.jsx)(a._H,{id:"select.suite.variable"}),className:"drawer_padding",children:(0,e.jsx)(at.Z.List,{name:"env_info",children:function(x,p){var F=p.add,A=p.remove;return x.map(function(R,_e){var Ne,ze,He,Je,Ee,ue,Ze,he=tt.getFieldValue("env_info"),ke=function(Gn){var Yn=Gn.label,Qn=Gn.value,ya=Gn.width;return(0,e.jsxs)("div",{style:{display:"flex"},children:[(0,e.jsx)("div",{style:{flexWrap:"nowrap",flexShrink:0},children:Yn}),(0,e.jsx)("div",{style:{flexWrap:"wrap",width:ya},children:Qn})]})};return(0,e.jsxs)($.Z,{style:{marginBottom:8},align:"start",children:[(0,e.jsx)(It.Z,{placement:"topLeft",overlayStyle:{width:250},title:(Ne=he[_e])!==null&&Ne!==void 0&&Ne.name||(ze=he[_e])!==null&&ze!==void 0&&ze.des?(0,e.jsxs)($.Z,{direction:"vertical",children:[!!((He=he[_e])!==null&&He!==void 0&&He.name)&&(0,e.jsx)(ke,{label:v({id:"select.suite.variable.name"}),value:(Je=he[_e])===null||Je===void 0?void 0:Je.name,width:180}),!!((Ee=he[_e])!==null&&Ee!==void 0&&Ee.des)&&(0,e.jsx)(ke,{label:v({id:"select.suite.variable.desc"}),value:(ue=he[_e])===null||ue===void 0?void 0:ue.des,width:165})]}):null,children:(0,e.jsx)(la,{children:((Ze=he[_e])===null||Ze===void 0?void 0:Ze.name)||"key"})}),(0,e.jsx)("span",{style:{marginTop:5,display:"block"},children:"="}),(0,e.jsx)(at.Z.Item,{name:[R.name,"val"],fieldKey:[R.fieldKey,"val"],children:(0,e.jsx)(s.Z,{disabled:st,autoComplete:"off",placeholder:he[_e].des||v({id:"select.suite.value"})})})]},R.key)})}})}),ge.includes("reboot")&&ye&&(0,e.jsx)(at.Z.Item,{label:(0,e.jsx)(a._H,{id:"select.suite.need_reboot"}),name:"need_reboot",className:"drawer_padding",children:(0,e.jsxs)(Gt.ZP.Group,{children:[(0,e.jsx)(Gt.ZP,{value:!0,children:(0,e.jsx)(a._H,{id:"operation.yes"})}),(0,e.jsx)(Gt.ZP,{value:!1,children:(0,e.jsx)(a._H,{id:"operation.no"})})]})}),ge.includes("script")&&ye&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(at.Z.Item,{name:"setup_info",label:(0,e.jsx)(a._H,{id:"select.suite.setup_info"}),className:"drawer_padding",children:(0,e.jsx)(s.Z.TextArea,{rows:4,placeholder:b.setup_info?v({id:"select.suite.setup_info.placeholder"}):v({id:"select.suite.please.enter"})})}),(0,e.jsx)(at.Z.Item,{name:"cleanup_info",label:(0,e.jsx)(a._H,{id:"select.suite.cleanup_info"}),className:"drawer_padding",children:(0,e.jsx)(s.Z.TextArea,{rows:4,placeholder:b.cleanup_info?v({id:"select.suite.cleanup_info.placeholder"}):v({id:"select.suite.please.enter"})})})]}),(0,e.jsx)(at.Z.Item,{name:"priority",label:(0,e.jsx)(N.fD,{title:v({id:"select.suite.priority"}),desc:v({id:"select.suite.priority.desc"})}),className:"drawer_padding",children:(0,e.jsx)(bt.Z,{formatter:N.zW,style:{width:"100%"},min:0,step:1,max:20,placeholder:(it==null||(h=it.priority)===null||h===void 0?void 0:h.length)>1?v({id:"select.suite.multiple.values"}):v({id:"select.suite.please.enter"})})})]})})})})},da=(0,n.memo)((0,n.forwardRef)(oa)),ea=t(76613),ua=t(48766),ca=t(81343),fa=t(26388),va=t(79390),ma=function(T){var l=T.styleObj,i=T.record,h=T.disabled,_=T.columnsInner,v=T.selectedSuiteKeys,K=T.setSelectedCaseKeysFn,g=T.selectedCaseObj,ge=T.onColumnsChange,ye=T.columnsChange,ve=T.refreshDeps,Fe=(0,n.useState)([]),z=(0,r.Z)(Fe,2),Re=z[0],Pe=z[1],se={selectedRowKeys:Re,onChange:function(H){Pe(H),K((0,fa.Z)({},i.id,H))},getCheckboxProps:function(){return{disabled:v.length>0}}};return(0,n.useEffect)(function(){g[i.id]!==Re&&Pe(g[i.id]||[])},[g]),(0,e.jsx)(va.sL,{style:l,hasChange:ye,rowKey:function(H){return H.id+""},refreshDeps:ve,className:E().conf_table,rowSelection:h?void 0:se,columns:_,onColumnsChange:ge,rowClassName:function(H,q){return q%2==0?"inner-odd":"inner-even"},name:"ws-test-job-suite-inner",dataSource:i.test_case_list||[],pagination:!1})},Un=t(6130),ta=100,pa=function(l){var i=l.dataSource,h=l.onDataSourceChange,_=l.width,v=l.disabled,K=l.run_mode,g=l.contrl,ge=l.control,ye=l.server_type,ve=l.test_type,Fe=(0,a.YB)(),z=Fe.formatMessage,Re=(0,n.useRef)(null),Pe=(0,n.useState)(!0),se=(0,r.Z)(Pe,2),D=se[0],H=se[1],q=(0,n.useState)(!1),je=(0,r.Z)(q,2),Q=je[0],Ue=je[1],ne=(0,n.useState)([]),y=(0,r.Z)(ne,2),rt=y[0],We=y[1],J=(0,n.useState)([]),Ct=(0,r.Z)(J,2),St=Ct[0],et=Ct[1],tt=(0,n.useState)({}),At=(0,r.Z)(tt,2),gt=At[0],X=At[1],B=(0,n.useState)([]),m=(0,r.Z)(B,2),C=m[0],j=m[1],Me=(0,n.useState)({}),oe=(0,r.Z)(Me,2),de=oe[0],jt=oe[1],ot=(0,n.useState)(!1),Xt=(0,r.Z)(ot,2),qt=Xt[0],vn=Xt[1],cn=(0,n.useState)(!1),Se=(0,r.Z)(cn,2),ie=Se[0],st=Se[1],Oe=(0,n.useState)([]),De=(0,r.Z)(Oe,2),xn=De[0],en=De[1],tn=(0,n.useState)(!1),yn=(0,r.Z)(tn,2),G=yn[0],M=yn[1],be=(0,n.useState)(!1),me=(0,r.Z)(be,2),pe=me[0],Sn=me[1],On=function(c){var u=c.target.checked;if(st(u),M(!1),vn(!1),X({}),u){var b=i.map(function(Z){return Z.id+""});We(b),en(b)}else We([])},An=function(c){h(i.filter(function(u){return u.id!==c}),K)},Rn=function(c){var u=i.filter(function(b){var Z=b.test_case_list.filter(function(p){if(c!==p.id)return p});if(Z.length>0){var x=b;return x.test_case_list=Z,x}});h(u,K)},it=function(c,u){var b;return(b=Re.current)===null||b===void 0?void 0:b.show("suite",u)},Fn=function(c,u){var b;return(b=Re.current)===null||b===void 0?void 0:b.show("case",u)},zn=[{title:"Test Conf",dataIndex:"title",width:200,ellipsis:{shwoTitle:!1},fixed:"left",render:function(c){return(0,e.jsx)(Un.K,{ellipsis:{tooltip:!0},children:c||"-"})}},{title:(0,e.jsx)(a._H,{id:"select.suite.the.server"}),ellipsis:{shwoTitle:!1},key:"server",width:150,render:function(c,u){var b=z({id:"select.suite.random"}),Z=u.server_tag_id,x=u.ip,p=u.customer_server;if(Z&&Z.length>0){var F=x?x.split(",").map(function(R){return(0,e.jsx)(_t.Z,{children:R},R)}):b;return(0,e.jsx)(Un.K,{ellipsis:{tooltip:!0},children:F})}if((0,d.isNull)(x)&&p&&JSON.stringify(p)!=="{}")return(0,e.jsx)(Un.K,{ellipsis:{tooltip:!0},children:(p==null?void 0:p.custom_ip)||""});var A=x&&!["\u968F\u673A"].includes(x)?x:b;return(0,e.jsx)(Un.K,{ellipsis:{tooltip:!0},children:A||"-"})}},{title:(0,e.jsx)(a._H,{id:"select.suite.timeout"}),dataIndex:"timeout",width:130},{title:"Repeat",dataIndex:"repeat",width:80},Q&&"reboot"in g&&{title:(0,e.jsx)(a._H,{id:"select.suite.restart"}),dataIndex:"reboot",render:function(c,u){return z({id:"operation.".concat(u.need_reboot?"yes":"no")})},width:80},Q&&"script"in g&&{title:(0,e.jsx)(a._H,{id:"select.suite.script"}),width:100,dataIndex:"script",render:function(c,u){var b=z({id:"select.suite.before.restart"}),Z=z({id:"select.suite.after.restart"});return u.setup_info||u.cleanup_info?(0,e.jsx)(Un.K,{ellipsis:{tooltip:!0},children:"".concat(b,":").concat(u.setup_info||"-","\uFF0C").concat(Z,":").concat(u.cleanup_info||"-")}):"-"}},Q&&"variable"in g&&{title:(0,e.jsx)(a._H,{id:"select.suite.variable"}),dataIndex:"variable",width:150,render:function(c,u){if(u.env_info&&u.env_info.length>0){var b=u.env_info.map(function(Z){return Z.name?"".concat(Z.name||"","=").concat(Z.val||"",";"):"-"});return(0,e.jsx)(Un.K,{ellipsis:{tooltip:!0},children:b})}return"-"}},{title:(0,e.jsx)(a._H,{id:"select.suite.priority"}),dataIndex:"priority",width:80},{title:(0,e.jsx)(a._H,{id:"Table.columns.operation"}),dataIndex:"operation",width:ta,fixed:"right",render:function(c,u,b){return!v&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(W.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return Fn(b,u)},children:(0,e.jsx)(a._H,{id:"select.suite.config"})}),(0,e.jsx)(ea.Z,{className:E().remove,onClick:function(){return Rn(u.id)}})]})}}],Jn=[{title:"Test Suite",dataIndex:"title",fixed:"left",ellipsis:{shwoTitle:!1},render:function(c){return(0,e.jsx)(Un.K,{ellipsis:{tooltip:!0},children:c||"-"})}},Q&&"reboot"in g&&{title:z({id:"select.suite.restart"}),dataIndex:"reboot",width:80,render:function(c,u){return z({id:"operation.".concat(u.need_reboot?"yes":"no")})}},Q&&"script"in g&&{title:z({id:"select.suite.script"}),dataIndex:"script",width:150,render:function(c,u){var b=u.setup_info,Z=u.cleanup_info,x=z({id:"select.suite.before.restart"}),p=z({id:"select.suite.after.restart"});return b||Z?(0,e.jsx)(Un.K,{ellipsis:{tooltip:!0},children:"".concat(x,":").concat(b||"-","\uFF0C").concat(p,":").concat(Z||"-")}):"-"}},Q&&{title:z({id:"select.suite.priority"}),width:80,dataIndex:"priority"},{title:z({id:"Table.columns.operation"}),width:ta,dataIndex:"operation",fixed:"right",render:function(c,u,b){return!v&&(0,e.jsxs)(e.Fragment,{children:[Q&&(0,e.jsx)(W.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return it(b,u)},children:(0,e.jsx)(a._H,{id:"select.suite.config"})}),(0,e.jsx)(ea.Z,{className:E().remove,style:Q?{marginTop:6,padding:0}:{margin:0,paddingRight:6,width:60,textAlign:"right"},onClick:function(){return An(u.id)}})]})}}];(0,n.useEffect)(function(){i.map(function(S){S.isAdvancedConfig&&Ue(!0)})},[i]);var Ve={selectedRowKeys:rt,onChange:function(c){We(c),vn(!!c.length&&c.length<i.length),st(c.length==i.length)},getCheckboxProps:function(){return{disabled:St.length>0}}},ae=function(c){var u=O().cloneDeep(gt)||{};u=(0,f.Z)((0,f.Z)({},u),c),X(u)};(0,n.useEffect)(function(){var S=[];Object.values(gt).forEach(function(u){S=S.concat(u)});var c=C.length;Sn(!!S.length&&S.length<c),M(S.length==c),et(S)},[gt]),(0,n.useEffect)(function(){var S={};Object.keys(gt).forEach(function(c){if(de[c]){var u=gt[c].filter(function(b){if(C.indexOf(b)>-1)return b});S[c]=u}}),X(S)},[C]);var U=function(c){var u=c.target.checked;st(!1),We([]),u?(X(de),en(i.map(function(b){return b.id+""}))):X({})},$t=function(){var c,u=[];i.map(function(b){St.map(function(Z){u=u.concat(b.test_case_list.filter(function(x){return x.id==Z}))})}),(c=Re.current)===null||c===void 0||c.show("case",u)},Ft=function(){var c,u=[];i.forEach(function(b){rt.map(function(Z){b.id==Z&&u.push(b)})}),(c=Re.current)===null||c===void 0||c.show("suite",u)};(0,n.useEffect)(function(){var S=[],c={};i.forEach(function(u){S=S.concat(u.test_case_list.map(function(b){return b.id+""})),c[u.id]=u.test_case_list.map(function(b){return b.id+""})}),j(S),jt(c)},[_,v,i]);var Ut=function(c){Ue(c)},Ot=function(){if(rt.length===0&&St.length===0){H(!1);return}return rt.length>0&&Ft(),St.length>0&&$t(),H(!0)},Wt=function(c,u,b,Z){var x=u.id+"";en(c?xn.filter(function(p){return p!==x}):xn.concat([x])),Z(u,b)},dt=function(){H(!0)},Mt=(0,n.useMemo)(function(){return zn.reduce(function(S,c){return S+(c==null?void 0:c.width)},0)},[zn]),Vt=function(){X({}),We([]),st(!1),M(!1),vn(!1)},fn=n.useState((0,fe.Z)()),Nt=(0,r.Z)(fn,2),Nn=Nt[0],Wn=Nt[1];return(0,e.jsxs)("div",{style:K==="standalone"?{marginBottom:10,position:"relative"}:{position:"relative"},children:[(0,e.jsxs)(te.Z,{justify:"space-between",align:"middle",children:[(0,e.jsx)("span",{className:E().title,children:K==="standalone"?(0,e.jsx)(a._H,{id:"select.suite.standalone"}):(0,e.jsx)(a._H,{id:"select.suite.cluster"})}),i.length>0&&!v&&(0,e.jsxs)($.Z,{style:{height:"32px"},children:[(0,e.jsx)("span",{className:E().title,children:(0,e.jsx)(a._H,{id:"select.suite.advanced.config"})}),(0,e.jsx)(_n.Z,{size:"small",checked:Q,onChange:Ut})]})]}),!v&&(0,e.jsxs)(te.Z,{justify:"space-between",align:"middle",className:E().batch_setting_table_bar,children:[(0,e.jsxs)($.Z,{children:[(0,e.jsx)(o.Z,{indeterminate:qt,checked:ie,onChange:On,disabled:!Q,children:(0,e.jsx)(a._H,{id:"select.suite.selectAll.suites"})}),(0,e.jsx)(o.Z,{indeterminate:pe,checked:G,onChange:U,children:(0,e.jsx)(a._H,{id:"select.suite.selectAll.conf"})})]}),(0,e.jsx)(It.Z,{title:(0,e.jsx)("span",{onClick:function(){return H(!0)},style:{cursor:"pointer"},children:(0,e.jsx)(a._H,{id:"select.suite.select.suite/conf"})}),open:!D,children:(0,e.jsx)(W.Z,{size:"small",type:"primary",onClick:Ot,onMouseLeave:dt,children:(0,e.jsx)(a._H,{id:"select.suite.batch.config"})})})]}),(0,e.jsx)(Dt.Z,{bodyStyle:{width:"100%"},children:(0,e.jsx)(ee.Z,{style:{width:_-2},rowSelection:Q?Ve:void 0,showHeader:Q,columns:Jn.filter(Boolean),pagination:!1,className:E().suite_table_loading,scroll:Q?{x:Mt}:void 0,size:"small",rowKey:function(c){return c.id+""},dataSource:i,rowClassName:function(c,u){return u%2==0?"outter outter-odd":"outter outter-even"},expandable:{expandedRowKeys:xn,columnWidth:22,expandedRowRender:function(c){return(0,e.jsx)(ma,{styleObj:{width:_-14},scroll:Q?{x:Mt}:void 0,record:c,refreshDeps:[Q,g,v,Nn,i],disabled:v,selectedCaseObj:gt,columnsInner:zn.filter(Boolean),checked:Q,contrl:g,columnsChange:Nn,onColumnsChange:function(){return Wn((0,fe.Z)())},selectedSuiteKeys:rt,setSelectedCaseKeysFn:ae})},expandIcon:function(c){var u=c.expanded,b=c.onExpand,Z=c.record;return u?(0,e.jsx)(ua.Z,{onClick:function(p){return Wt(u,Z,p,b)}}):(0,e.jsx)(ca.Z,{onClick:function(p){return Wt(u,Z,p,b)}})}}})}),(0,e.jsx)(da,{ref:Re,test_type:ve,server_type:ye,run_mode:K,contrl:ge,checked:Q,onDataSourceChange:h,testSuiteData:i,onOk:Vt})]})},na=pa,aa,_a=(0,Be.ZP)(Y.Z)(aa||(aa=(0,Tt.Z)([`
    display: flex !important;
    align-items: start !important;
    & .anticon.anticon-exclamation-circle.ant-alert-icon {
        margin-top: 4px;
    }
    & .ant-alert-close-icon {
        margin-top: 5px;
    }
`]))),ha=function(l,i){return["ips","instance_name"].includes(l)?i==null?void 0:i.map(function(h){var _=h.ip,v=h.sn;return"".concat(_,"/").concat(v)}):i==null?void 0:i.map(function(h){var _=h.name;return _})},ga=function(l){var i=l.sources,h=l.isDelete,_=(0,a.YB)();return i?JSON.stringify(i)==="{}"?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)(e.Fragment,{children:Object.keys(i).map(function(v){return(v==null?void 0:v.length)>0&&(0,e.jsx)(_a,{showIcon:!0,type:"warning",closable:!0,message:(0,e.jsxs)($.Z,{wrap:!0,children:[ha(v,i[v]).map(function(K){return(0,e.jsx)(P.Z.Text,{children:K},(0,fe.Z)())}),(0,e.jsx)(P.Z.Text,{children:_.formatMessage({id:"select.suite.".concat(h?"removed":"existent")})})]})},(0,fe.Z)())}).filter(Boolean)}):(0,e.jsx)(e.Fragment,{})},ra=ga,ja=function(l){var i=l.handleData,h=l.contrl,_=l.test_type,v=l.business_type,K=l.template,g=K===void 0?{}:K,ge=l.disabled,ye=ge===void 0?!1:ge,ve=l.onRef,Fe=l.server_type,z=l.setPageLoading,Re=l.caseDataRef,Pe=(0,a.YB)(),se=Pe.formatMessage,D=(0,k.UO)(),H=D.ws_id,q=(0,n.useRef)(null),je=(0,n.useRef)(null),Q=(0,n.useState)(!0),Ue=(0,r.Z)(Q,2),ne=Ue[0],y=Ue[1],rt=(0,n.useState)([]),We=(0,r.Z)(rt,2),J=We[0],Ct=We[1],St=(0,n.useState)(0),et=(0,r.Z)(St,2),tt=et[0],At=et[1],gt=(0,n.useState)([]),X=(0,r.Z)(gt,2),B=X[0],m=X[1],C=(0,n.useState)([]),j=(0,r.Z)(C,2),Me=j[0],oe=j[1],de=n.useState(!1),jt=(0,r.Z)(de,2),ot=jt[0],Xt=jt[1],qt=(0,n.useState)([]),vn=(0,r.Z)(qt,2),cn=vn[0],Se=vn[1],ie=(0,n.useState)([]),st=(0,r.Z)(ie,2),Oe=st[0],De=st[1],xn=(0,n.useState)(!1),en=(0,r.Z)(xn,2),tn=en[0],yn=en[1],G=(0,n.useState)(!0),M=(0,r.Z)(G,2),be=M[0],me=M[1];(0,n.useImperativeHandle)(ve,function(){return{setChecked:console.log,reset:function(){return m([])},setVal:function(ae){var U=Rn(O().isArray(ae)?ae:[]);return m(U),U}}});var pe=(0,n.useMemo)(function(){var Ve=0;return B.map(function(ae){O().isArray(O().get(ae,"test_case_list"))&&(Ve+=ae.test_case_list.length)}),Ve},[B]),Sn=function(){var ae;(ae=je.current)===null||ae===void 0||ae.openDrawer({test_config:B})},On=function(){var Ve=(0,xe.Z)((0,we.Z)().mark(function ae(){var U,$t,Ft,Ut,Ot;return(0,we.Z)().wrap(function(dt){for(;;)switch(dt.prev=dt.next){case 0:return be&&z(!0),y(!0),Ct([]),U={test_type:_,ws_id:H},$t=_==="business"?{business_type:v}:{},dt.next=7,(0,L.Zu)((0,f.Z)((0,f.Z)((0,f.Z)({},U),$t),{},{page_size:200}));case 7:if(dt.t0=dt.sent,dt.t0){dt.next=10;break}dt.t0={};case 10:Ft=dt.t0,Ut=Ft.data,Ot=Ut===void 0?[]:Ut,Ot.map(function(Mt,Vt){var fn;return Mt.key=Vt+"",Mt.title=Mt.name,Mt.children=(fn=Mt.test_case_list)===null||fn===void 0?void 0:fn.map(function(Nt,Nn){return Nt.parentId=Mt.id,Nt.key=Vt+"-"+Nn,Nt.title=Nt.name,Nt.ip=Nt.ip||"\u968F\u673A",Nt}),Mt}),Re&&(Re.current=Ot),Ct(Ot),y(!1),yn(!0),me(!1);case 19:case"end":return dt.stop()}},ae)}));return function(){return Ve.apply(this,arguments)}}();(0,n.useEffect)(function(){On()},[]);var An=function(ae,U){var $t=ae.var,Ft=ae.title,Ut=ae.name,Ot=U.server_is_deleted,Wt=U.test_case_id,dt=U.repeat,Mt=U.timeout,Vt=U.need_reboot,fn=U.is_instance,Nt=U.priority,Nn=U.console,Wn=U.monitor_info,S=[];$t&&(S=JSON.parse($t));var c=U.env_info,u=c?Object.keys(c).map(function(Ee){return{name:Ee,val:c[Ee]}}):[],b=U.setup_info==="[]"?"":U.setup_info,Z=U.cleanup_info==="[]"?"":U.cleanup_info,x=u.length>0?u:S,p={setup_info:b,cleanup_info:Z,env_info:x,title:Ft,name:Ut,id:Wt,repeat:dt,timeout:Mt,need_reboot:Vt,is_instance:fn,priority:Nt,console:Nn,monitor_info:Wn,server_is_deleted:Ot,server_object_id:null,custom_channel:null,custom_ip:null,server_tag_id:[],ip:null};if(Ot)return p;var F=U.customer_server,A=U.server_tag_id,R=U.ip,_e=U.server_object_id,Ne=void 0,ze=void 0;F&&(Ne=F.custom_channel,ze=F.custom_ip);var He=R;!He&&ze&&(He=ze);var Je=(0,f.Z)((0,f.Z)((0,f.Z)({},U),p),{},{custom_channel:Ne,custom_ip:ze,ip:He,server_object_id:_e});return A?O().isArray(A)?Je.server_tag_id=O().filter(A):typeof A=="string"&&A.indexOf(",")>-1?Je.server_tag_id=A.split(",").map(function(Ee){return Ee-0}):Je.server_tag_id=[]:Je.server_tag_id=[],Je},Rn=function(ae){var U=ae==null?void 0:ae.reduce(function($t,Ft){var Ut=Ft.test_suite_id,Ot=Ft.cases,Wt=Ft.setup_info,dt=J.findIndex(function(Vt){var fn=Vt.id;return fn===Ut});if(~dt){var Mt=Ot==null?void 0:Ot.reduce(function(Vt,fn){var Nt=J[dt].test_case_list,Nn=fn||{},Wn=Nn.test_case_id,S=Nt.findIndex(function(u){var b=u.id;return b===Wn});if(~S){var c=Nt[S];return Vt.concat(An(c,fn))}return Vt},[]);return Mt.length>0?$t.concat((0,f.Z)((0,f.Z)({},Ft),{},{id:Ut,title:J[dt].name,run_mode:J[dt].run_mode,setup_info:Wt==="[]"?"":Wt,test_case_list:Mt})):$t}return $t},[]);return L.Zu.length>U&&Xt(!0),U};(0,n.useEffect)(function(){if(tn&&J.length>0&&JSON.stringify(g)!=="{}"){var Ve=Rn(g.test_config);m(Ve)}},[g,tn]);var it=function(){return At(q.current.clientWidth)};(0,n.useEffect)(function(){return it(),window.addEventListener("resize",it),function(){window.removeEventListener("resize",it)}},[]),(0,n.useEffect)(function(){var Ve=[];Object.keys(h).map(function(ae){h[ae].config_index==3&&Ve.push(h[ae].name)}),oe(Ve)},[h]),(0,n.useEffect)(function(){i(B);var Ve=[],ae=[];B.forEach(function(U){U.run_mode==="cluster"?ae.push(U):Ve.push(U)}),Se(Ve),De(ae)},[B]);var Fn=function(ae){if(ae.length===0)return m([]);var U=[];ae.forEach(function($t){var Ft=B.findIndex(function(Wt){return Wt.id===$t.id});if(Ft===-1)U.push($t);else{var Ut=[],Ot=B[Ft].test_case_list;$t.test_case_list.forEach(function(Wt){var dt=Ot.findIndex(function(Mt){return Mt.id===Wt.id});dt===-1?Ut.push(Wt):Ut.push(Ot[dt])}),U.push((0,f.Z)((0,f.Z)({},B[Ft]),{},{test_case_list:Ut}))}}),m(U)},zn=function(ae,U){m(U==="cluster"?cn.concat(ae):Oe.concat(ae))},Jn={disabled:ye,width:tt,test_type:_,server_type:Fe,contrl:h,control:Me,loading:ne,ws_id:H,onDataSourceChange:zn};return(0,e.jsx)("div",{className:E().suite,ref:q,style:{position:"relative",width:"100%"},children:(0,e.jsxs)(lt.Z,{spinning:ne,children:[(0,e.jsxs)("div",{children:[(0,e.jsx)(W.Z,{disabled:ye,type:"primary",size:"small",onClick:Sn,style:{marginBottom:"12px"},children:(0,e.jsx)(a._H,{id:"select.suite.select.case"})}),B.length>0&&(0,e.jsx)("span",{style:{paddingLeft:8},children:(0,e.jsxs)($.Z,{children:[(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(P.Z.Text,{style:{color:"rgba(0,0,0,.65)"},children:(0,e.jsx)(a._H,{id:"select.suite.selected"})}),(0,e.jsx)(I.Z,{style:{backgroundColor:"rgba(140,140,140,0.10)",color:"rgba(0,0,0,.65)"},count:B.length,overflowCount:999999})]}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(P.Z.Text,{style:{color:"rgba(0,0,0,.65)"},children:"Test Conf"}),(0,e.jsx)(I.Z,{style:{backgroundColor:"rgba(140,140,140,0.10)",color:"rgba(0,0,0,.65)"},count:pe,overflowCount:999999})]})]})})]}),(0,e.jsxs)($.Z,{direction:"vertical",size:6,style:{width:"100%"},children:[ot&&(0,e.jsx)(Y.Z,{message:se({id:"select.suite.table.is_delete.alart",defaultMessage:"\u6240\u9009\u7528\u4F8B\u5DF2\u4E0D\u5B58\u5728"}),type:"warning",showIcon:!0,closable:!0}),(0,e.jsx)(ra,{sources:g==null?void 0:g.server_deleted,isDelete:!0}),(0,e.jsx)(ra,{sources:g==null?void 0:g.server_no_allocated}),_==="business"?(0,e.jsx)(nt,{testType:_,onRef:je,handleSelect:Fn,control:Me,treeData:J,loading:ne}):(0,e.jsx)(Mn,{testType:_,onRef:je,handleSelect:Fn,control:Me,treeData:J,loading:ne}),cn.length===0&&Oe.length===0&&(0,e.jsx)(Dt.Z,{bodyStyle:{width:tt||"100%"},children:(0,e.jsx)(Ke.Z,{image:Ke.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsx)(a._H,{id:"select.suite.please.select.case"})})}),cn.length>0&&(0,e.jsx)(na,(0,f.Z)((0,f.Z)({},Jn),{},{dataSource:cn,run_mode:"standalone"})),Oe.length>0&&(0,e.jsx)(na,(0,f.Z)((0,f.Z)({},Jn),{},{dataSource:Oe,run_mode:"cluster"}))]})]})})},xa=ja},93354:function(nn,an,t){"use strict";t.d(an,{Zu:function(){return Dt},ge:function(){return Ke}});var bn=t(35832),lt=t(32326),Ht=t(22812),Dt=function(){var I=(0,lt.Z)((0,bn.Z)().mark(function mn(P){return(0,bn.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.abrupt("return",(0,Ht.WY)("/api/case/workspace/case/",{params:P}));case 1:case"end":return W.stop()}},mn)}));return function(P){return I.apply(this,arguments)}}(),wt=null;function Ke(){return(0,Ht.WY)("/api/case/test_domain/")}function Pn(I){return request("/api/server/server_tag/",{params:I})}function Y(I){return request("/api/server/test_server/channel/check/",{params:I})}function mt(I){return request("/api/server/test_cluster/",{params:I})}function $(I){return request("/api/server/cloud_server/",{params:I})}function kt(I){return request("/api/server/test_cluster/",{params:I})}},83396:function(nn,an,t){"use strict";t.d(an,{Z:function(){return xe}});var bn=t(29700),lt=t(77335),Ht=t(57556),Dt=t(68591),wt=t.n(Dt),Ke=t(85628),Pn=t(10929),Y=t(22374),mt=t(41140),$=t(39448),kt=Y.forwardRef(function(r,n){var d,O=r.prefixCls,re=O===void 0?"rc-switch":O,Et=r.className,w=r.checked,sn=r.defaultChecked,ce=r.disabled,o=r.loadingIcon,zt=r.checkedChildren,s=r.unCheckedChildren,Jt=r.onClick,ut=r.onChange,a=r.onKeyDown,k=(0,Pn.Z)(r,["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"]),L=(0,mt.Z)(!1,{value:w,defaultValue:sn}),Ge=(0,Ke.Z)(L,2),le=Ge[0],fe=Ge[1];function e(E,on){var te=le;return ce||(te=E,fe(te),ut==null||ut(te,on)),te}function V(E){E.which===$.Z.LEFT?e(!1,E):E.which===$.Z.RIGHT&&e(!0,E),a==null||a(E)}function nt(E){var on=e(!le,E);Jt==null||Jt(on,E)}var ln=wt()(re,Et,(d={},(0,lt.Z)(d,"".concat(re,"-checked"),le),(0,lt.Z)(d,"".concat(re,"-disabled"),ce),d));return Y.createElement("button",Object.assign({},k,{type:"button",role:"switch","aria-checked":le,disabled:ce,className:ln,ref:n,onKeyDown:V,onClick:nt}),o,Y.createElement("span",{className:"".concat(re,"-inner")},le?zt:s))});kt.displayName="Switch";var I=kt,mn=t(53532),P=t(4631),rn=t(19245),W=t(65526),we=function(r,n){var d={};for(var O in r)Object.prototype.hasOwnProperty.call(r,O)&&n.indexOf(O)<0&&(d[O]=r[O]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var re=0,O=Object.getOwnPropertySymbols(r);re<O.length;re++)n.indexOf(O[re])<0&&Object.prototype.propertyIsEnumerable.call(r,O[re])&&(d[O[re]]=r[O[re]]);return d},f=Y.forwardRef(function(r,n){var d,O=r.prefixCls,re=r.size,Et=r.disabled,w=r.loading,sn=r.className,ce=sn===void 0?"":sn,o=we(r,["prefixCls","size","disabled","loading","className"]),zt=Y.useContext(mn.E_),s=zt.getPrefixCls,Jt=zt.direction,ut=Y.useContext(rn.Z),a=Y.useContext(P.Z),k=(Et!=null?Et:a)||w,L=s("switch",O),Ge=Y.createElement("div",{className:"".concat(L,"-handle")},w&&Y.createElement(Ht.Z,{className:"".concat(L,"-loading-icon")})),le=wt()((d={},(0,lt.Z)(d,"".concat(L,"-small"),(re||ut)==="small"),(0,lt.Z)(d,"".concat(L,"-loading"),w),(0,lt.Z)(d,"".concat(L,"-rtl"),Jt==="rtl"),d),ce);return Y.createElement(W.Z,{insertExtraNode:!0},Y.createElement(I,(0,bn.Z)({},o,{prefixCls:L,className:le,disabled:k,ref:n,loadingIcon:Ge})))});f.__ANT_SWITCH=!0;var xe=f}}]);
