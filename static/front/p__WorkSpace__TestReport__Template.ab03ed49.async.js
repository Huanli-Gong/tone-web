(self.webpackChunktone_front=self.webpackChunktone_front||[]).push([[9083,2485],{76613:function(pe,X,a){"use strict";a.d(X,{Z:function(){return xe}});var Y=a(45972),W=a(22374),q={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},D=q,ge=a(25078),Q=function(re,M){return W.createElement(ge.Z,(0,Y.Z)((0,Y.Z)({},re),{},{ref:M,icon:D}))};Q.displayName="MinusCircleOutlined";var xe=W.forwardRef(Q)},99193:function(pe,X,a){"use strict";a.d(X,{Z:function(){return xe}});var Y=a(45972),W=a(22374),q={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M890.5 755.3L537.9 269.2c-12.8-17.6-39-17.6-51.7 0L133.5 755.3A8 8 0 00140 768h75c5.1 0 9.9-2.5 12.9-6.6L512 369.8l284.1 391.6c3 4.1 7.8 6.6 12.9 6.6h75c6.5 0 10.3-7.4 6.5-12.7z"}}]},name:"up",theme:"outlined"},D=q,ge=a(25078),Q=function(re,M){return W.createElement(ge.Z,(0,Y.Z)((0,Y.Z)({},re),{},{ref:M,icon:D}))};Q.displayName="UpOutlined";var xe=W.forwardRef(Q)},79756:function(pe){pe.exports={suite:"suite___18kgg",spinWrapper:"spinWrapper___17EdH",nav:"nav___3Ls6P",bar:"bar___2Pxqj",title:"title___2N2r_",remove:"remove___1mY09",batch:"batch___3KKK_",info:"info___2RGDG",var:"var___FaJBX",action:"action___3XoLG",column_outter:"column_outter___38ySl",conf_table:"conf_table___1WoTS",suite_table_loading:"suite_table_loading___8OeYB",batch_setting_table_bar:"batch_setting_table_bar___gNpdm",suite_drawer:"suite_drawer___3WpmF",case_drawer:"case_drawer___3clkU",drawer_padding:"drawer_padding___1jhA-",case_form:"case_form___1gwse",suite_form:"suite_form___RGHI0",serverItemUnchecked:"serverItemUnchecked___lvVQl",btn_style:"btn_style___3zR_3"}},93354:function(pe,X,a){"use strict";a.d(X,{Zu:function(){return D},ge:function(){return Q}});var Y=a(35832),W=a(32326),q=a(22812),D=function(){var z=(0,W.Z)((0,Y.Z)().mark(function G(ye){return(0,Y.Z)().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return se.abrupt("return",(0,q.WY)("/api/case/workspace/case/",{params:ye}));case 1:case"end":return se.stop()}},G)}));return function(ye){return z.apply(this,arguments)}}(),ge=null;function Q(){return(0,q.WY)("/api/case/test_domain/")}function xe(z){return request("/api/server/server_tag/",{params:z})}function Ze(z){return request("/api/server/test_server/channel/check/",{params:z})}function re(z){return request("/api/server/test_cluster/",{params:z})}function M(z){return request("/api/server/cloud_server/",{params:z})}function ae(z){return request("/api/server/test_cluster/",{params:z})}},21446:function(pe,X,a){"use strict";a.r(X),a.d(X,{default:function(){return Qt}});var Y=a(67448),W=a(47548),q=a(46721),D=a(94867),ge=a(67515),Q=a(41083),xe=a(81138),Ze=a(96146),re=a(64974),M=a(35832),ae=a(32326),z=a(20693),G=a(3278),ye=a(40204),Ge=a(10724),se=a(8281),Ke=a(58591),Vt=a(70772),ie=a(6701),Jt=a(88966),Le=a(11048),I=a(39190),Xt=a(57359),F=a(34423),qt=a(14320),U=a(53479),en=a(38519),We=a(16416),tn=a(31650),V=a(25100),l=a(20418),m=a(22374),u=a(22812),Ue=a(72882),yt=a(13598),jt=a(526),nn=a(88018),Ct=a(58414),rn=a(64510),lt=a(87445),an=a(68501),St=a(98501),_t=a(99193),kt=a(66304),ct=a(24812),wt=a(93354),Rt=a(53933),Tt=a(79756),It=a.n(Tt),e=a(52454),Ot=function(g,Z){var h=(0,u.YB)(),f=h.formatMessage,k=(0,ct.UO)(),d=k.ws_id,R=g.onOk,w=g.perfKeys,y=g.funcKeys,T=(0,m.useState)(!1),O=(0,I.Z)(T,2),_=O[0],p=O[1],c=(0,m.useState)(null),v=(0,I.Z)(c,2),C=v[0],E=v[1],B=(0,m.useState)(!1),$=(0,I.Z)(B,2),le=$[0],K=$[1],S=(0,m.useState)([]),A=(0,I.Z)(S,2),je=A[0],Ce=A[1],be=(0,m.useState)([]),ce=(0,I.Z)(be,2),Se=ce[0],Pe=ce[1],Qe=(0,m.useState)(""),_e=(0,I.Z)(Qe,2),de=_e[0],De=_e[1],Ve=(0,m.useState)(""),Ee=(0,I.Z)(Ve,2),ke=Ee[0],Fe=Ee[1],Je=(0,m.useState)(!1),we=(0,I.Z)(Je,2),ue=we[0],Me=we[1],Xe=(0,m.useState)(""),He=(0,I.Z)(Xe,2),fe=He[0],qe=He[1],et=(0,m.useState)([]),Ne=(0,I.Z)(et,2),Ae=Ne[0],he=Ne[1],tt=(0,u.QT)(function(){return(0,Rt.ge)({ws_id:d,page_size:100})},{initialData:[]}),nt=tt.data,Re=(0,u.QT)(function(i){return(0,wt.Zu)(i)},{initialData:[],manual:!0}),te=Re.data,Te=Re.loading,ve=Re.run,ze=(0,m.useMemo)(function(){return te.reduce(function(i,t,r){var n=0,s=t.test_case_list.reduce(function(o,x,b){var P="".concat(r,"-").concat(b),L=!1,j=!1;if(!Se.includes(x.id)){var ne=fe==="performance"?w.includes(x.id):y.includes(x.id);ne&&n++,L=ne,j=ne}return o.concat((0,l.Z)((0,l.Z)({},x),{},{parentId:t.id,key:P,title:x.name,disableCheckbox:L,disabled:j}))},[]);return i.concat((0,l.Z)((0,l.Z)({},t),{},{key:t.id+"",title:t.name,children:s,checkable:n!==t.test_case_list.length}))},[])},[te,fe,w,y,Se]),Ie=function(t){De(t),ve({domain:t,ws_id:d,test_type:fe,name:ke,page_size:100})},Be=function(t){Fe(t),ve({domain:de,ws_id:d,test_type:fe,name:t,page_size:100}).then(function(r){if(r.length)for(var n=0;n<r.length;n++)if(r[n].name.indexOf(t)===-1){var s=[];s.push(r[n].id+""),he(s)}else he([""])})},rt=function(t){he(t)},at=function(t){Ce(t)};(0,m.useImperativeHandle)(Z,function(){return{show:function(t,r,n){t&&E({source:t,rowkey:r,testType:n});var s=n==="func_item"?"functional":"performance";qe(s),p(!0),ve({domain:de,ws_id:d,test_type:s,name:ke,page_size:100}).then(function(o){var x=[],b=t.list.reduce(function(j,ne){return j.concat(ne.case_source.reduce(function(it,Zt){return it.concat(Zt.test_conf_id)},[]))},[]);Pe(b);for(var P=0;P<o.length;P++)for(var L=0;L<o[P].test_case_list.length;L++)b.includes(o[P].test_case_list[L].id)&&x.push("".concat(P,"-").concat(L));Ce(x)})}}});var me=(0,m.useCallback)(function(){p(!1),E(null),De(""),Fe(""),Ce([]),Me(!1),Pe([])},[]),st=function(){if(!le){K(!0);var t=te.reduce(function(r,n,s){var o=n.test_case_list.reduce(function(x,b,P){var L=je.findIndex(function(j){return j==="".concat(s,"-").concat(P)});return L>-1?x.concat({test_conf_id:b.id,test_conf_name:b.name}):x},[]);return o.length>0?r.concat({test_suite_id:n.id,suite_show_name:n.name,case_source:o}):r},[]);R((0,l.Z)((0,l.Z)({},C),{},{result:t})),me(),K(!1)}};return(0,e.jsx)(Ct.Z,{maskClosable:!1,keyboard:!1,footer:(0,e.jsx)("div",{style:{textAlign:"right"},children:(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(D.Z,{onClick:me,children:(0,e.jsx)(u._H,{id:"operation.cancel"})}),(0,e.jsx)(D.Z,{type:"primary",onClick:st,children:(0,e.jsx)(u._H,{id:"operation.ok"})})]})}),visible:_,destroyOnClose:!0,width:634,title:(0,e.jsx)(u._H,{id:"report.case.list"}),onClose:me,children:(0,e.jsxs)(W.Z,{spinning:Te,style:{width:"100%",height:"100%"},children:[(0,e.jsx)(G.Z.Search,{placeholder:f({id:"please.enter"}),onSearch:function(t){return Be(t.replace(/\s+/g,""))},style:{width:420}}),(0,e.jsxs)("div",{style:{position:"relative",paddingTop:"16px",display:"flex"},children:[(0,e.jsxs)("div",{className:It().nav,children:[(0,e.jsx)(u._H,{id:"report.domain"}),"\uFF1A"]}),(0,e.jsxs)("div",{style:{width:500},children:[(0,e.jsx)(D.Z,{type:de===""?"primary":"ghost",size:"small",style:{marginRight:8,marginBottom:8,border:"none"},onClick:function(){return Ie("")},children:(0,e.jsx)(u._H,{id:"report.all.s"})}),nt.map(function(i,t){if(!(!ue&&t>6))return i.id==de?(0,e.jsx)(D.Z,{type:"primary",size:"small",style:{marginRight:8,marginBottom:8},onClick:function(){return Ie(i.id)},children:i.name},i.id):(0,e.jsx)(D.Z,{type:"ghost",size:"small",style:{border:"none",marginRight:8,marginBottom:8},onClick:function(){return Ie(i.id)},children:i.name},i.id)})]}),(0,e.jsx)(D.Z,{type:"link",size:"small",style:{position:"absolute",right:0},onClick:function(){return Me(!ue)},icon:ue?(0,e.jsx)(_t.Z,{}):(0,e.jsx)(kt.Z,{}),children:ue?(0,e.jsx)(u._H,{id:"operation.collapse"}):(0,e.jsx)(u._H,{id:"operation.expand"})})]}),(0,e.jsx)(St.Z,{treeData:ze,checkedKeys:je,onExpand:rt,expandedKeys:Ae,checkable:!0,onCheck:at}),te.length===0&&(0,e.jsx)("div",{style:{height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,e.jsx)(lt.Z,{image:lt.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsx)(u._H,{id:"no.use.case"})})})]})})},bt=(0,m.memo)((0,m.forwardRef)(Ot)),$e=a(53160),H=a(20312),Pt=a(39935),dt=(0,m.createContext)(null),oe=function(){return(0,m.useContext)(dt)},Dt=a(15621),sn=a(89963),Oe=a(70077),N=a(4992),Et=a(54217),Ft=function(g){var Z=g.route,h=(0,ct.UO)(),f=h.ws_id,k=oe(),d=k.dataSource,R=k.bodyWidth;return(0,e.jsx)(N.hi,{children:(0,e.jsxs)(Oe.Z,{children:[(0,e.jsx)(Oe.Z.Item,{children:(0,e.jsx)(Et.rU,{to:"/ws/".concat(f,"/test_report?t=template"),children:(0,e.jsx)(u._H,{id:"report.template"})})}),Z.name==="TemplateCreate"?(0,e.jsx)(Oe.Z.Item,{children:(0,e.jsx)(u._H,{id:"menu.Workspace.TestReport.TemplateCreate"})}):(0,e.jsx)(Oe.Z.Item,{children:(0,e.jsx)("span",{children:(0,e.jsx)(V.Z.Text,{ellipsis:!0,style:{width:R-134},children:d.name})})})]})})},Mt=(0,m.memo)(Ft),ee=a(91959),Ht=a(488),ut=a(38733),ft=a(98141),Nt=a(93329),At=function(g){var Z=g.onOk,h=g.title,f=g.style,k=g.icon,d=g.width,R=m.useState(!1),w=(0,I.Z)(R,2),y=w[0],T=w[1],O=m.useState(h),_=(0,I.Z)(O,2),p=_[0],c=_[1],v=function(){T(!0)},C=function(){T(!1),c(h)},E=function(){C()},B=function(S){var A=S.target;c(A.value)},$=function(){Z(p),C()},le=function(){return k};return d<=0?(0,e.jsx)(e.Fragment,{}):y?(0,e.jsxs)(U.Z,{children:[k&&(0,e.jsx)("span",{style:{marginRight:8},children:(0,e.jsx)(le,{})}),(0,e.jsx)(G.Z,{value:p||"",size:"small",onChange:B,style:{width:d-120,marginRight:8}}),(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(D.Z,{size:"small",onClick:E,children:(0,e.jsx)(u._H,{id:"operation.cancel"})}),(0,e.jsx)(D.Z,{size:"small",type:"primary",onClick:$,children:(0,e.jsx)(u._H,{id:"operation.ok"})})]})]}):(0,e.jsxs)(U.Z,{children:[k&&(0,e.jsx)("span",{style:{marginRight:8},children:(0,e.jsx)(le,{})}),(0,e.jsxs)("div",{style:{width:d-20},children:[(0,e.jsx)("span",{style:(0,l.Z)((0,l.Z)({},f),{},{marginRight:8,wordBreak:"break-all"}),children:h||"-"}),(0,e.jsx)(Nt.Z,{onClick:v})]})]})},Ye=At,ht=a(53770),vt=a(76613),mt=a(46120),zt=function(g){var Z=g.source,h=g.dataItem,f=oe(),k=f.handleFieldChange,d=f.hanldeRemoveField,R=f.handleRemoveSuiteField,w=f.hanldeChangeSuiteName,y=f.suiteSelectRef,T=f.contrl,O=(0,m.useRef)(),_=(0,ut.F)(O);return(0,e.jsxs)(N.Rh,{id:"".concat(h,"-").concat(Z.rowkey),children:[(0,e.jsx)(N.sZ,{span:24,ref:O,children:(0,e.jsx)(U.Z,{justify:"space-between",children:(0,e.jsxs)(u.Nv,{accessible:T,fallback:(0,e.jsxs)(F.Z,{align:"center",children:[(0,e.jsx)(mt.r,{style:{transform:"translate(0px, 2px)"}}),(0,e.jsx)(V.Z.Text,{strong:!0,style:{width:_-80,display:"inline-block"},children:Z.name})]}),children:[(0,m.createElement)(Ye,(0,l.Z)((0,l.Z)({},Z),{},{icon:(0,e.jsx)(mt.r,{style:{transform:"translate(0px, 2px)"}}),key:Z.rowkey,title:Z.name,width:_-80,onOk:function(c){return k(c,"name",Z.rowkey,h)}})),(0,e.jsx)("span",{onClick:function(){return d(Z.rowkey,h)},children:(0,e.jsx)(ht.Z,{})})]})})}),(0,e.jsxs)(ie.Z,{span:24,style:{padding:"10px 16px 16px"},children:[(0,e.jsx)(u.Nv,{accessible:T,children:(0,e.jsx)(U.Z,{children:(0,e.jsx)(D.Z,{type:"primary",ghost:!0,onClick:function(){return y.current.show(Z,Z.rowkey,h)},children:(0,e.jsx)(u._H,{id:"report.select.case"})})})}),(0,e.jsx)(U.Z,{children:Z.list.map(function(p){var c;return(0,e.jsxs)(N.i0,{span:24,children:[(0,e.jsx)(N.TV,{justify:"space-between",children:(0,e.jsxs)(u.Nv,{accessible:T,fallback:(0,e.jsx)("span",{children:p.suite_show_name}),children:[(0,m.createElement)(Ye,(0,l.Z)((0,l.Z)({},p),{},{title:p.suite_show_name,key:p.rowkey,width:_-100,onOk:function(C){return w(p.test_suite_id,h,Z.rowkey,C)}})),(0,e.jsx)(vt.Z,{onClick:function(){return R(p,h,!0)}})]})}),(0,e.jsx)(U.Z,{children:(c=p.case_source)===null||c===void 0?void 0:c.map(function(v,C){return(0,e.jsx)(N.JZ,{span:24,len:p.case_source.length-1,idx:C,children:(0,e.jsxs)(U.Z,{justify:"space-between",align:"middle",children:[(0,e.jsx)(V.Z.Text,{children:v.test_conf_name}),(0,e.jsx)(u.Nv,{accessible:T,children:(0,e.jsx)(vt.Z,{onClick:function(){return R(v,h,!1)}})})]})},C)})})]},p.rowkey)})})]})]})},pt=zt,Bt=["dataItem","conf","source"],Gt=function(g){var Z=g.dataItem,h=g.conf,f=g.source,k=(0,Ht.Z)(g,Bt),d=oe(),R=d.handleFieldChange,w=d.hanldeRemoveField,y=d.handleGroupAddTestItem,T=d.contrl,O=(0,m.useRef)(),_=(0,ut.F)(O);return(0,e.jsxs)(N.ZA,{id:"".concat(Z,"-").concat(f.rowkey),children:[(0,e.jsx)(ie.Z,{span:24,children:(0,e.jsx)(N.pF,{justify:"space-between",ref:O,children:(0,e.jsxs)(u.Nv,{accessible:T,fallback:(0,e.jsxs)(F.Z,{align:"center",children:[(0,e.jsx)(ft.r,{style:{transform:"translate(0px, 1px)"}}),(0,e.jsx)(V.Z.Text,{strong:!0,children:f.name})]}),children:[(0,m.createElement)(Ye,(0,l.Z)((0,l.Z)({},f),{},{key:f.rowkey,icon:(0,e.jsx)(ft.r,{}),title:f.name,width:_-80,onOk:function(c){return R(c,"name",f.rowkey,Z)}})),(0,e.jsx)("span",{onClick:function(){return w(f.rowkey,Z)},children:(0,e.jsx)(ht.Z,{})})]})})}),(0,e.jsxs)(ie.Z,{span:24,style:{padding:16},children:[f.list.map(function(p){return(0,e.jsx)(pt,(0,l.Z)((0,l.Z)({source:p},k),{},{conf:h,dataItem:Z}),p.rowkey)}),(0,e.jsxs)(u.Nv,{accessible:T,children:[(0,e.jsx)(Ke.Z,{style:{margin:"12px 0"}}),(0,e.jsx)(U.Z,{children:(0,e.jsx)("span",{onClick:function(){return y(f.rowkey,Z)},children:(0,e.jsx)(V.Z.Link,{children:(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(Ue.Z,{}),(0,e.jsx)(u._H,{id:"report.test.item"})]})})})})]})]})]})},Kt=(0,m.memo)(Gt),Lt=a(41335),gt={need_test_suite_description:!0,need_test_env:!0,need_test_description:!0,need_test_conclusion:!0,show_type:"list",test_data:!1},xt={need_test_suite_description:!1,need_test_env:!1,need_test_description:!1,need_test_conclusion:!1,show_type:"list",test_data:!1},Wt=function(g){var Z=g.testType,h=(0,u.YB)(),f=h.formatMessage,k=oe(),d=k.dataSource,R=k.setDataSource,w=k.contrl,y={name:"performance",testRadioName:"need_perf_data",dataItem:"perf_item",conf:"perf_conf"};Z!=="performance"&&(y={name:"functional",testRadioName:"need_func_data",dataItem:"func_item",conf:"func_conf"});var T=function(v){R((0,H.ZP)(d,function(C){C[v]=d[v].concat({name:f({id:"report.test.item.num"},{data:"".concat(d[v].length-0+1)}),rowkey:(0,ee.Z)(),list:[{test_suite_id:null,suite_show_name:"suite",case_source:[],rowkey:(0,ee.Z)()}]})}))},O=function(v){R((0,H.ZP)(d,function(C){C[v]=d[v].concat({name:"".concat(f({id:"report.test.group"})).concat(d[v].length-0+1),list:[],is_group:!0,rowkey:(0,ee.Z)()})}))},_=function(v,C){R((0,H.ZP)(d,function(E){E[v]=C}))},p=function(v,C,E){R((0,H.ZP)(d,function(B){var $=(0,l.Z)({},d[E]);$[C]=v,B[E]=$}))};return(0,e.jsxs)(Ge.Z,{id:y.dataItem,style:{marginTop:20},bodyStyle:{padding:"12px 20px"},children:[(0,e.jsx)(U.Z,{children:(0,e.jsx)(We.Z,{checked:d[y.testRadioName],disabled:!w,onChange:function(v){var C=v.target;return _(y.testRadioName,C.checked)},children:(0,e.jsx)(V.Z.Text,{strong:!0,style:{fontSize:16},children:(0,e.jsx)(u._H,{id:"report.".concat(y.name,".test.data")})})})}),d[y.testRadioName]&&(0,e.jsxs)(U.Z,{style:{paddingLeft:24},children:[(0,e.jsx)(ie.Z,{span:24,style:{background:"rgba(0,0,0,0.03)",padding:14,marginTop:12},children:(0,e.jsx)(F.Z,{direction:"vertical",style:{width:"100%"},children:(0,e.jsxs)(F.Z,{direction:"vertical",style:{width:"100%"},children:[(0,e.jsx)(F.Z,{children:(0,e.jsx)(V.Z.Text,{children:(0,e.jsx)(u._H,{id:"report.basic.information"})})}),(0,e.jsx)(F.Z,{style:{width:"100%"},children:[[f({id:"report.test_env"}),"need_test_env"],[f({id:"report.test.description"}),"need_test_description"],[f({id:"report.test.conclusion"}),"need_test_conclusion"]].map(function(c){var v=(0,I.Z)(c,3),C=v[0],E=v[1],B=v[2];return(0,e.jsx)(Ut,{field:y.conf,title:C,name:E,text:B},E)})}),y.name!=="functional"&&(0,e.jsxs)("div",{style:{display:"flex"},children:[(0,e.jsx)("div",{style:{marginRight:12},children:(0,e.jsx)(u._H,{id:"report.data.view.style"})}),(0,e.jsx)("div",{children:(0,e.jsxs)(Le.ZP.Group,{disabled:!w,value:d[y.conf].show_type,onChange:function(v){var C=v.target;return p(C.value,"show_type",y.conf)},children:[(0,e.jsx)(Le.ZP,{value:"list",children:(0,e.jsx)(u._H,{id:"report.list.view"})}),(0,e.jsx)(Le.ZP,{value:"chart",children:(0,e.jsx)(u._H,{id:"report.chart.view"})})]})})]})]})})}),(0,e.jsx)(ie.Z,{span:24,children:d[y.dataItem].map(function(c){return c.is_group?(0,e.jsx)(Kt,(0,l.Z)((0,l.Z)({},y),{},{source:c}),c.rowkey):(0,e.jsx)(pt,(0,l.Z)((0,l.Z)({},y),{},{source:c}),c.rowkey)})}),(0,e.jsx)(Ke.Z,{style:{margin:"12px 0"}}),(0,e.jsxs)(ie.Z,{span:24,children:[(0,e.jsx)("span",{onClick:function(){return T(y.dataItem)},children:(0,e.jsx)(V.Z.Link,{children:(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(Ue.Z,{}),(0,e.jsx)(u._H,{id:"report.test.item"})]})})}),(0,e.jsx)(Ke.Z,{type:"vertical"}),(0,e.jsx)("span",{onClick:function(){return O(y.dataItem)},children:(0,e.jsx)(V.Z.Link,{children:(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(Ue.Z,{}),(0,e.jsx)(u._H,{id:"report.test.group"})]})})})]})]})]})},Ut=function(g){var Z=g.field,h=g.name,f=g.title,k=g.text,d=(0,u.YB)(),R=d.formatMessage,w=oe(),y=w.dataSource,T=w.setDataSource,O=w.contrl,_=function(c,v,C){T((0,H.ZP)(y,function(E){var B=(0,l.Z)({},y[C]);B[v]=c,E[C]=B}))};return(0,e.jsxs)(F.Z,{direction:"vertical",style:{width:"100%"},children:[(0,e.jsx)(We.Z,{disabled:!O,onChange:function(c){var v=c.target;return _(v.checked,h,Z)},checked:y[Z][h],children:f}),k&&(0,e.jsx)(G.Z.TextArea,{allowClear:!0,placeholder:R({id:"please.enter"}),value:y[Z][k],autoSize:{minRows:3,maxRows:3},disabled:!y[Z][h],onChange:function(c){var v=c.target;_(v.value,k,Z)}})]})},$t=function(g){var Z=(0,u.YB)(),h=Z.formatMessage,f=g.name,k=g.title,d=g.desc,R=oe(),w=R.dataSource,y=R.setDataSource,T=R.contrl,O=function(p,c){y((0,H.ZP)(w,function(v){v[p]=c}))};return(0,e.jsxs)(F.Z,{direction:"vertical",style:{width:"100%",background:"#fff",padding:20},children:[(0,e.jsx)(We.Z,(0,l.Z)((0,l.Z)({},g),{},{id:f,disabled:!T,onChange:function(p){var c=p.target;return O(f,c.checked)},checked:w[f],children:k})),d&&(0,e.jsx)(G.Z.TextArea,{placeholder:h({id:"please.enter"}),allowClear:!0,disabled:!w[f],value:w[d],onChange:function(p){var c=p.target;O(d,c.value)},autoSize:{minRows:3,maxRows:6}})]})},Yt=function(g){var Z=(0,u.YB)(),h=Z.formatMessage,f=g.route,k=g.match.params,d=k.ws_id,R=k.temp_id,w=(0,u.md)(),y=(0,m.useState)(!1),T=(0,I.Z)(y,2),O=T[0],_=T[1],p=m.useState(!1),c=(0,I.Z)(p,2),v=c[0],C=c[1],E=(0,jt.CR)(),B=E.height,$=(0,m.useRef)(),le=(0,m.useState)({ws_id:d,name:"",is_default:!1,need_test_background:!0,need_test_method:!0,need_test_summary:!0,need_test_conclusion:!0,need_test_env:!0,need_env_description:!0,need_func_data:!0,need_perf_data:!0,description:"",perf_conf:gt,func_conf:xt,perf_item:[],func_item:[]}),K=(0,I.Z)(le,2),S=K[0],A=K[1],je=function i(t){return t.reduce(function(r,n){return n.is_group?n.list.length>0?r.concat(i(n.list)):r:n.list&&n.list.length>0?r.concat(n.list.reduce(function(s,o){return s.concat(o.case_source.map(function(x){return x.test_conf_id}))},[])):r},[])},Ce=(0,m.useState)(w.WsMemberOperateSelf()),be=(0,I.Z)(Ce,2),ce=be[0],Se=be[1],Pe=(0,m.useMemo)(function(){return je(S.perf_item)},[S]),Qe=(0,m.useMemo)(function(){return je(S.func_item)},[S]),_e=function i(t){return t.map(function(r){return r.list?(0,l.Z)((0,l.Z)({},r),{},{rowkey:(0,ee.Z)(),list:i(r.list)}):(0,l.Z)((0,l.Z)({},r),{},{rowkey:(0,ee.Z)()})})},de=function(){var i=(0,ae.Z)((0,M.Z)().mark(function t(){var r,n,s,o,x,b,P;return(0,M.Z)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return _(!0),j.next=3,(0,$e.Q)({ws_id:d,id:R});case 3:r=j.sent,n=r.data,s=n.perf_item,o=n.func_item,x=n.perf_conf,b=n.func_conf,Se(w.WsMemberOperateSelf(n.creator)),P={func_conf:b||xt,perf_conf:x||gt,perf_item:_e(s),func_item:_e(o)},document.title="".concat(n.name," - T-One"),A(Object.assign(n,P)),_(!1);case 11:case"end":return j.stop()}},t)}));return function(){return i.apply(this,arguments)}}(),De=function(){var i=(0,ae.Z)((0,M.Z)().mark(function t(){return(0,M.Z)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:Se(w.IsWsSetting());case 1:case"end":return n.stop()}},t)}));return function(){return i.apply(this,arguments)}}();(0,m.useEffect)(function(){return f.name==="TemplateEdit"&&de(),f.name==="TemplateCreate"?De():(document.title="".concat(h({id:"report.create.report.template"})," - T-One"),_(!1)),function(){_(!0)}},[f.name]);var Ve=function(t,r,n,s){return(0,H.ZP)(t,function(o){o.list=t.list.map(function(x){return!x.is_group&&x.rowkey===r?(0,H.ZP)(x,function(b){b[n]=s}):x})})},Ee=function(t,r,n,s){return t.rowkey===r?(0,H.ZP)(t,function(o){o[n]=s}):t.is_group?Ve(t,r,n,s):t},ke=function(t,r,n,s){A((0,H.ZP)(S,function(o){o[s]=S[s].map(function(x){return Ee(x,n,r,t)})}))},Fe=function i(t,r){return t.reduce(function(n,s){return s.rowkey===r?n:s.is_group?n.concat((0,l.Z)((0,l.Z)({},s),{},{list:i(s.list,r)})):n.concat(s)},[])},Je=function(t,r){A((0,H.ZP)(S,function(n){n[r]=Fe(S[r],t)}))},we=function(t,r){var n=t.list.length;return{name:h({id:"report.test.item.num"},{data:"".concat(r+1,"-").concat(n+1)}),rowkey:(0,ee.Z)(),list:[{test_suite_id:null,suite_show_name:"suite",case_source:[],rowkey:(0,ee.Z)()}]}},ue=function i(t,r){return t.reduce(function(n,s,o){return s.rowkey===r?s.is_group?n.concat((0,l.Z)((0,l.Z)({},s),{},{list:s.list.concat(we(s,o))})):n.concat(we(s,o)):s.is_group?n.concat((0,l.Z)((0,l.Z)({},s),{},{list:i(s.list,r)})):n.concat(s)},[])},Me=function(t,r){A((0,H.ZP)(S,function(n){n[r]=ue(S[r],t)}))},Xe=function i(t,r,n,s,o){return"test_suite_id"in t&&t.test_suite_id===o?(0,l.Z)((0,l.Z)({},t),{},{suite_show_name:s}):t.list&&t.list.length>0?(0,l.Z)((0,l.Z)({},t),{},{list:t.list.map(function(x){return i(x,r,n,s,o)})}):t},He=function(t,r,n,s){A((0,H.ZP)(S,function(o){o[r]=S[r].map(function(x){return Xe(x,r,n,s,t)})}))},fe=function i(t,r,n){if("test_suite_id"in t){if(r)return t.test_suite_id===n.test_suite_id?void 0:t;var s=t.case_source.filter(function(o){return n.test_conf_id!==o.test_conf_id});return s.length>0?(0,l.Z)((0,l.Z)({},t),{},{case_source:s}):void 0}return(0,l.Z)((0,l.Z)({},t),{},{list:t.list.reduce(function(o,x){var b=i(x,r,n);return b?o.concat(b):o},[])})},qe=function(t,r,n){A((0,H.ZP)(S,function(s){s[r]=S[r].map(function(o){return fe(o,n,t)})}))},et=function(t){var r=t.result,n=t.rowkey,s=t.testType;return ke(r,"list",n,s)},Ne=function(t){for(var r={},n=0,s=t.length;n<s;n++){var o=t[n].name;if(r[o])throw h({id:"report.please.check"});r[o]=o}},Ae=function i(t){Ne(t);var r=t.reduce(function(n,s){var o=s.list;return"test_suite_id"in s?s.case_source.length===0?n:n.concat(s):o&&o.length>0?n.concat((0,l.Z)((0,l.Z)({},s),{},{list:i(o)})):n.concat(s)},[]);return r},he=function(){var i=(0,ae.Z)((0,M.Z)().mark(function t(r){var n;return(0,M.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(_(!0),f.name!=="TemplateEdit"){o.next=7;break}return o.next=4,(0,$e.$A)((0,l.Z)({ws_id:d,id:R},r));case 4:o.t0=o.sent,o.next=10;break;case 7:return o.next=9,(0,$e.s)(r);case 9:o.t0=o.sent;case 10:n=o.t0,n.code===200?u.m8.push("/ws/".concat(d,"/test_report?t=template")):(0,Pt.EV)(n.code,n.message),_(!1);case 13:case"end":return o.stop()}},t)}));return function(r){return i.apply(this,arguments)}}(),tt=function i(t){var r=(0,re.Z)(t),n;try{for(r.s();!(n=r.n()).done;){var s=n.value,o=s.is_group,x=s.list;if(o){var b=i(x);if(b)return!0}else if(x.length>0)return!0}}catch(P){r.e(P)}finally{r.f()}return!1},nt=function(){var i=(0,ae.Z)((0,M.Z)().mark(function t(){var r,n,s,o,x,b,P;return(0,M.Z)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!O){j.next=2;break}return j.abrupt("return");case 2:if(r=S.perf_item,n=S.func_item,s=S.name,s){j.next=5;break}return j.abrupt("return",Ze.default.warning(h({id:"report.template.cannot.be.empty"})));case 5:return j.prev=5,j.next=8,Ae(r);case 8:return o=j.sent,j.next=11,Ae(n);case 11:if(x=j.sent,b=tt(o.concat(x)),P=(0,l.Z)((0,l.Z)({},S),{},{perf_item:o,func_item:x}),!b){j.next=16;break}return j.abrupt("return",he(P));case 16:Q.Z.confirm({title:h({id:"report.template.confirm.title",defaultMessage:"\u63D0\u793A"}),centered:!0,content:h({id:"report.template.confirm.content",defaultMessage:"\u6D4B\u8BD5\u9879\u7F3A\u5C11\u7528\u4F8B\uFF0C\u662F\u5426\u7EE7\u7EED\u4FDD\u5B58\uFF1F"}),icon:(0,e.jsx)(yt.Z,{}),onOk:function(){return(0,ae.Z)((0,M.Z)().mark(function it(){return(0,M.Z)().wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:he(P);case 1:case"end":return ot.stop()}},it)}))()},onCancel:function(){_(!1)}}),j.next=23;break;case 19:j.prev=19,j.t0=j.catch(5),Ze.default.warning(j.t0),_(!1);case 23:case"end":return j.stop()}},t,null,[[5,19]])}));return function(){return i.apply(this,arguments)}}(),Re=(0,m.useState)(!1),te=(0,I.Z)(Re,2),Te=te[0],ve=te[1],ze=function(t,r){return A((0,H.ZP)(S,function(n){n[t]=r}))},Ie=(0,m.useState)(1200),Be=(0,I.Z)(Ie,2),rt=Be[0],at=Be[1],me=(0,m.useRef)(null),st=function(){return at(me.current.offsetWidth)};return(0,m.useEffect)(function(){var i=document.getElementById("report-body-container"),t={attributes:!0,childList:!0,subtree:!0},r=new MutationObserver(st);return r.observe(i,t),function(){r.disconnect()}},[]),(0,e.jsxs)(dt.Provider,{value:{dataSource:S,setDataSource:A,collapsed:Te,setCollapsed:ve,contrl:ce,bodyWidth:rt,handleFieldChange:ke,hanldeRemoveField:Je,handleRemoveSuiteField:qe,hanldeChangeSuiteName:He,handleGroupAddTestItem:Me,suiteSelectRef:$},children:[(0,e.jsx)(W.Z,{spinning:O,children:(0,e.jsxs)(N.ec,{height:B-50,children:[(0,e.jsx)(Dt.Z,{dataSource:S,setDataSource:A,collapsed:Te,setCollapsed:ve,contrl:ce}),(0,e.jsx)(N._r,{id:"report-body-container",collapsed:Te,children:(0,e.jsxs)(N.YC,{ref:me,children:[(0,e.jsx)(Mt,(0,l.Z)({},g)),(0,e.jsx)(N.EU,{children:(0,e.jsxs)(F.Z,{direction:"vertical",style:{width:"100%"},children:[(0,e.jsx)(G.Z,{style:{width:"100%"},placeholder:h({id:"report.name.input"}),value:S.name,onChange:function(t){var r=t.target;return ze("name",r.value)}}),(0,e.jsx)(G.Z.TextArea,{onChange:function(t){var r=t.target;return ze("description",r.value)},style:{width:"100%"},value:S.description,autoSize:{minRows:3,maxRows:6},placeholder:h({id:"report.description.textArea"})})]})}),(0,e.jsx)(F.Z,{direction:"vertical",style:{width:"100%",marginTop:20},size:20,children:[[h({id:"report.test.background"}),"need_test_background","background_desc"],[h({id:"report.test.method"}),"need_test_method","test_method_desc"],[h({id:"report.test.conclusion"}),"need_test_conclusion","test_conclusion_desc"],["Summary","need_test_summary"],[h({id:"report.env.description"}),"need_env_description","env_description_desc"],[h({id:"report.server.env"}),"need_test_env"]].map(function(i){var t=(0,I.Z)(i,3),r=t[0],n=t[1],s=t[2];return(0,e.jsx)($t,{title:r,name:n,desc:s},n)})}),(0,e.jsxs)("div",{style:{padding:20,background:"#fff",marginTop:20},children:[(0,e.jsx)(N.vU,{id:"test_data",children:(0,e.jsx)(u._H,{id:"report.test.data"})}),["performance","functional"].map(function(i){return(0,e.jsx)(Wt,{testType:i},i)})]})]})}),(0,e.jsx)(N.NF,{justify:"end",align:"middle",children:(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(D.Z,{onClick:function(){return C(!0)},children:(0,e.jsx)(u._H,{id:"operation.preview"})}),!S.is_default&&(0,e.jsx)(u.Nv,{accessible:ce,children:(0,e.jsx)(D.Z,{type:"primary",onClick:nt,children:f.name==="TemplateEdit"?(0,e.jsx)(u._H,{id:"report.update.report.template"}):(0,e.jsx)(u._H,{id:"report.save.report.template"})})})]})}),(0,e.jsx)(bt,{perfKeys:Pe,funcKeys:Qe,ref:$,onOk:et})]})}),v&&(0,e.jsx)("div",{style:{position:"fixed",left:0,right:0,bottom:0,top:0,zIndex:9999},children:(0,e.jsx)(Lt.default,(0,l.Z)((0,l.Z)({},g),{},{dataSet:S,setIsPreview:C}))})]})},Qt=Yt}}]);
