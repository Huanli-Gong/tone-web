(self.webpackChunktone_front=self.webpackChunktone_front||[]).push([[4697,2485],{59465:function(Ut,Wt,t){"use strict";t.d(Wt,{Z:function(){return J}});var un=t(28991),lt=t(67294),Lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},St=Lt,Pt=t(27029),ke=function(G,bt){return lt.createElement(Pt.Z,(0,un.Z)((0,un.Z)({},G),{},{ref:bt,icon:St}))},yn=lt.forwardRef(ke),J=yn},11063:function(Ut){Ut.exports={DeployModal_root:"DeployModal_root___1OL4b",Alert:"Alert___1ubcT"}},9005:function(Ut){Ut.exports={selection_table_thead:"selection_table_thead___mpj1J",selection_Checkbox:"selection_Checkbox___17qhJ",nav:"nav___2jNVy",domainList_Tab:"domainList_Tab___4ttRV",selection_table_tbody:"selection_table_tbody___1Rb5n",selection_table_row:"selection_table_row___FUw8w",col:"col___1UQIe",otherCol:"otherCol___gChIN"}},50335:function(Ut){Ut.exports={suite:"suite___18kgg",spinWrapper:"spinWrapper___17EdH",nav:"nav___3Ls6P",bar:"bar___2Pxqj",title:"title___2N2r_",remove:"remove___1mY09",batch:"batch___3KKK_",info:"info___2RGDG",var:"var___FaJBX",action:"action___3XoLG",column_outter:"column_outter___38ySl",conf_table:"conf_table___1WoTS",suite_table_loading:"suite_table_loading___8OeYB",batch_setting_table_bar:"batch_setting_table_bar___gNpdm",suite_drawer:"suite_drawer___3WpmF",case_drawer:"case_drawer___3clkU",drawer_padding:"drawer_padding___1jhA-",case_form:"case_form___1gwse",suite_form:"suite_form___RGHI0",serverItemUnchecked:"serverItemUnchecked___lvVQl",btn_style:"btn_style___3zR_3"}},46596:function(Ut){Ut.exports={not_logged_in:"not_logged_in___2rKJq",page_header:"page_header___33Sss",page_title:"page_title___cha7I",page_tags:"page_tags___3tZ3g",page_dec:"page_dec___1dqBn",page_preview_nav:"page_preview_nav___3I8Rg",page_body_content:"page_body_content___-zdqi",page_body:"page_body___2M3UY",yaml_copy_link:"yaml_copy_link___3TKWX",yaml_transform_icon:"yaml_transform_icon___CeuId",page_body_title:"page_body_title___7Eq27",form_row:"form_row___3-KTb",page_body_nav:"page_body_nav___K_Ncj",options_bar:"options_bar___ijZBk",yaml_container:"yaml_container___tENuh",yaml_operate:"yaml_operate___2wHTK",job_search_inp:"job_search_inp___g03ny",template_popover:"template_popover___dHPLz",template_popover_hide_content:"template_popover_hide_content___vl_rd",template_item:"template_item___292Qu"}},94955:function(Ut,Wt,t){"use strict";t.d(Wt,{Z:function(){return L}});var un=t(71194),lt=t(50146),Lt=t(20228),St=t(11382),Pt=t(43358),ke=t(34041),yn=t(20136),J=t(55241),mt=t(88983),G=t(47933),bt=t(47673),E=t(4107),sn=t(17462),w=t(76772),Vt=t(22385),W=t(89456),Me=t(39428),_=t(34792),Ze=t(48086),i=t(3182),n=t(9715),h=t(20526),T=t(2824),oe=t(67294),Zt=t(1870),H=t(16917),qt=t(71153),_e=t(60331),p=t(85893),zt=(0,oe.forwardRef)(function(Y,Je){var Se=Y||{},he=Se.onChange,e=Se.dataSource,Q=e===void 0?[]:e,at=Se.delCallback;function Jt(C,Gt){if(C.preventDefault(),Q&&Array.isArray(Q)){var Be=Q.filter(function(Xe){return Xe.id!==Gt}),we=Be.map(function(Xe){return Xe.id});he(we),at(Be)}}return(0,p.jsx)("div",{ref:Je,children:Q.map(function(C){return(0,p.jsx)(_e.Z,{closable:!(Q&&Q.length===1),onClose:function(Be){return Jt(Be,C.id)},children:C.ip},C.id)})})}),o=t(1693),Nt=t(11063),dt=t.n(Nt),a=t(96486),L=(0,oe.forwardRef)(function(Y,Je){var Se,he,e=(0,H.YB)(),Q=e.formatMessage,at=h.Z.useForm(),Jt=(0,T.Z)(at,1),C=Jt[0],Gt=(0,oe.useState)(!1),Be=(0,T.Z)(Gt,2),we=Be[0],Xe=Be[1],Pe=(0,oe.useState)(""),_n=(0,T.Z)(Pe,2),en=_n[0],Ct=_n[1],cn=(0,oe.useState)(""),hn=(0,T.Z)(cn,2),tn=hn[0],ae=hn[1],Le=(0,oe.useState)(!1),It=(0,T.Z)(Le,2),Ft=It[0],ln=It[1],gn=(0,oe.useState)([]),gt=(0,T.Z)(gn,2),nn=gt[0],ft=gt[1],kt=(0,oe.useState)([]),Bt=(0,T.Z)(kt,2),dn=Bt[0],Yt=Bt[1],qe=(0,oe.useState)("common"),Ke=(0,T.Z)(qe,2),$=Ke[0],et=Ke[1],Ot=(0,oe.useState)({}),fn=(0,T.Z)(Ot,2),pt=fn[0],ot=fn[1],rt=(0,oe.useMemo)(function(){return["openanolis","opensource"].includes("opensource")},[]),vn=h.Z.useWatch("arch",C),Sn=h.Z.useWatch("os",C),bn=function(){Yt([]),et("common"),ot({}),ln(!1)},Pn=function(){var N=(0,i.Z)((0,Me.Z)().mark(function V(){var te,ge,Ge,Dt,be;return(0,Me.Z)().wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:return Et.prev=0,Et.next=3,(0,o.un)({arch:vn,os:Sn});case 3:te=Et.sent,ge=te.code,Ge=te.msg,Dt=te.data,be=Dt===void 0?[]:Dt,ge===200?(0,a.isString)(be)?ft([]):ft(be):Ze.default.error(Ge||Q({id:"device.failed.to.request.version"})),Et.next=13;break;case 11:Et.prev=11,Et.t0=Et.catch(0);case 13:case"end":return Et.stop()}},V,null,[[0,11]])}));return function(){return N.apply(this,arguments)}}();(0,oe.useImperativeHandle)(Je,function(){return{show:function(V){var te=V.detailData,ge=V.radio_type,Ge=V.instance_id;if(ln(!0),ae(ge),rt){C.setFieldsValue({instance_id:Ge});return}var Dt=te.map(function(be){return{ip:be,id:be}});Yt(Dt),C.setFieldsValue({ips:te})}}});var In=function(V){Yt(V)},Rn=function(V){et(V.target.value)},On=function(){C.validateFields().then(function(){var V=(0,i.Z)((0,Me.Z)().mark(function te(ge){var Ge,Dt,be,Zn,Et,jn;return(0,Me.Z)().wrap(function(Bn){for(;;)switch(Bn.prev=Bn.next){case 0:return Xe(!0),Ct(Q({id:"device.deploying"})),Bn.next=4,(0,o.Ty)(ge);case 4:Ge=Bn.sent,Dt=Ge.code,be=Ge.msg,Zn=Ge.data,Et=Zn===void 0?{}:Zn,Dt===200?(jn=Et.fail_servers)!==null&&jn!==void 0&&jn.length?ot(Et):(Ze.default.success(Q({id:"device.deploy.finish"})),C.resetFields(),bn(),Y.callback(Et)):Ze.default.error(be||Q({id:"device.deploy.failed"})),Xe(!1),Ct("");case 12:case"end":return Bn.stop()}},te)}));return function(te){return V.apply(this,arguments)}}()).catch(function(){Xe(!1),Ct("")})},Kn=function(){we||(C.resetFields(),bn())},Dn=function(){var V=pt.success_servers,te=V===void 0?[]:V,ge=pt.fail_servers,Ge=ge===void 0?[]:ge,Dt=te==null?void 0:te.map(function(be){return be.ip}).join(" / ");return(0,p.jsxs)("div",{children:[te!=null&&te.length?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("span",{style:{color:"#1890FF"},children:Dt}),"\xA0",(0,p.jsx)(H._H,{id:"device.deploy.success"}),"\uFF1B\xA0"]}):null,Ge==null?void 0:Ge.map(function(be){return(0,p.jsxs)("div",{children:[(0,p.jsx)("span",{style:{color:"#F5222D"},children:be&&be.ip}),"\xA0",(0,p.jsx)(H._H,{id:"device.deploy.failed"}),"\xA0",(0,p.jsx)(W.Z,{placement:"bottomLeft",title:be&&be.msg,children:(0,p.jsx)("a",{children:(0,p.jsx)(H._H,{id:"view.details"})})})]},be.ip)})]})},st=function(){ot({})},Fe=function(){return rt?"active":tn==="cloudManage"?"passive":"active"};return(0,oe.useEffect)(function(){Ft&&vn&&Sn&&Pn()},[Ft,vn,Sn]),(0,p.jsx)(lt.Z,{className:dt().DeployModal_root,title:Q({id:"agent.deploy.btn"}),open:Ft,maskClosable:!1,width:460,confirmLoading:we,closable:!we,onOk:On,onCancel:Kn,children:(0,p.jsxs)(St.Z,{tip:en,spinning:we,children:[(Se=pt.success_servers)!==null&&Se!==void 0&&Se.length||(he=pt.fail_servers)!==null&&he!==void 0&&he.length?(0,p.jsx)("div",{className:dt().Alert,children:(0,p.jsx)(w.Z,{message:Dn(),type:"info",showIcon:!0,closable:!0,onClose:st})}):null,(0,p.jsxs)(h.Z,{form:C,layout:"vertical",initialValues:{channel:"common",mode:Fe(),user:"root",arch:"x86_64",os:"Linux"},children:[!rt&&(0,p.jsx)(h.Z.Item,{label:"IP",name:"ips",rules:[{required:!0,message:Q({id:"DeployModal.ids.message"})}],children:(0,p.jsx)(zt,{dataSource:dn,delCallback:In})}),rt&&(0,p.jsx)(h.Z.Item,{label:"InstanceID",name:"instance_id",children:(0,p.jsx)(E.Z,{disabled:!0})}),!rt&&(0,p.jsx)(h.Z.Item,{label:(0,p.jsx)(H._H,{id:"device.deploy.mode"}),name:"channel",children:(0,p.jsxs)(G.ZP.Group,{onChange:Rn,children:[(0,p.jsx)(G.ZP,{value:"common",children:(0,p.jsx)(H._H,{id:"device.deploy.mode.common"})}),!rt&&tn!=="cloudManage"&&(0,p.jsx)(G.ZP,{value:null,children:Q({id:"device.deploy.mode.self_agent"},{data:null})})]})}),(0,p.jsx)(h.Z.Item,{label:"Mode",name:"mode",children:(0,p.jsxs)(G.ZP.Group,{children:[(0,p.jsxs)(G.ZP,{value:"active",children:["active",(0,p.jsx)(J.Z,{placement:"topLeft",content:(0,p.jsx)(H._H,{id:"device.mode.active"}),children:(0,p.jsx)(Zt.Z,{style:{opacity:.65,marginLeft:2}})})]}),(0,p.jsxs)(G.ZP,{value:"passive",children:["passive",(0,p.jsx)(J.Z,{placement:"topLeft",content:(0,p.jsx)(H._H,{id:"device.mode.passive"}),children:(0,p.jsx)(Zt.Z,{style:{opacity:.65,marginLeft:2}})})]})]})}),(0,p.jsx)(h.Z.Item,{label:"OS",name:"os",required:!0,children:(0,p.jsx)(ke.Z,{options:[{value:"Linux",label:"Linux"},{value:"Debian",label:"Debian"}]})}),(0,p.jsx)(h.Z.Item,{label:"arch",name:"arch",required:!0,children:(0,p.jsxs)(ke.Z,{children:[(0,p.jsx)(ke.Z.Option,{value:"x86_64",children:"x86_64"}),(0,p.jsx)(ke.Z.Option,{value:"aarch64",children:"aarch64"})]})}),(0,p.jsx)(h.Z.Item,{label:(0,p.jsx)(H._H,{id:"agent.modal.Version"}),name:"version",rules:[{required:!0,message:Q({id:"please.select"})}],children:(0,p.jsx)(ke.Z,{placeholder:Q({id:"please.select"}),showSearch:!0,optionFilterProp:"children",filterOption:function(V,te){return te.children.toLowerCase().indexOf(V.toLowerCase())>=0},children:nn==null?void 0:nn.map(function(N){return(0,p.jsx)(ke.Z.Option,{value:N.version,children:N.version},N.id)})})}),!rt&&$==="common"&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(h.Z.Item,{label:"User",name:"user",rules:[{required:!1,max:20,message:Q({id:"device.user.message"})}],children:(0,p.jsx)(E.Z,{placeholder:Q({id:"please.enter"}),autoComplete:"off"})}),(0,p.jsx)(h.Z.Item,{label:"Password",name:"password",children:(0,p.jsx)(E.Z.Password,{placeholder:Q({id:"please.enter"})})})]})]})]})})})},5751:function(Ut,Wt,t){"use strict";var un=t(43358),lt=t(34041),Lt=t(47673),St=t(4107),Pt=t(11849),ke=t(39428),yn=t(3182),J=t(9715),mt=t(20526),G=t(2824),bt=t(67294),E=t(92211),sn=t.n(E),w=t(16917),Vt=t(20009),W=t(63885),Me=t(96486),_=t.n(Me),Ze=t(85893);Wt.Z=function(i){var n=i.contrl,h=i.disabled,T=h===void 0?!1:h,oe=i.callBackProjectId,Zt=i.onRef,H=Zt===void 0?null:Zt,qt=i.template,_e=qt===void 0?{}:qt,p=i.test_type,zt=p===void 0?"":p,o=i.business_type,Nt=o===void 0?"":o,dt=i.baselineListDataRef,a=i.projectListDataRef,L=(0,w.YB)(),Y=L.formatMessage,Je=mt.Z.useForm(),Se=(0,G.Z)(Je,1),he=Se[0],e=(0,Vt.UO)(),Q=e.ws_id,at=bt.useState([]),Jt=(0,G.Z)(at,2),C=Jt[0],Gt=Jt[1],Be={page_num:1,page_size:20,ws_id:Q,search:"",tab:"all",test_type:zt},we=(0,w.QT)(function(){return(0,W.YK)({ws_id:Q,page_size:500})},{manual:!0,initialData:[]}),Xe=we.data,Pe=we.run,_n=(0,w.QT)(function(){return(0,W.bU)({ws_id:Q,test_type:zt,page_size:500})},{manual:!0,initialData:[]}),en=_n.data,Ct=_n.run,cn=function(){var ae=(0,yn.Z)((0,ke.Z)().mark(function Le(It){var Ft,ln;return(0,ke.Z)().wrap(function(gt){for(;;)switch(gt.prev=gt.next){case 0:return gt.next=2,(0,W.NQ)(It);case 2:Ft=gt.sent,ln=Ft.data,Gt(ln);case 5:case"end":return gt.stop()}},Le)}));return function(It){return ae.apply(this,arguments)}}();(0,bt.useEffect)(function(){"baseline"in n&&Ct(),"project"in n&&Pe(),"baseline_job"in n&&cn(Be)},[n,T]),(0,bt.useImperativeHandle)(H,function(){return{form:he,reset:function(){he.resetFields()},setVal:function(Le){he.setFieldsValue(Le)}}}),bt.useEffect(function(){if(a&&(a.current=Xe),dt&&(dt.current=en),JSON.stringify(_e)!=="{}"){var ae=_e.project,Le=_e.baseline,It=_e.project_id,Ft=_e.baseline_id,ln=_e.baseline_job,gn=_e.baseline_job_id,gt=ae||It,nn=Le||Ft,ft=ln||gn;if(gt&&Xe.length>0){var kt=Xe.findIndex(function(Yt){return Yt.id===gt});he.setFieldsValue({project:~kt?gt:void 0})}if(nn&&en.length>0){var Bt=en.findIndex(function(Yt){return Yt.id===nn});he.setFieldsValue({baseline:~Bt?nn:void 0})}if(ft&&C.length>0){var dn=C.findIndex(function(Yt){return Yt.id===ft});he.setFieldsValue({baseline_job_id:~dn?ft:void 0})}}},[Xe,en,C,_e]),(0,bt.useEffect)(function(){if(JSON.stringify(_e)!=="{}"){var ae=_e.baseline_id;he.setFieldsValue((0,Pt.Z)((0,Pt.Z)({},_e),{},{baseline_id:ae}))}return function(){he.resetFields()}},[_e]),(0,bt.useEffect)(function(){if(Xe.length>0){if(!he.getFieldValue("project")){var ae=Xe.filter(function(Le){return Le.is_default})[0];ae&&he.setFieldsValue({project:ae.id})}oe(Xe[0].id)}},[Xe]);var hn=function(Le){oe(Le)},tn=(0,Me.debounce)(function(ae){cn((0,Pt.Z)((0,Pt.Z)({},Be),{},{search:ae}))},500);return(0,Ze.jsxs)(mt.Z,{colon:!1,layout:"horizontal",size:"small",labelCol:{span:5},wrapperCol:{span:14},style:{width:"100%"},name:"basic",form:he,className:sn().job_test_form,children:["job_name"in n&&(0,Ze.jsx)(mt.Z.Item,{name:"name",label:n.job_name.alias||(0,Ze.jsx)(w._H,{id:"job.form.".concat(n.job_name.name)}),rules:[{message:Y({id:"job.form.job_name.message"},{date:"{date}"})},{max:128,message:Y({id:"job.form.job_name.limit.message"})}],children:(0,Ze.jsx)(St.Z,{autoComplete:"off",title:Y({id:"job.form.job_name.message"},{date:"{date}"}),placeholder:Y({id:"job.form.job_name.message"},{date:"{date}"}),disabled:T})}),"project"in n&&(0,Ze.jsx)(mt.Z.Item,{name:"project",label:n.project.alias||(0,Ze.jsx)(w._H,{id:"job.form.".concat(n.project.name)}),children:(0,Ze.jsx)(lt.Z,{allowClear:!0,getPopupContainer:function(Le){return Le.parentNode},showSearch:!0,disabled:T,placeholder:Y({id:"job.form.project.placeholder"}),onSelect:hn,filterOption:function(Le,It){return It.label.indexOf(Le)>=0},options:Xe.map(function(ae){return{label:"".concat(ae.name,"(").concat(ae.product_name,")"),value:ae.id}})})}),(["functional","performance"].includes(zt)||["functional","performance"].includes(Nt))&&"baseline"in n&&(0,Ze.jsx)(mt.Z.Item,{name:"baseline",label:n.baseline.alias||(0,Ze.jsx)(w._H,{id:"job.form.".concat(n.baseline.name)}),children:(0,Ze.jsx)(lt.Z,{allowClear:!0,getPopupContainer:function(Le){return Le.parentNode},showSearch:!0,disabled:T,placeholder:Y({id:"job.form.baseline.placeholder"}),filterOption:function(Le,It){return It.label.indexOf(Le)>=0},options:en.map(function(ae){return{label:ae.name,value:ae.id}})})}),"baseline_job"in n&&(0,Ze.jsx)(mt.Z.Item,{name:"baseline_job_id",label:n.baseline_job.alias||(0,Ze.jsx)(w._H,{id:"job.form.".concat(n.baseline_job.name)}),children:(0,Ze.jsx)(lt.Z,{allowClear:!0,showSearch:!0,getPopupContainer:function(Le){return Le.parentNode},placeholder:Y({id:"job.form.baseline_job_id.placeholder"}),onSearch:tn,disabled:T,filterOption:!1,options:C.map(function(ae){return{label:"#".concat(ae.id," ").concat(ae.name),value:ae.id}})})})]})}},51847:function(Ut,Wt,t){"use strict";var un=t(47673),lt=t(4107),Lt=t(13062),St=t(71230),Pt=t(89032),ke=t(15746),yn=t(43358),J=t(34041),mt=t(88983),G=t(47933),bt=t(93224),E=t(11849),sn=t(9715),w=t(20526),Vt=t(2824),W=t(67294),Me=t(92211),_=t.n(Me),Ze=t(45680),i=t(84739),n=t(55787),h=t(60306),T=t(37579),oe=t(60035),Zt=t(45537),H=t(16917),qt=t(20009),_e=t(96486),p=t.n(_e),zt=t(24480),o=t(85893),Nt=["branch","kernel_packages"];Wt.Z=function(dt){var a=dt.contrl,L=dt.disabled,Y=L===void 0?!1:L,Je=dt.envErrorFlag,Se=dt.project_id,he=dt.onRef,e=he===void 0?null:he,Q=dt.template,at=Q===void 0?{}:Q,Jt=(0,H.YB)(),C=Jt.formatMessage,Gt=(0,qt.UO)(),Be=Gt.ws_id,we=w.Z.useForm(),Xe=(0,Vt.Z)(we,1),Pe=Xe[0],_n=(0,W.useState)(!1),en=(0,Vt.Z)(_n,2),Ct=en[0],cn=en[1],hn=(0,W.useState)(!1),tn=(0,Vt.Z)(hn,2),ae=tn[0],Le=tn[1],It=(0,W.useState)(!1),Ft=(0,Vt.Z)(It,2),ln=Ft[0],gn=Ft[1],gt=(0,W.useState)("no"),nn=(0,Vt.Z)(gt,2),ft=nn[0],kt=nn[1],Bt=function($){kt($.target.value),!Y&&Pe.resetFields(["kernel_packages","kernel_version","scripts"])};(0,W.useImperativeHandle)(e,function(){return{form:Pe,reset:function(){Pe.resetFields(),cn(!1),Le(!1),gn(!1),kt("no")},setVal:function($){var et=$.rpm_info,Ot=$.script_info,fn=$.kernel_version,pt=$.kernel_info,ot=$.build_pkg_info;et=et||[{pos:"before",rpm:""}],Ot=Ot||[{pos:"before",script:""}],Pe.resetFields();var rt="no";if(pt&&p().get(pt,"kernel_packages")&&fn){rt="install_push",Pe.setFieldsValue((0,E.Z)((0,E.Z)({},$),{},{kernel_install:rt,rpm_info:et,script_info:Ot})),kt(rt);return}if(pt&&p().get(pt,"kernel_packages")&&!fn){rt="install_un_push",Pe.setFieldsValue((0,E.Z)((0,E.Z)({},$),{},{kernel_install:rt,rpm_info:et,script_info:Ot})),kt(rt);return}if(ot&&p().get(ot,"code_repo")&&p().get(ot,"code_branch")&&p().get(ot,"cpu_arch")){rt="install_build_kernel",Pe.setFieldsValue((0,E.Z)((0,E.Z)({},$),{},{kernel_install:rt,rpm_info:et,script_info:Ot})),kt(rt);return}Pe.setFieldsValue((0,E.Z)((0,E.Z)({},$),{},{kernel_install:rt,rpm_info:et,script_info:Ot})),kt(rt)}}}),(0,W.useEffect)(function(){Je&&Pe.scrollToField("env_info")},[Je]);var dn=(0,H.QT)(function(){return(0,Ze.ZP)({enable:"True"})}),Yt=dn.data;(0,W.useEffect)(function(){if(JSON.stringify(at)!=="{}"){var Ke=at.monitor_info,$=at.need_reboot,et=at.rpm_info,Ot=at.script_info,fn=at.env_info,pt=at.kernel_info,ot=at.kernel_version,rt=at.iclone_info,vn=at.build_pkg_info,Sn=rt||{},bn=Sn.os,Pn=bn===void 0?"":bn,In=Sn.app_name,Rn=In===void 0?"":In,On=pt||{},Kn=On.branch,Dn=On.kernel_packages,st=(0,bt.Z)(On,Nt),Fe=!1;(Pn||Rn)&&(Fe=!0,cn(Fe));var N=vn&&JSON.stringify(vn)!=="{}";ot&&kt("install_push"),!ot&&!N&&Dn&&kt(Dn.length>0?"install_un_push":"no"),N&&kt("install_build_kernel"),Le($);var V=!1;Ke&&Ke.length>0&&(gn(!0),V=!0);var te=fn?(0,oe.xX)(fn):"",ge=p().isArray(Ke)?Ke.map(function(Ge){var Dt={monitor_type:Ge.monitor_type};return p().get(Ge,"monitor_type")==="custom_machine"&&(Dt.server=Ge.server_input),Dt}):[];Pe.setFieldsValue((0,E.Z)((0,E.Z)({monitor_info:Ke&&Ke.length>0?ge:[{monitor_type:"case_machine",server:""}],rpm_info:et&&et.length>0?et:[{pos:"before",rpm:""}],script_info:Ot&&Ot.length>0?Ot:[{pos:"before",script:""}],need_reboot:$,env_info:te,reclone_contrl:Fe,os:Pn,app_name:Rn,moniter_contrl:V,kernel_version:ot,kernel_packages:Dn},st),vn))}},[at,Yt]);var qe=function($){var et=$.target;Le(et.value)};return(0,W.useEffect)(function(){Pe.setFieldsValue({kernel_install:ft})},[ft]),(0,o.jsxs)(w.Z,{colon:!1,layout:"horizontal",size:"small",labelCol:{span:5},wrapperCol:{span:14},style:{width:"100%"},name:"env",form:Pe,className:_().job_test_form,initialValues:{rpm_info:[{pos:"before",rpm:""}],script_info:[{pos:"before",script:""}],monitor_info:[{monitor_type:"case_machine",server:""}],need_reboot:!1,hotfix_install:!0,scripts:[{pos:"before",script:""}],kernel_install:"no"},children:["reclone"in a&&(0,o.jsx)(w.Z.Item,{label:a.reclone.alias||(0,o.jsx)(H._H,{id:"job.form.".concat(a.reclone.name)}),name:"reclone_contrl",initialValue:!1,children:(0,o.jsxs)(G.ZP.Group,{disabled:Y,onChange:function($){var et=$.target;return cn(et.value)},children:[(0,o.jsx)(G.ZP,{value:!0,children:(0,o.jsx)(H._H,{id:"operation.yes"})}),(0,o.jsx)(G.ZP,{value:!1,children:(0,o.jsx)(H._H,{id:"operation.no"})})]})}),Ct&&(0,o.jsxs)(w.Z.Item,{label:" ",children:[(0,o.jsx)(w.Z.Item,{label:(0,o.jsx)(H._H,{id:"job.form.physical.machine"}),children:(0,o.jsxs)(St.Z,{gutter:10,children:[(0,o.jsx)(ke.Z,{span:12,children:(0,o.jsx)(w.Z.Item,{name:"os",noStyle:!0,children:(0,o.jsxs)(J.Z,{getPopupContainer:function($){return $.parentNode},placeholder:(0,o.jsx)(H._H,{id:"job.form.iclone.os"}),disabled:Y,children:[(0,o.jsx)(J.Z.Option,{value:"AliOS7U2-4.9-x86-64",children:"AliOS7U2-4.9-x86-64"}),(0,o.jsx)(J.Z.Option,{value:"AliOS7U2-aarch64",children:"AliOS7U2-aarch64"}),(0,o.jsx)(J.Z.Option,{value:"AliOS7U2-x86-64",children:"AliOS7U2-x86-64"})]})})}),(0,o.jsx)(ke.Z,{span:12,children:(0,o.jsx)(w.Z.Item,{name:"app_name",noStyle:!0,children:(0,o.jsxs)(J.Z,{getPopupContainer:function($){return $.parentNode},placeholder:(0,o.jsx)(H._H,{id:"job.form.iclone.template"}),disabled:Y,children:[(0,o.jsx)(J.Z.Option,{value:"baseos_server",children:"baseos_server"}),(0,o.jsx)(J.Z.Option,{value:"app_server",children:"app_server"})]})})})]})}),(0,o.jsx)(w.Z.Item,{name:"vm",label:(0,o.jsx)(H._H,{id:"job.form.vm"}),children:(0,o.jsx)(J.Z,{getPopupContainer:function($){return $.parentNode},placeholder:(0,o.jsx)(H._H,{id:"job.form.vm.config"}),disabled:Y})})]}),"kernel_install"in a&&(0,o.jsx)(w.Z.Item,{label:a.kernel_install.alias||(0,o.jsx)(H._H,{id:"job.form.".concat(a.kernel_install.name)}),name:"kernel_install",children:(0,o.jsxs)(G.ZP.Group,{value:ft,disabled:Y,onChange:Bt,children:[(0,o.jsx)(G.ZP,{value:"no",children:(0,o.jsx)(H._H,{id:"job.form.uninstall"})}),(0,o.jsx)(G.ZP,{value:"install_push",children:(0,o.jsx)(H._H,{id:"job.form.install_push"})}),(0,o.jsx)(G.ZP,{value:"install_un_push",children:(0,o.jsx)(H._H,{id:"job.form.install_un_push"})}),(0,o.jsx)(G.ZP,{value:"install_build_kernel",children:(0,o.jsx)(H._H,{id:"job.form.install_build_kernel"})})]})}),ft==="install_push"&&(0,o.jsx)(i.Z,{form:Pe,kernel:ft,kernelList:Yt,disabled:Y,needScriptList:!zt.lU.includes(Be)}),ft==="install_un_push"&&(0,o.jsx)(n.Z,{disabled:Y,form:Pe,needScriptList:!zt.lU.includes(Be)}),ft==="install_build_kernel"&&(0,o.jsx)(h.Z,{disabled:Y,form:Pe,project_id:Se}),"reboot"in a&&(0,o.jsx)(w.Z.Item,{label:a.reboot.alias||(0,o.jsx)(H._H,{id:"job.form.".concat(a.reboot.name)}),name:"need_reboot",children:(0,o.jsxs)(G.ZP.Group,{disabled:Y,onChange:qe,children:[(0,o.jsx)(G.ZP,{value:!0,children:(0,o.jsx)(H._H,{id:"operation.yes"})}),(0,o.jsx)(G.ZP,{value:!1,children:(0,o.jsx)(H._H,{id:"operation.no"})})]})}),"global_variable"in a&&(0,o.jsx)(w.Z.Item,{label:a.global_variable.alias||(0,o.jsx)(H._H,{id:"job.form.".concat(a.global_variable.name)}),children:(0,o.jsx)(w.Z.Item,{name:"env_info",rules:[function(){return{validator:function($,et){if(et){var Ot=/^(\w+=((('[^']+'|"[^"]+")|.+)(\n)))*\w+=(('[^']+'|"[^"]+")|.+)$/;return Ot.test(et)?Promise.resolve():Promise.reject(C({id:"job.form.env_info.placeholder"}))}else return Promise.resolve()}}}],children:(0,o.jsx)(lt.Z.TextArea,{disabled:Y,placeholder:C({id:"job.form.env_info.placeholder"})})})}),"rpm"in a&&(0,o.jsx)(T.Z,{form:Pe,label:a.rpm.alias||(0,o.jsx)(H._H,{id:"job.form.".concat(a.rpm.name)}),listName:"rpm_info",textName:"rpm",radioName:"pos",buttonText:C({id:"job.form.rpm.buttonText"}),placeholder:C({id:"job.form.rpm.placeholder"}),buttonShow:ae,disabled:Y}),"script"in a&&(0,o.jsx)(T.Z,{form:Pe,label:a.script.alias||(0,o.jsx)(H._H,{id:"job.form.".concat(a.script.name)}),listName:"script_info",textName:"script",radioName:"pos",buttonText:C({id:"job.form.script.buttonText"}),placeholder:C({id:"job.form.script.placeholder"}),buttonShow:ae,disabled:Y}),"monitor"in a&&(0,o.jsx)(w.Z.Item,{label:a.monitor.alias||(0,o.jsx)(H._H,{id:"job.form.".concat(a.monitor.name,".config")}),name:"moniter_contrl",initialValue:!1,children:(0,o.jsxs)(G.ZP.Group,{disabled:Y,onChange:function($){var et=$.target;gn(et.value),et&&Pe.setFieldsValue((0,E.Z)((0,E.Z)({},Pe.getFieldsValue()),{},{monitor_info:[{monitor_type:"case_machine",server:""}]}))},children:[(0,o.jsx)(G.ZP,{value:!0,children:(0,o.jsx)(H._H,{id:"operation.yes"})}),(0,o.jsx)(G.ZP,{value:!1,children:(0,o.jsx)(H._H,{id:"operation.no"})})]})}),ln&&(0,o.jsx)(Zt.Z,{disabled:Y,formComponent:Pe,template:at})]})}},63509:function(Ut,Wt,t){"use strict";t.d(Wt,{Z:function(){return dt}});var un=t(77883),lt=t(47673),Lt=t(4107),St=t(11849),Pt=t(39428),ke=t(3182),yn=t(9715),J=t(20526),mt=t(2824),G=t(43358),bt=t(34041),E=t(67294),sn=t(92211),w=t.n(sn),Vt=t(22928),W=t(71459),Me=t(20136),_=t(55241),Ze=t(20310),i=t(1870),n=t(12788),h=t(85893),T,oe=(0,n.ZP)(i.Z)(T||(T=(0,Ze.Z)([`
	color: rgba(0, 0, 0, 0.65);
	cursor: pointer;
	position: absolute;
	right: -22px;
	top: 5px;
`]))),Zt=function(L){var Y=L.contextNode,Je=L.placement,Se=Je===void 0?"top":Je,he=L.style,e=he===void 0?{}:he;return(0,h.jsx)(_.Z,{placement:Se,overlayStyle:{zIndex:1e4},content:Y,color:"#fff",children:(0,h.jsx)(oe,{style:e})})},H=Zt,qt=t(63885),_e=t(16917),p=t(20009),zt=t(96486),o=t.n(zt),Nt=bt.Z.Option,dt=function(a){var L=a.contrl,Y=a.disabled,Je=Y===void 0?!1:Y,Se=a.onRef,he=Se===void 0?null:Se,e=a.template,Q=e===void 0?{}:e,at=a.isReset,Jt=a.tagsDataRef,C=a.reportTemplateDataRef,Gt=a.callback,Be=(0,_e.YB)(),we=Be.formatMessage,Xe=(0,p.UO)(),Pe=Xe.ws_id,_n=J.Z.useForm(),en=(0,mt.Z)(_n,1),Ct=en[0],cn=(0,E.useState)([]),hn=(0,mt.Z)(cn,2),tn=hn[0],ae=hn[1],Le=(0,E.useState)([]),It=(0,mt.Z)(Le,2),Ft=It[0],ln=It[1],gn=E.useState(),gt=(0,mt.Z)(gn,2),nn=gt[0],ft=gt[1],kt=(0,E.useState)([]),Bt=(0,mt.Z)(kt,2),dn=Bt[0],Yt=Bt[1],qe=(0,E.useState)({}),Ke=(0,mt.Z)(qe,2),$=Ke[0],et=Ke[1],Ot=(0,E.useState)(""),fn=(0,mt.Z)(Ot,2),pt=fn[0],ot=fn[1],rt=(0,E.useState)(!1),vn=(0,mt.Z)(rt,2),Sn=vn[0],bn=vn[1];(0,E.useImperativeHandle)(he,function(){return{form:Ct,reset:function(){Ct.resetFields()},setVal:function(Fe){var N=/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i,V=o().get(Fe,"callback_api")||"",te=N.test(V);bn(V&&!te),ft(o().get(Fe,"report_name")||""),ot(V),Ct.setFieldsValue(Fe)}}});var Pn=function(){var st=(0,ke.Z)((0,Pt.Z)().mark(function Fe(){var N,V;return(0,Pt.Z)().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return ge.next=2,(0,Vt.oG)({ws_id:Pe,page_size:500});case 2:N=ge.sent,V=N.data,Jt&&(Jt.current=V),ae(V);case 6:case"end":return ge.stop()}},Fe)}));return function(){return st.apply(this,arguments)}}(),In=function(){var st=(0,ke.Z)((0,Pt.Z)().mark(function Fe(){var N,V,te,ge,Ge;return(0,Pt.Z)().wrap(function(be){for(;;)switch(be.prev=be.next){case 0:return be.prev=0,be.next=3,(0,qt.MD)({ws_id:Pe,page_size:99999});case 3:N=be.sent,V=N.code,te=N.data,V===200&&(ge=o().isArray(te)?te:[],Ge=o().find(ge,{is_default:!0}),C&&(C.current=ge),Yt(ge),et(Ge)),be.next=12;break;case 9:be.prev=9,be.t0=be.catch(0),console.log(be.t0);case 12:case"end":return be.stop()}},Fe,null,[[0,9]])}));return function(){return st.apply(this,arguments)}}();(0,E.useEffect)(function(){In(),Pn()},[]),(0,E.useEffect)(function(){at&&(ft(""),ot(""))},[at]),(0,E.useEffect)(function(){if(JSON.stringify(Q)!=="{}"){var st,Fe,N,V=Q.cleanup_info,te=Q.tags,ge=Q.notice_info,Ge=Q.report_name,Dt=Q.callback_api,be=Q.job_timeout,Zn=Q.report_template||Q.report_template_id;if(o().isArray(ge)&&ge.forEach(function(jn){st=jn.subject,jn.type==="email"&&(Fe=jn.to),jn.type==="ding"&&(N=jn.to)}),o().isArray(dn)){var Et=o().find(dn,["id",Zn]);Zn=o().get(Et,"id")}Ct.setFieldsValue({cleanup_info:V,tags:te,notice_subject:st,email:Fe,ding_token:N,report_template:Zn,report_name:Ge,callback_api:Dt,job_timeout:be}),ln(te),ft(Ge),ot(Dt)}},[$,dn,Q]);var Rn=function(Fe){var N=Fe.target.value,V=o().cloneDeep(Ct.getFieldsValue()),te=o().get(V,"report_template")||o().get($,"id");Ct.setFieldsValue((0,St.Z)((0,St.Z)({},V),{},{report_name:N,report_template:te})),ft(N)},On=function(Fe){var N=Fe.target.value;ot(N);var V=o().cloneDeep(Ct.getFieldsValue());Ct.setFieldsValue((0,St.Z)((0,St.Z)({},V),{},{callback_api:N}));var te=/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i,ge=te.test(N);bn(N&&!ge)},Kn=function(){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("span",{children:(0,h.jsx)(_e._H,{id:"job.form.callback_api.tips"})}),(0,h.jsx)("span",{className:w().create_doc,onClick:function(){return window.open("/help_doc/17")},children:(0,h.jsx)(_e._H,{id:"job.form.callback_api.help.document"})})]})},Dn=(0,E.useMemo)(function(){return tn==null?void 0:tn.filter(function(st){return Ft==null?void 0:Ft.includes(st.id)})},[Ft,tn]);return(0,h.jsxs)(J.Z,{colon:!1,layout:"horizontal",size:"small",labelCol:{span:5},wrapperCol:{span:14},style:{width:"100%"},name:"more",form:Ct,className:w().job_test_form,children:["cleanup"in L&&(0,h.jsx)(J.Z.Item,{name:"cleanup_info",label:L.cleanup.alias||(0,h.jsx)(_e._H,{id:"job.form.".concat(L.cleanup.name)}),children:(0,h.jsx)(Lt.Z.TextArea,{disabled:Je,placeholder:we({id:"job.form.cleanup_info.placeholder"})})}),"job_tag"in L&&(0,h.jsx)(W.OT,{tags:tn,initialValue:Dn,label:L.job_tag.alias||(0,h.jsx)(_e._H,{id:"job.form.".concat(L.job_tag.name)}),disabled:Je,callback:Gt}),"notice_subject"in L&&(0,h.jsx)(J.Z.Item,{name:"notice_subject",label:L.notice_subject.alias||(0,h.jsx)(_e._H,{id:"job.form.".concat(L.notice_subject.name)}),children:(0,h.jsx)(Lt.Z,{autoComplete:"off",disabled:Je,placeholder:we({id:"job.form.notice_subject.placeholder"},{date:"{date}"})})}),"email_notice"in L&&(0,h.jsx)(J.Z.Item,{name:"email",label:L.email_notice.alias||(0,h.jsx)(_e._H,{id:"job.form.".concat(L.email_notice.name)}),rules:[function(){return{validator:function(Fe,N){var V=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(N){var te=N.split(/,|ï¼Œ|\n|\s/g),ge=te.filter(function(Ge){return!V.test(Ge)});return ge.length===0?Promise.resolve():Promise.reject(we({id:"job.form.email.validator"}))}else return Promise.resolve()}}}],children:(0,h.jsx)(Lt.Z,{autoComplete:"off",disabled:Je,placeholder:we({id:"job.form.email.placeholder"})})}),"ding_notice"in L&&(0,h.jsx)(J.Z.Item,{name:"ding_token",label:L.ding_notice.alias||(0,h.jsx)(_e._H,{id:"job.form.".concat(L.ding_notice.name)}),children:(0,h.jsx)(Lt.Z,{autoComplete:"off",disabled:Je,placeholder:we({id:"job.form.ding_token.placeholder"})})}),"report"in L&&(0,h.jsxs)(J.Z.Item,{label:L.report.alias||we({id:"job.form.report.label"}),name:"report_name",children:[(0,h.jsx)(Lt.Z,{value:nn||void 0,onChange:Rn,autoComplete:"off",disabled:Je,placeholder:we({id:"job.form.report.placeholder"},{job_name:"{job_name}",report_seq_id:"{report_seq_id}"})}),(0,h.jsx)(H,{contextNode:(0,h.jsxs)("div",{children:[(0,h.jsx)(_e._H,{id:"job.form.report.tips"}),(0,h.jsx)("p",{style:{marginBottom:0},children:"{date} {job_name} {job_id} {product_version}"})]})})]}),nn&&"report"in L&&(0,h.jsx)(J.Z.Item,{name:"report_template",label:L.report.alias||we({id:"job.form.report_template.label"}),children:(0,h.jsx)(bt.Z,{showSearch:!0,disabled:Je,placeholder:we({id:"job.form.report_template.placeholder"}),optionFilterProp:"children",filterOption:function(Fe,N){return N.children.toLowerCase().indexOf(Fe.toLowerCase())>=0},children:dn.map(function(st){return(0,h.jsx)(Nt,{value:st.id,children:st.name},st.id)})})}),"callback_api"in L&&(0,h.jsxs)(J.Z.Item,{name:"callback_api",label:L.callback_api.alias||we({id:"job.form.callback_api.label"}),validateStatus:Sn&&"error"||void 0,help:Sn&&we({id:"job.form.callback_api.help"}),children:[(0,h.jsx)(Lt.Z,{value:pt,onChange:On,autoComplete:"off",disabled:Je,placeholder:we({id:"job.form.callback_api.placeholder"})}),(0,h.jsx)(H,{contextNode:(0,h.jsxs)("div",{children:[(0,h.jsx)(_e._H,{id:"job.form.callback_api.icons"}),(0,h.jsx)("p",{style:{marginBottom:0},children:Kn()})]})})]}),!1]})}},41719:function(Ut,Wt,t){"use strict";t.d(Wt,{Z:function(){return xa}});var un=t(20228),lt=t(11382),Lt=t(58024),St=t(91894),Pt=t(13254),ke=t(14277),yn=t(17462),J=t(76772),mt=t(49111),G=t(19650),bt=t(54029),E=t(79166),sn=t(402),w=t(97272),Vt=t(57663),W=t(71577),Me=t(39428),_=t(11849),Ze=t(3182),i=t(2824),n=t(67294),h=t(96486),T=t.n(h),oe=t(57338),Zt=t(440),H=t(32157),qt=t(45742),_e=t(63185),p=t(9676),zt=t(47673),o=t(4107),Nt=t(58491),dt=t(57254),a=t(16917),L=t(20009),Y=t(19028),Je=t(9005),Se=t.n(Je),he=t(44586),e=t(85893),Q=function(r){var l=r.testType,f=r.onRef,m=r.handleSelect,c=r.control,y=r.treeData,v=y===void 0?[]:y,ne=r.loading,ve=(0,a.YB)(),z=ve.formatMessage,ce=o.Z.Search,X=(0,L.UO)(),re=X.ws_id,je=(0,a.md)(),ue=(0,n.useState)(!1),O=(0,i.Z)(ue,2),P=O[0],se=O[1],Ye=(0,n.useState)(!1),I=(0,i.Z)(Ye,2),B=I[0],$e=I[1],xe=(0,n.useState)(!1),Ie=(0,i.Z)(xe,2),jt=Ie[0],ut=Ie[1],Oe=(0,n.useState)([]),me=(0,i.Z)(Oe,2),Ue=me[0],Ae=me[1],De=(0,n.useState)(!1),We=(0,i.Z)(De,2),Ee=We[0],Qe=We[1],Re=(0,n.useState)(""),tt=(0,i.Z)(Re,2),it=tt[0],xt=tt[1],At=n.useState(""),Ht=(0,i.Z)(At,2),yt=Ht[0],Qt=Ht[1],ye=function(F){return~F.domain_name_list.indexOf(it)&&~F.name.toLowerCase().indexOf(yt.toLowerCase())},x=n.useMemo(function(){return v.map(function(ee){return(0,_.Z)((0,_.Z)({},ee),{},{rowkey:(0,he.Z)()})})},[v]),K=n.useMemo(function(){return x.reduce(function(ee,F){var Ce=F.test_case_list,R=F.rowkey;return ee.concat(R,Ce.map(function(pe){return pe.id}))},[])},[x,yt,it]),k=n.useMemo(function(){return x.reduce(function(ee,F){var Ce=F.test_case_list,R=F.rowkey;return ye(F)?ee.concat(R,Ce.map(function(pe){return pe.id})):ee},[])},[x,it,yt]),Z=function(F){var Ce=F.slice().sort().join(",");Ce&&Ce===K.slice().sort().join(",")?($e(!1),ut(!0)):F&&F.length?($e(!0),ut(!1)):($e(!1),ut(!1))},j=function(F){xt(F)},q=(0,a.QT)(Y.ge,{initialData:[]}),ie=q.data;(0,n.useImperativeHandle)(f,function(){return{openDrawer:function(F){var Ce=F.test_config,R=[];v.forEach(function(pe){var Cn=Ce.findIndex(function(an){var xn=an.id;return xn===pe.id});if(Cn>-1){var mn=[];pe.test_case_list.forEach(function(an){var xn=Ce[Cn].test_case_list.findIndex(function(En){var wn=En.id;return wn===an.id});xn>-1&&mn.push(an.id)}),mn.length&&mn.length===pe.test_case_list.length&&R.push(pe.id),mn.length&&R.push.apply(R,mn)}}),Z(R),Ae(R),se(!0)}}});var D=function(F){Ae(F),Z(F)},_t=function(F){var Ce=F.target;ut(Ce.checked),Ae(Ce.checked?K:[])},He=function(){se(!1),Ae([]),xt(""),Qt("")},Rt=function(){var F=(0,h.cloneDeep)(v),Ce=F.filter(function(R){if(R.test_case_list=R.children.filter(function(pe){if(Ue.indexOf(pe.id)>-1)return pe.setup_info="",pe.cleanup_info="",pe.need_reboot=!1,pe.console=void 0,pe.monitor_info=[{items:void 0,servers:void 0}],pe.priority=10,pe.server_object_id=void 0,pe.ip=pe.ip||"\u968F\u673A",pe.env_info=pe.var?JSON.parse(pe.var).length>0?JSON.parse(pe.var):[]:[],pe}),delete R.children,R.test_case_list.length>0)return R.need_reboot=!1,R.priority=10,R.console=void 0,R.monitor_info=[{items:void 0,servers:void 0}],R.setup_info="",R.cleanup_info="",R});m(Ce),He()},Kt=n.useMemo(function(){return x.map(function(ee){return{key:ee.rowkey,title:ee.name,children:ee.test_case_list.map(function(F){return(0,_.Z)((0,_.Z)({},F),{},{key:F.id,title:F.name,selectable:!1,style:{display:ye(ee)?void 0:"none"}})}),style:{display:ye(ee)?void 0:"none"},selectable:!1,checkable:ee.test_case_list.length!==0}})},[x,it,yt]);return(0,e.jsx)(Zt.Z,{maskClosable:!1,keyboard:!1,className:Se().suite,title:(0,e.jsx)(a._H,{id:"select.suite.drawer.title"}),width:634,forceRender:!0,destroyOnClose:!0,onClose:function(){return se(!1)},open:P,bodyStyle:{paddingBottom:80},footer:(0,e.jsxs)("div",{style:{textAlign:"right",padding:"0 8px"},children:[(0,e.jsx)(p.Z,{disabled:ne,indeterminate:B,onChange:_t,checked:jt,style:{float:"left"},children:(0,e.jsx)(a._H,{id:"select.suite.drawer.checkbox"})}),(0,e.jsx)(W.Z,{onClick:He,style:{marginRight:8},children:(0,e.jsx)(a._H,{id:"operation.cancel"})}),(0,e.jsx)(W.Z,{onClick:Rt,type:"primary",children:(0,e.jsx)(a._H,{id:"operation.ok"})})]}),children:(0,e.jsxs)(lt.Z,{spinning:ne,wrapperClassName:Se().spinWrapper,children:[(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,e.jsx)(ce,{onChange:function(F){var Ce,R=F.target;return Qt(R==null||(Ce=R.value)===null||Ce===void 0?void 0:Ce.replace(/\s+/g,""))},placeholder:z({id:"select.suite.search.placeholder"}),value:yt,allowClear:!0,style:{marginBottom:12}}),c.includes("domain")&&(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{style:{position:"relative",display:"flex"},children:[(0,e.jsx)("div",{className:Se().nav,children:(0,e.jsx)(a._H,{id:"select.suite.domain"})}),(0,e.jsxs)("div",{className:Se().domainList_Tab,children:[(0,e.jsx)(W.Z,{className:Se().domain_all,size:"small",type:it===""?"primary":"ghost",onClick:function(){return j("")},children:(0,e.jsx)(a._H,{id:"select.suite.all.btn"})}),ie.map(function(ee,F){if(!(!Ee&&F>6))return(0,e.jsx)(W.Z,{type:ee.name==it?"primary":"ghost",size:"small",style:(0,_.Z)({marginRight:8,marginBottom:8,boxShadow:"none"},ee.name===it?{}:{border:"none"}),onClick:function(){return j(ee.name)},children:ee.name},ee.id)})]}),(0,e.jsx)(W.Z,{type:"link",size:"small",onClick:function(){return Qe(!Ee)},icon:Ee?(0,e.jsx)(Nt.Z,{}):(0,e.jsx)(dt.Z,{}),style:{position:"absolute",right:0},children:z(Ee?{id:"operation.collapse"}:{id:"operation.expand"})})]})})]}),k!=null&&k.length?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:Se().selection_table_thead,children:[(0,e.jsx)("div",{style:{width:200},children:"Test Suite"}),(0,e.jsx)("div",{children:(0,e.jsx)(a._H,{id:"select.suite.business.name"})})]}),(0,e.jsx)(qt.Z,{className:Se().selection_table_tbody,checkedKeys:Ue,checkable:!0,onCheck:D,titleRender:function(F){var Ce=F||{},R=Ce.title,pe=Ce.children,Cn=Ce.business_name;return(0,e.jsxs)("div",{className:Se().selection_table_row,children:[(0,e.jsx)("div",{className:Se().col,style:{width:pe?200:"100%"},children:R||null}),(0,e.jsx)("div",{className:Se().otherCol,children:Cn||(pe?"-":null)})]},F.id)},treeData:Kt})]}):(0,e.jsxs)("div",{style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[(0,e.jsx)(ke.Z,{image:ke.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsx)(a._H,{id:"select.suite.no.case"})}),(0,e.jsx)(a.Nv,{accessible:je.WsMemberOperateSelf(),children:(0,e.jsx)(w.Z.Link,{target:"_blank",href:l?"/ws/".concat(re,"/test_suite?test_type=").concat(l):"/ws/".concat(re,"/test_suite"),children:(0,e.jsx)(W.Z,{type:"primary",children:(0,e.jsx)(a._H,{id:"select.suite.add.case"})})})})]})]})})},at=Q,Jt=t(50335),C=t.n(Jt),Gt=t(13062),Be=t(71230),we=t(20310),Xe=t(12788),Pe,_n=Xe.ZP.div(Pe||(Pe=(0,we.Z)([`
    width: 100%;
    `,`
`])),function(S){var r=S.expanded;return r?"":"height: 32px; overflow: hidden;"}),en=function(r){var l=r.dataSource,f=r.onChange,m=r.active,c=n.useRef(null),y=n.useRef(null),v=n.useState(!1),ne=(0,i.Z)(v,2),ve=ne[0],z=ne[1],ce=n.useState(!1),X=(0,i.Z)(ce,2),re=X[0],je=X[1],ue=n.useCallback(function(O){for(var P=0,se=O.length;P<se;P++){var Ye=O[P];if(Ye.intersectionRatio===0)return je(!0)}},[]);return n.useEffect(function(){var O=new IntersectionObserver(ue,{root:y.current});if(y.current){var P=y.current.childNodes;P.forEach(function(se){return O.observe(se)})}return function(){O.disconnect()}},[]),(0,e.jsxs)(Be.Z,{style:{display:"flex",flexFlow:"row nowrap"},children:[(0,e.jsx)("div",{ref:c,children:(0,e.jsx)(w.Z.Text,{strong:!0,children:(0,e.jsx)(a._H,{id:"select.suite.domain"})})}),(0,e.jsx)("div",{style:{flex:1},children:(0,e.jsx)(_n,{expanded:ve,ref:y,children:[{name:"",id:""}].concat(l||[]).map(function(O){var P={onClick:function(){f==null||f(O.name==="\u5168\u90E8"?"":O.name)},size:"small",style:{marginBottom:8,marginRight:8,border:"none",boxShadow:"none",transition:"none"},type:m===O.name?"primary":"ghost"};return(0,e.jsx)(W.Z,(0,_.Z)((0,_.Z)({},P),{},{children:O.name||(0,e.jsx)(a._H,{id:"all"})}),O.id)})})}),re&&(0,e.jsx)(w.Z.Link,{style:{userSelect:"none"},children:ve?(0,e.jsxs)(G.Z,{style:{cursor:"pointer"},onClick:function(){return z(!1)},children:[(0,e.jsx)(Nt.Z,{}),(0,e.jsx)(w.Z.Link,{children:(0,e.jsx)(a._H,{id:"operation.collapse"})})]}):(0,e.jsxs)(G.Z,{style:{cursor:"pointer"},onClick:function(){return z(!0)},children:[(0,e.jsx)(dt.Z,{}),(0,e.jsx)(w.Z.Link,{children:(0,e.jsx)(a._H,{id:"operation.expand"})})]})})]})},Ct=en,cn=function(r){var l=r.testType,f=r.onRef,m=r.handleSelect,c=r.control,y=r.treeData,v=y===void 0?[]:y,ne=r.loading,ve=(0,a.YB)(),z=ve.formatMessage,ce=(0,L.UO)(),X=ce.ws_id,re=o.Z.Search,je=(0,n.useState)(!1),ue=(0,i.Z)(je,2),O=ue[0],P=ue[1],se=(0,a.md)(),Ye=(0,n.useState)([]),I=(0,i.Z)(Ye,2),B=I[0],$e=I[1],xe=(0,n.useState)(!1),Ie=(0,i.Z)(xe,2),jt=Ie[0],ut=Ie[1],Oe=(0,n.useState)(""),me=(0,i.Z)(Oe,2),Ue=me[0],Ae=me[1],De=n.useState(""),We=(0,i.Z)(De,2),Ee=We[0],Qe=We[1],Re=function(j){return~j.domain_name_list.indexOf(Ue)&&~j.name.toLowerCase().indexOf(Ee.toLowerCase())},tt=n.useMemo(function(){return v.map(function(Z){return(0,_.Z)((0,_.Z)({},Z),{},{rowkey:(0,he.Z)()})})},[v]),it=n.useMemo(function(){return tt.reduce(function(Z,j){var q=j.test_case_list,ie=j.rowkey;return Z.concat(ie,q.map(function(D){return D.id}))},[])},[tt,Ee,Ue]),xt=n.useMemo(function(){return tt.reduce(function(Z,j){var q=j.test_case_list,ie=j.rowkey;return Re(j)?Z.concat(ie,q.map(function(D){return D.id})):Z},[])},[tt,Ue,Ee]),At=function(j){ut(j.slice().sort().join(",")&&j.slice().sort().join(",")==it.slice().sort().join(","))},Ht=(0,a.QT)(Y.ge,{initialData:[]}),yt=Ht.data;(0,n.useImperativeHandle)(f,function(){return{openDrawer:function(j){var q=j.test_config,ie=v.reduce(function(D,_t){var He=q.findIndex(function(Rt){var Kt=Rt.id;return Kt===_t.id});return~He?D.concat(_t.test_case_list.reduce(function(Rt,Kt){var ee=q[He].test_case_list.findIndex(function(F){var Ce=F.id;return Ce===Kt.id});return~ee?Rt.concat(Kt.id):Rt},[])):D},[]);At(ie),$e(ie),P(!0)}}});var Qt=function(j){$e(j),At(j)},ye=function(j){var q=j.target;ut(q.checked),$e(q.checked?it:[])},x=function(){P(!1),$e([]),Ae(""),Qe("")},K=function(){var j=(0,h.cloneDeep)(v),q=j.filter(function(ie){if(ie.test_case_list=ie.children.filter(function(D){if(B.indexOf(D.id)>-1){if(D.setup_info="",D.cleanup_info="",D.need_reboot=!1,D.console=void 0,D.monitor_info=[{items:void 0,servers:void 0}],D.priority=10,D.server_object_id=void 0,D.ip=D.ip||"\u968F\u673A",D.env_info=[],D.var){var _t=JSON.parse(D.var).map(function(He){return(0,_.Z)((0,_.Z)({},He),{},{is_sys:!0})});D.env_info=_t}return D}}),delete ie.children,ie.test_case_list.length>0)return ie.need_reboot=!1,ie.priority=10,ie.console=void 0,ie.monitor_info=[{items:void 0,servers:void 0}],ie.setup_info="",ie.cleanup_info="",ie});m(q),x()},k=n.useMemo(function(){return tt.map(function(Z){return{key:Z.rowkey,title:Z.name,children:Z.test_case_list.map(function(j){return{key:j.id,title:j.name,selectable:!1,style:{display:Re(Z)?void 0:"none"}}}),style:{display:Re(Z)?void 0:"none"},selectable:!1,checkable:Z.test_case_list.length>0}})},[Ue,Ee,tt]);return(0,e.jsx)(Zt.Z,{maskClosable:!1,keyboard:!1,className:C().suite,title:(0,e.jsx)(a._H,{id:"select.suite.drawer.title"}),width:634,forceRender:!0,destroyOnClose:!0,onClose:function(){return P(!1)},open:O,bodyStyle:{paddingBottom:80},footer:(0,e.jsxs)("div",{style:{textAlign:"right",padding:"0 8px"},children:[!!it.length&&(0,e.jsx)(p.Z,{onChange:ye,checked:jt,disabled:ne,style:{float:"left"},children:(0,e.jsx)(a._H,{id:"select.suite.drawer.checkbox"})}),(0,e.jsx)(W.Z,{onClick:x,style:{marginRight:8},children:(0,e.jsx)(a._H,{id:"operation.cancel"})}),(0,e.jsx)(W.Z,{onClick:K,type:"primary",children:(0,e.jsx)(a._H,{id:"operation.ok"})})]}),children:(0,e.jsxs)(lt.Z,{spinning:ne,wrapperClassName:C().spinWrapper,children:[(0,e.jsx)(re,{placeholder:z({id:"please.enter"}),onChange:function(j){var q=j.target;return Qe(q.value.replace(/\s+/g,""))},value:Ee,allowClear:!0}),(0,e.jsx)("div",{style:{marginTop:16},children:c.indexOf("domain")>-1&&(0,e.jsx)(Ct,{active:Ue,onChange:Ae,dataSource:yt})}),!!(v!=null&&v.length)&&(0,e.jsx)(qt.Z,{style:{marginTop:8},checkedKeys:B,checkable:!0,onCheck:Qt,treeData:k}),((v==null?void 0:v.length)===0||xt.length===0)&&(0,e.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[(0,e.jsx)(ke.Z,{image:ke.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsx)(a._H,{id:"select.suite.no.case"})}),(0,e.jsx)(a.Nv,{accessible:se.WsMemberOperateSelf(),children:(0,e.jsx)(w.Z.Link,{target:"_blank",href:l?"/ws/".concat(X,"/test_suite?test_type=").concat(l):"/ws/".concat(X,"/test_suite"),children:(0,e.jsx)(W.Z,{type:"primary",children:(0,e.jsx)(a._H,{id:"select.suite.add.case"})})})})]})]})})},hn=cn,tn=t(66456),ae=t(79764),Le=t(22385),It=t(89456),Ft=t(77576),ln=t(52141),gn=t(71153),gt=t(60331),nn=t(77883),ft=t(61241),kt=t(88983),Bt=t(47933),dn=t(93224),Yt=t(9715),qe=t(20526),Ke=(0,n.createContext)(null),$=t(53909),et=t(89032),Ot=t(15746),fn=t(43358),pt=t(34041),ot=t(77045),rt=t(23279),vn=t.n(rt),Sn=t(48736),bn=t(27049),Pn=function(r){var l=r.menu,f=r.uri,m=(0,a.md)();return(0,e.jsxs)(G.Z,{direction:"vertical",style:{width:"100%"},size:0,children:[l,(0,e.jsxs)(a.Nv,{accessible:m.IsSysTestAdmin(),fallback:(0,e.jsx)(e.Fragment,{}),children:[(0,e.jsx)(bn.Z,{style:{margin:0}}),(0,e.jsx)(Be.Z,{justify:"center",align:"middle",style:{height:30},children:(0,e.jsx)(w.Z.Link,{target:"_blank",href:f,style:{width:"100%",textAlign:"center"},children:"\u53BB\u914D\u7F6E"})})]})]})},In=Pn,Rn=t(96942);function On(S,r,l){l===void 0&&(l={});var f=(0,n.useRef)();f.current=r,(0,n.useEffect)(function(){var m=(0,Rn.n)(l.target,window);if(!!m.addEventListener){var c=function(v){return f.current&&f.current(v)};return m.addEventListener(S,c,{capture:l.capture,once:l.once,passive:l.passive}),function(){m.removeEventListener(S,c,{capture:l.capture})}}},[S,l.target,l.capture,l.once,l.passive])}var Kn=On;function Dn(){return!!(typeof window!="undefined"&&window.document&&window.document.createElement)}var st=function(S,r){var l=typeof Symbol=="function"&&S[Symbol.iterator];if(!l)return S;var f=l.call(S),m,c=[],y;try{for(;(r===void 0||r-- >0)&&!(m=f.next()).done;)c.push(m.value)}catch(v){y={error:v}}finally{try{m&&!m.done&&(l=f.return)&&l.call(f)}finally{if(y)throw y.error}}return c},Fe=function(){return Dn()?document.visibilityState:"visible"};function N(){var S=st((0,n.useState)(function(){return Fe()}),2),r=S[0],l=S[1];return Kn("visibilitychange",function(){l(Fe())},{target:function(){return document}}),r}var V=N,te=function(r){return new Map([["Available","success"],["Occupied","error"],["Reserved","warning"]]).get(r)||void 0},ge=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],f=r==null?void 0:r.map(function(m){var c=m.id;return c});return l==null?void 0:l.reduce(function(m,c){return f.includes(c.id)?m:m.concat(c)},[]).concat(r)},Ge=function(r){var l=(0,a.YB)(),f=l.formatMessage,m=r.serverObjectType,c=r.run_mode,y=r.server_type,v=r.serverList,ne=(0,L.UO)(),ve=ne.ws_id,z=(0,n.useContext)(Ke),ce=z.setServerList,X=100,re=(0,n.useState)(!0),je=(0,i.Z)(re,2),ue=je[0],O=je[1],P=(0,n.useState)(1),se=(0,i.Z)(P,2),Ye=se[0],I=se[1],B=n.useState(!1),$e=(0,i.Z)(B,2),xe=$e[0],Ie=$e[1],jt=(0,n.useState)(void 0),ut=(0,i.Z)(jt,2),Oe=ut[0],me=ut[1],Ue=(0,n.useState)(1),Ae=(0,i.Z)(Ue,2),De=Ae[0],We=Ae[1],Ee=function(){var ye=(0,Ze.Z)((0,Me.Z)().mark(function x(){var K,k,Z,j,q,ie,D=arguments;return(0,Me.Z)().wrap(function(He){for(;;)switch(He.prev=He.next){case 0:return K=D.length>0&&D[0]!==void 0?D[0]:1,k=Oe?{ip:Oe}:{},He.next=4,(0,ot.fp)((0,_.Z)({ws_id:ve,state:["Available","Occupied","Reserved"],page_num:K,page_size:X},k));case 4:Z=He.sent,j=Z.data,q=Z.code,ie=Z.total_page,q===200&&j&&(ce(function(Rt){return ge(Rt,j)}),We(ie));case 9:case"end":return He.stop()}},x)}));return function(){return ye.apply(this,arguments)}}(),Qe=function(){var ye=(0,Ze.Z)((0,Me.Z)().mark(function x(){var K,k,Z,j,q,ie,D=arguments;return(0,Me.Z)().wrap(function(He){for(;;)switch(He.prev=He.next){case 0:return K=D.length>0&&D[0]!==void 0?D[0]:1,k=Oe?{ip:Oe}:{},He.next=4,(0,ot.Y_)((0,_.Z)({cluster_type:"aligroup",ws_id:ve,page_num:K,page_size:X},k));case 4:Z=He.sent,j=Z.data,q=Z.code,ie=Z.total_page,q===200&&j&&(ce(function(Rt){return ge(Rt,j)}),We(ie));case 9:case"end":return He.stop()}},x)}));return function(){return ye.apply(this,arguments)}}(),Re=function(){var ye=(0,Ze.Z)((0,Me.Z)().mark(function x(){var K,k,Z,j,q;return(0,Me.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return K=Oe?{ip:Oe}:{},D.next=3,(0,ot.CR)((0,_.Z)({ws_id:ve,no_page:!0,is_instance:m==="instance",state:["Available","Occupied","Reserved"]},K));case 3:k=D.sent,Z=k.data,j=k.code,q=k.total_page,j===200&&Z&&(ce(function(_t){return ge(_t,Z)}),We(q));case 8:case"end":return D.stop()}},x)}));return function(){return ye.apply(this,arguments)}}(),tt=function(){var ye=(0,Ze.Z)((0,Me.Z)().mark(function x(){var K,k,Z,j,q;return(0,Me.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return K=Oe?{ip:Oe}:{},D.next=3,(0,ot.aN)((0,_.Z)({cluster_type:"aliyun",ws_id:ve,no_page:!0},K));case 3:k=D.sent,Z=k.data,j=k.code,q=k.total_page,j===200&&Z&&(ce(function(_t){return ge(_t,Z)}),We(q));case 8:case"end":return D.stop()}},x)}));return function(){return ye.apply(this,arguments)}}(),it=function(){var ye=(0,Ze.Z)((0,Me.Z)().mark(function x(){var K,k=arguments;return(0,Me.Z)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(K=k.length>0&&k[0]!==void 0?k[0]:1,O(!0),y!=="aligroup"){j.next=12;break}if(c!=="cluster"){j.next=8;break}return j.next=6,Qe(K);case 6:j.next=10;break;case 8:return j.next=10,Ee(K);case 10:j.next=19;break;case 12:if(c!=="cluster"){j.next=17;break}return j.next=15,tt();case 15:j.next=19;break;case 17:return j.next=19,Re();case 19:O(!1);case 20:case"end":return j.stop()}},x)}));return function(){return ye.apply(this,arguments)}}();(0,n.useEffect)(function(){return m!=="ip"&&m!=="server_tag_id"&&(it(1),I(1)),function(){Ie(!1),We(1)}},[m,Oe]);var xt=V();n.useEffect(function(){xt==="hidden"&&Ie(!0),xe&&xt==="visible"&&(it(1),I(1))},[xt]);var At=function(x){var K=x.target;if(y==="aligroup"){var k=K.clientHeight,Z=K.scrollHeight,j=K.scrollTop;if(k+j===Z){var q=Ye+1;q<=De&&(I(q),it(q))}}},Ht=function(x){me(x||void 0)},yt=(0,n.useMemo)(function(){switch(m){case"server_object_id":return f({id:"select.suite.server_object_id.message"});case"instance":return f({id:"select.suite.instance.message"});case"setting":return f({id:"select.suite.setting.message"});default:return""}},[m]),Qt=(0,n.useMemo)(function(){var ye=[];return m==="server_object_id"&&(c==="standalone"?ye=v.map(function(x){var K=x.ip||x.sn;return{value:x.id,label:(0,e.jsxs)(w.Z.Text,{ellipsis:{tooltip:K},children:[(0,e.jsx)(E.Z,{status:te(x.state),style:{marginRight:8}}),K]}),search_key:K}}):ye=v.map(function(x){return{value:x.id,label:x.name,search_key:x.name}})),m==="instance"&&(ye=v.filter(function(x){return x.is_instance}).map(function(x){var K=x.private_ip,k=K?"".concat(K," / ").concat(x.instance_name):x.instance_name;return{value:x.id,label:(0,e.jsxs)(w.Z.Text,{ellipsis:{tooltip:k},children:[(0,e.jsx)(E.Z,{style:{marginRight:8},status:te(x.state)}),k]}),search_key:k}})),m==="setting"&&(ye=v.filter(function(x){return!x.is_instance}).map(function(x){return{value:x.id,label:(0,e.jsx)(w.Z.Text,{ellipsis:{tooltip:!0},children:x.template_name}),search_key:x.template_name}})),ye},[v,m,c]);return["ip","server_tag_id"].includes(m)?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)(qe.Z.Item,{noStyle:!0,children:(0,e.jsx)(qe.Z.Item,{name:"server_object_id",rules:[{required:!0,message:yt}],children:(0,e.jsx)(pt.Z,{allowClear:!0,style:{width:"100%"},placeholder:yt,dropdownMatchSelectWidth:340,showSearch:!0,onSearch:vn()(Ht,300),loading:ue,onPopupScroll:At,popupClassName:"job_select_drop_cls",getPopupContainer:function(x){return x.parentNode},dropdownRender:function(x){return(0,e.jsx)(In,{menu:x,uri:"/ws/".concat(ve,"/device/").concat(y==="aliyun"?"cloud":"group","?t=").concat(c,"&isInstance=").concat(m==="instance"?1:0)})},optionFilterProp:"children",filterOption:function(x,K){var k;return((k=K==null?void 0:K.search_key)!==null&&k!==void 0?k:"").toLowerCase().includes(x.toLowerCase())},options:Qt})})})},Dt=Ge,be=function(r){var l=(0,a.YB)(),f=l.formatMessage,m=r.run_mode,c=r.server_type,y=r.serverObjectType,v=r.tagList,ne=(0,L.UO)(),ve=ne.ws_id,z=(0,n.useContext)(Ke),ce=z.setTagList,X=100,re=(0,n.useState)(1),je=(0,i.Z)(re,2),ue=je[0],O=je[1],P=(0,n.useState)(!0),se=(0,i.Z)(P,2),Ye=se[0],I=se[1],B=(0,n.useState)(1),$e=(0,i.Z)(B,2),xe=$e[0],Ie=$e[1],jt=function(){var Oe=(0,Ze.Z)((0,Me.Z)().mark(function me(){var Ue,Ae,De,We,Ee,Qe=arguments;return(0,Me.Z)().wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:return Ue=Qe.length>0&&Qe[0]!==void 0?Qe[0]:1,I(!0),tt.next=4,(0,ot.yM)({ws_id:ve,run_mode:m,page_num:Ue,run_environment:c,page_size:X});case 4:Ae=tt.sent,De=Ae.data,We=Ae.code,Ee=Ae.total_page,We===200&&De&&(ce(function(it){return De.reduce(function(xt,At){var Ht=it.map(function(yt){var Qt=yt.id;return Qt});return Ht.includes(At.id)?xt:xt.concat(At)},[])}),Ie(Ee)),I(!1);case 10:case"end":return tt.stop()}},me)}));return function(){return Oe.apply(this,arguments)}}();(0,n.useEffect)(function(){y==="server_tag_id"&&(ce([]),jt(1),O(1))},[y]);var ut=function(me){var Ue=me.target,Ae=Ue.clientHeight,De=Ue.scrollHeight,We=Ue.scrollTop;if(Ae+We===De){var Ee=ue+1;Ee<=xe&&(O(Ee),jt(Ee))}};return(0,e.jsx)(qe.Z.Item,{name:"server_tag_id",rules:[{required:!0,message:f({id:"select.suite.server_tag_id.message"})}],children:(0,e.jsx)(pt.Z,{placeholder:(0,e.jsx)(a._H,{id:"select.suite.server_tag_id.message"}),style:{width:"100%"},allowClear:!0,filterOption:function(me,Ue){var Ae;return((Ae=Ue==null?void 0:Ue.name)!==null&&Ae!==void 0?Ae:"").toLowerCase().includes(me.toLowerCase())},tagRender:$.lR,mode:"multiple",loading:Ye,onPopupScroll:ut,getPopupContainer:function(me){return me.parentNode},options:v==null?void 0:v.map(function(Oe){return{value:Oe.id,label:(0,e.jsx)(gt.Z,{color:Oe.tag_color,children:Oe.name}),name:Oe.name}})})})},Zn=be,Et=t(94955),jn=t(27047),Wn=function(r){var l=(0,a.YB)(),f=l.formatMessage,m=r.mask,c=r.multipInfo,y=r.form,v=(0,n.useContext)(Ke),ne=v.setMask,ve=v.setLoading,z=(0,n.useRef)(null),ce=function(ue){var O;(O=z.current)===null||O===void 0||O.show((0,_.Z)((0,_.Z)({},ue),{},{detailData:(ue==null?void 0:ue.errors)||[]}))},X=function(ue){var O=ue.success_servers,P=O===void 0?[]:O,se=P==null?void 0:P.map(function(Ye){return Ye.ip});se!=null&&se.length&&y.setFieldsValue({custom_ip:se[0]})},re=function(ue){var O,P=ue.data,se=ue.channelType;return(0,e.jsxs)("span",{children:[(0,e.jsx)("span",{children:(O=P.msg)===null||O===void 0?void 0:O.join("")}),!1]})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(qe.Z.Item,{name:"custom_channel",style:{width:"100%"},rules:m?[]:[{required:!0,message:f({id:"select.suite.custom_channel"})}],children:(0,e.jsx)(jn.k,{style:{width:"100%"},placeholder:c.selfServer?f({id:"select.suite.multiple.values"}):f({id:"select.suite.agent.select"}),onChange:function(ue){ne(!1),ue&&y.validate}})}),(0,e.jsx)(qe.Z.Item,{name:"custom_ip",style:{width:"100%"},validateTrigger:["onBlur"],rules:[{required:!0,message:f({id:"select.suite.custom_ip"})},{validator:function(ue,O){return(0,Ze.Z)((0,Me.Z)().mark(function P(){var se,Ye,I,B;return(0,Me.Z)().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:if(O){xe.next=2;break}return xe.abrupt("return",Promise.resolve(f({id:"select.suite.custom_ip"})));case 2:if(se=y.getFieldValue("custom_channel"),se){xe.next=5;break}return xe.abrupt("return",Promise.reject(f({id:"select.suite.custom_channel"})));case 5:return ve(!0),xe.next=8,(0,ot.oO)({ip:O,channel_type:se});case 8:if(xe.t0=xe.sent,xe.t0){xe.next=11;break}xe.t0={};case 11:if(Ye=xe.t0,I=Ye.code,B=Ye.msg,I===200){xe.next=17;break}return ve(!1),xe.abrupt("return",Promise.reject((0,e.jsx)(re,{data:{msg:B,errors:[O]},channelType:se})));case 17:return Promise.resolve(),ve(!1),xe.abrupt("return");case 20:case"end":return xe.stop()}},P)}))()}}],children:(0,e.jsx)(o.Z,{allowClear:!0,placeholder:c.selfServer?f({id:"select.suite.multiple.values"}):"".concat(f({id:"select.suite.enter.ip"})).concat(""),autoComplete:"off"})}),(0,e.jsx)(Et.Z,{ref:z,callback:X})]})},Bn=Wn,na=(0,n.memo)(function(S){var r=(0,a.YB)(),l=r.formatMessage,f=S.batch,m=S.server_type,c=S.run_mode,y=S.form,v=S.serverType,ne=S.serverObjectType,ve=S.mask,z=S.multipInfo,ce=(0,n.useContext)(Ke),X=ce.setServerObjectType,re=ce.setServerType,je=ce.setMask,ue=ce.settingType,O=ce.setServerList,P=ce.setTagList,se=(0,n.useCallback)(function(B){var $e=B.target;re($e.value),O([])},[]),Ye=(0,n.useCallback)(function(B){O([]),P([]),X(B),je(!1),y.setFieldsValue({server_object_id:void 0})},[]),I=function($e){je(!1),$e==="pool"?(re("pool"),X("ip")):re("custom")};return(0,e.jsxs)(e.Fragment,{children:[!ve&&(0,e.jsx)(qe.Z.Item,{label:ue==="suite"?(0,e.jsx)($.fD,{title:l({id:"select.suite.the.server"}),desc:l({id:"select.suite.the.server.desc"})}):l({id:"select.suite.the.server"}),className:"drawer_padding",children:(0,e.jsxs)(Bt.ZP.Group,{value:v,onChange:se,children:[(0,e.jsx)(Bt.ZP,{value:"pool",children:(0,e.jsx)(a._H,{id:"select.suite.the.server.pool"})}),m!=="aliyun"&&c==="standalone"&&(0,e.jsx)(Bt.ZP,{value:"custom",children:(0,e.jsx)(a._H,{id:"select.suite.self.owned.server"})})]})}),ve&&f&&(0,e.jsxs)(qe.Z.Item,{className:"drawer_padding",label:(0,e.jsx)(a._H,{id:"select.suite.the.server"}),children:[(0,e.jsxs)("label",{className:"ant-radio-wrapper",onClick:function(){return I("pool")},children:[(0,e.jsx)("span",{className:"ant-radio ant-radio-checked",children:(0,e.jsx)("span",{className:"ant-radio-inner ".concat(z.serverPool?"":C().serverItemUncheckeds),style:{borderColor:"#d9d9d9"}})}),(0,e.jsx)("span",{children:(0,e.jsx)(a._H,{id:"select.suite.the.server.pool"})})]}),m!=="aliyun"&&c==="standalone"&&(0,e.jsxs)("label",{className:"ant-radio-wrapper",onClick:function(){return I("self")},children:[(0,e.jsx)("span",{className:"ant-radio ant-radio-checked",children:(0,e.jsx)("span",{className:"ant-radio-inner ".concat(z.selfServer?"":C().serverItemUnchecked),style:{borderColor:"#d9d9d9"}})}),(0,e.jsx)("span",{children:(0,e.jsx)(a._H,{id:"select.suite.self.owned.server"})})]})]}),(0,e.jsx)(Be.Z,{style:{marginBottom:8},className:"drawer_padding",gutter:8,children:v==="pool"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ot.Z,{span:10,children:(0,e.jsxs)(pt.Z,{style:{width:"100%"},value:ne,onChange:Ye,placeholder:l({id:"select.suite.multiple.values"}),children:[(0,e.jsx)(pt.Z.Option,{value:"ip",children:(0,e.jsx)(a._H,{id:"select.suite.random"})}),m==="aliyun"&&c==="standalone"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(pt.Z.Option,{value:"instance",title:l({id:"select.suite.instance"}),children:(0,e.jsx)(a._H,{id:"select.suite.instance"})}),(0,e.jsx)(pt.Z.Option,{value:"setting",title:l({id:"select.suite.setting"}),children:(0,e.jsx)(a._H,{id:"select.suite.setting"})})]}):(0,e.jsx)(pt.Z.Option,{value:"server_object_id",children:(0,e.jsx)(a._H,{id:"select.suite.server_object_id"})}),(0,e.jsx)(pt.Z.Option,{value:"server_tag_id",children:(0,e.jsx)(a._H,{id:"select.suite.server_tag_id"})})]})}),(0,e.jsxs)(Ot.Z,{span:14,children:[(ne==="ip"||!ne)&&(0,e.jsx)(o.Z,{title:l({id:"select.suite.randomly.schedule"}),style:{width:"100%"},autoComplete:"off",disabled:!0,placeholder:l({id:"select.suite.randomly.schedule"})}),ne&&ne!=="ip"&&ne!=="server_tag_id"&&(0,e.jsx)(Dt,(0,_.Z)({},S)),ne==="server_tag_id"&&(0,e.jsx)(Zn,(0,_.Z)({},S))]})]}):(0,e.jsx)(Bn,(0,_.Z)({},S))}),(0,e.jsx)(qe.Z.Item,{name:"timeout",label:(0,e.jsx)($.fD,{title:"Timeout",desc:l({id:"select.suite.timeout"})}),className:"drawer_padding",children:(0,e.jsx)(ft.Z,{formatter:$.zW,style:{width:"100%"},min:0,step:1,placeholder:z!=null&&z.timeout?l({id:"select.suite.multiple.values"}):l({id:"select.suite.please.enter"})})}),(0,e.jsx)(qe.Z.Item,{name:"repeat",label:(0,e.jsx)($.fD,{title:"Repeat",desc:"".concat(l(ue==="suite"?{id:"select.suite.repeat.tootip1"}:{id:"select.suite.repeat.tootip2"}))}),className:"drawer_padding",children:(0,e.jsx)(ft.Z,{style:{width:"100%"},min:1,step:1,formatter:$.zW,max:1e4,placeholder:l({id:z.repeat?"select.suite.multiple.values":"please.enter"})})}),ue==="suite"&&(0,e.jsx)("div",{style:{height:8,background:"rgba(0,0,0,0.03)",width:"100%",marginBottom:8}})]})}),aa=t(73171),ra=["custom_channel","custom_ip","server_object_id","server_tag_id","repeat","timeout"],Vn,zn,sa=(0,Xe.ZP)(Zt.Z)(Vn||(Vn=(0,we.Z)([`
    .ant-form-item {
        margin-bottom: 8px;
    }
    .ant-drawer-body {
        padding: 0;
    }
    .ant-form {
        padding: 13px 0;
    }
    .ant-drawer-header {
        padding: 16px 14px 8px;
    }
    .drawer_padding {
        padding-left: 20px;
        padding-right: 20px;
    }
`]))),ia=Xe.ZP.div(zn||(zn=(0,we.Z)([`
    font-size: 12px;
    color: rgba(0,0,0,.65);
    margin-top: 4px;
    margin-right: 14px;
    word-wrap: break-word;
    word-break: break-all;
    overflow: hidden;
`]))),Jn=function(r){return Object.prototype.toString.call(r)},la=function(r){var l=Jn(r);if(l==="[object Array]"&&JSON.stringify(r)!=="[]"){var f=r.reduce(function(m,c){var y=Jn(c);if(JSON.stringify(c)!=="{}"&&y==="[object Object]"){var v=Object.keys(c).reduce(function(ne,ve){var z=c[ve];return z!=null&&z!==""&&(ne[ve]=z),ne},{});return JSON.stringify(v)!=="{}"?m.concat(v):m}return m},[]);return f.length>0?f:void 0}},Gn=function(r){return Object.keys(r).reduce(function(l,f){if(f==="server_tag_id"&&JSON.stringify(r[f])!=="[]"){var m=r[f].reduce(function(y,v){return JSON.stringify(v)!=="[]"?y.concat(v.toString()):y},[]),c=m;m.length>0&&(c=T().uniq(m).map(function(y){return y.split(",").map(function(v){return Number(v)})})),l[f]=c}else l[f]=T().uniq(r[f]).reduce(function(y,v){return T().isArray(v)?(JSON.stringify(v)==="[]"||y.push(v),y):v!=null&&v!==""?y.concat(v):y},[]);return l},{})},$n=function(r){var l=Object.keys(r).reduce(function(f,m){var c=r[m];return m==="env_info"?(f[m]=[{val:"",name:""}],f):(c&&c.length===0||c&&c.length>1||(f[m]=c&&c[0]),f)},{});return l.custom_ip&&l.custom_channel?l:(0,_.Z)((0,_.Z)({},l),{},{custom_ip:null,custom_channel:null})},Yn=function(r){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,f={},m=function ne(ve){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ve.reduce(function(ce,X){return Object.keys(X).forEach(function(re){var je=X[re];re==="test_case_list"?f=ne(je,f):re in ce?T().isArray(je)?ce[re].push(je):ce[re]=ce[re].concat(je):ce[re]=[je]}),ce},z)},c=m(r),y=Gn(c);if(l){var v=Gn(f);return{suiteMultip:y,caseMultip:v}}return{suiteMultip:y}},oa=function(r,l){var f,m=(0,a.YB)(),c=m.formatMessage,y=r.contrl,v=r.checked,ne=r.server_type,ve=r.test_type,z=r.run_mode,ce=r.onDataSourceChange,X=r.testSuiteData,re=r.onOk,je=(0,n.useState)("pool"),ue=(0,i.Z)(je,2),O=ue[0],P=ue[1],se=(0,n.useState)("ip"),Ye=(0,i.Z)(se,2),I=Ye[0],B=Ye[1],$e=(0,n.useState)(null),xe=(0,i.Z)($e,2),Ie=xe[0],jt=xe[1],ut=qe.Z.useForm(),Oe=(0,i.Z)(ut,1),me=Oe[0],Ue=(0,n.useState)(void 0),Ae=(0,i.Z)(Ue,2),De=Ae[0],We=Ae[1],Ee=(0,n.useState)(!1),Qe=(0,i.Z)(Ee,2),Re=Qe[0],tt=Qe[1],it=(0,n.useState)(!0),xt=(0,i.Z)(it,2),At=xt[0],Ht=xt[1],yt=(0,n.useState)(!1),Qt=(0,i.Z)(yt,2),ye=Qt[0],x=Qt[1],K=(0,n.useState)(!1),k=(0,i.Z)(K,2),Z=k[0],j=k[1],q=(0,n.useState)([]),ie=(0,i.Z)(q,2),D=ie[0],_t=ie[1],He=(0,n.useState)([]),Rt=(0,i.Z)(He,2),Kt=Rt[0],ee=Rt[1],F=(0,n.useState)(null),Ce=(0,i.Z)(F,2),R=Ce[0],pe=Ce[1],Cn=(0,n.useState)(null),mn=(0,i.Z)(Cn,2),an=mn[0],xn=mn[1],En=(0,n.useMemo)(function(){return(0,$.O6)(R)},[R]),wn=(0,n.useMemo)(function(){return(0,$.O6)(an)},[an,R]),Ln=function(b){var U=b.server_object_id,le=b.server_tag_id,d=b.ip,s=b.is_instance,u=b.customer_server,g=location.search.indexOf("inheriting_machine")!==-1;if(T().isNull(d)){B("ip");return}if(u&&JSON.stringify(u)!=="{}"){var M=u.custom_ip,fe=u.custom_channel;M&&fe&&(B("ip"),P("custom"));return}if(g&&d){ne==="aliyun"&&z==="standalone"?(s===0&&B("setting"),s===1&&B("instance")):B("server_object_id");return}if(Array.isArray(le)&&le.length||U){P("pool"),U&&(ne==="aliyun"&&z==="standalone"?(s===0&&B("setting"),s===1&&B("instance")):B("server_object_id")),T().isEmpty(le)||B("server_tag_id");return}B("ip")};(0,n.useEffect)(function(){if(De){var Ne={repeat:ve==="performance"?3:1,need_reboot:!1,setup_info:"",cleanup_info:"",console:!0,priority:10,timeout:3600};if(Re)if(Ie==="suite"){var b=Yn(De,!0),U=b.suiteMultip,le=b.caseMultip;pe(le),xn(U);var d=$n(le),s=$n(U),u=d.custom_channel,g=d.custom_ip,M=d.ip,fe=d.server_object_id,Te=d.server_tag_id,vt=d.repeat,Ve=d.timeout,ze={custom_channel:u,custom_ip:g,ip:M,server_object_id:fe,server_tag_id:Te,repeat:vt,timeout:Ve};Ln(ze),me.setFieldsValue((0,_.Z)((0,_.Z)({},s),ze))}else{var on=Yn(De),pn=on.suiteMultip;pe(pn);var An=$n(pn),Hn=An.env_info;An.env_info=!Hn||Hn.length===0?[{val:"",name:""}]:Hn,me.setFieldsValue(An)}else{var Nn=(0,_.Z)((0,_.Z)({},Ne),De);De.console==null&&(Nn.console=!0);var kn=De.env_info;kn&&kn.length===0&&(Nn.env_info=new Array(1).fill({val:"",name:""})),Ln(Nn),me.setFieldsValue(Nn)}}},[Re,De,ne,Ie]),(0,n.useImperativeHandle)(l,function(){return{show:function(b,U){jt(b);var le=T().isArray(U);x(!0),We(U),tt(le),Ht(!1)}}});var Fn=(0,n.useCallback)(function(){me.resetFields(),x(!1),We(null),tt(!1),Ht(!0),pe(null),xn(null),_t([]),ee([]),j(!1),P("pool"),B("ip"),jt("case")},[]),ct=function(b){for(var U="",le=0,d=D.length;le<d;le++){var s=D[le];if(s.id===b){I==="server_object_id"&&(U=z==="cluster"?s.name:s.ip||s.sn),I==="instance"&&(U=s.private_ip?s.private_ip:s.instance_name),I==="setting"&&(U=s.template_name);break}}return U},de=function(b){return b.reduce(function(U,le,d){for(var s=Kt.length,u=0;u<s;u++)if(Kt[u].id===le)return U+="".concat(Kt[u].name).concat(d+1<b.length?",":"");return""},"")},A=function(){return O==="custom"},Mt=function(){return!A()&&I==="server_tag_id"},wt=function(){return!A()&&I&&I!=="server_tag_id"&&I!=="ip"},$t=function(){return!A()&&I==="ip"},Tt=function(b,U){var le=U.custom_channel,d=U.custom_ip,s=U.server_object_id,u=U.server_tag_id,g=null;A()?le&&d&&(g=d):($t()&&(g="\u968F\u673A"),wt()&&(g=ct(s)),Mt()&&(g=de(u)));var M=void 0;I==="instance"&&(M=1),I==="setting"&&(M=0);var fe=(0,_.Z)((0,_.Z)({},U),{},{ip:g,is_instance:M}),Te=(0,_.Z)((0,_.Z)({},b),Object.keys(fe).reduce(function(Ve,ze){var on=fe[ze];if(ze==="env_info"){var pn=la(on);return Ve[ze]=pn,Ve}return Ve[ze]=on!=null?on:b[ze],Ve},{})),vt=(0,_.Z)((0,_.Z)({},Te),{},{custom_channel:null,custom_ip:null,customer_server:null,server_object_id:null,server_tag_id:[]});return Z?Te:A()?(0,_.Z)((0,_.Z)({},vt),{},{customer_server:{custom_channel:le,custom_ip:d},custom_channel:le,custom_ip:d}):Mt()?(0,_.Z)((0,_.Z)({},vt),{},{server_tag_id:u}):wt()?(0,_.Z)((0,_.Z)({},vt),{},{server_object_id:s}):vt},Xt=function(){me.validateFields().then(function(b){var U=b.custom_channel,le=b.custom_ip,d=b.server_object_id,s=b.server_tag_id,u=b.repeat,g=b.timeout,M=(0,dn.Z)(b,ra),fe={custom_channel:U,custom_ip:le,server_object_id:d,server_tag_id:s,repeat:u,timeout:g},Te=Re?De.map(function(Ve){return Ve.id}):[De.id],vt=[];Ie==="suite"?Re?vt=X.reduce(function(Ve,ze){return Ve.concat(Te.includes(ze.id)?(0,_.Z)((0,_.Z)((0,_.Z)({},ze),M),{},{test_case_list:ze.test_case_list.reduce(function(on,pn){return on.concat(Tt(pn,fe))},[])}):ze)},[]):vt=X.map(function(Ve){return Ve.id===De.id?(0,_.Z)((0,_.Z)({},Ve),M):Ve}):vt=X.reduce(function(Ve,ze){return Ve.concat((0,_.Z)((0,_.Z)({},ze),{},{test_case_list:ze.test_case_list.reduce(function(on,pn){if(Te.includes(pn.id)){var An=Tt(pn,b);return on.concat(An)}return on.concat(pn)},[])}))},[]),ce(vt,z),Fn(),re()}).catch(function(b){return console.log(b)})},nt=(0,n.useMemo)(function(){if(Re&&R){var Ne=R.ip,b=R.custom_ip,U=R.repeat,le=R.server_tag_id,d=R.server_object_id,s=R.is_instance,u=R.timeout,g=d?d.length:0,M=le?le.length:0,fe=b?b.length:0,Te=Array.isArray(Ne)?Ne.filter(function(ze){return ze==="\u968F\u673A"}):[],vt=g+M+Te.length>1,Ve=fe>1;return(Ve||vt)&&j(!0),!vt&&!Ve&&(P("pool"),g===1&&(B("server_object_id"),ne==="aliyun"&&(s&&s.length===1&&z==="standalone"?B(s[0]===1?"instance":"setting"):B("server_object_id"))),M===1&&B("server_tag_id"),fe===1&&P("custom"),Te.length===1&&B("ip")),!vt&&Ve&&P("custom"),g+M+Te.length>=1&&fe>=1&&(j(!0),P("pool"),B("ip"),Ve=!0,vt=!0),vt&&B(null),{serverPool:vt,selfServer:Ve,repeat:U.length>1,server_tag_id:M>1,server_object_id:g>1,random:Te.length>1,timeout:u.length>1,setup_info:Ie==="suite"?an.setup_info.length>1:R.setup_info.length>1,cleanup_info:Ie==="suite"?an.cleanup_info.length>1:R.cleanup_info.length>1}}return{serverPool:!1,selfServer:!1,repeat:!1,cleanup_info:!1,setup_info:!1,timeout:!1}},[R,Re,ne,Ie,an,z]),ht=qe.Z.useWatch("env_info",me),rn=function(b,U){var le=me.getFieldValue(["env_info",U.name,"name"]),d=me.getFieldValue(["env_info",U.name,"val"]);if(b==="name")for(var s in ht){var u;if(+s!==U.name&&((u=ht[s].name)===null||u===void 0?void 0:u.trim())===(le==null?void 0:le.trim()))return Promise.reject(c({id:"ws.test.job.variable.name.repeat"}))}return b==="name"&&le||b==="val"&&d?Promise.resolve():!le&&d?Promise.reject(c({id:"ws.test.job.variable.name.empty"})):le&&!d?Promise.reject(c({id:"ws.test.job.variable.value.empty"})):(me.setFields([{name:["env_info",U.name,"name"],errors:[]},{name:["env_info",U.name,"val"],errors:[]}]),Promise.resolve())};return(0,e.jsx)(sa,{maskClosable:!1,keyboard:!1,title:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"".concat(c(Re?{id:"select.suite.batch.config"}:{id:"select.suite.config"})," ").concat(Ie==="suite"?"Suite":"Conf")}),!Re&&(0,e.jsx)(ia,{children:De==null?void 0:De.title})]}),width:376,forceRender:!0,destroyOnClose:!0,onClose:Fn,open:ye,bodyStyle:{paddingBottom:80,overflowX:"hidden"},footer:(0,e.jsxs)("div",{style:{textAlign:"right",padding:"0 8px"},children:[(0,e.jsx)(W.Z,{onClick:Fn,style:{marginRight:8},children:(0,e.jsx)(a._H,{id:"operation.cancel"})}),(0,e.jsx)(W.Z,{onClick:Xt,type:"primary",children:(0,e.jsx)(a._H,{id:"operation.ok"})})]}),children:(0,e.jsx)(lt.Z,{spinning:At,children:(0,e.jsx)(Ke.Provider,{value:{setLoading:Ht,setServerList:_t,setTagList:ee,setServerType:P,setServerObjectType:B,setMask:j,settingType:Ie},children:(0,e.jsxs)(qe.Z,{layout:"vertical",form:me,scrollToFirstError:!0,children:[(Ie==="suite"&&wn||En)&&(0,e.jsx)("div",{style:{padding:"0 20px 8px"},children:(0,e.jsx)(J.Z,{message:(0,e.jsx)(a._H,{id:"select.suite.vertical.message"}),type:"warning",showIcon:!0,style:{fontSize:12,padding:"5px 10px"}})}),(Re||Ie==="case")&&(0,e.jsx)(na,(0,_.Z)((0,_.Z)({},r),{},{form:me,dataSource:De,visible:ye,multipInfo:nt,loading:At,serverList:D,tagList:Kt,serverType:O,serverObjectType:I,mask:Z,batch:Re})),y.includes("variable")&&v&&Ie==="case"&&(0,e.jsx)(qe.Z.Item,{label:(0,e.jsx)(a._H,{id:"select.suite.variable"}),className:"drawer_padding",children:(0,e.jsx)(qe.Z.List,{name:"env_info",children:function(b,U){var le=U.add,d=U.remove;return(0,e.jsxs)(Be.Z,{children:[b.map(function(s,u){var g=ht[u]||{},M=g.is_sys;return(0,e.jsxs)(Be.Z,{children:[(0,e.jsx)("div",{style:{width:"90%",marginRight:8},children:(0,e.jsxs)(G.Z,{style:{marginBottom:8},align:"start",children:[(0,e.jsx)(qe.Z.Item,{name:[s.name,"name"],rules:[{validator:function(){return rn("name",s)}}],children:(0,e.jsx)(o.Z,{disabled:!!M,autoComplete:"off",placeholder:c({id:"ws.test.job.variable.name"}),allowClear:!0})}),(0,e.jsx)("span",{style:{marginTop:5,display:"block"},children:"="}),(0,e.jsx)(qe.Z.Item,{name:[s.name,"val"],rules:[{validator:function(){return rn("val",s)}}],children:(0,e.jsx)(o.Z,{autoComplete:"off",placeholder:c({id:"ws.test.job.variable.value"}),allowClear:!0})})]})}),!M&&b.length>1&&(0,e.jsx)(aa.Z,{onClick:function(){return d(u)},style:{marginTop:10}})]},s.key)}),(0,e.jsx)(W.Z,{type:"link",onClick:function(){return le({name:""})},size:"small",style:{padding:0,fontSize:12},children:"+ \u6DFB\u52A0\u53D8\u91CF"})]})}})}),y.includes("reboot")&&v&&(0,e.jsx)(qe.Z.Item,{label:(0,e.jsx)(a._H,{id:"select.suite.need_reboot"}),name:"need_reboot",className:"drawer_padding",children:(0,e.jsxs)(Bt.ZP.Group,{children:[(0,e.jsx)(Bt.ZP,{value:!0,children:(0,e.jsx)(a._H,{id:"operation.yes"})}),(0,e.jsx)(Bt.ZP,{value:!1,children:(0,e.jsx)(a._H,{id:"operation.no"})})]})}),y.includes("script")&&v&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(qe.Z.Item,{name:"setup_info",label:(0,e.jsx)(a._H,{id:"select.suite.setup_info"}),className:"drawer_padding",children:(0,e.jsx)(o.Z.TextArea,{rows:4,placeholder:nt.setup_info?c({id:"select.suite.setup_info.placeholder"}):c({id:"select.suite.please.enter"})})}),(0,e.jsx)(qe.Z.Item,{name:"cleanup_info",label:(0,e.jsx)(a._H,{id:"select.suite.cleanup_info"}),className:"drawer_padding",children:(0,e.jsx)(o.Z.TextArea,{rows:4,placeholder:nt.cleanup_info?c({id:"select.suite.cleanup_info.placeholder"}):c({id:"select.suite.please.enter"})})})]}),(0,e.jsx)(qe.Z.Item,{name:"priority",label:(0,e.jsx)($.fD,{title:c({id:"select.suite.priority"}),desc:c({id:"select.suite.priority.desc"})}),className:"drawer_padding",children:(0,e.jsx)(ft.Z,{formatter:$.zW,style:{width:"100%"},min:0,step:1,max:20,placeholder:(R==null||(f=R.priority)===null||f===void 0?void 0:f.length)>1?c({id:"select.suite.multiple.values"}):c({id:"select.suite.please.enter"})})})]})})})})},ua=(0,n.memo)((0,n.forwardRef)(oa)),Qn=t(59465),ca=t(44378),da=t(68002),fa=t(32059),va=t(85450),ma=function(S){var r=S.styleObj,l=S.record,f=S.disabled,m=S.columnsInner,c=S.selectedSuiteKeys,y=S.setSelectedCaseKeysFn,v=S.selectedCaseObj,ne=S.onColumnsChange,ve=S.columnsChange,z=S.refreshDeps,ce=(0,n.useState)([]),X=(0,i.Z)(ce,2),re=X[0],je=X[1],ue={selectedRowKeys:re,onChange:function(P){je(P),y((0,fa.Z)({},l.id,P))},getCheckboxProps:function(){return{disabled:c.length>0}}};return(0,n.useEffect)(function(){v[l.id]!==re&&je(v[l.id]||[])},[v]),(0,e.jsx)(va.sL,{style:r,hasChange:ve,rowKey:function(P){return P.id+""},refreshDeps:z,className:C().conf_table,rowSelection:f?void 0:ue,columns:m,onColumnsChange:ne,rowClassName:function(P,se){return se%2==0?"inner-odd":"inner-even"},name:"ws-test-job-suite-inner",dataSource:l.test_case_list||[],pagination:!1})},Mn=t(10753),Xn=100,pa=function(r){var l=r.dataSource,f=r.onDataSourceChange,m=r.width,c=r.disabled,y=r.run_mode,v=r.contrl,ne=r.control,ve=r.server_type,z=r.test_type,ce=(0,a.YB)(),X=ce.formatMessage,re=(0,n.useRef)(null),je=(0,n.useState)(!0),ue=(0,i.Z)(je,2),O=ue[0],P=ue[1],se=(0,n.useState)(!0),Ye=(0,i.Z)(se,2),I=Ye[0],B=Ye[1],$e=(0,n.useState)([]),xe=(0,i.Z)($e,2),Ie=xe[0],jt=xe[1],ut=(0,n.useState)([]),Oe=(0,i.Z)(ut,2),me=Oe[0],Ue=Oe[1],Ae=(0,n.useState)({}),De=(0,i.Z)(Ae,2),We=De[0],Ee=De[1],Qe=(0,n.useState)([]),Re=(0,i.Z)(Qe,2),tt=Re[0],it=Re[1],xt=(0,n.useState)({}),At=(0,i.Z)(xt,2),Ht=At[0],yt=At[1],Qt=(0,n.useState)(!1),ye=(0,i.Z)(Qt,2),x=ye[0],K=ye[1],k=(0,n.useState)(!1),Z=(0,i.Z)(k,2),j=Z[0],q=Z[1],ie=(0,n.useState)([]),D=(0,i.Z)(ie,2),_t=D[0],He=D[1],Rt=(0,n.useState)(!1),Kt=(0,i.Z)(Rt,2),ee=Kt[0],F=Kt[1],Ce=(0,n.useState)(!1),R=(0,i.Z)(Ce,2),pe=R[0],Cn=R[1],mn=function(s){var u=s.target.checked;if(q(u),F(!1),K(!1),Ee({}),u){var g=l.map(function(M){return M.id+""});jt(g),He(g)}else jt([])},an=function(s){f(l.filter(function(u){return u.id!==s}),y)},xn=function(s){var u=l.filter(function(g){var M=g.test_case_list.filter(function(Te){if(s!==Te.id)return Te});if(M.length>0){var fe=g;return fe.test_case_list=M,fe}});f(u,y)},En=function(s,u){var g;return(g=re.current)===null||g===void 0?void 0:g.show("suite",u)},wn=function(s,u){var g;return(g=re.current)===null||g===void 0?void 0:g.show("case",u)},Ln=[{title:"Test Conf",dataIndex:"title",width:200,ellipsis:{shwoTitle:!1},fixed:"left",render:function(s){return(0,e.jsx)(Mn.K,{ellipsis:{tooltip:!0},children:s||"-"})}},{title:(0,e.jsx)(a._H,{id:"select.suite.the.server"}),ellipsis:{shwoTitle:!1},key:"server",width:150,render:function(s,u){var g=X({id:"select.suite.random"}),M=u.server_tag_id,fe=u.ip,Te=u.customer_server;if(M&&M.length>0){var vt=fe?fe.split(",").map(function(ze){return(0,e.jsx)(gt.Z,{children:ze},ze)}):g;return(0,e.jsx)(Mn.K,{ellipsis:{tooltip:!0},children:vt})}if((0,h.isNull)(fe)&&Te&&JSON.stringify(Te)!=="{}")return(0,e.jsx)(Mn.K,{ellipsis:{tooltip:!0},children:(Te==null?void 0:Te.custom_ip)||""});var Ve=fe&&!["\u968F\u673A"].includes(fe)?fe:g;return(0,e.jsx)(Mn.K,{ellipsis:{tooltip:!0},children:Ve||"-"})}},{title:(0,e.jsx)(a._H,{id:"select.suite.table.timeout"}),dataIndex:"timeout",width:130},{title:"Repeat",dataIndex:"repeat",width:80},I&&"reboot"in v&&{title:(0,e.jsx)(a._H,{id:"select.suite.restart"}),dataIndex:"reboot",render:function(s,u){return X({id:"operation.".concat(u.need_reboot?"yes":"no")})},width:80},I&&"script"in v&&{title:(0,e.jsx)(a._H,{id:"select.suite.script"}),width:100,dataIndex:"script",render:function(s,u){var g=X({id:"select.suite.before.restart"}),M=X({id:"select.suite.after.restart"});return u.setup_info||u.cleanup_info?(0,e.jsx)(Mn.K,{ellipsis:{tooltip:!0},children:"".concat(g,":").concat(u.setup_info||"-","\uFF0C").concat(M,":").concat(u.cleanup_info||"-")}):"-"}},I&&"variable"in v&&{title:(0,e.jsx)(a._H,{id:"select.suite.variable"}),dataIndex:"variable",width:150,render:function(s,u){if(u.env_info&&u.env_info.length>0){var g=u.env_info.map(function(M){return M.name?"".concat(M.name||"","=").concat(M.val||"",";"):"-"});return(0,e.jsx)(Mn.K,{ellipsis:{tooltip:!0},children:g})}return"-"}},{title:(0,e.jsx)(a._H,{id:"select.suite.priority"}),dataIndex:"priority",width:80},{title:(0,e.jsx)(a._H,{id:"Table.columns.operation"}),dataIndex:"operation",width:Xn,fixed:"right",render:function(s,u,g){return!c&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(W.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return wn(g,u)},children:(0,e.jsx)(a._H,{id:"select.suite.config"})}),(0,e.jsx)(Qn.Z,{className:C().remove,onClick:function(){return xn(u.id)}})]})}}],Fn=[{title:"Test Suite",dataIndex:"title",fixed:"left",ellipsis:{shwoTitle:!1},render:function(s){return(0,e.jsx)(Mn.K,{ellipsis:{tooltip:!0},children:s||"-"})}},I&&"reboot"in v&&{title:X({id:"select.suite.restart"}),dataIndex:"reboot",width:80,render:function(s,u){return X({id:"operation.".concat(u.need_reboot?"yes":"no")})}},I&&"script"in v&&{title:X({id:"select.suite.script"}),dataIndex:"script",width:150,render:function(s,u){var g=u.setup_info,M=u.cleanup_info,fe=X({id:"select.suite.before.restart"}),Te=X({id:"select.suite.after.restart"});return g||M?(0,e.jsx)(Mn.K,{ellipsis:{tooltip:!0},children:"".concat(fe,":").concat(g||"-","\uFF0C").concat(Te,":").concat(M||"-")}):"-"}},I&&{title:X({id:"select.suite.priority"}),width:80,dataIndex:"priority"},{title:X({id:"Table.columns.operation"}),width:Xn,dataIndex:"operation",fixed:"right",render:function(s,u,g){return!c&&(0,e.jsxs)(e.Fragment,{children:[I&&(0,e.jsx)(W.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return En(g,u)},children:(0,e.jsx)(a._H,{id:"select.suite.config"})}),(0,e.jsx)(Qn.Z,{className:C().remove,style:I?{marginTop:6,padding:0}:{margin:0,paddingRight:6,width:60,textAlign:"right"},onClick:function(){return an(u.id)}})]})}}];(0,n.useEffect)(function(){l.map(function(d){d.isAdvancedConfig&&B(!0)})},[l]);var ct={selectedRowKeys:Ie,onChange:function(s){jt(s),K(!!s.length&&s.length<l.length),q(s.length==l.length)},getCheckboxProps:function(){return{disabled:me.length>0}}},de=function(s){var u=T().cloneDeep(We)||{};u=(0,_.Z)((0,_.Z)({},u),s),Ee(u)};(0,n.useEffect)(function(){var d=[];Object.values(We).forEach(function(u){d=d.concat(u)});var s=tt.length;Cn(!!d.length&&d.length<s),F(d.length==s),Ue(d)},[We]),(0,n.useEffect)(function(){var d={};Object.keys(We).forEach(function(s){if(Ht[s]){var u=We[s].filter(function(g){if(tt.indexOf(g)>-1)return g});d[s]=u}}),Ee(d)},[tt]);var A=function(s){var u=s.target.checked;q(!1),jt([]),u?(Ee(Ht),He(l.map(function(g){return g.id+""}))):Ee({})},Mt=function(){var s,u=[];l.map(function(g){me.map(function(M){u=u.concat(g.test_case_list.filter(function(fe){return fe.id==M}))})}),(s=re.current)===null||s===void 0||s.show("case",u)},wt=function(){var s,u=[];l.forEach(function(g){Ie.map(function(M){g.id==M&&u.push(g)})}),(s=re.current)===null||s===void 0||s.show("suite",u)};(0,n.useEffect)(function(){var d=[],s={};l.forEach(function(u){d=d.concat(u.test_case_list.map(function(g){return g.id+""})),s[u.id]=u.test_case_list.map(function(g){return g.id+""})}),it(d),yt(s)},[m,c,l]);var $t=function(s){B(s)},Tt=function(){if(Ie.length===0&&me.length===0){P(!1);return}return Ie.length>0&&wt(),me.length>0&&Mt(),P(!0)},Xt=function(s,u,g,M){var fe=u.id+"";He(s?_t.filter(function(Te){return Te!==fe}):_t.concat([fe])),M(u,g)},nt=function(){P(!0)},ht=(0,n.useMemo)(function(){return Ln.reduce(function(d,s){return d+(s==null?void 0:s.width)},0)},[Ln]),rn=function(){Ee({}),jt([]),q(!1),F(!1),K(!1)},Ne=n.useState((0,he.Z)()),b=(0,i.Z)(Ne,2),U=b[0],le=b[1];return(0,e.jsxs)("div",{style:y==="standalone"?{marginBottom:10,position:"relative"}:{position:"relative"},children:[(0,e.jsxs)(Be.Z,{justify:"space-between",align:"middle",children:[(0,e.jsx)("span",{className:C().title,children:y==="standalone"?(0,e.jsx)(a._H,{id:"select.suite.standalone"}):(0,e.jsx)(a._H,{id:"select.suite.cluster"})}),l.length>0&&!c&&(0,e.jsxs)(G.Z,{style:{height:"32px"},children:[(0,e.jsx)("span",{className:C().title,children:(0,e.jsx)(a._H,{id:"select.suite.advanced.config"})}),(0,e.jsx)(ln.Z,{size:"small",checked:I,onChange:$t})]})]}),!c&&(0,e.jsxs)(Be.Z,{justify:"space-between",align:"middle",className:C().batch_setting_table_bar,children:[(0,e.jsxs)(G.Z,{children:[(0,e.jsx)(p.Z,{indeterminate:x,checked:j,onChange:mn,disabled:!I,children:(0,e.jsx)(a._H,{id:"select.suite.selectAll.suites"})}),(0,e.jsx)(p.Z,{indeterminate:pe,checked:ee,onChange:A,children:(0,e.jsx)(a._H,{id:"select.suite.selectAll.conf"})})]}),(0,e.jsx)(It.Z,{title:(0,e.jsx)("span",{onClick:function(){return P(!0)},style:{cursor:"pointer"},children:(0,e.jsx)(a._H,{id:"select.suite.select.suite/conf"})}),open:!O,children:(0,e.jsx)(W.Z,{size:"small",type:"primary",onClick:Tt,onMouseLeave:nt,children:(0,e.jsx)(a._H,{id:"select.suite.batch.config"})})})]}),(0,e.jsx)(St.Z,{bodyStyle:{width:"100%"},children:(0,e.jsx)(ae.Z,{style:{width:m-2},rowSelection:I?ct:void 0,showHeader:I,columns:Fn.filter(Boolean),pagination:!1,className:C().suite_table_loading,scroll:I?{x:ht}:void 0,size:"small",rowKey:function(s){return s.id+""},dataSource:l,rowClassName:function(s,u){return u%2==0?"outter outter-odd":"outter outter-even"},expandable:{expandedRowKeys:_t,columnWidth:22,expandedRowRender:function(s){return(0,e.jsx)(ma,{styleObj:{width:m-14},scroll:I?{x:ht}:void 0,record:s,refreshDeps:[I,v,c,U,l],disabled:c,selectedCaseObj:We,columnsInner:Ln.filter(Boolean),checked:I,contrl:v,columnsChange:U,onColumnsChange:function(){return le((0,he.Z)())},selectedSuiteKeys:Ie,setSelectedCaseKeysFn:de})},expandIcon:function(s){var u=s.expanded,g=s.onExpand,M=s.record;return u?(0,e.jsx)(ca.Z,{onClick:function(Te){return Xt(u,M,Te,g)}}):(0,e.jsx)(da.Z,{onClick:function(Te){return Xt(u,M,Te,g)}})}}})}),(0,e.jsx)(ua,{ref:re,test_type:z,server_type:ve,run_mode:y,contrl:ne,checked:I,onDataSourceChange:f,testSuiteData:l,onOk:rn})]})},qn=pa,ea,_a=(0,Xe.ZP)(J.Z)(ea||(ea=(0,we.Z)([`
    display: flex !important;
    align-items: start !important;
    & .anticon.anticon-exclamation-circle.ant-alert-icon {
        margin-top: 4px;
    }
    & .ant-alert-close-icon {
        margin-top: 5px;
    }
`]))),ha=function(r,l){return["ips","instance_name"].includes(r)?l==null?void 0:l.map(function(f){var m=f.ip,c=f.sn;return"".concat(m,"/").concat(c)}):l==null?void 0:l.map(function(f){var m=f.name;return m})},ga=function(r){var l=r.sources,f=r.isDelete,m=(0,a.YB)();return l?JSON.stringify(l)==="{}"?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)(e.Fragment,{children:Object.keys(l).map(function(c){return(c==null?void 0:c.length)>0&&(0,e.jsx)(_a,{showIcon:!0,type:"warning",closable:!0,message:(0,e.jsxs)(G.Z,{wrap:!0,children:[ha(c,l[c]).map(function(y){return(0,e.jsx)(w.Z.Text,{children:y},(0,he.Z)())}),(0,e.jsx)(w.Z.Text,{children:m.formatMessage({id:"select.suite.".concat(f?"removed":"existent")})})]})},(0,he.Z)())}).filter(Boolean)}):(0,e.jsx)(e.Fragment,{})},ta=ga,ja=function(r){var l=r.handleData,f=r.contrl,m=r.test_type,c=r.business_type,y=r.template,v=y===void 0?{}:y,ne=r.disabled,ve=ne===void 0?!1:ne,z=r.onRef,ce=r.server_type,X=r.setPageLoading,re=r.caseDataRef,je=(0,a.YB)(),ue=je.formatMessage,O=(0,L.UO)(),P=O.ws_id,se=(0,n.useRef)(null),Ye=(0,n.useRef)(null),I=(0,n.useState)(!0),B=(0,i.Z)(I,2),$e=B[0],xe=B[1],Ie=(0,n.useState)([]),jt=(0,i.Z)(Ie,2),ut=jt[0],Oe=jt[1],me=(0,n.useState)(0),Ue=(0,i.Z)(me,2),Ae=Ue[0],De=Ue[1],We=(0,n.useState)([]),Ee=(0,i.Z)(We,2),Qe=Ee[0],Re=Ee[1],tt=(0,n.useState)([]),it=(0,i.Z)(tt,2),xt=it[0],At=it[1],Ht=n.useState(!1),yt=(0,i.Z)(Ht,2),Qt=yt[0],ye=yt[1],x=(0,n.useState)([]),K=(0,i.Z)(x,2),k=K[0],Z=K[1],j=(0,n.useState)([]),q=(0,i.Z)(j,2),ie=q[0],D=q[1],_t=(0,n.useState)(!1),He=(0,i.Z)(_t,2),Rt=He[0],Kt=He[1],ee=(0,n.useState)(!0),F=(0,i.Z)(ee,2),Ce=F[0],R=F[1];(0,n.useImperativeHandle)(z,function(){return{setChecked:console.log,reset:function(){return Re([])},setVal:function(de){var A=xn(T().isArray(de)?de:[]);return Re(A),A}}});var pe=(0,n.useMemo)(function(){var ct=0;return Qe.map(function(de){T().isArray(T().get(de,"test_case_list"))&&(ct+=de.test_case_list.length)}),ct},[Qe]),Cn=function(){var de;(de=Ye.current)===null||de===void 0||de.openDrawer({test_config:Qe})},mn=function(){var ct=(0,Ze.Z)((0,Me.Z)().mark(function de(){var A,Mt,wt,$t,Tt;return(0,Me.Z)().wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:return Ce&&X(!0),xe(!0),Oe([]),A={test_type:m,ws_id:P},Mt=m==="business"?{business_type:c}:{},nt.next=7,(0,Y.Zu)((0,_.Z)((0,_.Z)((0,_.Z)({},A),Mt),{},{page_size:200}));case 7:if(nt.t0=nt.sent,nt.t0){nt.next=10;break}nt.t0={};case 10:wt=nt.t0,$t=wt.data,Tt=$t===void 0?[]:$t,Tt.map(function(ht,rn){var Ne;return ht.key=rn+"",ht.title=ht.name,ht.children=(Ne=ht.test_case_list)===null||Ne===void 0?void 0:Ne.map(function(b,U){return b.parentId=ht.id,b.key=rn+"-"+U,b.title=b.name,b.ip=b.ip||"\u968F\u673A",b}),ht}),re&&(re.current=Tt),Oe(Tt),xe(!1),Kt(!0),R(!1);case 19:case"end":return nt.stop()}},de)}));return function(){return ct.apply(this,arguments)}}();(0,n.useEffect)(function(){mn()},[]);var an=function(de,A){var Mt=de.var,wt=de.title,$t=de.name,Tt=A.server_is_deleted,Xt=A.test_case_id,nt=A.repeat,ht=A.timeout,rn=A.need_reboot,Ne=A.is_instance,b=A.priority,U=A.console,le=A.monitor_info,d=Mt?JSON.parse(Mt):[],s=A.env_info,u=s?Object.keys(s).map(function(Tn){return{name:Tn,val:s[Tn]}}):[],g=A.setup_info==="[]"?"":A.setup_info,M=A.cleanup_info==="[]"?"":A.cleanup_info,fe=d.map(function(Tn){return Tn.name}),Te=u.reduce(function(Tn,Un){return fe.includes(Un.name)?Tn.concat((0,_.Z)((0,_.Z)({},Un),{},{is_sys:!0})):Tn.concat(Un)},[]),vt={setup_info:g,cleanup_info:M,env_info:Te,title:wt,name:$t,id:Xt,repeat:nt,timeout:ht,need_reboot:rn,is_instance:Ne,priority:b,console:U,monitor_info:le,server_is_deleted:Tt,server_object_id:null,custom_channel:null,custom_ip:null,server_tag_id:[],ip:null};if(Tt)return vt;var Ve=A.customer_server,ze=A.server_tag_id,on=A.ip,pn=A.server_object_id,An=void 0,Hn=void 0;Ve&&(An=Ve.custom_channel,Hn=Ve.custom_ip);var Nn=on;!Nn&&Hn&&(Nn=Hn);var kn=(0,_.Z)((0,_.Z)((0,_.Z)({},A),vt),{},{custom_channel:An,custom_ip:Hn,ip:Nn,server_object_id:pn});return ze?T().isArray(ze)?kn.server_tag_id=T().filter(ze):typeof ze=="string"&&ze.indexOf(",")>-1?kn.server_tag_id=ze.split(",").map(function(Tn){return Tn-0}):kn.server_tag_id=[]:kn.server_tag_id=[],kn},xn=function(de){var A=de==null?void 0:de.reduce(function(Mt,wt){var $t=wt.test_suite_id,Tt=wt.cases,Xt=wt.setup_info,nt=ut.findIndex(function(rn){var Ne=rn.id;return Ne===$t});if(~nt){var ht=Tt==null?void 0:Tt.reduce(function(rn,Ne){var b=ut[nt].test_case_list,U=Ne||{},le=U.test_case_id,d=b.findIndex(function(u){var g=u.id;return g===le});if(~d){var s=b[d];return rn.concat(an(s,Ne))}return rn},[]);return ht.length>0?Mt.concat((0,_.Z)((0,_.Z)({},wt),{},{id:$t,title:ut[nt].name,run_mode:ut[nt].run_mode,setup_info:Xt==="[]"?"":Xt,test_case_list:ht})):Mt}return Mt},[]);return Y.Zu.length>A&&ye(!0),A};(0,n.useEffect)(function(){if(Rt&&ut.length>0&&JSON.stringify(v)!=="{}"){var ct=xn(v.test_config);Re(ct)}},[v,Rt]);var En=function(){return De(se.current.clientWidth)};(0,n.useEffect)(function(){return En(),window.addEventListener("resize",En),function(){window.removeEventListener("resize",En)}},[]),(0,n.useEffect)(function(){var ct=[];Object.keys(f).map(function(de){f[de].config_index==3&&ct.push(f[de].name)}),At(ct)},[f]),(0,n.useEffect)(function(){l(Qe);var ct=[],de=[];Qe.forEach(function(A){A.run_mode==="cluster"?de.push(A):ct.push(A)}),Z(ct),D(de)},[Qe]);var wn=function(de){if(de.length===0)return Re([]);var A=[];de.forEach(function(Mt){var wt=Qe.findIndex(function(Xt){return Xt.id===Mt.id});if(wt===-1)A.push(Mt);else{var $t=[],Tt=Qe[wt].test_case_list;Mt.test_case_list.forEach(function(Xt){var nt=Tt.findIndex(function(ht){return ht.id===Xt.id});nt===-1?$t.push(Xt):$t.push(Tt[nt])}),A.push((0,_.Z)((0,_.Z)({},Qe[wt]),{},{test_case_list:$t}))}}),Re(A)},Ln=function(de,A){Re(A==="cluster"?k.concat(de):ie.concat(de))},Fn={disabled:ve,width:Ae,test_type:m,server_type:ce,contrl:f,control:xt,loading:$e,ws_id:P,onDataSourceChange:Ln};return(0,e.jsx)("div",{className:C().suite,ref:se,style:{position:"relative",width:"100%"},children:(0,e.jsxs)(lt.Z,{spinning:$e,children:[(0,e.jsxs)("div",{children:[(0,e.jsx)(W.Z,{disabled:ve,type:"primary",size:"small",onClick:Cn,style:{marginBottom:"12px"},children:(0,e.jsx)(a._H,{id:"select.suite.select.case"})}),Qe.length>0&&(0,e.jsx)("span",{style:{paddingLeft:8},children:(0,e.jsxs)(G.Z,{children:[(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(w.Z.Text,{style:{color:"rgba(0,0,0,.65)"},children:(0,e.jsx)(a._H,{id:"select.suite.selected"})}),(0,e.jsx)(E.Z,{style:{backgroundColor:"rgba(140,140,140,0.10)",color:"rgba(0,0,0,.65)"},count:Qe.length,overflowCount:999999})]}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(w.Z.Text,{style:{color:"rgba(0,0,0,.65)"},children:"Test Conf"}),(0,e.jsx)(E.Z,{style:{backgroundColor:"rgba(140,140,140,0.10)",color:"rgba(0,0,0,.65)"},count:pe,overflowCount:999999})]})]})})]}),(0,e.jsxs)(G.Z,{direction:"vertical",size:6,style:{width:"100%"},children:[Qt&&(0,e.jsx)(J.Z,{message:ue({id:"select.suite.table.is_delete.alart",defaultMessage:"\u6240\u9009\u7528\u4F8B\u5DF2\u4E0D\u5B58\u5728"}),type:"warning",showIcon:!0,closable:!0}),(0,e.jsx)(ta,{sources:v==null?void 0:v.server_deleted,isDelete:!0}),(0,e.jsx)(ta,{sources:v==null?void 0:v.server_no_allocated}),m==="business"?(0,e.jsx)(at,{testType:m,onRef:Ye,handleSelect:wn,control:xt,treeData:ut,loading:$e}):(0,e.jsx)(hn,{testType:m,onRef:Ye,handleSelect:wn,control:xt,treeData:ut,loading:$e}),k.length===0&&ie.length===0&&(0,e.jsx)(St.Z,{bodyStyle:{width:Ae||"100%"},children:(0,e.jsx)(ke.Z,{image:ke.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsx)(a._H,{id:"select.suite.please.select.case"})})}),k.length>0&&(0,e.jsx)(qn,(0,_.Z)((0,_.Z)({},Fn),{},{dataSource:k,run_mode:"standalone"})),ie.length>0&&(0,e.jsx)(qn,(0,_.Z)((0,_.Z)({},Fn),{},{dataSource:ie,run_mode:"cluster"}))]})]})})},xa=ja},19028:function(Ut,Wt,t){"use strict";t.d(Wt,{Zu:function(){return St},ge:function(){return ke}});var un=t(39428),lt=t(3182),Lt=t(16917),St=function(){var E=(0,lt.Z)((0,un.Z)().mark(function sn(w){return(0,un.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.abrupt("return",(0,Lt.WY)("/api/case/workspace/case/",{params:w}));case 1:case"end":return W.stop()}},sn)}));return function(w){return E.apply(this,arguments)}}(),Pt=null;function ke(){return(0,Lt.WY)("/api/case/test_domain/")}function yn(E){return request("/api/server/server_tag/",{params:E})}function J(E){return request("/api/server/test_server/channel/check/",{params:E})}function mt(E){return request("/api/server/test_cluster/",{params:E})}function G(E){return request("/api/server/cloud_server/",{params:E})}function bt(E){return request("/api/server/test_cluster/",{params:E})}},52141:function(Ut,Wt,t){"use strict";t.d(Wt,{Z:function(){return Ze}});var un=t(22122),lt=t(96156),Lt=t(7085),St=t(94184),Pt=t.n(St),ke=t(28481),yn=t(81253),J=t(67294),mt=t(5663),G=t(92389),bt=J.forwardRef(function(i,n){var h,T=i.prefixCls,oe=T===void 0?"rc-switch":T,Zt=i.className,H=i.checked,qt=i.defaultChecked,_e=i.disabled,p=i.loadingIcon,zt=i.checkedChildren,o=i.unCheckedChildren,Nt=i.onClick,dt=i.onChange,a=i.onKeyDown,L=(0,yn.Z)(i,["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"]),Y=(0,mt.Z)(!1,{value:H,defaultValue:qt}),Je=(0,ke.Z)(Y,2),Se=Je[0],he=Je[1];function e(C,Gt){var Be=Se;return _e||(Be=C,he(Be),dt==null||dt(Be,Gt)),Be}function Q(C){C.which===G.Z.LEFT?e(!1,C):C.which===G.Z.RIGHT&&e(!0,C),a==null||a(C)}function at(C){var Gt=e(!Se,C);Nt==null||Nt(Gt,C)}var Jt=Pt()(oe,Zt,(h={},(0,lt.Z)(h,"".concat(oe,"-checked"),Se),(0,lt.Z)(h,"".concat(oe,"-disabled"),_e),h));return J.createElement("button",Object.assign({},L,{type:"button",role:"switch","aria-checked":Se,disabled:_e,className:Jt,ref:n,onKeyDown:Q,onClick:at}),p,J.createElement("span",{className:"".concat(oe,"-inner")},Se?zt:o))});bt.displayName="Switch";var E=bt,sn=t(53124),w=t(98866),Vt=t(97647),W=t(21790),Me=function(i,n){var h={};for(var T in i)Object.prototype.hasOwnProperty.call(i,T)&&n.indexOf(T)<0&&(h[T]=i[T]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var oe=0,T=Object.getOwnPropertySymbols(i);oe<T.length;oe++)n.indexOf(T[oe])<0&&Object.prototype.propertyIsEnumerable.call(i,T[oe])&&(h[T[oe]]=i[T[oe]]);return h},_=J.forwardRef(function(i,n){var h=i.prefixCls,T=i.size,oe=i.disabled,Zt=i.loading,H=i.className,qt=H===void 0?"":H,_e=Me(i,["prefixCls","size","disabled","loading","className"]),p=J.useContext(sn.E_),zt=p.getPrefixCls,o=p.direction,Nt=J.useContext(Vt.Z),dt=J.useContext(w.Z),a=(oe!=null?oe:dt)||Zt,L=zt("switch",h),Y=J.createElement("div",{className:"".concat(L,"-handle")},Zt&&J.createElement(Lt.Z,{className:"".concat(L,"-loading-icon")})),Je=Pt()((0,lt.Z)((0,lt.Z)((0,lt.Z)({},"".concat(L,"-small"),(T||Nt)==="small"),"".concat(L,"-loading"),Zt),"".concat(L,"-rtl"),o==="rtl"),qt);return J.createElement(W.Z,{insertExtraNode:!0},J.createElement(E,(0,un.Z)({},_e,{prefixCls:L,className:Je,disabled:a,ref:n,loadingIcon:Y})))});_.__ANT_SWITCH=!0;var Ze=_}}]);
