(self.webpackChunktone_front=self.webpackChunktone_front||[]).push([[9083,2485],{59465:function(Te,te,a){"use strict";a.d(te,{Z:function(){return pe}});var ne=a(28991),J=a(67294),ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},M=ve,Ke=a(27029),me=function(G,V){return J.createElement(Ke.Z,(0,ne.Z)((0,ne.Z)({},G),{},{ref:V,icon:M}))},Be=J.forwardRef(me),pe=Be},50335:function(Te){Te.exports={suite:"suite___18kgg",spinWrapper:"spinWrapper___17EdH",nav:"nav___3Ls6P",bar:"bar___2Pxqj",title:"title___2N2r_",remove:"remove___1mY09",batch:"batch___3KKK_",info:"info___2RGDG",var:"var___FaJBX",action:"action___3XoLG",column_outter:"column_outter___38ySl",conf_table:"conf_table___1WoTS",suite_table_loading:"suite_table_loading___8OeYB",batch_setting_table_bar:"batch_setting_table_bar___gNpdm",suite_drawer:"suite_drawer___3WpmF",case_drawer:"case_drawer___3clkU",drawer_padding:"drawer_padding___1jhA-",case_form:"case_form___1gwse",suite_form:"suite_form___RGHI0",serverItemUnchecked:"serverItemUnchecked___lvVQl",btn_style:"btn_style___3zR_3"}},19028:function(Te,te,a){"use strict";a.d(te,{Zu:function(){return M},ge:function(){return me}});var ne=a(39428),J=a(3182),ve=a(16917),M=function(){var K=(0,J.Z)((0,ne.Z)().mark(function L(ge){return(0,ne.Z)().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return re.abrupt("return",(0,ve.WY)("/api/case/workspace/case/",{params:ge}));case 1:case"end":return re.stop()}},L)}));return function(ge){return K.apply(this,arguments)}}(),Ke=null;function me(){return(0,ve.WY)("/api/case/test_domain/")}function Be(K){return request("/api/server/server_tag/",{params:K})}function pe(K){return request("/api/server/test_server/channel/check/",{params:K})}function We(K){return request("/api/server/test_cluster/",{params:K})}function G(K){return request("/api/server/cloud_server/",{params:K})}function V(K){return request("/api/server/test_cluster/",{params:K})}},18712:function(Te,te,a){"use strict";a.r(te),a.d(te,{default:function(){return Qt}});var ne=a(20228),J=a(11382),ve=a(57663),M=a(71577),Ke=a(71194),me=a(50146),Be=a(34792),pe=a(48086),We=a(91220),G=a(39428),V=a(3182),K=a(47673),L=a(4107),ge=a(58024),Le=a(91894),re=a(48736),Ie=a(27049),Vt=a(89032),ae=a(15746),Jt=a(88983),$e=a(47933),b=a(2824),Xt=a(49111),F=a(19650),qt=a(13062),U=a(71230),en=a(63185),xe=a(9676),tn=a(402),Y=a(97272),l=a(11849),m=a(67294),u=a(16917),Ue=a(20009),Ye=a(49101),jt=a(68855),Ct=a(60035),nn=a(57338),St=a(440),rn=a(13254),dt=a(14277),an=a(32157),_t=a(45742),kt=a(58491),wt=a(57254),Rt=a(19028),Tt=a(2880),It=a(50335),bt=a.n(It),e=a(85893),Pt=function(Z,y){var f=(0,u.YB)(),c=f.formatMessage,R=(0,Ue.UO)(),d=R.ws_id,T=Z.onOk,_=Z.perfKeys,j=Z.funcKeys,P=(0,m.useState)(!1),I=(0,b.Z)(P,2),w=I[0],p=I[1],h=(0,m.useState)(null),v=(0,b.Z)(h,2),g=v[0],C=v[1],D=(0,m.useState)(!1),A=(0,b.Z)(D,2),ie=A[0],$=A[1],S=(0,m.useState)([]),z=(0,b.Z)(S,2),Ze=z[0],ye=z[1],Pe=(0,m.useState)([]),oe=(0,b.Z)(Pe,2),je=oe[0],Oe=oe[1],Je=(0,m.useState)(""),Ce=(0,b.Z)(Je,2),le=Ce[0],De=Ce[1],Xe=(0,m.useState)(""),Ee=(0,b.Z)(Xe,2),Se=Ee[0],Fe=Ee[1],qe=(0,m.useState)(!1),_e=(0,b.Z)(qe,2),ce=_e[0],Me=_e[1],et=(0,m.useState)(""),He=(0,b.Z)(et,2),de=He[0],tt=He[1],nt=(0,m.useState)([]),Ne=(0,b.Z)(nt,2),Ae=Ne[0],ue=Ne[1],rt=(0,u.QT)(function(){return(0,Tt.ge)({ws_id:d,page_size:100})},{initialData:[]}),at=rt.data,ke=(0,u.QT)(function(i){return(0,Rt.Zu)(i)},{initialData:[],manual:!0}),ee=ke.data,we=ke.loading,fe=ke.run,ze=(0,m.useMemo)(function(){return ee.reduce(function(i,t,r){var n=0,s=t.test_case_list.reduce(function(o,x,E){var O="".concat(r,"-").concat(E),B=!1,k=!1;if(!je.includes(x.id)){var W=de==="performance"?_.includes(x.id):j.includes(x.id);W&&n++,B=W,k=W}return o.concat((0,l.Z)((0,l.Z)({},x),{},{parentId:t.id,key:O,title:x.name,disableCheckbox:B,disabled:k}))},[]);return i.concat((0,l.Z)((0,l.Z)({},t),{},{key:t.id+"",title:t.name,children:s,checkable:n!==t.test_case_list.length}))},[])},[ee,de,_,j,je]),Re=function(t){De(t),fe({domain:t,ws_id:d,test_type:de,name:Se,page_size:100})},Ge=function(t){Fe(t),fe({domain:le,ws_id:d,test_type:de,name:t,page_size:100}).then(function(r){if(r.length)for(var n=0;n<r.length;n++)if(r[n].name.indexOf(t)===-1){var s=[];s.push(r[n].id+""),ue(s)}else ue([""])})},st=function(t){ue(t)},it=function(t){ye(t)};(0,m.useImperativeHandle)(y,function(){return{show:function(t,r,n){t&&C({source:t,rowkey:r,testType:n});var s=n==="func_item"?"functional":"performance";tt(s),p(!0),fe({domain:le,ws_id:d,test_type:s,name:Se,page_size:100}).then(function(o){var x=[],E=t.list.reduce(function(k,W){return k.concat(W.case_source.reduce(function(lt,yt){return lt.concat(yt.test_conf_id)},[]))},[]);Oe(E);for(var O=0;O<o.length;O++)for(var B=0;B<o[O].test_case_list.length;B++)E.includes(o[O].test_case_list[B].id)&&x.push("".concat(O,"-").concat(B));ye(x)})}}});var he=(0,m.useCallback)(function(){p(!1),C(null),De(""),Fe(""),ye([]),Me(!1),Oe([])},[]),ot=function(){if(!ie){$(!0);var t=ee.reduce(function(r,n,s){var o=n.test_case_list.reduce(function(x,E,O){var B=Ze.findIndex(function(k){return k==="".concat(s,"-").concat(O)});return B>-1?x.concat({test_conf_id:E.id,test_conf_name:E.name}):x},[]);return o.length>0?r.concat({test_suite_id:n.id,suite_show_name:n.name,case_source:o}):r},[]);T((0,l.Z)((0,l.Z)({},g),{},{result:t})),he(),$(!1)}};return(0,e.jsx)(St.Z,{maskClosable:!1,keyboard:!1,footer:(0,e.jsx)("div",{style:{textAlign:"right"},children:(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(M.Z,{onClick:he,children:(0,e.jsx)(u._H,{id:"operation.cancel"})}),(0,e.jsx)(M.Z,{type:"primary",onClick:ot,children:(0,e.jsx)(u._H,{id:"operation.ok"})})]})}),visible:w,destroyOnClose:!0,width:634,title:(0,e.jsx)(u._H,{id:"report.case.list"}),onClose:he,children:(0,e.jsxs)(J.Z,{spinning:we,style:{width:"100%",height:"100%"},children:[(0,e.jsx)(L.Z.Search,{placeholder:c({id:"please.enter"}),onSearch:function(t){return Ge(t.replace(/\s+/g,""))},style:{width:420}}),(0,e.jsxs)("div",{style:{position:"relative",paddingTop:"16px",display:"flex"},children:[(0,e.jsxs)("div",{className:bt().nav,children:[(0,e.jsx)(u._H,{id:"report.domain"}),"\uFF1A"]}),(0,e.jsxs)("div",{style:{width:500},children:[(0,e.jsx)(M.Z,{type:le===""?"primary":"ghost",size:"small",style:{marginRight:8,marginBottom:8,border:"none"},onClick:function(){return Re("")},children:(0,e.jsx)(u._H,{id:"report.all.s"})}),at.map(function(i,t){if(!(!ce&&t>6))return i.id==le?(0,e.jsx)(M.Z,{type:"primary",size:"small",style:{marginRight:8,marginBottom:8},onClick:function(){return Re(i.id)},children:i.name},i.id):(0,e.jsx)(M.Z,{type:"ghost",size:"small",style:{border:"none",marginRight:8,marginBottom:8},onClick:function(){return Re(i.id)},children:i.name},i.id)})]}),(0,e.jsx)(M.Z,{type:"link",size:"small",style:{position:"absolute",right:0},onClick:function(){return Me(!ce)},icon:ce?(0,e.jsx)(kt.Z,{}):(0,e.jsx)(wt.Z,{}),children:ce?(0,e.jsx)(u._H,{id:"operation.collapse"}):(0,e.jsx)(u._H,{id:"operation.expand"})})]}),(0,e.jsx)(_t.Z,{treeData:ze,checkedKeys:Ze,onExpand:st,expandedKeys:Ae,checkable:!0,onCheck:it}),ee.length===0&&(0,e.jsx)("div",{style:{height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,e.jsx)(dt.Z,{image:dt.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsx)(u._H,{id:"no.use.case"})})})]})})},Ot=(0,m.memo)((0,m.forwardRef)(Pt)),Qe=a(88047),H=a(10746),X=a(24480),ut=(0,m.createContext)(null),se=function(){return(0,m.useContext)(ut)},Dt=a(44629),sn=a(36017),be=a(35247),N=a(14495),Et=a(73727),Ft=function(Z){var y=Z.route,f=(0,Ue.UO)(),c=f.ws_id,R=se(),d=R.dataSource,T=R.bodyWidth;return(0,e.jsx)(N.hi,{children:(0,e.jsxs)(be.Z,{children:[(0,e.jsx)(be.Z.Item,{children:(0,e.jsx)(Et.rU,{to:"/ws/".concat(c,"/test_report?t=template"),children:(0,e.jsx)(u._H,{id:"report.template"})})}),y.name==="TemplateCreate"?(0,e.jsx)(be.Z.Item,{children:(0,e.jsx)(u._H,{id:"menu.Workspace.TestReport.TemplateCreate"})}):(0,e.jsx)(be.Z.Item,{children:(0,e.jsx)("span",{children:(0,e.jsx)(Y.Z.Text,{ellipsis:!0,style:{width:T-134},children:d.name})})})]})})},Mt=(0,m.memo)(Ft),q=a(44586),Ht=a(93224),ft=a(22063),ht=a(79437),Nt=a(8212),At=function(Z){var y=Z.onOk,f=Z.title,c=Z.style,R=Z.icon,d=Z.width,T=m.useState(!1),_=(0,b.Z)(T,2),j=_[0],P=_[1],I=m.useState(f),w=(0,b.Z)(I,2),p=w[0],h=w[1],v=function(){P(!0)},g=function(){P(!1),h(f)},C=function(){g()},D=function(S){var z=S.target;h(z.value)},A=function(){y(p),g()},ie=function(){return R};return d<=0?(0,e.jsx)(e.Fragment,{}):j?(0,e.jsxs)(U.Z,{children:[R&&(0,e.jsx)("span",{style:{marginRight:8},children:(0,e.jsx)(ie,{})}),(0,e.jsx)(L.Z,{value:p||"",size:"small",onChange:D,style:{width:d-120,marginRight:8}}),(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(M.Z,{size:"small",onClick:C,children:(0,e.jsx)(u._H,{id:"operation.cancel"})}),(0,e.jsx)(M.Z,{size:"small",type:"primary",onClick:A,children:(0,e.jsx)(u._H,{id:"operation.ok"})})]})]}):(0,e.jsxs)(U.Z,{children:[R&&(0,e.jsx)("span",{style:{marginRight:8},children:(0,e.jsx)(ie,{})}),(0,e.jsxs)("div",{style:{width:d-20},children:[(0,e.jsx)("span",{style:(0,l.Z)((0,l.Z)({},c),{},{marginRight:8,wordBreak:"break-all"}),children:f||"-"}),(0,e.jsx)(Nt.Z,{onClick:v})]})]})},Ve=At,vt=a(54549),mt=a(59465),pt=a(43910),zt=function(Z){var y=Z.source,f=Z.dataItem,c=se(),R=c.handleFieldChange,d=c.hanldeRemoveField,T=c.handleRemoveSuiteField,_=c.hanldeChangeSuiteName,j=c.suiteSelectRef,P=c.contrl,I=(0,m.useRef)(),w=(0,ft.F)(I);return(0,e.jsxs)(N.Rh,{id:"".concat(f,"-").concat(y.rowkey),children:[(0,e.jsx)(N.sZ,{span:24,ref:I,children:(0,e.jsx)(U.Z,{justify:"space-between",children:(0,e.jsxs)(u.Nv,{accessible:P,fallback:(0,e.jsxs)(F.Z,{align:"center",children:[(0,e.jsx)(pt.r,{style:{transform:"translate(0px, 2px)"}}),(0,e.jsx)(Y.Z.Text,{strong:!0,style:{width:w-80,display:"inline-block"},children:y.name})]}),children:[(0,m.createElement)(Ve,(0,l.Z)((0,l.Z)({},y),{},{icon:(0,e.jsx)(pt.r,{style:{transform:"translate(0px, 2px)"}}),key:y.rowkey,title:y.name,width:w-80,onOk:function(h){return R(h,"name",y.rowkey,f)}})),(0,e.jsx)("span",{onClick:function(){return d(y.rowkey,f)},children:(0,e.jsx)(vt.Z,{})})]})})}),(0,e.jsxs)(ae.Z,{span:24,style:{padding:"10px 16px 16px"},children:[(0,e.jsx)(u.Nv,{accessible:P,children:(0,e.jsx)(U.Z,{children:(0,e.jsx)(M.Z,{type:"primary",ghost:!0,onClick:function(){return j.current.show(y,y.rowkey,f)},children:(0,e.jsx)(u._H,{id:"report.select.case"})})})}),(0,e.jsx)(U.Z,{children:y.list.map(function(p){var h;return(0,e.jsxs)(N.i0,{span:24,children:[(0,e.jsx)(N.TV,{justify:"space-between",children:(0,e.jsxs)(u.Nv,{accessible:P,fallback:(0,e.jsx)("span",{children:p.suite_show_name}),children:[(0,m.createElement)(Ve,(0,l.Z)((0,l.Z)({},p),{},{title:p.suite_show_name,key:p.rowkey,width:w-100,onOk:function(g){return _(p.test_suite_id,f,y.rowkey,g)}})),(0,e.jsx)(mt.Z,{onClick:function(){return T(p,f,!0)}})]})}),(0,e.jsx)(U.Z,{children:(h=p.case_source)===null||h===void 0?void 0:h.map(function(v,g){return(0,e.jsx)(N.JZ,{span:24,len:p.case_source.length-1,idx:g,children:(0,e.jsxs)(U.Z,{justify:"space-between",align:"middle",children:[(0,e.jsx)(Y.Z.Text,{children:v.test_conf_name}),(0,e.jsx)(u.Nv,{accessible:P,children:(0,e.jsx)(mt.Z,{onClick:function(){return T(v,f,!1)}})})]})},g)})})]},p.rowkey)})})]})]})},gt=zt,Gt=["dataItem","conf","source"],Kt=function(Z){var y=Z.dataItem,f=Z.conf,c=Z.source,R=(0,Ht.Z)(Z,Gt),d=se(),T=d.handleFieldChange,_=d.hanldeRemoveField,j=d.handleGroupAddTestItem,P=d.contrl,I=(0,m.useRef)(),w=(0,ft.F)(I);return(0,e.jsxs)(N.ZA,{id:"".concat(y,"-").concat(c.rowkey),children:[(0,e.jsx)(ae.Z,{span:24,children:(0,e.jsx)(N.pF,{justify:"space-between",ref:I,children:(0,e.jsxs)(u.Nv,{accessible:P,fallback:(0,e.jsxs)(F.Z,{align:"center",children:[(0,e.jsx)(ht.r,{style:{transform:"translate(0px, 1px)"}}),(0,e.jsx)(Y.Z.Text,{strong:!0,children:c.name})]}),children:[(0,m.createElement)(Ve,(0,l.Z)((0,l.Z)({},c),{},{key:c.rowkey,icon:(0,e.jsx)(ht.r,{}),title:c.name,width:w-80,onOk:function(h){return T(h,"name",c.rowkey,y)}})),(0,e.jsx)("span",{onClick:function(){return _(c.rowkey,y)},children:(0,e.jsx)(vt.Z,{})})]})})}),(0,e.jsxs)(ae.Z,{span:24,style:{padding:16},children:[c.list.map(function(p){return(0,e.jsx)(gt,(0,l.Z)((0,l.Z)({source:p},R),{},{conf:f,dataItem:y}),p.rowkey)}),(0,e.jsxs)(u.Nv,{accessible:P,children:[(0,e.jsx)(Ie.Z,{style:{margin:"12px 0"}}),(0,e.jsx)(U.Z,{children:(0,e.jsx)("span",{onClick:function(){return j(c.rowkey,y)},children:(0,e.jsx)(Y.Z.Link,{children:(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(Ye.Z,{}),(0,e.jsx)(u._H,{id:"report.test.item"})]})})})})]})]})]})},Bt=(0,m.memo)(Kt),Wt=a(92145),xt={need_test_suite_description:!0,need_test_env:!0,need_test_description:!0,need_test_conclusion:!0,show_type:"list",test_data:!1},Zt={need_test_suite_description:!1,need_test_env:!1,need_test_description:!1,need_test_conclusion:!1,show_type:"list",test_data:!1},Lt=function(Z){var y=Z.testType,f=(0,u.YB)(),c=f.formatMessage,R=se(),d=R.dataSource,T=R.setDataSource,_=R.contrl,j={name:"performance",testRadioName:"need_perf_data",dataItem:"perf_item",conf:"perf_conf"};y!=="performance"&&(j={name:"functional",testRadioName:"need_func_data",dataItem:"func_item",conf:"func_conf"});var P=function(v){T((0,H.ZP)(d,function(g){g[v]=d[v].concat({name:c({id:"report.test.item.num"},{data:"".concat(d[v].length-0+1)}),rowkey:(0,q.Z)(),list:[{test_suite_id:null,suite_show_name:"suite",case_source:[],rowkey:(0,q.Z)()}]})}))},I=function(v){T((0,H.ZP)(d,function(g){g[v]=d[v].concat({name:"".concat(c({id:"report.test.group"})).concat(d[v].length-0+1),list:[],is_group:!0,rowkey:(0,q.Z)()})}))},w=function(v,g){T((0,H.ZP)(d,function(C){C[v]=g}))},p=function(v,g,C){T((0,H.ZP)(d,function(D){var A=(0,l.Z)({},d[C]);A[g]=v,D[C]=A}))};return(0,e.jsxs)(Le.Z,{id:j.dataItem,style:{marginTop:20},bodyStyle:{padding:"12px 20px"},children:[(0,e.jsx)(U.Z,{children:(0,e.jsx)(xe.Z,{checked:d[j.testRadioName],disabled:!_,onChange:function(v){var g=v.target;return w(j.testRadioName,g.checked)},children:(0,e.jsx)(Y.Z.Text,{strong:!0,style:{fontSize:16},children:(0,e.jsx)(u._H,{id:"report.".concat(j.name,".test.data")})})})}),d[j.testRadioName]&&(0,e.jsxs)(U.Z,{style:{paddingLeft:24},children:[(0,e.jsx)(ae.Z,{span:24,style:{background:"rgba(0,0,0,0.03)",padding:14,marginTop:12},children:(0,e.jsx)(F.Z,{direction:"vertical",style:{width:"100%"},children:(0,e.jsxs)(F.Z,{direction:"vertical",style:{width:"100%"},children:[(0,e.jsx)(F.Z,{children:(0,e.jsx)(Y.Z.Text,{children:(0,e.jsx)(u._H,{id:"report.basic.information"})})}),(0,e.jsx)(F.Z,{style:{width:"100%"},children:[[c({id:"report.test_env"}),"need_test_env"],[c({id:"report.test.description"}),"need_test_description"],[c({id:"report.test.conclusion"}),"need_test_conclusion"]].map(function(h){var v=(0,b.Z)(h,3),g=v[0],C=v[1],D=v[2];return(0,e.jsx)($t,{field:j.conf,title:g,name:C,text:D},C)})}),j.name!=="functional"&&(0,e.jsxs)("div",{style:{display:"flex"},children:[(0,e.jsx)("div",{style:{marginRight:12},children:(0,e.jsx)(u._H,{id:"report.data.view.style"})}),(0,e.jsx)("div",{children:(0,e.jsxs)($e.ZP.Group,{disabled:!_,value:d[j.conf].show_type,onChange:function(v){var g=v.target;return p(g.value,"show_type",j.conf)},children:[(0,e.jsx)($e.ZP,{value:"list",children:(0,e.jsx)(u._H,{id:"report.list.view"})}),(0,e.jsx)($e.ZP,{value:"chart",children:(0,e.jsx)(u._H,{id:"report.chart.view"})})]})})]})]})})}),(0,e.jsx)(ae.Z,{span:24,children:d[j.dataItem].map(function(h){return h.is_group?(0,e.jsx)(Bt,(0,l.Z)((0,l.Z)({},j),{},{source:h}),h.rowkey):(0,e.jsx)(gt,(0,l.Z)((0,l.Z)({},j),{},{source:h}),h.rowkey)})}),(0,e.jsx)(Ie.Z,{style:{margin:"12px 0"}}),(0,e.jsxs)(ae.Z,{span:24,children:[(0,e.jsx)("span",{onClick:function(){return P(j.dataItem)},children:(0,e.jsx)(Y.Z.Link,{children:(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(Ye.Z,{}),(0,e.jsx)(u._H,{id:"report.test.item"})]})})}),(0,e.jsx)(Ie.Z,{type:"vertical"}),(0,e.jsx)("span",{onClick:function(){return I(j.dataItem)},children:(0,e.jsx)(Y.Z.Link,{children:(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(Ye.Z,{}),(0,e.jsx)(u._H,{id:"report.test.group"})]})})})]})]})]})},$t=function(Z){var y=Z.field,f=Z.name,c=Z.title,R=Z.text,d=(0,u.YB)(),T=d.formatMessage,_=se(),j=_.dataSource,P=_.setDataSource,I=_.contrl,w=function(h,v,g){P((0,H.ZP)(j,function(C){var D=(0,l.Z)({},j[g]);D[v]=h,C[g]=D}))};return(0,e.jsxs)(F.Z,{direction:"vertical",style:{width:"100%"},children:[(0,e.jsx)(xe.Z,{disabled:!I,onChange:function(h){var v=h.target;return w(v.checked,f,y)},checked:j[y][f],children:c}),R&&(0,e.jsx)(L.Z.TextArea,{allowClear:!0,placeholder:T({id:"please.enter"}),value:j[y][R],autoSize:{minRows:3,maxRows:3},disabled:!j[y][f],onChange:function(h){var v=h.target;w(v.value,R,y)}})]})},Ut=function(Z){var y=(0,u.YB)(),f=y.formatMessage,c=Z.name,R=Z.title,d=Z.desc,T=se(),_=T.dataSource,j=T.setDataSource,P=T.contrl,I=_.server_info_config,w=(0,X.PM)(),p=function(C,D){j((0,H.ZP)(_,function(A){A[C]=D}))},h=X.vs.length===I.length,v=I.length>0&&I.length<X.vs.length;return(0,e.jsxs)(F.Z,{direction:"vertical",style:{width:"100%",background:"#fff",padding:20},children:[(0,e.jsx)(xe.Z,(0,l.Z)((0,l.Z)({},Z),{},{id:c,disabled:!P,onChange:function(C){var D=C.target;return p(c,D.checked)},checked:_[c],children:R})),d&&(0,e.jsx)(L.Z.TextArea,{placeholder:f({id:"please.enter"}),allowClear:!0,disabled:!_[c],value:_[d],onChange:function(C){var D=C.target;p(d,D.value)},autoSize:{minRows:3,maxRows:6}}),c==="need_test_env"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ie.Z,{style:{margin:"8px 0"}}),(0,e.jsx)(xe.Z,{indeterminate:v,onChange:function(C){return p("server_info_config",C.target.checked?X.vs:[])},checked:h,children:"\u5168\u9009"}),(0,e.jsx)(xe.Z.Group,{onChange:function(C){return p("server_info_config",C)},disabled:!_[c],value:I||[],options:w.map(function(g){var C=(0,b.Z)(g,2),D=C[0],A=C[1];return{label:D,value:A}})})]})]})},Yt=function(Z){var y=(0,u.YB)(),f=y.formatMessage,c=Z.route,R=(0,Ue.UO)(),d=R.ws_id,T=R.temp_id,_=(0,u.md)(),j=(0,m.useState)(!1),P=(0,b.Z)(j,2),I=P[0],w=P[1],p=m.useState(!1),h=(0,b.Z)(p,2),v=h[0],g=h[1],C=(0,Ct.CR)(),D=C.height,A=(0,m.useRef)(),ie=(0,m.useState)({ws_id:d,name:"",is_default:!1,need_test_background:!0,need_test_method:!0,need_test_summary:!0,need_test_conclusion:!0,need_test_env:!0,need_env_description:!0,need_func_data:!0,need_perf_data:!0,description:"",perf_conf:xt,func_conf:Zt,perf_item:[],func_item:[],server_info_config:X.vs}),$=(0,b.Z)(ie,2),S=$[0],z=$[1],Ze=function i(t){return t.reduce(function(r,n){return n.is_group?n.list.length>0?r.concat(i(n.list)):r:n.list&&n.list.length>0?r.concat(n.list.reduce(function(s,o){return s.concat(o.case_source.map(function(x){return x.test_conf_id}))},[])):r},[])},ye=(0,m.useState)(_.WsMemberOperateSelf()),Pe=(0,b.Z)(ye,2),oe=Pe[0],je=Pe[1],Oe=(0,m.useMemo)(function(){return Ze(S.perf_item)},[S]),Je=(0,m.useMemo)(function(){return Ze(S.func_item)},[S]),Ce=function i(t){return t.map(function(r){return r.list?(0,l.Z)((0,l.Z)({},r),{},{rowkey:(0,q.Z)(),list:i(r.list)}):(0,l.Z)((0,l.Z)({},r),{},{rowkey:(0,q.Z)()})})},le=function(){var i=(0,V.Z)((0,G.Z)().mark(function t(){var r,n,s,o,x,E,O,B;return(0,G.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return w(!0),W.next=3,(0,Qe.Q)({ws_id:d,id:T});case 3:r=W.sent,n=r.data,s=n.perf_item,o=n.func_item,x=n.perf_conf,E=n.func_conf,O=n.server_info_config,je(_.WsMemberOperateSelf(n.creator)),B={server_info_config:O?JSON.parse(O==null?void 0:O.replace(/\'/g,'"')):X.vs,func_conf:E||Zt,perf_conf:x||xt,perf_item:Ce(s),func_item:Ce(o)},document.title="".concat(n.name," - T-One"),z(Object.assign(n,B)),w(!1);case 11:case"end":return W.stop()}},t)}));return function(){return i.apply(this,arguments)}}(),De=function(){var i=(0,V.Z)((0,G.Z)().mark(function t(){return(0,G.Z)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:je(_.IsWsSetting());case 1:case"end":return n.stop()}},t)}));return function(){return i.apply(this,arguments)}}();(0,m.useEffect)(function(){return c.name==="TemplateEdit"&&le(),c.name==="TemplateCreate"?De():(document.title="".concat(f({id:"report.create.report.template"})," - T-One"),w(!1)),function(){w(!0)}},[c.name]);var Xe=function(t,r,n,s){return(0,H.ZP)(t,function(o){o.list=t.list.map(function(x){return!x.is_group&&x.rowkey===r?(0,H.ZP)(x,function(E){E[n]=s}):x})})},Ee=function(t,r,n,s){return t.rowkey===r?(0,H.ZP)(t,function(o){o[n]=s}):t.is_group?Xe(t,r,n,s):t},Se=function(t,r,n,s){z((0,H.ZP)(S,function(o){o[s]=S[s].map(function(x){return Ee(x,n,r,t)})}))},Fe=function i(t,r){return t.reduce(function(n,s){return s.rowkey===r?n:s.is_group?n.concat((0,l.Z)((0,l.Z)({},s),{},{list:i(s.list,r)})):n.concat(s)},[])},qe=function(t,r){z((0,H.ZP)(S,function(n){n[r]=Fe(S[r],t)}))},_e=function(t,r){var n=t.list.length;return{name:f({id:"report.test.item.num"},{data:"".concat(r+1,"-").concat(n+1)}),rowkey:(0,q.Z)(),list:[{test_suite_id:null,suite_show_name:"suite",case_source:[],rowkey:(0,q.Z)()}]}},ce=function i(t,r){return t.reduce(function(n,s,o){return s.rowkey===r?s.is_group?n.concat((0,l.Z)((0,l.Z)({},s),{},{list:s.list.concat(_e(s,o))})):n.concat(_e(s,o)):s.is_group?n.concat((0,l.Z)((0,l.Z)({},s),{},{list:i(s.list,r)})):n.concat(s)},[])},Me=function(t,r){z((0,H.ZP)(S,function(n){n[r]=ce(S[r],t)}))},et=function i(t,r,n,s,o){return"test_suite_id"in t&&t.test_suite_id===o?(0,l.Z)((0,l.Z)({},t),{},{suite_show_name:s}):t.list&&t.list.length>0?(0,l.Z)((0,l.Z)({},t),{},{list:t.list.map(function(x){return i(x,r,n,s,o)})}):t},He=function(t,r,n,s){z((0,H.ZP)(S,function(o){o[r]=S[r].map(function(x){return et(x,r,n,s,t)})}))},de=function i(t,r,n){if("test_suite_id"in t){if(r)return t.test_suite_id===n.test_suite_id?void 0:t;var s=t.case_source.filter(function(o){return n.test_conf_id!==o.test_conf_id});return s.length>0?(0,l.Z)((0,l.Z)({},t),{},{case_source:s}):void 0}return(0,l.Z)((0,l.Z)({},t),{},{list:t.list.reduce(function(o,x){var E=i(x,r,n);return E?o.concat(E):o},[])})},tt=function(t,r,n){z((0,H.ZP)(S,function(s){s[r]=S[r].map(function(o){return de(o,n,t)})}))},nt=function(t){var r=t.result,n=t.rowkey,s=t.testType;return Se(r,"list",n,s)},Ne=function(t){for(var r={},n=0,s=t.length;n<s;n++){var o=t[n].name;if(r[o])throw f({id:"report.please.check"});r[o]=o}},Ae=function i(t){Ne(t);var r=t.reduce(function(n,s){var o=s.list;return"test_suite_id"in s?s.case_source.length===0?n:n.concat(s):o&&o.length>0?n.concat((0,l.Z)((0,l.Z)({},s),{},{list:i(o)})):n.concat(s)},[]);return r},ue=function(){var i=(0,V.Z)((0,G.Z)().mark(function t(r){var n;return(0,G.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(w(!0),c.name!=="TemplateEdit"){o.next=7;break}return o.next=4,(0,Qe.$A)((0,l.Z)({ws_id:d,id:T},r));case 4:o.t0=o.sent,o.next=10;break;case 7:return o.next=9,(0,Qe.s)(r);case 9:o.t0=o.sent;case 10:n=o.t0,n.code===200?u.m8.push("/ws/".concat(d,"/test_report?t=template")):(0,X.EV)(n.code,n.message),w(!1);case 13:case"end":return o.stop()}},t)}));return function(r){return i.apply(this,arguments)}}(),rt=function i(t){var r=(0,We.Z)(t),n;try{for(r.s();!(n=r.n()).done;){var s=n.value,o=s.is_group,x=s.list;if(o){var E=i(x);if(E)return!0}else if(x.length>0)return!0}}catch(O){r.e(O)}finally{r.f()}return!1},at=function(){var i=(0,V.Z)((0,G.Z)().mark(function t(){var r,n,s,o,x,E,O;return(0,G.Z)().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(!I){k.next=2;break}return k.abrupt("return");case 2:if(r=S.perf_item,n=S.func_item,s=S.name,s){k.next=5;break}return k.abrupt("return",pe.default.warning(f({id:"report.template.cannot.be.empty"})));case 5:return k.prev=5,k.next=8,Ae(r);case 8:return o=k.sent,k.next=11,Ae(n);case 11:if(x=k.sent,E=rt(o.concat(x)),O=(0,l.Z)((0,l.Z)({},S),{},{perf_item:o,func_item:x}),!E){k.next=16;break}return k.abrupt("return",ue(O));case 16:me.Z.confirm({title:f({id:"report.template.confirm.title",defaultMessage:"\u63D0\u793A"}),centered:!0,content:f({id:"report.template.confirm.content",defaultMessage:"\u6D4B\u8BD5\u9879\u7F3A\u5C11\u7528\u4F8B\uFF0C\u662F\u5426\u7EE7\u7EED\u4FDD\u5B58\uFF1F"}),icon:(0,e.jsx)(jt.Z,{}),onOk:function(){return(0,V.Z)((0,G.Z)().mark(function lt(){return(0,G.Z)().wrap(function(ct){for(;;)switch(ct.prev=ct.next){case 0:ue(O);case 1:case"end":return ct.stop()}},lt)}))()},onCancel:function(){w(!1)}}),k.next=23;break;case 19:k.prev=19,k.t0=k.catch(5),pe.default.warning(k.t0),w(!1);case 23:case"end":return k.stop()}},t,null,[[5,19]])}));return function(){return i.apply(this,arguments)}}(),ke=(0,m.useState)(!1),ee=(0,b.Z)(ke,2),we=ee[0],fe=ee[1],ze=function(t,r){return z((0,H.ZP)(S,function(n){n[t]=r}))},Re=(0,m.useState)(1200),Ge=(0,b.Z)(Re,2),st=Ge[0],it=Ge[1],he=(0,m.useRef)(null),ot=function(){return it(he.current.offsetWidth)};return(0,m.useEffect)(function(){var i=document.getElementById("report-body-container"),t={attributes:!0,childList:!0,subtree:!0},r=new MutationObserver(ot);return r.observe(i,t),function(){r.disconnect()}},[]),(0,e.jsxs)(ut.Provider,{value:{dataSource:S,setDataSource:z,collapsed:we,setCollapsed:fe,contrl:oe,bodyWidth:st,handleFieldChange:Se,hanldeRemoveField:qe,handleRemoveSuiteField:tt,hanldeChangeSuiteName:He,handleGroupAddTestItem:Me,suiteSelectRef:A},children:[(0,e.jsx)(J.Z,{spinning:I,children:(0,e.jsxs)(N.ec,{height:D-50,children:[(0,e.jsx)(Dt.Z,{dataSource:S,setDataSource:z,collapsed:we,setCollapsed:fe,contrl:oe}),(0,e.jsx)(N._r,{id:"report-body-container",collapsed:we,children:(0,e.jsxs)(N.YC,{ref:he,children:[(0,e.jsx)(Mt,(0,l.Z)({},Z)),(0,e.jsx)(N.EU,{children:(0,e.jsxs)(F.Z,{direction:"vertical",style:{width:"100%"},children:[(0,e.jsx)(L.Z,{style:{width:"100%"},placeholder:f({id:"report.name.input"}),value:S.name,onChange:function(t){var r=t.target;return ze("name",r.value)}}),(0,e.jsx)(L.Z.TextArea,{onChange:function(t){var r=t.target;return ze("description",r.value)},style:{width:"100%"},value:S.description,autoSize:{minRows:3,maxRows:6},placeholder:f({id:"report.description.textArea"})})]})}),(0,e.jsx)(F.Z,{direction:"vertical",style:{width:"100%",marginTop:20},size:20,children:[[f({id:"report.test.background"}),"need_test_background","background_desc"],[f({id:"report.test.method"}),"need_test_method","test_method_desc"],[f({id:"report.test.conclusion"}),"need_test_conclusion","test_conclusion_desc"],["Summary","need_test_summary"],[f({id:"report.env.description"}),"need_env_description","env_description_desc"],[f({id:"report.server.env"}),"need_test_env"]].map(function(i){var t=(0,b.Z)(i,3),r=t[0],n=t[1],s=t[2];return(0,e.jsx)(Ut,{title:r,name:n,desc:s},n)})}),(0,e.jsxs)("div",{style:{padding:20,background:"#fff",marginTop:20},children:[(0,e.jsx)(N.vU,{id:"test_data",children:(0,e.jsx)(u._H,{id:"report.test.data"})}),["performance","functional"].map(function(i){return(0,e.jsx)(Lt,{testType:i},i)})]})]})}),(0,e.jsx)(N.NF,{justify:"end",align:"middle",children:(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(M.Z,{onClick:function(){return g(!0)},children:(0,e.jsx)(u._H,{id:"operation.preview"})}),!S.is_default&&(0,e.jsx)(u.Nv,{accessible:oe,children:(0,e.jsx)(M.Z,{type:"primary",onClick:at,children:c.name==="TemplateEdit"?(0,e.jsx)(u._H,{id:"report.update.report.template"}):(0,e.jsx)(u._H,{id:"report.save.report.template"})})})]})}),(0,e.jsx)(Ot,{perfKeys:Oe,funcKeys:Je,ref:A,onOk:nt})]})}),v&&(0,e.jsx)("div",{style:{position:"fixed",left:0,right:0,bottom:0,top:0,zIndex:9999},children:(0,e.jsx)(Wt.default,(0,l.Z)((0,l.Z)({},Z),{},{dataSet:S,setIsPreview:g}))})]})},Qt=Yt}}]);
