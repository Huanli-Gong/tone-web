(self.webpackChunktone_front=self.webpackChunktone_front||[]).push([[9831],{76613:function(zt,Jt,t){"use strict";t.d(Jt,{Z:function(){return Dn}});var gn=t(45972),it=t(22374),Ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},St=Ht,Mt=t(25078),Ke=function(ct,N){return it.createElement(Mt.Z,(0,gn.Z)((0,gn.Z)({},ct),{},{ref:N,icon:St}))};Ke.displayName="MinusCircleOutlined";var Dn=it.forwardRef(Ke)},65318:function(zt){zt.exports={DeployModal_root:"DeployModal_root___1OL4b",Alert:"Alert___1ubcT"}},11467:function(zt){zt.exports={selection_table_thead:"selection_table_thead___mpj1J",selection_Checkbox:"selection_Checkbox___17qhJ",nav:"nav___2jNVy",domainList_Tab:"domainList_Tab___4ttRV",selection_table_tbody:"selection_table_tbody___1Rb5n",selection_table_row:"selection_table_row___FUw8w",col:"col___1UQIe",otherCol:"otherCol___gChIN"}},79756:function(zt){zt.exports={suite:"suite___18kgg",spinWrapper:"spinWrapper___17EdH",nav:"nav___3Ls6P",bar:"bar___2Pxqj",title:"title___2N2r_",remove:"remove___1mY09",batch:"batch___3KKK_",info:"info___2RGDG",var:"var___FaJBX",action:"action___3XoLG",column_outter:"column_outter___38ySl",conf_table:"conf_table___1WoTS",suite_table_loading:"suite_table_loading___8OeYB",batch_setting_table_bar:"batch_setting_table_bar___gNpdm",suite_drawer:"suite_drawer___3WpmF",case_drawer:"case_drawer___3clkU",drawer_padding:"drawer_padding___1jhA-",case_form:"case_form___1gwse",suite_form:"suite_form___RGHI0",serverItemUnchecked:"serverItemUnchecked___lvVQl",btn_style:"btn_style___3zR_3"}},50690:function(zt){zt.exports={not_logged_in:"not_logged_in___2rKJq",page_header:"page_header___33Sss",page_title:"page_title___cha7I",page_tags:"page_tags___3tZ3g",page_dec:"page_dec___1dqBn",page_preview_nav:"page_preview_nav___3I8Rg",page_body_content:"page_body_content___-zdqi",page_body:"page_body___2M3UY",yaml_copy_link:"yaml_copy_link___3TKWX",yaml_transform_icon:"yaml_transform_icon___CeuId",page_body_title:"page_body_title___7Eq27",form_row:"form_row___3-KTb",page_body_nav:"page_body_nav___K_Ncj",options_bar:"options_bar___ijZBk",yaml_container:"yaml_container___tENuh",yaml_operate:"yaml_operate___2wHTK",job_search_inp:"job_search_inp___g03ny",template_popover:"template_popover___dHPLz",template_popover_hide_content:"template_popover_hide_content___vl_rd",template_item:"template_item___292Qu"}},55704:function(zt,Jt,t){"use strict";t.d(Jt,{Z:function(){return H}});var gn=t(67515),it=t(12238),Ht=t(67448),St=t(47548),Mt=t(69230),Ke=t(33821),Dn=t(13059),W=t(53676),ct=t(88966),N=t(11048),kt=t(20693),I=t(3278),fn=t(53374),R=t(61674),Gt=t(79625),B=t(96584),Fe=t(35832),m=t(81138),ge=t(96146),s=t(32326),n=t(65790),u=t(17187),C=t(39190),ne=t(22374),bt=t(74066),P=t(22812),Yt=t(51937),V=t(34516),a=t(52454),Qt=(0,ne.forwardRef)(function(je,Je){var oe=je||{},ve=oe.onChange,e=oe.dataSource,z=e===void 0?[]:e,Ct=oe.delCallback;function Xt(M,me){if(M.preventDefault(),z&&Array.isArray(z)){var re=z.filter(function(Be){return Be.id!==me}),gt=re.map(function(Be){return Be.id});ve(gt),Ct(re)}}return(0,a.jsx)("div",{ref:Je,children:z.map(function(M){return(0,a.jsx)(V.Z,{closable:!(z&&z.length===1),onClose:function(re){return Xt(re,M.id)},children:M.ip},M.id)})})}),Q=t(77033),ae=t(65318),Zt=t.n(ae),r=t(97207),H=(0,ne.forwardRef)(function(je,Je){var oe,ve,e=(0,P.YB)(),z=e.formatMessage,Ct=u.Z.useForm(),Xt=(0,C.Z)(Ct,1),M=Xt[0],me=(0,ne.useState)(!1),re=(0,C.Z)(me,2),gt=re[0],Be=re[1],jn=(0,ne.useState)(""),Zn=(0,C.Z)(jn,2),dt=Zn[0],xn=Zn[1],vn=(0,ne.useState)(""),En=(0,C.Z)(vn,2),Tn=En[0],X=En[1],Ie=(0,ne.useState)(!1),Ot=(0,C.Z)(Ie,2),Kt=Ot[0],Dt=Ot[1],wt=(0,ne.useState)([]),ut=(0,C.Z)(wt,2),yn=ut[0],ln=ut[1],Mn=(0,ne.useState)([]),Ce=(0,C.Z)(Mn,2),ce=Ce[0],_e=Ce[1],de=(0,ne.useState)("common"),$t=(0,C.Z)(de,2),ft=$t[0],on=$t[1],pt=(0,ne.useState)({}),In=(0,C.Z)(pt,2),Et=In[0],qt=In[1],Wn=(0,ne.useState)("x86_64"),wn=(0,C.Z)(Wn,2),Ln=wn[0],An=wn[1],$e=(0,ne.useMemo)(function(){return["openanolis","opensource"].includes("opensource")},[]),Ne=function(){_e([]),on("common"),qt({}),Dt(!1)},Re=function(){var jt=(0,s.Z)((0,Fe.Z)().mark(function Ye(Tt){var _n,en,Cn,It,Nn;return(0,Fe.Z)().wrap(function(Ut){for(;;)switch(Ut.prev=Ut.next){case 0:return Ut.prev=0,Ut.next=3,(0,Q.un)({arch:Tt});case 3:_n=Ut.sent,en=_n.code,Cn=_n.msg,It=_n.data,Nn=It===void 0?[]:It,en===200?(0,r.isString)(Nn)?ln([]):ln(Nn):ge.default.error(Cn||z({id:"device.failed.to.request.version"})),Ut.next=13;break;case 11:Ut.prev=11,Ut.t0=Ut.catch(0);case 13:case"end":return Ut.stop()}},Ye,null,[[0,11]])}));return function(Tt){return jt.apply(this,arguments)}}();(0,ne.useImperativeHandle)(Je,function(){return{show:function(Ye){var Tt=Ye.detailData,_n=Ye.radio_type,en=Ye.instance_id;if(Dt(!0),X(_n),$e){M.setFieldsValue({instance_id:en});return}var Cn=Tt.map(function(It){return{ip:It,id:It}});_e(Cn),M.setFieldsValue({ips:Tt})}}});var Ge=function(Ye){_e(Ye)},_t=function(Ye){on(Ye.target.value)},at=function(){M.validateFields().then(function(){var Ye=(0,s.Z)((0,Fe.Z)().mark(function Tt(_n){var en,Cn,It,Nn,Vn,Ut;return(0,Fe.Z)().wrap(function(Bn){for(;;)switch(Bn.prev=Bn.next){case 0:return Be(!0),xn(z({id:"device.deploying"})),Bn.next=4,(0,Q.Ty)(_n);case 4:en=Bn.sent,Cn=en.code,It=en.msg,Nn=en.data,Vn=Nn===void 0?{}:Nn,Cn===200?(Ut=Vn.fail_servers)!==null&&Ut!==void 0&&Ut.length?qt(Vn):(ge.default.success(z({id:"device.deploy.finish"})),M.resetFields(),Ne(),je.callback(Vn)):ge.default.error(It||z({id:"device.deploy.failed"})),Be(!1),xn("");case 12:case"end":return Bn.stop()}},Tt)}));return function(Tt){return Ye.apply(this,arguments)}}()).catch(function(){Be(!1),xn("")})},mn=function(){gt||(M.resetFields(),Ne())},Fn=function(){var Ye=Et.success_servers,Tt=Ye===void 0?[]:Ye,_n=Et.fail_servers,en=_n===void 0?[]:_n,Cn=Tt==null?void 0:Tt.map(function(It){return It.ip}).join(" / ");return(0,a.jsxs)("div",{children:[Tt!=null&&Tt.length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{style:{color:"#1890FF"},children:Cn}),"\xA0",(0,a.jsx)(P._H,{id:"device.deploy.success"}),"\uFF1B\xA0"]}):null,en==null?void 0:en.map(function(It){return(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{style:{color:"#F5222D"},children:It&&It.ip}),"\xA0",(0,a.jsx)(P._H,{id:"device.deploy.failed"}),"\xA0",(0,a.jsx)(B.Z,{placement:"bottomLeft",title:It&&It.msg,children:(0,a.jsx)("a",{children:(0,a.jsx)(P._H,{id:"view.details"})})})]},It.ip)})]})},vt=function(){qt({})},pn=function(){return $e?"active":Tn==="cloudManage"?"passive":"active"};return(0,ne.useEffect)(function(){Kt&&Re(Ln)},[Kt,Ln]),(0,a.jsx)("div",{children:(0,a.jsx)(it.Z,{className:Zt().DeployModal_root,title:z({id:"agent.deploy.btn"}),open:Kt,maskClosable:!1,width:460,confirmLoading:gt,closable:!gt,onOk:at,onCancel:mn,children:(0,a.jsxs)(St.Z,{tip:dt,spinning:gt,children:[(oe=Et.success_servers)!==null&&oe!==void 0&&oe.length||(ve=Et.fail_servers)!==null&&ve!==void 0&&ve.length?(0,a.jsx)("div",{className:Zt().Alert,children:(0,a.jsx)(R.Z,{message:Fn(),type:"info",showIcon:!0,closable:!0,onClose:vt})}):null,(0,a.jsxs)(u.Z,{form:M,layout:"vertical",initialValues:{channel:"common",mode:pn(),user:"root",arch:"x86_64"},children:[!$e&&(0,a.jsx)(u.Z.Item,{label:"IP",name:"ips",rules:[{required:!0,message:z({id:"DeployModal.ids.message"})}],children:(0,a.jsx)(Qt,{dataSource:ce,delCallback:Ge})}),$e&&(0,a.jsx)(u.Z.Item,{label:"InstanceID",name:"instance_id",children:(0,a.jsx)(I.Z,{disabled:!0})}),!$e&&(0,a.jsx)(u.Z.Item,{label:(0,a.jsx)(P._H,{id:"device.deploy.mode"}),name:"channel",children:(0,a.jsxs)(N.ZP.Group,{onChange:_t,children:[(0,a.jsx)(N.ZP,{value:"common",children:(0,a.jsx)(P._H,{id:"device.deploy.mode.common"})}),!$e&&Tn!=="cloudManage"&&(0,a.jsx)(N.ZP,{value:null,children:z({id:"device.deploy.mode.self_agent"},{data:null})})]})}),(0,a.jsx)(u.Z.Item,{label:"Mode",name:"mode",children:(0,a.jsxs)(N.ZP.Group,{children:[(0,a.jsxs)(N.ZP,{value:"active",children:["active",(0,a.jsx)(W.Z,{placement:"topLeft",content:(0,a.jsx)(P._H,{id:"device.mode.active"}),children:(0,a.jsx)(bt.Z,{style:{opacity:.65,marginLeft:2}})})]}),(0,a.jsxs)(N.ZP,{value:"passive",children:["passive",(0,a.jsx)(W.Z,{placement:"topLeft",content:(0,a.jsx)(P._H,{id:"device.mode.passive"}),children:(0,a.jsx)(bt.Z,{style:{opacity:.65,marginLeft:2}})})]})]})}),(0,a.jsx)(u.Z.Item,{label:"arch",name:"arch",required:!0,children:(0,a.jsxs)(Ke.Z,{onSelect:function(Ye){return An(Ye)},children:[(0,a.jsx)(Ke.Z.Option,{value:"x86_64",children:"x86_64"}),(0,a.jsx)(Ke.Z.Option,{value:"aarch64",children:"aarch64"})]})}),(0,a.jsx)(u.Z.Item,{label:(0,a.jsx)(P._H,{id:"agent.modal.Version"}),name:"version",rules:[{required:!0,message:z({id:"please.select"})}],children:(0,a.jsx)(Ke.Z,{placeholder:z({id:"please.select"}),showSearch:!0,optionFilterProp:"children",filterOption:function(Ye,Tt){return Tt.children.toLowerCase().indexOf(Ye.toLowerCase())>=0},children:yn==null?void 0:yn.map(function(jt){return(0,a.jsx)(Ke.Z.Option,{value:jt.version,children:jt.version},jt.id)})})}),!$e&&ft==="common"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Z.Item,{label:"User",name:"user",rules:[{required:!1,max:20,message:z({id:"device.user.message"})}],children:(0,a.jsx)(I.Z,{placeholder:z({id:"please.enter"}),autoComplete:"off"})}),(0,a.jsx)(u.Z.Item,{label:"Password",name:"password",children:(0,a.jsx)(I.Z.Password,{placeholder:z({id:"please.enter"})})})]})]})]})})})})},60798:function(zt,Jt,t){"use strict";var gn=t(69230),it=t(33821),Ht=t(20693),St=t(3278),Mt=t(20418),Ke=t(35832),Dn=t(32326),W=t(65790),ct=t(17187),N=t(39190),kt=t(22374),I=t(24895),fn=t.n(I),R=t(22812),Gt=t(24812),B=t(75841),Fe=t(97207),m=t.n(Fe),ge=t(52454);Jt.Z=function(s){var n=s.contrl,u=s.disabled,C=u===void 0?!1:u,ne=s.callBackProjectId,bt=s.onRef,P=bt===void 0?null:bt,Yt=s.template,V=Yt===void 0?{}:Yt,a=s.test_type,Qt=a===void 0?"":a,Q=s.business_type,ae=Q===void 0?"":Q,Zt=s.baselineListDataRef,r=s.projectListDataRef,H=(0,R.YB)(),je=H.formatMessage,Je=ct.Z.useForm(),oe=(0,N.Z)(Je,1),ve=oe[0],e=(0,Gt.UO)(),z=e.ws_id,Ct=kt.useState([]),Xt=(0,N.Z)(Ct,2),M=Xt[0],me=Xt[1],re={page_num:1,page_size:20,ws_id:z,search:"",tab:"all",test_type:Qt},gt=(0,R.QT)(function(){return(0,B.YK)({ws_id:z,page_size:500})},{manual:!0,initialData:[]}),Be=gt.data,jn=gt.run,Zn=(0,R.QT)(function(){return(0,B.bU)({ws_id:z,test_type:Qt,page_size:500})},{manual:!0,initialData:[]}),dt=Zn.data,xn=Zn.run,vn=function(){var X=(0,Dn.Z)((0,Ke.Z)().mark(function Ie(Ot){var Kt,Dt;return(0,Ke.Z)().wrap(function(ut){for(;;)switch(ut.prev=ut.next){case 0:return ut.next=2,(0,B.NQ)(Ot);case 2:Kt=ut.sent,Dt=Kt.data,me(Dt);case 5:case"end":return ut.stop()}},Ie)}));return function(Ot){return X.apply(this,arguments)}}();(0,kt.useEffect)(function(){"baseline"in n&&xn(),"project"in n&&jn(),"baseline_job"in n&&vn(re)},[n,C]),(0,kt.useImperativeHandle)(P,function(){return{form:ve,reset:function(){ve.resetFields()},setVal:function(Ie){ve.setFieldsValue(Ie)}}}),kt.useEffect(function(){if(r&&(r.current=Be),Zt&&(Zt.current=dt),JSON.stringify(V)!=="{}"){var X=V.project,Ie=V.baseline,Ot=V.project_id,Kt=V.baseline_id,Dt=V.baseline_job,wt=V.baseline_job_id,ut=X||Ot,yn=Ie||Kt,ln=Dt||wt;if(ut&&Be.length>0){var Mn=Be.findIndex(function(_e){return _e.id===ut});ve.setFieldsValue({project:~Mn?ut:void 0})}if(yn&&dt.length>0){var Ce=dt.findIndex(function(_e){return _e.id===yn});ve.setFieldsValue({baseline:~Ce?yn:void 0})}if(ln&&M.length>0){var ce=M.findIndex(function(_e){return _e.id===ln});ve.setFieldsValue({baseline_job_id:~ce?ln:void 0})}}},[Be,dt,M,V]),(0,kt.useEffect)(function(){if(JSON.stringify(V)!=="{}"){var X=V.baseline_id;ve.setFieldsValue((0,Mt.Z)((0,Mt.Z)({},V),{},{baseline_id:X}))}return function(){ve.resetFields()}},[V]),(0,kt.useEffect)(function(){if(Be.length>0){if(!ve.getFieldValue("project")){var X=Be.filter(function(Ie){return Ie.is_default})[0];X&&ve.setFieldsValue({project:X.id})}ne(Be[0].id)}},[Be]);var En=function(Ie){ne(Ie)},Tn=(0,Fe.debounce)(function(X){vn((0,Mt.Z)((0,Mt.Z)({},re),{},{search:X}))},500);return(0,ge.jsxs)(ct.Z,{colon:!1,layout:"horizontal",size:"small",labelCol:{span:5},wrapperCol:{span:14},style:{width:"100%"},name:"basic",form:ve,className:fn().job_test_form,children:["job_name"in n&&(0,ge.jsx)(ct.Z.Item,{name:"name",label:n.job_name.alias||(0,ge.jsx)(R._H,{id:"job.form.".concat(n.job_name.name)}),rules:[{pattern:/^[A-Za-z0-9\{}\._-]+$/g,message:je({id:"job.form.job_name.message"},{date:"{date}"})},{max:128,message:je({id:"job.form.job_name.limit.message"})}],children:(0,ge.jsx)(St.Z,{autoComplete:"off",title:je({id:"job.form.job_name.message"},{date:"{date}"}),placeholder:je({id:"job.form.job_name.message"},{date:"{date}"}),disabled:C})}),"project"in n&&(0,ge.jsx)(ct.Z.Item,{name:"project",label:n.project.alias||(0,ge.jsx)(R._H,{id:"job.form.".concat(n.project.name)}),children:(0,ge.jsx)(it.Z,{allowClear:!0,getPopupContainer:function(Ie){return Ie.parentNode},showSearch:!0,disabled:C,placeholder:je({id:"job.form.project.placeholder"}),onSelect:En,filterOption:function(Ie,Ot){return Ot.label.indexOf(Ie)>=0},options:Be.map(function(X){return{label:"".concat(X.name,"(").concat(X.product_name,")"),value:X.id}})})}),(["functional","performance"].includes(Qt)||["functional","performance"].includes(ae))&&"baseline"in n&&(0,ge.jsx)(ct.Z.Item,{name:"baseline",label:n.baseline.alias||(0,ge.jsx)(R._H,{id:"job.form.".concat(n.baseline.name)}),children:(0,ge.jsx)(it.Z,{allowClear:!0,getPopupContainer:function(Ie){return Ie.parentNode},showSearch:!0,disabled:C,placeholder:je({id:"job.form.baseline.placeholder"}),filterOption:function(Ie,Ot){return Ot.label.indexOf(Ie)>=0},options:dt.map(function(X){return{label:X.name,value:X.id}})})}),"baseline_job"in n&&(0,ge.jsx)(ct.Z.Item,{name:"baseline_job_id",label:n.baseline_job.alias||(0,ge.jsx)(R._H,{id:"job.form.".concat(n.baseline_job.name)}),children:(0,ge.jsx)(it.Z,{allowClear:!0,showSearch:!0,getPopupContainer:function(Ie){return Ie.parentNode},placeholder:je({id:"job.form.baseline_job_id.placeholder"}),onSearch:Tn,disabled:C,filterOption:!1,options:M.map(function(X){return{label:"#".concat(X.id," ").concat(X.name),value:X.id}})})})]})}},22686:function(zt,Jt,t){"use strict";var gn=t(20693),it=t(3278),Ht=t(14320),St=t(53479),Mt=t(70772),Ke=t(6701),Dn=t(69230),W=t(33821),ct=t(88966),N=t(11048),kt=t(488),I=t(20418),fn=t(65790),R=t(17187),Gt=t(39190),B=t(22374),Fe=t(24895),m=t.n(Fe),ge=t(14582),s=t(96211),n=t(78938),u=t(39854),C=t(86323),ne=t(526),bt=t(40896),P=t(22812),Yt=t(97207),V=t.n(Yt),a=t(52454),Qt=["branch","kernel_packages"];Jt.Z=function(Q){var ae=Q.contrl,Zt=Q.disabled,r=Zt===void 0?!1:Zt,H=Q.envErrorFlag,je=Q.project_id,Je=Q.onRef,oe=Je===void 0?null:Je,ve=Q.template,e=ve===void 0?{}:ve,z=(0,P.YB)(),Ct=z.formatMessage,Xt=R.Z.useForm(),M=(0,Gt.Z)(Xt,1),me=M[0],re=(0,B.useState)(!1),gt=(0,Gt.Z)(re,2),Be=gt[0],jn=gt[1],Zn=(0,B.useState)(!1),dt=(0,Gt.Z)(Zn,2),xn=dt[0],vn=dt[1],En=(0,B.useState)(!1),Tn=(0,Gt.Z)(En,2),X=Tn[0],Ie=Tn[1],Ot=(0,B.useState)("no"),Kt=(0,Gt.Z)(Ot,2),Dt=Kt[0],wt=Kt[1],ut=function(ce){wt(ce.target.value),!r&&me.resetFields(["kernel_packages","kernel_version","scripts"])};(0,B.useImperativeHandle)(oe,function(){return{form:me,reset:function(){me.resetFields(),jn(!1),vn(!1),Ie(!1),wt("no")},setVal:function(ce){var _e=ce.rpm_info,de=ce.script_info,$t=ce.kernel_version,ft=ce.kernel_info,on=ce.build_pkg_info;_e=_e||[{pos:"before",rpm:""}],de=de||[{pos:"before",script:""}],me.resetFields();var pt="no";if(ft&&V().get(ft,"kernel_packages")&&$t){pt="install_push",me.setFieldsValue((0,I.Z)((0,I.Z)({},ce),{},{kernel_install:pt,rpm_info:_e,script_info:de})),wt(pt);return}if(ft&&V().get(ft,"kernel_packages")&&!$t){pt="install_un_push",me.setFieldsValue((0,I.Z)((0,I.Z)({},ce),{},{kernel_install:pt,rpm_info:_e,script_info:de})),wt(pt);return}if(on&&V().get(on,"code_repo")&&V().get(on,"code_branch")&&V().get(on,"cpu_arch")){pt="install_build_kernel",me.setFieldsValue((0,I.Z)((0,I.Z)({},ce),{},{kernel_install:pt,rpm_info:_e,script_info:de})),wt(pt);return}me.setFieldsValue((0,I.Z)((0,I.Z)({},ce),{},{kernel_install:pt,rpm_info:_e,script_info:de})),wt(pt)}}}),(0,B.useEffect)(function(){H&&me.scrollToField("env_info")},[H]);var yn=(0,P.QT)(function(){return(0,ge.ZP)({enable:"True"})}),ln=yn.data;(0,B.useEffect)(function(){if(JSON.stringify(e)!=="{}"){var Ce=e.monitor_info,ce=e.need_reboot,_e=e.rpm_info,de=e.script_info,$t=e.env_info,ft=e.kernel_info,on=e.kernel_version,pt=e.iclone_info,In=e.build_pkg_info,Et=pt||{},qt=Et.os,Wn=qt===void 0?"":qt,wn=Et.app_name,Ln=wn===void 0?"":wn,An=ft||{},$e=An.branch,Ne=An.kernel_packages,Re=(0,kt.Z)(An,Qt),Ge=!1;(Wn||Ln)&&(Ge=!0,jn(Ge));var _t=In&&JSON.stringify(In)!=="{}";on&&wt("install_push"),!on&&!_t&&Ne&&wt(Ne.length>0?"install_un_push":"no"),_t&&wt("install_build_kernel"),vn(ce);var at=!1;Ce&&Ce.length>0&&(Ie(!0),at=!0);var mn=$t?(0,ne.xX)($t):"",Fn=V().isArray(Ce)?Ce.map(function(vt){var pn={monitor_type:vt.monitor_type};return V().get(vt,"monitor_type")==="custom_machine"&&(pn.server=vt.server_input),pn}):[];me.setFieldsValue((0,I.Z)((0,I.Z)({monitor_info:Ce&&Ce.length>0?Fn:[{monitor_type:"case_machine",server:""}],rpm_info:_e&&_e.length>0?_e:[{pos:"before",rpm:""}],script_info:de&&de.length>0?de:[{pos:"before",script:""}],need_reboot:ce,env_info:mn,reclone_contrl:Ge,os:Wn,app_name:Ln,moniter_contrl:at,kernel_version:on,kernel_packages:Ne},Re),In))}},[e,ln]);var Mn=function(ce){var _e=ce.target;vn(_e.value)};return(0,B.useEffect)(function(){me.setFieldsValue({kernel_install:Dt})},[Dt]),(0,a.jsxs)(R.Z,{colon:!1,layout:"horizontal",size:"small",labelCol:{span:5},wrapperCol:{span:14},style:{width:"100%"},name:"env",form:me,className:m().job_test_form,initialValues:{rpm_info:[{pos:"before",rpm:""}],script_info:[{pos:"before",script:""}],monitor_info:[{monitor_type:"case_machine",server:""}],need_reboot:!1,hotfix_install:!0,scripts:[{pos:"before",script:""}],kernel_install:"no"},children:["reclone"in ae&&(0,a.jsx)(R.Z.Item,{label:ae.reclone.alias||(0,a.jsx)(P._H,{id:"job.form.".concat(ae.reclone.name)}),name:"reclone_contrl",initialValue:!1,children:(0,a.jsxs)(N.ZP.Group,{disabled:r,onChange:function(ce){var _e=ce.target;return jn(_e.value)},children:[(0,a.jsx)(N.ZP,{value:!0,children:(0,a.jsx)(P._H,{id:"operation.yes"})}),(0,a.jsx)(N.ZP,{value:!1,children:(0,a.jsx)(P._H,{id:"operation.no"})})]})}),Be&&(0,a.jsxs)(R.Z.Item,{label:" ",children:[(0,a.jsx)(R.Z.Item,{label:(0,a.jsx)(P._H,{id:"job.form.physical.machine"}),children:(0,a.jsxs)(St.Z,{gutter:10,children:[(0,a.jsx)(Ke.Z,{span:12,children:(0,a.jsx)(R.Z.Item,{name:"os",noStyle:!0,children:(0,a.jsxs)(W.Z,{getPopupContainer:function(ce){return ce.parentNode},placeholder:(0,a.jsx)(P._H,{id:"job.form.iclone.os"}),disabled:r,children:[(0,a.jsx)(W.Z.Option,{value:"AliOS7U2-4.9-x86-64",children:"AliOS7U2-4.9-x86-64"}),(0,a.jsx)(W.Z.Option,{value:"AliOS7U2-aarch64",children:"AliOS7U2-aarch64"}),(0,a.jsx)(W.Z.Option,{value:"AliOS7U2-x86-64",children:"AliOS7U2-x86-64"})]})})}),(0,a.jsx)(Ke.Z,{span:12,children:(0,a.jsx)(R.Z.Item,{name:"app_name",noStyle:!0,children:(0,a.jsxs)(W.Z,{getPopupContainer:function(ce){return ce.parentNode},placeholder:(0,a.jsx)(P._H,{id:"job.form.iclone.template"}),disabled:r,children:[(0,a.jsx)(W.Z.Option,{value:"baseos_server",children:"baseos_server"}),(0,a.jsx)(W.Z.Option,{value:"app_server",children:"app_server"})]})})})]})}),(0,a.jsx)(R.Z.Item,{name:"vm",label:(0,a.jsx)(P._H,{id:"job.form.vm"}),children:(0,a.jsx)(W.Z,{getPopupContainer:function(ce){return ce.parentNode},placeholder:(0,a.jsx)(P._H,{id:"job.form.vm.config"}),disabled:r})})]}),"kernel_install"in ae&&(0,a.jsx)(R.Z.Item,{label:ae.kernel_install.alias||(0,a.jsx)(P._H,{id:"job.form.".concat(ae.kernel_install.name)}),name:"kernel_install",children:(0,a.jsxs)(N.ZP.Group,{value:Dt,disabled:r,onChange:ut,children:[(0,a.jsx)(N.ZP,{value:"no",children:(0,a.jsx)(P._H,{id:"job.form.uninstall"})}),(0,a.jsx)(N.ZP,{value:"install_push",children:(0,a.jsx)(P._H,{id:"job.form.install_push"})}),(0,a.jsx)(N.ZP,{value:"install_un_push",children:(0,a.jsx)(P._H,{id:"job.form.install_un_push"})}),(0,a.jsx)(N.ZP,{value:"install_build_kernel",children:(0,a.jsx)(P._H,{id:"job.form.install_build_kernel"})})]})}),Dt==="install_push"&&(0,a.jsx)(s.Z,{form:me,kernel:Dt,kernelList:ln,disabled:r}),Dt==="install_un_push"&&(0,a.jsx)(n.Z,{disabled:r,form:me}),Dt==="install_build_kernel"&&(0,a.jsx)(u.Z,{disabled:r,form:me,project_id:je}),"reboot"in ae&&(0,a.jsx)(R.Z.Item,{label:ae.reboot.alias||(0,a.jsx)(P._H,{id:"job.form.".concat(ae.reboot.name)}),name:"need_reboot",children:(0,a.jsxs)(N.ZP.Group,{disabled:r,onChange:Mn,children:[(0,a.jsx)(N.ZP,{value:!0,children:(0,a.jsx)(P._H,{id:"operation.yes"})}),(0,a.jsx)(N.ZP,{value:!1,children:(0,a.jsx)(P._H,{id:"operation.no"})})]})}),"global_variable"in ae&&(0,a.jsx)(R.Z.Item,{label:ae.global_variable.alias||(0,a.jsx)(P._H,{id:"job.form.".concat(ae.global_variable.name)}),children:(0,a.jsx)(R.Z.Item,{name:"env_info",rules:[function(){return{validator:function(ce,_e){if(_e){var de=/^(\w+=((('[^']+'|"[^"]+")|.+)(\n)))*\w+=(('[^']+'|"[^"]+")|.+)$/;return de.test(_e)?Promise.resolve():Promise.reject(Ct({id:"job.form.env_info.placeholder"}))}else return Promise.resolve()}}}],children:(0,a.jsx)(it.Z.TextArea,{disabled:r,placeholder:Ct({id:"job.form.env_info.placeholder"})})})}),"rpm"in ae&&(0,a.jsx)(C.Z,{form:me,label:ae.rpm.alias||(0,a.jsx)(P._H,{id:"job.form.".concat(ae.rpm.name)}),listName:"rpm_info",textName:"rpm",radioName:"pos",buttonText:Ct({id:"job.form.rpm.buttonText"}),placeholder:Ct({id:"job.form.rpm.placeholder"}),buttonShow:xn,disabled:r}),"script"in ae&&(0,a.jsx)(C.Z,{form:me,label:ae.script.alias||(0,a.jsx)(P._H,{id:"job.form.".concat(ae.script.name)}),listName:"script_info",textName:"script",radioName:"pos",buttonText:Ct({id:"job.form.script.buttonText"}),placeholder:Ct({id:"job.form.script.placeholder"}),buttonShow:xn,disabled:r}),"monitor"in ae&&(0,a.jsx)(R.Z.Item,{label:ae.monitor.alias||(0,a.jsx)(P._H,{id:"job.form.".concat(ae.monitor.name,".config")}),name:"moniter_contrl",initialValue:!1,children:(0,a.jsxs)(N.ZP.Group,{disabled:r,onChange:function(ce){var _e=ce.target;Ie(_e.value),_e&&me.setFieldsValue((0,I.Z)((0,I.Z)({},me.getFieldsValue()),{},{monitor_info:[{monitor_type:"case_machine",server:""}]}))},children:[(0,a.jsx)(N.ZP,{value:!0,children:(0,a.jsx)(P._H,{id:"operation.yes"})}),(0,a.jsx)(N.ZP,{value:!1,children:(0,a.jsx)(P._H,{id:"operation.no"})})]})}),X&&(0,a.jsx)(bt.Z,{disabled:r,formComponent:me,template:e})]})}},48451:function(zt,Jt,t){"use strict";t.d(Jt,{Z:function(){return Zt}});var gn=t(39693),it=t(20693),Ht=t(3278),St=t(20418),Mt=t(35832),Ke=t(32326),Dn=t(65790),W=t(17187),ct=t(39190),N=t(69230),kt=t(33821),I=t(22374),fn=t(24895),R=t.n(fn),Gt=t(12568),B=t(6895),Fe=t(13059),m=t(53676),ge=t(41428),s=t(74066),n=t(97939),u=t(52454),C,ne=(0,n.ZP)(s.Z)(C||(C=(0,ge.Z)([`
	color: rgba(0, 0, 0, 0.65);
	cursor: pointer;
	position: absolute;
	right: -22px;
	top: 5px;
`]))),bt=function(H){var je=H.contextNode,Je=H.placement,oe=Je===void 0?"top":Je,ve=H.style,e=ve===void 0?{}:ve;return(0,u.jsx)(m.Z,{placement:oe,overlayStyle:{zIndex:1e4},content:je,color:"#fff",children:(0,u.jsx)(ne,{style:e})})},P=bt,Yt=t(75841),V=t(22812),a=t(24812),Qt=t(97207),Q=t.n(Qt),ae=kt.Z.Option,Zt=function(r){var H=r.contrl,je=r.disabled,Je=je===void 0?!1:je,oe=r.onRef,ve=oe===void 0?null:oe,e=r.template,z=e===void 0?{}:e,Ct=r.isReset,Xt=r.tagsDataRef,M=r.reportTemplateDataRef,me=(0,V.YB)(),re=me.formatMessage,gt=(0,a.UO)(),Be=gt.ws_id,jn=W.Z.useForm(),Zn=(0,ct.Z)(jn,1),dt=Zn[0],xn=(0,I.useState)([]),vn=(0,ct.Z)(xn,2),En=vn[0],Tn=vn[1],X=I.useState(),Ie=(0,ct.Z)(X,2),Ot=Ie[0],Kt=Ie[1],Dt=(0,I.useState)([]),wt=(0,ct.Z)(Dt,2),ut=wt[0],yn=wt[1],ln=(0,I.useState)({}),Mn=(0,ct.Z)(ln,2),Ce=Mn[0],ce=Mn[1],_e=(0,I.useState)(""),de=(0,ct.Z)(_e,2),$t=de[0],ft=de[1],on=(0,I.useState)(!1),pt=(0,ct.Z)(on,2),In=pt[0],Et=pt[1];(0,I.useImperativeHandle)(ve,function(){return{form:dt,reset:function(){dt.resetFields()},setVal:function(Ne){var Re=/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i,Ge=Q().get(Ne,"callback_api")||"",_t=Re.test(Ge);Et(Ge&&!_t),Kt(Q().get(Ne,"report_name")||""),ft(Ge),dt.setFieldsValue(Ne)}}});var qt=function(){var $e=(0,Ke.Z)((0,Mt.Z)().mark(function Ne(){var Re,Ge;return(0,Mt.Z)().wrap(function(at){for(;;)switch(at.prev=at.next){case 0:return at.next=2,(0,Gt.oG)({ws_id:Be,page_size:500});case 2:Re=at.sent,Ge=Re.data,Xt&&(Xt.current=Ge),Tn(Ge);case 6:case"end":return at.stop()}},Ne)}));return function(){return $e.apply(this,arguments)}}(),Wn=function(){var $e=(0,Ke.Z)((0,Mt.Z)().mark(function Ne(){var Re,Ge,_t,at,mn;return(0,Mt.Z)().wrap(function(vt){for(;;)switch(vt.prev=vt.next){case 0:return vt.prev=0,vt.next=3,(0,Yt.MD)({ws_id:Be,page_size:99999});case 3:Re=vt.sent,Ge=Re.code,_t=Re.data,Ge===200&&(at=Q().isArray(_t)?_t:[],mn=Q().find(at,{is_default:!0}),M&&(M.current=at),yn(at),ce(mn)),vt.next=12;break;case 9:vt.prev=9,vt.t0=vt.catch(0),console.log(vt.t0);case 12:case"end":return vt.stop()}},Ne,null,[[0,9]])}));return function(){return $e.apply(this,arguments)}}();(0,I.useEffect)(function(){Wn(),qt()},[]),(0,I.useEffect)(function(){Ct&&(Kt(""),ft(""))},[Ct]),(0,I.useEffect)(function(){if(JSON.stringify(z)!=="{}"){var $e,Ne,Re,Ge=z.cleanup_info,_t=z.tags,at=z.notice_info,mn=z.report_name,Fn=z.callback_api,vt=z.job_timeout,pn=z.report_template||z.report_template_id;if(Q().isArray(at)&&at.forEach(function(Ye){$e=Ye.subject,Ye.type==="email"&&(Ne=Ye.to),Ye.type==="ding"&&(Re=Ye.to)}),Q().isArray(ut)){var jt=Q().find(ut,["id",pn]);pn=Q().get(jt,"id")}dt.setFieldsValue({cleanup_info:Ge,tags:_t,notice_subject:$e,email:Ne,ding_token:Re,report_template:pn,report_name:mn,callback_api:Fn,job_timeout:vt}),Kt(mn),ft(Fn)}},[Ce,ut,z]);var wn=function(Ne){var Re=Ne.target.value,Ge=Q().cloneDeep(dt.getFieldsValue()),_t=Q().get(Ge,"report_template")||Q().get(Ce,"id");dt.setFieldsValue((0,St.Z)((0,St.Z)({},Ge),{},{report_name:Re,report_template:_t})),Kt(Re)},Ln=function(Ne){var Re=Ne.target.value;ft(Re);var Ge=Q().cloneDeep(dt.getFieldsValue());dt.setFieldsValue((0,St.Z)((0,St.Z)({},Ge),{},{callback_api:Re}));var _t=/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i,at=_t.test(Re);Et(Re&&!at)},An=function(){return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{children:(0,u.jsx)(V._H,{id:"job.form.callback_api.tips"})}),(0,u.jsx)("span",{className:R().create_doc,onClick:function(){return window.open("/help_doc/17")},children:(0,u.jsx)(V._H,{id:"job.form.callback_api.help.document"})})]})};return(0,u.jsxs)(W.Z,{colon:!1,layout:"horizontal",size:"small",labelCol:{span:5},wrapperCol:{span:14},style:{width:"100%"},name:"more",form:dt,className:R().job_test_form,children:["cleanup"in H&&(0,u.jsx)(W.Z.Item,{name:"cleanup_info",label:H.cleanup.alias||(0,u.jsx)(V._H,{id:"job.form.".concat(H.cleanup.name)}),children:(0,u.jsx)(Ht.Z.TextArea,{disabled:Je,placeholder:re({id:"job.form.cleanup_info.placeholder"})})}),"job_tag"in H&&(0,u.jsx)(B.OT,{tags:En,label:H.job_tag.alias||(0,u.jsx)(V._H,{id:"job.form.".concat(H.job_tag.name)}),disabled:Je}),"notice_subject"in H&&(0,u.jsx)(W.Z.Item,{name:"notice_subject",label:H.notice_subject.alias||(0,u.jsx)(V._H,{id:"job.form.".concat(H.notice_subject.name)}),children:(0,u.jsx)(Ht.Z,{autoComplete:"off",disabled:Je,placeholder:re({id:"job.form.notice_subject.placeholder"},{date:"{date}"})})}),"email_notice"in H&&(0,u.jsx)(W.Z.Item,{name:"email",label:H.email_notice.alias||(0,u.jsx)(V._H,{id:"job.form.".concat(H.email_notice.name)}),rules:[function(){return{validator:function(Ne,Re){var Ge=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(Re){var _t=Re.split(/,|，|\n|\s/g),at=_t.filter(function(mn){return!Ge.test(mn)});return at.length===0?Promise.resolve():Promise.reject(re({id:"job.form.email.validator"}))}else return Promise.resolve()}}}],children:(0,u.jsx)(Ht.Z,{autoComplete:"off",disabled:Je,placeholder:re({id:"job.form.email.placeholder"})})}),"ding_notice"in H&&(0,u.jsx)(W.Z.Item,{name:"ding_token",label:H.ding_notice.alias||(0,u.jsx)(V._H,{id:"job.form.".concat(H.ding_notice.name)}),children:(0,u.jsx)(Ht.Z,{autoComplete:"off",disabled:Je,placeholder:re({id:"job.form.ding_token.placeholder"})})}),"report"in H&&(0,u.jsxs)(W.Z.Item,{label:H.report.alias||re({id:"job.form.report.label"}),name:"report_name",children:[(0,u.jsx)(Ht.Z,{value:Ot||void 0,onChange:wn,autoComplete:"off",disabled:Je,placeholder:re({id:"job.form.report.placeholder"},{job_name:"{job_name}",report_seq_id:"{report_seq_id}"})}),(0,u.jsx)(P,{contextNode:(0,u.jsxs)("div",{children:[(0,u.jsx)(V._H,{id:"job.form.report.tips"}),(0,u.jsx)("p",{style:{marginBottom:0},children:"{date} {job_name} {job_id} {product_version}"})]})})]}),Ot&&"report"in H&&(0,u.jsx)(W.Z.Item,{name:"report_template",label:H.report.alias||re({id:"job.form.report_template.label"}),children:(0,u.jsx)(kt.Z,{showSearch:!0,disabled:Je,placeholder:re({id:"job.form.report_template.placeholder"}),optionFilterProp:"children",filterOption:function(Ne,Re){return Re.children.toLowerCase().indexOf(Ne.toLowerCase())>=0},children:ut.map(function($e){return(0,u.jsx)(ae,{value:$e.id,children:$e.name},$e.id)})})}),"callback_api"in H&&(0,u.jsxs)(W.Z.Item,{name:"callback_api",label:H.callback_api.alias||re({id:"job.form.callback_api.label"}),validateStatus:In&&"error"||void 0,help:In&&re({id:"job.form.callback_api.help"}),children:[(0,u.jsx)(Ht.Z,{value:$t,onChange:Ln,autoComplete:"off",disabled:Je,placeholder:re({id:"job.form.callback_api.placeholder"})}),(0,u.jsx)(P,{contextNode:(0,u.jsxs)("div",{children:[(0,u.jsx)(V._H,{id:"job.form.callback_api.icons"}),(0,u.jsx)("p",{style:{marginBottom:0},children:An()})]})})]}),!1]})}},19208:function(zt,Jt,t){"use strict";t.d(Jt,{Z:function(){return ha}});var gn=t(67448),it=t(47548),Ht=t(40204),St=t(10724),Mt=t(64510),Ke=t(87445),Dn=t(53374),W=t(61674),ct=t(57359),N=t(34423),kt=t(90846),I=t(56511),fn=t(31650),R=t(25100),Gt=t(46721),B=t(94867),Fe=t(35832),m=t(20418),ge=t(32326),s=t(39190),n=t(22374),u=t(97207),C=t.n(u),ne=t(88018),bt=t(58414),P=t(68501),Yt=t(98501),V=t(38519),a=t(16416),Qt=t(20693),Q=t(3278),ae=t(99193),Zt=t(66304),r=t(22812),H=t(24812),je=t(93354),Je=t(11467),oe=t.n(Je),ve=t(91959),e=t(52454),z=function(l){var c=l.testType,j=l.onRef,_=l.handleSelect,p=l.control,L=l.treeData,h=L===void 0?[]:L,ue=l.loading,Pe=(0,r.YB)(),xe=Pe.formatMessage,He=Q.Z.Search,G=(0,H.UO)(),Me=G.ws_id,Ue=(0,r.md)(),q=(0,n.useState)(!1),S=(0,s.Z)(q,2),E=S[0],Y=S[1],Qe=(0,n.useState)(!1),T=(0,s.Z)(Qe,2),A=T[0],Xe=T[1],$=(0,n.useState)(!1),fe=(0,s.Z)($,2),We=fe[0],Oe=fe[1],Rt=(0,n.useState)([]),Ve=(0,s.Z)(Rt,2),tt=Ve[0],xt=Ve[1],De=(0,n.useState)(!1),mt=(0,s.Z)(De,2),qe=mt[0],F=mt[1],f=(0,n.useState)(""),b=(0,s.Z)(f,2),O=b[0],we=b[1],se=n.useState(""),ie=(0,s.Z)(se,2),ht=ie[0],ot=ie[1],Bt=function(w){return~w.domain_name_list.indexOf(O)&&~w.name.toLowerCase().indexOf(ht.toLowerCase())},Wt=n.useMemo(function(){return h.map(function(U){return(0,m.Z)((0,m.Z)({},U),{},{rowkey:(0,ve.Z)()})})},[h]),hn=n.useMemo(function(){return Wt.reduce(function(U,w){var be=w.test_case_list,te=w.rowkey;return U.concat(te,be.map(function(pe){return pe.id}))},[])},[Wt,ht,O]),tn=n.useMemo(function(){return Wt.reduce(function(U,w){var be=w.test_case_list,te=w.rowkey;return Bt(w)?U.concat(te,be.map(function(pe){return pe.id})):U},[])},[Wt,O,ht]),ye=function(w){var be=w.slice().sort().join(",");be&&be===hn.slice().sort().join(",")?(Xe(!1),Oe(!0)):w&&w.length?(Xe(!0),Oe(!1)):(Xe(!1),Oe(!1))},ee=function(w){we(w)},rt=(0,r.QT)(je.ge,{initialData:[]}),Le=rt.data;(0,n.useImperativeHandle)(j,function(){return{openDrawer:function(w){var be=w.test_config,te=[];h.forEach(function(pe){var Rn=be.findIndex(function(st){var bn=st.id;return bn===pe.id});if(Rn>-1){var Sn=[];pe.test_case_list.forEach(function(st){var bn=be[Rn].test_case_list.findIndex(function(Hn){var kn=Hn.id;return kn===st.id});bn>-1&&Sn.push(st.id)}),Sn.length&&Sn.length===pe.test_case_list.length&&te.push(pe.id),Sn.length&&te.push.apply(te,Sn)}}),ye(te),xt(te),Y(!0)}}});var Se=function(w){xt(w),ye(w)},nn=function(w){var be=w.target;Oe(be.checked),xt(be.checked?hn:[])},an=function(){Y(!1),xt([]),we(""),ot("")},cn=function(){var w=(0,u.cloneDeep)(h),be=w.filter(function(te){if(te.test_case_list=te.children.filter(function(pe){if(tt.indexOf(pe.id)>-1)return pe.setup_info="",pe.cleanup_info="",pe.need_reboot=!1,pe.console=void 0,pe.monitor_info=[{items:void 0,servers:void 0}],pe.priority=10,pe.server_object_id=void 0,pe.ip=pe.ip||"\u968F\u673A",pe.env_info=pe.var?JSON.parse(pe.var).length>0?JSON.parse(pe.var):[]:[],pe}),delete te.children,te.test_case_list.length>0)return te.need_reboot=!1,te.priority=10,te.console=void 0,te.monitor_info=[{items:void 0,servers:void 0}],te.setup_info="",te.cleanup_info="",te});_(be),an()},rn=n.useMemo(function(){return Wt.map(function(U){return{key:U.rowkey,title:U.name,children:U.test_case_list.map(function(w){return(0,m.Z)((0,m.Z)({},w),{},{key:w.id,title:w.name,selectable:!1,style:{display:Bt(U)?void 0:"none"}})}),style:{display:Bt(U)?void 0:"none"},selectable:!1,checkable:U.test_case_list.length!==0}})},[Wt,O,ht]);return(0,e.jsx)(bt.Z,{maskClosable:!1,keyboard:!1,className:oe().suite,title:(0,e.jsx)(r._H,{id:"select.suite.drawer.title"}),width:634,forceRender:!0,destroyOnClose:!0,onClose:function(){return Y(!1)},open:E,bodyStyle:{paddingBottom:80},footer:(0,e.jsxs)("div",{style:{textAlign:"right",padding:"0 8px"},children:[(0,e.jsx)(a.Z,{disabled:ue,indeterminate:A,onChange:nn,checked:We,style:{float:"left"},children:(0,e.jsx)(r._H,{id:"select.suite.drawer.checkbox"})}),(0,e.jsx)(B.Z,{onClick:an,style:{marginRight:8},children:(0,e.jsx)(r._H,{id:"operation.cancel"})}),(0,e.jsx)(B.Z,{onClick:cn,type:"primary",children:(0,e.jsx)(r._H,{id:"operation.ok"})})]}),children:(0,e.jsxs)(it.Z,{spinning:ue,wrapperClassName:oe().spinWrapper,children:[(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,e.jsx)(He,{onChange:function(w){var be,te=w.target;return ot(te==null||(be=te.value)===null||be===void 0?void 0:be.replace(/\s+/g,""))},placeholder:xe({id:"select.suite.search.placeholder"}),value:ht,allowClear:!0,style:{marginBottom:12}}),p.includes("domain")&&(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{style:{position:"relative",display:"flex"},children:[(0,e.jsx)("div",{className:oe().nav,children:(0,e.jsx)(r._H,{id:"select.suite.domain"})}),(0,e.jsxs)("div",{className:oe().domainList_Tab,children:[(0,e.jsx)(B.Z,{className:oe().domain_all,size:"small",type:O===""?"primary":"ghost",onClick:function(){return ee("")},children:(0,e.jsx)(r._H,{id:"select.suite.all.btn"})}),Le.map(function(U,w){if(!(!qe&&w>6))return(0,e.jsx)(B.Z,{type:U.name==O?"primary":"ghost",size:"small",style:(0,m.Z)({marginRight:8,marginBottom:8,boxShadow:"none"},U.name===O?{}:{border:"none"}),onClick:function(){return ee(U.name)},children:U.name},U.id)})]}),(0,e.jsx)(B.Z,{type:"link",size:"small",onClick:function(){return F(!qe)},icon:qe?(0,e.jsx)(ae.Z,{}):(0,e.jsx)(Zt.Z,{}),style:{position:"absolute",right:0},children:xe(qe?{id:"operation.collapse"}:{id:"operation.expand"})})]})})]}),tn!=null&&tn.length?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:oe().selection_table_thead,children:[(0,e.jsx)("div",{style:{width:200},children:"Test Suite"}),(0,e.jsx)("div",{children:(0,e.jsx)(r._H,{id:"select.suite.business.name"})})]}),(0,e.jsx)(Yt.Z,{className:oe().selection_table_tbody,checkedKeys:tt,checkable:!0,onCheck:Se,titleRender:function(w){var be=w||{},te=be.title,pe=be.children,Rn=be.business_name;return(0,e.jsxs)("div",{className:oe().selection_table_row,children:[(0,e.jsx)("div",{className:oe().col,style:{width:pe?200:"100%"},children:te||null}),(0,e.jsx)("div",{className:oe().otherCol,children:Rn||(pe?"-":null)})]},w.id)},treeData:rn})]}):(0,e.jsxs)("div",{style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[(0,e.jsx)(Ke.Z,{image:Ke.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsx)(r._H,{id:"select.suite.no.case"})}),(0,e.jsx)(r.Nv,{accessible:Ue.WsMemberOperateSelf(),children:(0,e.jsx)(R.Z.Link,{target:"_blank",href:c?"/ws/".concat(Me,"/test_suite?test_type=").concat(c):"/ws/".concat(Me,"/test_suite"),children:(0,e.jsx)(B.Z,{type:"primary",children:(0,e.jsx)(r._H,{id:"select.suite.add.case"})})})})]})]})})},Ct=z,Xt=t(79756),M=t.n(Xt),me=t(14320),re=t(53479),gt=t(41428),Be=t(97939),jn,Zn=Be.ZP.div(jn||(jn=(0,gt.Z)([`
    width: 100%;
    `,`
`])),function(D){var l=D.expanded;return l?"":"height: 32px; overflow: hidden;"}),dt=function(l){var c=l.dataSource,j=l.onChange,_=l.active,p=n.useRef(null),L=n.useRef(null),h=n.useState(!1),ue=(0,s.Z)(h,2),Pe=ue[0],xe=ue[1],He=n.useState(!1),G=(0,s.Z)(He,2),Me=G[0],Ue=G[1],q=n.useCallback(function(S){for(var E=0,Y=S.length;E<Y;E++){var Qe=S[E];if(Qe.intersectionRatio===0)return Ue(!0)}},[]);return n.useEffect(function(){var S=new IntersectionObserver(q,{root:L.current});if(L.current){var E=L.current.childNodes;E.forEach(function(Y){return S.observe(Y)})}return function(){S.disconnect()}},[]),(0,e.jsxs)(re.Z,{style:{display:"flex",flexFlow:"row nowrap"},children:[(0,e.jsx)("div",{ref:p,children:(0,e.jsx)(R.Z.Text,{strong:!0,children:(0,e.jsx)(r._H,{id:"select.suite.domain"})})}),(0,e.jsx)("div",{style:{flex:1},children:(0,e.jsx)(Zn,{expanded:Pe,ref:L,children:[{name:"",id:""}].concat(c||[]).map(function(S){var E={onClick:function(){j==null||j(S.name==="\u5168\u90E8"?"":S.name)},size:"small",style:{marginBottom:8,marginRight:8,border:"none",boxShadow:"none",transition:"none"},type:_===S.name?"primary":"ghost"};return(0,e.jsx)(B.Z,(0,m.Z)((0,m.Z)({},E),{},{children:S.name||(0,e.jsx)(r._H,{id:"all"})}),S.id)})})}),Me&&(0,e.jsx)(R.Z.Link,{style:{userSelect:"none"},children:Pe?(0,e.jsxs)(N.Z,{style:{cursor:"pointer"},onClick:function(){return xe(!1)},children:[(0,e.jsx)(ae.Z,{}),(0,e.jsx)(R.Z.Link,{children:(0,e.jsx)(r._H,{id:"operation.collapse"})})]}):(0,e.jsxs)(N.Z,{style:{cursor:"pointer"},onClick:function(){return xe(!0)},children:[(0,e.jsx)(Zt.Z,{}),(0,e.jsx)(R.Z.Link,{children:(0,e.jsx)(r._H,{id:"operation.expand"})})]})})]})},xn=dt,vn=function(l){var c=l.testType,j=l.onRef,_=l.handleSelect,p=l.control,L=l.treeData,h=L===void 0?[]:L,ue=l.loading,Pe=(0,r.YB)(),xe=Pe.formatMessage,He=(0,H.UO)(),G=He.ws_id,Me=Q.Z.Search,Ue=(0,n.useState)(!1),q=(0,s.Z)(Ue,2),S=q[0],E=q[1],Y=(0,r.md)(),Qe=(0,n.useState)([]),T=(0,s.Z)(Qe,2),A=T[0],Xe=T[1],$=(0,n.useState)(!1),fe=(0,s.Z)($,2),We=fe[0],Oe=fe[1],Rt=(0,n.useState)(""),Ve=(0,s.Z)(Rt,2),tt=Ve[0],xt=Ve[1],De=n.useState(""),mt=(0,s.Z)(De,2),qe=mt[0],F=mt[1],f=function(ee){return~ee.domain_name_list.indexOf(tt)&&~ee.name.toLowerCase().indexOf(qe.toLowerCase())},b=n.useMemo(function(){return h.map(function(ye){return(0,m.Z)((0,m.Z)({},ye),{},{rowkey:(0,ve.Z)()})})},[h]),O=n.useMemo(function(){return b.reduce(function(ye,ee){var rt=ee.test_case_list,Le=ee.rowkey;return ye.concat(Le,rt.map(function(Se){return Se.id}))},[])},[b,qe,tt]),we=n.useMemo(function(){return b.reduce(function(ye,ee){var rt=ee.test_case_list,Le=ee.rowkey;return f(ee)?ye.concat(Le,rt.map(function(Se){return Se.id})):ye},[])},[b,tt,qe]),se=function(ee){Oe(ee.slice().sort().join(",")&&ee.slice().sort().join(",")==O.slice().sort().join(","))},ie=(0,r.QT)(je.ge,{initialData:[]}),ht=ie.data;(0,n.useImperativeHandle)(j,function(){return{openDrawer:function(ee){var rt=ee.test_config,Le=h.reduce(function(Se,nn){var an=rt.findIndex(function(cn){var rn=cn.id;return rn===nn.id});return~an?Se.concat(nn.test_case_list.reduce(function(cn,rn){var U=rt[an].test_case_list.findIndex(function(w){var be=w.id;return be===rn.id});return~U?cn.concat(rn.id):cn},[])):Se},[]);se(Le),Xe(Le),E(!0)}}});var ot=function(ee){Xe(ee),se(ee)},Bt=function(ee){var rt=ee.target;Oe(rt.checked),Xe(rt.checked?O:[])},Wt=function(){E(!1),Xe([]),xt(""),F("")},hn=function(){var ee=(0,u.cloneDeep)(h),rt=ee.filter(function(Le){if(Le.test_case_list=Le.children.filter(function(Se){if(A.indexOf(Se.id)>-1)return Se.setup_info="",Se.cleanup_info="",Se.need_reboot=!1,Se.console=void 0,Se.monitor_info=[{items:void 0,servers:void 0}],Se.priority=10,Se.server_object_id=void 0,Se.ip=Se.ip||"\u968F\u673A",Se.env_info=Se.var?JSON.parse(Se.var).length>0?JSON.parse(Se.var):[]:[],Se}),delete Le.children,Le.test_case_list.length>0)return Le.need_reboot=!1,Le.priority=10,Le.console=void 0,Le.monitor_info=[{items:void 0,servers:void 0}],Le.setup_info="",Le.cleanup_info="",Le});_(rt),Wt()},tn=n.useMemo(function(){return b.map(function(ye){return{key:ye.rowkey,title:ye.name,children:ye.test_case_list.map(function(ee){return{key:ee.id,title:ee.name,selectable:!1,style:{display:f(ye)?void 0:"none"}}}),style:{display:f(ye)?void 0:"none"},selectable:!1,checkable:ye.test_case_list.length>0}})},[tt,qe,b]);return(0,e.jsx)(bt.Z,{maskClosable:!1,keyboard:!1,className:M().suite,title:(0,e.jsx)(r._H,{id:"select.suite.drawer.title"}),width:634,forceRender:!0,destroyOnClose:!0,onClose:function(){return E(!1)},open:S,bodyStyle:{paddingBottom:80},footer:(0,e.jsxs)("div",{style:{textAlign:"right",padding:"0 8px"},children:[!!O.length&&(0,e.jsx)(a.Z,{onChange:Bt,checked:We,disabled:ue,style:{float:"left"},children:(0,e.jsx)(r._H,{id:"select.suite.drawer.checkbox"})}),(0,e.jsx)(B.Z,{onClick:Wt,style:{marginRight:8},children:(0,e.jsx)(r._H,{id:"operation.cancel"})}),(0,e.jsx)(B.Z,{onClick:hn,type:"primary",children:(0,e.jsx)(r._H,{id:"operation.ok"})})]}),children:(0,e.jsxs)(it.Z,{spinning:ue,wrapperClassName:M().spinWrapper,children:[(0,e.jsx)(Me,{placeholder:xe({id:"please.enter"}),onChange:function(ee){var rt=ee.target;return F(rt.value.replace(/\s+/g,""))},value:qe,allowClear:!0}),(0,e.jsx)("div",{style:{marginTop:16},children:p.indexOf("domain")>-1&&(0,e.jsx)(xn,{active:tt,onChange:xt,dataSource:ht})}),!!(h!=null&&h.length)&&(0,e.jsx)(Yt.Z,{style:{marginTop:8},checkedKeys:A,checkable:!0,onCheck:ot,treeData:tn}),((h==null?void 0:h.length)===0||we.length===0)&&(0,e.jsxs)("div",{style:{height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[(0,e.jsx)(Ke.Z,{image:Ke.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsx)(r._H,{id:"select.suite.no.case"})}),(0,e.jsx)(r.Nv,{accessible:Y.WsMemberOperateSelf(),children:(0,e.jsx)(R.Z.Link,{target:"_blank",href:c?"/ws/".concat(G,"/test_suite?test_type=").concat(c):"/ws/".concat(G,"/test_suite"),children:(0,e.jsx)(B.Z,{type:"primary",children:(0,e.jsx)(r._H,{id:"select.suite.add.case"})})})})]})]})})},En=vn,Tn=t(11407),X=t(68077),Ie=t(79625),Ot=t(96584),Kt=t(76740),Dt=t(83396),wt=t(51937),ut=t(34516),yn=t(39693),ln=t(1518),Mn=t(88966),Ce=t(11048),ce=t(488),_e=t(65790),de=t(17187),$t=(0,n.createContext)(null),ft=t(33705),on=t(70772),pt=t(6701),In=t(69230),Et=t(33821),qt=t(70991),Wn=t(8281),wn=t(58591),Ln=function(l){var c=l.menu,j=l.uri,_=(0,r.md)();return(0,e.jsxs)(N.Z,{direction:"vertical",style:{width:"100%"},size:0,children:[c,(0,e.jsxs)(r.Nv,{accessible:_.IsSysTestAdmin(),fallback:(0,e.jsx)(e.Fragment,{}),children:[(0,e.jsx)(wn.Z,{style:{margin:0}}),(0,e.jsx)(re.Z,{justify:"center",align:"middle",style:{height:30},children:(0,e.jsx)(R.Z.Link,{target:"_blank",href:j,style:{width:"100%",textAlign:"center"},children:"\u53BB\u914D\u7F6E"})})]})]})},An=Ln,$e=t(23101);function Ne(D,l,c){c===void 0&&(c={});var j=(0,n.useRef)();j.current=l,(0,n.useEffect)(function(){var _=(0,$e.n)(c.target,window);if(!!_.addEventListener){var p=function(h){return j.current&&j.current(h)};return _.addEventListener(D,p,{capture:c.capture,once:c.once,passive:c.passive}),function(){_.removeEventListener(D,p,{capture:c.capture})}}},[D,c.target,c.capture,c.once,c.passive])}var Re=Ne;function Ge(){return!!(typeof window!="undefined"&&window.document&&window.document.createElement)}var _t=function(D,l){var c=typeof Symbol=="function"&&D[Symbol.iterator];if(!c)return D;var j=c.call(D),_,p=[],L;try{for(;(l===void 0||l-- >0)&&!(_=j.next()).done;)p.push(_.value)}catch(h){L={error:h}}finally{try{_&&!_.done&&(c=j.return)&&c.call(j)}finally{if(L)throw L.error}}return p},at=function(){return Ge()?document.visibilityState:"visible"};function mn(){var D=_t((0,n.useState)(function(){return at()}),2),l=D[0],c=D[1];return Re("visibilitychange",function(){c(at())},{target:function(){return document}}),l}var Fn=mn,vt=function(l){return new Map([["Available","success"],["Occupied","error"],["Reserved","warning"]]).get(l)||void 0},pn=function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],j=l==null?void 0:l.map(function(_){var p=_.id;return p});return c==null?void 0:c.reduce(function(_,p){return j.includes(p.id)?_:_.concat(p)},[]).concat(l)},jt=function(l){var c=(0,r.YB)(),j=c.formatMessage,_=l.serverObjectType,p=l.run_mode,L=l.server_type,h=l.serverList,ue=(0,H.UO)(),Pe=ue.ws_id,xe=(0,n.useContext)($t),He=xe.setServerList,G=100,Me=(0,n.useState)(!0),Ue=(0,s.Z)(Me,2),q=Ue[0],S=Ue[1],E=(0,n.useState)(1),Y=(0,s.Z)(E,2),Qe=Y[0],T=Y[1],A=n.useState(!1),Xe=(0,s.Z)(A,2),$=Xe[0],fe=Xe[1],We=function(){var F=(0,ge.Z)((0,Fe.Z)().mark(function f(){var b,O,we,se,ie=arguments;return(0,Fe.Z)().wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return b=ie.length>0&&ie[0]!==void 0?ie[0]:1,ot.next=3,(0,qt.fp)({ws_id:Pe,state:["Available","Occupied","Reserved"],page_num:b,page_size:G});case 3:O=ot.sent,we=O.data,se=O.code,se===200&&we&&He(function(Bt){return pn(Bt,we)});case 7:case"end":return ot.stop()}},f)}));return function(){return F.apply(this,arguments)}}(),Oe=function(){var F=(0,ge.Z)((0,Fe.Z)().mark(function f(){var b,O,we,se,ie=arguments;return(0,Fe.Z)().wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return b=ie.length>0&&ie[0]!==void 0?ie[0]:1,ot.next=3,(0,qt.Y_)({cluster_type:"aligroup",ws_id:Pe,page_num:b,page_size:G});case 3:O=ot.sent,we=O.data,se=O.code,se===200&&we&&He(function(Bt){return pn(Bt,we)});case 7:case"end":return ot.stop()}},f)}));return function(){return F.apply(this,arguments)}}(),Rt=function(){var F=(0,ge.Z)((0,Fe.Z)().mark(function f(){var b,O,we;return(0,Fe.Z)().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,(0,qt.CR)({ws_id:Pe,no_page:!0,is_instance:_==="instance",state:["Available","Occupied","Reserved"]});case 2:b=ie.sent,O=b.data,we=b.code,we===200&&O&&He(function(ht){return pn(ht,O)});case 6:case"end":return ie.stop()}},f)}));return function(){return F.apply(this,arguments)}}(),Ve=function(){var F=(0,ge.Z)((0,Fe.Z)().mark(function f(){var b,O,we;return(0,Fe.Z)().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,(0,qt.aN)({cluster_type:"aliyun",ws_id:Pe,no_page:!0});case 2:b=ie.sent,O=b.data,we=b.code,we===200&&O&&He(function(ht){return pn(ht,O)});case 6:case"end":return ie.stop()}},f)}));return function(){return F.apply(this,arguments)}}(),tt=function(){var F=(0,ge.Z)((0,Fe.Z)().mark(function f(){var b,O=arguments;return(0,Fe.Z)().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:if(b=O.length>0&&O[0]!==void 0?O[0]:1,S(!0),L!=="aligroup"){se.next=12;break}if(p!=="cluster"){se.next=8;break}return se.next=6,Oe(b);case 6:se.next=10;break;case 8:return se.next=10,We(b);case 10:se.next=19;break;case 12:if(p!=="cluster"){se.next=17;break}return se.next=15,Ve();case 15:se.next=19;break;case 17:return se.next=19,Rt();case 19:S(!1);case 20:case"end":return se.stop()}},f)}));return function(){return F.apply(this,arguments)}}();(0,n.useEffect)(function(){return _!=="ip"&&_!=="server_tag_id"&&(tt(1),T(1)),function(){fe(!1)}},[_]);var xt=Fn();n.useEffect(function(){xt==="hidden"&&fe(!0),$&&xt==="visible"&&(tt(1),T(1))},[xt]);var De=function(f){var b=f.target;if(L==="aligroup"){var O=b.clientHeight,we=b.scrollHeight,se=b.scrollTop;if(O+se===we){var ie=Qe+1;T(ie),tt(ie)}}},mt=(0,n.useMemo)(function(){switch(_){case"server_object_id":return j({id:"select.suite.server_object_id.message"});case"instance":return j({id:"select.suite.instance.message"});case"setting":return j({id:"select.suite.setting.message"});default:return""}},[_]),qe=(0,n.useMemo)(function(){var F=[];return _==="server_object_id"&&(p==="standalone"?F=h.map(function(f){var b=f.ip||f.sn;return{value:f.id,label:(0,e.jsxs)(R.Z.Text,{ellipsis:{tooltip:b},children:[(0,e.jsx)(I.Z,{status:vt(f.state),style:{marginRight:8}}),b]}),search_key:b}}):F=h.map(function(f){return{value:f.id,label:f.name,search_key:f.name}})),_==="instance"&&(F=h.filter(function(f){return f.is_instance}).map(function(f){var b=f.private_ip,O=b?"".concat(b," / ").concat(f.instance_name):f.instance_name;return{value:f.id,label:(0,e.jsxs)(R.Z.Text,{ellipsis:{tooltip:O},children:[(0,e.jsx)(I.Z,{style:{marginRight:8},status:vt(f.state)}),O]}),search_key:O}})),_==="setting"&&(F=h.filter(function(f){return!f.is_instance}).map(function(f){return{value:f.id,label:(0,e.jsx)(R.Z.Text,{ellipsis:{tooltip:!0},children:f.template_name}),search_key:f.template_name}})),F},[h,_,p]);return["ip","server_tag_id"].includes(_)?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)(de.Z.Item,{noStyle:!0,children:(0,e.jsx)(de.Z.Item,{name:"server_object_id",rules:[{required:!0,message:mt}],children:(0,e.jsx)(Et.Z,{allowClear:!0,style:{width:"100%"},placeholder:mt,dropdownMatchSelectWidth:340,showSearch:!0,loading:q,onPopupScroll:De,popupClassName:"job_select_drop_cls",dropdownRender:function(f){return(0,e.jsx)(An,{menu:f,uri:"/ws/".concat(Pe,"/device/").concat(L==="aliyun"?"cloud":"group","?t=").concat(p,"&isInstance=").concat(_==="instance"?1:0)})},optionFilterProp:"children",filterOption:function(f,b){var O;return((O=b==null?void 0:b.search_key)!==null&&O!==void 0?O:"").toLowerCase().includes(f.toLowerCase())},options:qe})})})},Ye=jt,Tt=function(l){var c=(0,r.YB)(),j=c.formatMessage,_=l.run_mode,p=l.server_type,L=l.serverObjectType,h=l.tagList,ue=(0,H.UO)(),Pe=ue.ws_id,xe=(0,n.useContext)($t),He=xe.setTagList,G=100,Me=(0,n.useState)(1),Ue=(0,s.Z)(Me,2),q=Ue[0],S=Ue[1],E=(0,n.useState)(!0),Y=(0,s.Z)(E,2),Qe=Y[0],T=Y[1],A=function(){var $=(0,ge.Z)((0,Fe.Z)().mark(function fe(){var We,Oe,Rt,Ve,tt=arguments;return(0,Fe.Z)().wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return We=tt.length>0&&tt[0]!==void 0?tt[0]:1,T(!0),De.next=4,(0,qt.yM)({ws_id:Pe,run_mode:_,page_num:We,run_environment:p,page_size:G});case 4:Oe=De.sent,Rt=Oe.data,Ve=Oe.code,Ve===200&&Rt&&He(function(mt){return Rt.reduce(function(qe,F){var f=mt.map(function(b){var O=b.id;return O});return f.includes(F.id)?qe:qe.concat(F)},[])}),T(!1);case 9:case"end":return De.stop()}},fe)}));return function(){return $.apply(this,arguments)}}();(0,n.useEffect)(function(){L==="server_tag_id"&&(He([]),A(1),S(1))},[L]);var Xe=function(fe){var We=fe.target,Oe=We.clientHeight,Rt=We.scrollHeight,Ve=We.scrollTop;if(Oe+Ve===Rt){var tt=q+1;S(tt),A(tt)}};return(0,e.jsx)(de.Z.Item,{name:"server_tag_id",rules:[{required:!0,message:j({id:"select.suite.server_tag_id.message"})}],children:(0,e.jsx)(Et.Z,{placeholder:(0,e.jsx)(r._H,{id:"select.suite.server_tag_id.message"}),style:{width:"100%"},allowClear:!0,filterOption:function(fe,We){var Oe;return((Oe=We==null?void 0:We.name)!==null&&Oe!==void 0?Oe:"").toLowerCase().includes(fe.toLowerCase())},tagRender:ft.lR,mode:"multiple",loading:Qe,onPopupScroll:Xe,options:h==null?void 0:h.map(function($){return{value:$.id,label:(0,e.jsx)(ut.Z,{color:$.tag_color,children:$.name}),name:$.name}})})})},_n=Tt,en=t(55704),Cn=t(53919),It=function(l){var c=(0,r.YB)(),j=c.formatMessage,_=l.mask,p=l.multipInfo,L=l.form,h=(0,n.useContext)($t),ue=h.setMask,Pe=h.setLoading,xe=(0,n.useRef)(null),He=function(q){var S;(S=xe.current)===null||S===void 0||S.show((0,m.Z)((0,m.Z)({},q),{},{detailData:(q==null?void 0:q.errors)||[]}))},G=function(q){var S=q.success_servers,E=S===void 0?[]:S,Y=E==null?void 0:E.map(function(Qe){return Qe.ip});Y!=null&&Y.length&&L.setFieldsValue({custom_ip:Y[0]})},Me=function(q){var S,E=q.data,Y=q.channelType;return(0,e.jsxs)("span",{children:[(0,e.jsx)("span",{children:(S=E.msg)===null||S===void 0?void 0:S.join("")}),!1]})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(de.Z.Item,{name:"custom_channel",style:{width:"100%"},rules:_?[]:[{required:!0,message:j({id:"select.suite.custom_channel"})}],children:(0,e.jsx)(Cn.k,{style:{width:"100%"},placeholder:p.selfServer?j({id:"select.suite.multiple.values"}):j({id:"select.suite.agent.select"}),onChange:function(q){ue(!1),q&&L.validate}})}),(0,e.jsx)(de.Z.Item,{name:"custom_ip",style:{width:"100%"},validateTrigger:["onBlur"],rules:[{required:!0,message:j({id:"select.suite.custom_ip"})},{validator:function(q,S){return(0,ge.Z)((0,Fe.Z)().mark(function E(){var Y,Qe,T,A;return(0,Fe.Z)().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(S){$.next=2;break}return $.abrupt("return",Promise.resolve(j({id:"select.suite.custom_ip"})));case 2:if(Y=L.getFieldValue("custom_channel"),Y){$.next=5;break}return $.abrupt("return",Promise.reject(j({id:"select.suite.custom_channel"})));case 5:return Pe(!0),$.next=8,(0,qt.oO)({ip:S,channel_type:Y});case 8:if($.t0=$.sent,$.t0){$.next=11;break}$.t0={};case 11:if(Qe=$.t0,T=Qe.code,A=Qe.msg,T===200){$.next=17;break}return Pe(!1),$.abrupt("return",Promise.reject((0,e.jsx)(Me,{data:{msg:A,errors:[S]},channelType:Y})));case 17:return Promise.resolve(),Pe(!1),$.abrupt("return");case 20:case"end":return $.stop()}},E)}))()}}],children:(0,e.jsx)(Q.Z,{allowClear:!0,placeholder:p.selfServer?j({id:"select.suite.multiple.values"}):"".concat(j({id:"select.suite.enter.ip"})).concat(""),autoComplete:"off"})}),(0,e.jsx)(en.Z,{ref:xe,callback:G})]})},Nn=It,Vn=(0,n.memo)(function(D){var l=(0,r.YB)(),c=l.formatMessage,j=D.batch,_=D.server_type,p=D.run_mode,L=D.form,h=D.serverType,ue=D.serverObjectType,Pe=D.mask,xe=D.multipInfo,He=(0,n.useContext)($t),G=He.setServerObjectType,Me=He.setServerType,Ue=He.setMask,q=He.settingType,S=He.setServerList,E=He.setTagList,Y=(0,n.useCallback)(function(A){var Xe=A.target;Me(Xe.value),S([])},[]),Qe=(0,n.useCallback)(function(A){S([]),E([]),G(A),Ue(!1),L.setFieldsValue({server_object_id:void 0})},[]),T=function(Xe){Ue(!1),Xe==="pool"?(Me("pool"),G("ip")):Me("custom")};return(0,e.jsxs)(e.Fragment,{children:[!Pe&&(0,e.jsx)(de.Z.Item,{label:q==="suite"?(0,e.jsx)(ft.fD,{title:c({id:"select.suite.the.server"}),desc:c({id:"select.suite.the.server.desc"})}):c({id:"select.suite.the.server"}),className:"drawer_padding",children:(0,e.jsxs)(Ce.ZP.Group,{value:h,onChange:Y,children:[(0,e.jsx)(Ce.ZP,{value:"pool",children:(0,e.jsx)(r._H,{id:"select.suite.the.server.pool"})}),_!=="aliyun"&&p==="standalone"&&(0,e.jsx)(Ce.ZP,{value:"custom",children:(0,e.jsx)(r._H,{id:"select.suite.self.owned.server"})})]})}),Pe&&j&&(0,e.jsxs)(de.Z.Item,{className:"drawer_padding",label:(0,e.jsx)(r._H,{id:"select.suite.the.server"}),children:[(0,e.jsxs)("label",{className:"ant-radio-wrapper",onClick:function(){return T("pool")},children:[(0,e.jsx)("span",{className:"ant-radio ant-radio-checked",children:(0,e.jsx)("span",{className:"ant-radio-inner ".concat(xe.serverPool?"":M().serverItemUncheckeds),style:{borderColor:"#d9d9d9"}})}),(0,e.jsx)("span",{children:(0,e.jsx)(r._H,{id:"select.suite.the.server.pool"})})]}),_!=="aliyun"&&p==="standalone"&&(0,e.jsxs)("label",{className:"ant-radio-wrapper",onClick:function(){return T("self")},children:[(0,e.jsx)("span",{className:"ant-radio ant-radio-checked",children:(0,e.jsx)("span",{className:"ant-radio-inner ".concat(xe.selfServer?"":M().serverItemUnchecked),style:{borderColor:"#d9d9d9"}})}),(0,e.jsx)("span",{children:(0,e.jsx)(r._H,{id:"select.suite.self.owned.server"})})]})]}),(0,e.jsx)(re.Z,{style:{marginBottom:8},className:"drawer_padding",gutter:8,children:h==="pool"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(pt.Z,{span:10,children:(0,e.jsxs)(Et.Z,{style:{width:"100%"},value:ue,onChange:Qe,placeholder:c({id:"select.suite.multiple.values"}),children:[(0,e.jsx)(Et.Z.Option,{value:"ip",children:(0,e.jsx)(r._H,{id:"select.suite.random"})}),_==="aliyun"&&p==="standalone"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Et.Z.Option,{value:"instance",title:c({id:"select.suite.instance"}),children:(0,e.jsx)(r._H,{id:"select.suite.instance"})}),(0,e.jsx)(Et.Z.Option,{value:"setting",title:c({id:"select.suite.setting"}),children:(0,e.jsx)(r._H,{id:"select.suite.setting"})})]}):(0,e.jsx)(Et.Z.Option,{value:"server_object_id",children:(0,e.jsx)(r._H,{id:"select.suite.server_object_id"})}),(0,e.jsx)(Et.Z.Option,{value:"server_tag_id",children:(0,e.jsx)(r._H,{id:"select.suite.server_tag_id"})})]})}),(0,e.jsxs)(pt.Z,{span:14,children:[(ue==="ip"||!ue)&&(0,e.jsx)(Q.Z,{title:c({id:"select.suite.randomly.schedule"}),style:{width:"100%"},autoComplete:"off",disabled:!0,placeholder:c({id:"select.suite.randomly.schedule"})}),ue&&ue!=="ip"&&ue!=="server_tag_id"&&(0,e.jsx)(Ye,(0,m.Z)({},D)),ue==="server_tag_id"&&(0,e.jsx)(_n,(0,m.Z)({},D))]})]}):(0,e.jsx)(Nn,(0,m.Z)({},D))}),(0,e.jsx)(de.Z.Item,{name:"repeat",label:(0,e.jsx)(ft.fD,{title:"Repeat",desc:"".concat(c(q==="suite"?{id:"select.suite.repeat.tootip1"}:{id:"select.suite.repeat.tootip2"}))}),className:"drawer_padding",children:(0,e.jsx)(ln.Z,{style:{width:"100%"},min:1,step:1,formatter:ft.zW,max:1e4,placeholder:c({id:xe.repeat?"select.suite.multiple.values":"please.enter"})})}),q==="suite"&&(0,e.jsx)("div",{style:{height:8,background:"rgba(0,0,0,0.03)",width:"100%",marginBottom:8}})]})}),Ut=["custom_channel","custom_ip","server_object_id","server_tag_id","repeat"],Gn,Bn,Yn,na=(0,Be.ZP)(bt.Z)(Gn||(Gn=(0,gt.Z)([`
    .ant-form-item {
        margin-bottom: 8px;
    }
    .ant-drawer-body {
        padding: 0;
    }
    .ant-form {
        padding: 13px 0;
    }
    .ant-drawer-header {
        padding: 16px 14px 8px;
    }
    .drawer_padding {
        padding-left: 20px;
        padding-right: 20px;
    }
`]))),aa=Be.ZP.div(Bn||(Bn=(0,gt.Z)([`
    font-size: 12px;
    color: rgba(0,0,0,.65);
    margin-top: 4px;
    margin-right: 14px;
    word-wrap: break-word;
    word-break: break-all;
    overflow: hidden;
`]))),ra=Be.ZP.div(Yn||(Yn=(0,gt.Z)([`
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-variant: tabular-nums;
    list-style: none;
    font-feature-settings: 'tnum', "tnum";
    position: relative;
    display: inline-block;
    min-width: 0;
    padding: 4px 11px;
    color: rgba(0, 0, 0, 0.85);
    font-size: 14px;
    line-height: 1.5715;
    background-image: none;
    border: 1px solid #d9d9d9;
    border-radius: 2px;
    transition: all 0.3s;
    color: rgba(0, 0, 0, 0.25);
    background-color: #f5f5f5;
    cursor: not-allowed;
    opacity: 1;
    width: 159px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
`]))),sa=function(l,c){var j,_=(0,r.YB)(),p=_.formatMessage,L=l.contrl,h=l.checked,ue=l.server_type,Pe=l.test_type,xe=l.run_mode,He=l.onDataSourceChange,G=l.testSuiteData,Me=l.onOk,Ue=(0,n.useState)("pool"),q=(0,s.Z)(Ue,2),S=q[0],E=q[1],Y=(0,n.useState)("ip"),Qe=(0,s.Z)(Y,2),T=Qe[0],A=Qe[1],Xe=(0,n.useState)(null),$=(0,s.Z)(Xe,2),fe=$[0],We=$[1],Oe=de.Z.useForm(),Rt=(0,s.Z)(Oe,1),Ve=Rt[0],tt=(0,n.useState)(void 0),xt=(0,s.Z)(tt,2),De=xt[0],mt=xt[1],qe=(0,n.useState)(!1),F=(0,s.Z)(qe,2),f=F[0],b=F[1],O=(0,n.useState)(!0),we=(0,s.Z)(O,2),se=we[0],ie=we[1],ht=(0,n.useState)(!1),ot=(0,s.Z)(ht,2),Bt=ot[0],Wt=ot[1],hn=(0,n.useState)(!1),tn=(0,s.Z)(hn,2),ye=tn[0],ee=tn[1],rt=(0,n.useState)(!1),Le=(0,s.Z)(rt,2),Se=Le[0],nn=Le[1],an=(0,n.useState)([]),cn=(0,s.Z)(an,2),rn=cn[0],U=cn[1],w=(0,n.useState)([]),be=(0,s.Z)(w,2),te=be[0],pe=be[1],Rn=(0,n.useState)(null),Sn=(0,s.Z)(Rn,2),st=Sn[0],bn=Sn[1],Hn=(0,n.useState)(null),kn=(0,s.Z)(Hn,2),On=kn[0],zn=kn[1],lt=(0,n.useMemo)(function(){return(0,ft.O6)(st)},[st]),le=(0,n.useMemo)(function(){return(0,ft.O6)(On)},[On,st]),k=function(o){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,g={},y=function Ae(ke){var he=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ke.reduce(function(K,et){return Object.keys(et).forEach(function(Te){var Ze=et[Te];Te==="test_case_list"?g=Ae(Ze,g):Te in K?C().isArray(Ze)?K[Te].push(Ze):K[Te]=K[Te].concat(Ze):K[Te]=[Ze]}),K},he)},Z=function(ke){return Object.keys(ke).reduce(function(he,K){if(K==="server_tag_id"&&JSON.stringify(ke[K])!=="[]"){var et=ke[K].reduce(function(Ze,Vt){return JSON.stringify(Vt)!=="[]"?Ze.concat(Vt.toString()):Ze},[]),Te=et;et.length>0&&(Te=C().uniq(et).map(function(Ze){return Ze.split(",").map(function(Vt){return Number(Vt)})})),he[K]=Te}else he[K]=C().uniq(ke[K]).reduce(function(Ze,Vt){return C().isArray(Vt)?(JSON.stringify(Vt)==="[]"||Ze.push(Vt),Ze):Vt!=null&&Vt!==""?Ze.concat(Vt):Ze},[]);return he},{})},J=y(o),Ee=Z(J);if(d){var nt=Z(g);return{suiteMultip:Ee,caseMultip:nt}}return{suiteMultip:Ee}},Lt=function(o){var d=o.server_object_id,g=o.server_tag_id,y=o.ip,Z=o.is_instance,J=o.customer_server,Ee=location.search.indexOf("inheriting_machine")!==-1;if(C().isNull(y)){A("ip");return}if(J&&JSON.stringify(J)!=="{}"){var nt=J.custom_ip,Ae=J.custom_channel;nt&&Ae&&(A("ip"),E("custom"));return}if(Ee&&y){ue==="aliyun"&&xe==="standalone"?(Z===0&&A("setting"),Z===1&&A("instance")):A("server_object_id");return}if(Array.isArray(g)&&g.length||d){E("pool"),d&&(ue==="aliyun"&&xe==="standalone"?(Z===0&&A("setting"),Z===1&&A("instance")):A("server_object_id")),C().isEmpty(g)||A("server_tag_id");return}A("ip")},Pt=function(o){var d=Object.keys(o).reduce(function(g,y){var Z=o[y];return y==="env_info"&&Z&&Z.length===0?(g[y]=new Array(1).fill({val:"",name:""}),g):(Z&&Z.length===0||Z&&Z.length>1||(g[y]=Z&&Z[0]),g)},{});return d.custom_ip&&d.custom_channel?d:(0,m.Z)((0,m.Z)({},d),{},{custom_ip:null,custom_channel:null})};(0,n.useEffect)(function(){if(De){var i={repeat:Pe==="performance"?3:1,need_reboot:!1,setup_info:"",cleanup_info:"",console:!0,priority:10};if(f)if(fe==="suite"){var o=k(De,!0),d=o.suiteMultip,g=o.caseMultip;bn(g),zn(d);var y=Pt(g),Z=Pt(d),J=y.custom_channel,Ee=y.custom_ip,nt=y.ip,Ae=y.server_object_id,ke=y.server_tag_id,he=y.repeat,K={custom_channel:J,custom_ip:Ee,ip:nt,server_object_id:Ae,server_tag_id:ke,repeat:he};Lt(K),Ve.setFieldsValue((0,m.Z)((0,m.Z)({},Z),K))}else{var et=k(De),Te=et.suiteMultip;bn(Te);var Ze=Pt(Te),Vt=Ze.env_info;(!Vt||Vt.length===0)&&(Ze.env_info=new Array(1).fill({val:"",name:""})),ee(!0),Ve.setFieldsValue(Ze)}else{var Un=(0,m.Z)((0,m.Z)({},i),De);De.console==null&&(Un.console=!0);var Jn=De.env_info;Jn&&Jn.length===0&&(Un.env_info=new Array(1).fill({val:"",name:""}),ee(!0)),Lt(Un),Ve.setFieldsValue(Un)}}},[f,De,ue,fe]),(0,n.useImperativeHandle)(c,function(){return{show:function(o,d){We(o);var g=C().isArray(d);Wt(!0),mt(d),b(g),ie(!1)}}});var At=(0,n.useCallback)(function(){Ve.resetFields(),Wt(!1),mt(null),b(!1),ie(!0),ee(!1),bn(null),zn(null),U([]),pe([]),nn(!1),E("pool"),A("ip"),We("case")},[]),Ft=function(o){for(var d="",g=0,y=rn.length;g<y;g++){var Z=rn[g];if(Z.id===o){T==="server_object_id"&&(d=xe==="cluster"?Z.name:Z.ip||Z.sn),T==="instance"&&(d=Z.private_ip?Z.private_ip:Z.instance_name),T==="setting"&&(d=Z.template_name);break}}return d},sn=function(o){return o.reduce(function(d,g,y){for(var Z=te.length,J=0;J<Z;J++)if(te[J].id===g)return d+="".concat(te[J].name).concat(y+1<o.length?",":"");return""},"")},ze=function(){return S==="custom"},yt=function(){return!ze()&&T==="server_tag_id"},dn=function(){return!ze()&&T&&T!=="server_tag_id"&&T!=="ip"},un=function(){return!ze()&&T==="ip"},Nt=function(o){return Object.prototype.toString.call(o)},Pn=(0,n.useCallback)(function(i){var o=Nt(i);if(o==="[object Array]"&&JSON.stringify(i)!=="[]"){var d=i.reduce(function(g,y){var Z=Nt(y);if(JSON.stringify(y)!=="{}"&&Z==="[object Object]"){var J=Object.keys(y).reduce(function(Ee,nt){var Ae=y[nt];return Ae!=null&&Ae!==""&&(Ee[nt]=Ae),Ee},{});return JSON.stringify(J)!=="{}"?g.concat(J):g}return g},[]);return d.length>0?d:void 0}},[]),Kn=function(o,d){var g=d.custom_channel,y=d.custom_ip,Z=d.server_object_id,J=d.server_tag_id,Ee=null;ze()?g&&y&&(Ee=y):(un()&&(Ee="\u968F\u673A"),dn()&&(Ee=Ft(Z)),yt()&&(Ee=sn(J)));var nt=void 0;T==="instance"&&(nt=1),T==="setting"&&(nt=0);var Ae=(0,m.Z)((0,m.Z)({},d),{},{ip:Ee,is_instance:nt}),ke=(0,m.Z)((0,m.Z)({},o),Object.keys(Ae).reduce(function(K,et){var Te=Ae[et];if(et==="env_info"){var Ze=Pn(Te);return K[et]=Ze||o[et],K}return K[et]=Te!=null?Te:o[et],K},{})),he=(0,m.Z)((0,m.Z)({},ke),{},{custom_channel:null,custom_ip:null,customer_server:null,server_object_id:null,server_tag_id:[]});return Se?ke:ze()?(0,m.Z)((0,m.Z)({},he),{},{customer_server:{custom_channel:g,custom_ip:y},custom_channel:g,custom_ip:y}):yt()?(0,m.Z)((0,m.Z)({},he),{},{server_tag_id:J}):dn()?(0,m.Z)((0,m.Z)({},he),{},{server_object_id:Z}):he},x=function(){Ve.validateFields().then(function(o){var d=(0,m.Z)({},o),g=d.custom_channel,y=d.custom_ip,Z=d.server_object_id,J=d.server_tag_id,Ee=d.repeat,nt=(0,ce.Z)(d,Ut),Ae={custom_channel:g,custom_ip:y,server_object_id:Z,server_tag_id:J,repeat:Ee},ke=f?De.map(function(K){return K.id}):[De.id],he=[];fe==="suite"?f?he=G.reduce(function(K,et){return K.concat(ke.includes(et.id)?(0,m.Z)((0,m.Z)((0,m.Z)({},et),nt),{},{test_case_list:et.test_case_list.reduce(function(Te,Ze){return Te.concat(Kn(Ze,Ae))},[])}):et)},[]):he=G.map(function(K){return K.id===De.id?(0,m.Z)((0,m.Z)({},K),nt):K}):he=G.reduce(function(K,et){return K.concat((0,m.Z)((0,m.Z)({},et),{},{test_case_list:et.test_case_list.reduce(function(Te,Ze){return Te.concat(ke.includes(Ze.id)?Kn(Ze,o):Ze)},[])}))},[]),He(he,xe),At(),Me()}).catch(function(o){return console.log(o)})},v=(0,n.useMemo)(function(){if(f&&st){var i=st.ip,o=st.custom_ip,d=st.repeat,g=st.server_tag_id,y=st.server_object_id,Z=st.is_instance,J=y?y.length:0,Ee=g?g.length:0,nt=o?o.length:0,Ae=Array.isArray(i)?i.filter(function(K){return K==="\u968F\u673A"}):[],ke=J+Ee+Ae.length>1,he=nt>1;return(he||ke)&&nn(!0),!ke&&!he&&(E("pool"),J===1&&(A("server_object_id"),ue==="aliyun"&&(Z&&Z.length===1&&xe==="standalone"?A(Z[0]===1?"instance":"setting"):A("server_object_id"))),Ee===1&&A("server_tag_id"),nt===1&&E("custom"),Ae.length===1&&A("ip")),!ke&&he&&E("custom"),J+Ee+Ae.length>=1&&nt>=1&&(nn(!0),E("pool"),A("ip"),he=!0,ke=!0),ke&&A(null),{serverPool:ke,selfServer:he,repeat:d.length>1,server_tag_id:Ee>1,server_object_id:J>1,random:Ae.length>1,setup_info:fe==="suite"?On.setup_info.length>1:st.setup_info.length>1,cleanup_info:fe==="suite"?On.cleanup_info.length>1:st.cleanup_info.length>1}}return{serverPool:!1,selfServer:!1,repeat:!1,cleanup_info:!1,setup_info:!1}},[st,f,ue,fe,On,xe]);return(0,e.jsx)(na,{maskClosable:!1,keyboard:!1,title:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"".concat(p(f?{id:"select.suite.batch.config"}:{id:"select.suite.config"})," ").concat(fe==="suite"?"Suite":"Conf")}),!f&&(0,e.jsx)(aa,{children:De==null?void 0:De.title})]}),width:376,forceRender:!0,destroyOnClose:!0,onClose:At,visible:Bt,bodyStyle:{paddingBottom:80,overflowX:"hidden"},footer:(0,e.jsxs)("div",{style:{textAlign:"right",padding:"0 8px"},children:[(0,e.jsx)(B.Z,{onClick:At,style:{marginRight:8},children:(0,e.jsx)(r._H,{id:"operation.cancel"})}),(0,e.jsx)(B.Z,{onClick:x,type:"primary",children:(0,e.jsx)(r._H,{id:"operation.ok"})})]}),children:(0,e.jsx)(it.Z,{spinning:se,children:(0,e.jsx)($t.Provider,{value:{setLoading:ie,setServerList:U,setTagList:pe,setServerType:E,setServerObjectType:A,setMask:nn,settingType:fe},children:(0,e.jsxs)(de.Z,{layout:"vertical",form:Ve,scrollToFirstError:!0,children:[(fe==="suite"&&le||lt)&&(0,e.jsx)("div",{style:{padding:"0 20px 8px"},children:(0,e.jsx)(W.Z,{message:(0,e.jsx)(r._H,{id:"select.suite.vertical.message"}),type:"warning",showIcon:!0,style:{fontSize:12,padding:"5px 10px"}})}),(f||fe==="case")&&(0,e.jsx)(Vn,(0,m.Z)((0,m.Z)({},l),{},{form:Ve,dataSource:De,visible:Bt,multipInfo:v,loading:se,serverList:rn,tagList:te,serverType:S,serverObjectType:T,mask:Se,batch:f})),L.includes("variable")&&h&&fe==="case"&&(0,e.jsx)(de.Z.Item,{label:(0,e.jsx)(r._H,{id:"select.suite.variable"}),className:"drawer_padding",children:(0,e.jsx)(de.Z.List,{name:"env_info",children:function(o,d){var g=d.add,y=d.remove;return o.map(function(Z,J){var Ee,nt,Ae,ke,he,K,et,Te=Ve.getFieldValue("env_info"),Ze=function(Un){var Jn=Un.label,ga=Un.value,ja=Un.width;return(0,e.jsxs)("div",{style:{display:"flex"},children:[(0,e.jsx)("div",{style:{flexWrap:"nowrap",flexShrink:0},children:Jn}),(0,e.jsx)("div",{style:{flexWrap:"wrap",width:ja},children:ga})]})};return(0,e.jsxs)(N.Z,{style:{marginBottom:8},align:"start",children:[(0,e.jsx)(Ot.Z,{placement:"topLeft",overlayStyle:{width:250},title:(Ee=Te[J])!==null&&Ee!==void 0&&Ee.name||(nt=Te[J])!==null&&nt!==void 0&&nt.des?(0,e.jsxs)(N.Z,{direction:"vertical",children:[!!((Ae=Te[J])!==null&&Ae!==void 0&&Ae.name)&&(0,e.jsx)(Ze,{label:p({id:"select.suite.variable.name"}),value:(ke=Te[J])===null||ke===void 0?void 0:ke.name,width:180}),!!((he=Te[J])!==null&&he!==void 0&&he.des)&&(0,e.jsx)(Ze,{label:p({id:"select.suite.variable.desc"}),value:(K=Te[J])===null||K===void 0?void 0:K.des,width:165})]}):null,children:(0,e.jsx)(ra,{children:((et=Te[J])===null||et===void 0?void 0:et.name)||"key"})}),(0,e.jsx)("span",{style:{marginTop:5,display:"block"},children:"="}),(0,e.jsx)(de.Z.Item,{name:[Z.name,"val"],fieldKey:[Z.fieldKey,"val"],children:(0,e.jsx)(Q.Z,{disabled:ye,autoComplete:"off",placeholder:Te[J].des||p({id:"select.suite.value"})})})]},Z.key)})}})}),L.includes("reboot")&&h&&(0,e.jsx)(de.Z.Item,{label:(0,e.jsx)(r._H,{id:"select.suite.need_reboot"}),name:"need_reboot",className:"drawer_padding",children:(0,e.jsxs)(Ce.ZP.Group,{children:[(0,e.jsx)(Ce.ZP,{value:!0,children:(0,e.jsx)(r._H,{id:"operation.yes"})}),(0,e.jsx)(Ce.ZP,{value:!1,children:(0,e.jsx)(r._H,{id:"operation.no"})})]})}),L.includes("script")&&h&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(de.Z.Item,{name:"setup_info",label:(0,e.jsx)(r._H,{id:"select.suite.setup_info"}),className:"drawer_padding",children:(0,e.jsx)(Q.Z.TextArea,{rows:4,placeholder:v.setup_info?p({id:"select.suite.setup_info.placeholder"}):p({id:"select.suite.please.enter"})})}),(0,e.jsx)(de.Z.Item,{name:"cleanup_info",label:(0,e.jsx)(r._H,{id:"select.suite.cleanup_info"}),className:"drawer_padding",children:(0,e.jsx)(Q.Z.TextArea,{rows:4,placeholder:v.cleanup_info?p({id:"select.suite.cleanup_info.placeholder"}):p({id:"select.suite.please.enter"})})})]}),(0,e.jsx)(de.Z.Item,{name:"priority",label:(0,e.jsx)(ft.fD,{title:p({id:"select.suite.priority"}),desc:p({id:"select.suite.priority.desc"})}),className:"drawer_padding",children:(0,e.jsx)(ln.Z,{formatter:ft.zW,style:{width:"100%"},min:0,step:1,max:20,placeholder:(st==null||(j=st.priority)===null||j===void 0?void 0:j.length)>1?p({id:"select.suite.multiple.values"}):p({id:"select.suite.please.enter"})})})]})})})})},ia=(0,n.memo)((0,n.forwardRef)(sa)),Qn=t(76613),la=t(48766),oa=t(81343),ca=t(26388),da=t(79390),ua=function(D){var l=D.styleObj,c=D.record,j=D.disabled,_=D.columnsInner,p=D.selectedSuiteKeys,L=D.setSelectedCaseKeysFn,h=D.selectedCaseObj,ue=D.onColumnsChange,Pe=D.columnsChange,xe=D.refreshDeps,He=(0,n.useState)([]),G=(0,s.Z)(He,2),Me=G[0],Ue=G[1],q={selectedRowKeys:Me,onChange:function(E){Ue(E),L((0,ca.Z)({},c.id,E))},getCheckboxProps:function(){return{disabled:p.length>0}}};return(0,n.useEffect)(function(){h[c.id]!==Me&&Ue(h[c.id]||[])},[h]),(0,e.jsx)(da.sL,{style:l,hasChange:Pe,rowKey:function(E){return E.id+""},refreshDeps:xe,className:M().conf_table,rowSelection:j?void 0:q,columns:_,onColumnsChange:ue,rowClassName:function(E,Y){return Y%2==0?"inner-odd":"inner-even"},name:"ws-test-job-suite-inner",dataSource:c.test_case_list||[],pagination:!1})},$n=t(6130),Xn=100,fa=function(l){var c=l.dataSource,j=l.onDataSourceChange,_=l.width,p=l.disabled,L=l.run_mode,h=l.contrl,ue=l.control,Pe=l.server_type,xe=l.test_type,He=(0,r.YB)(),G=He.formatMessage,Me=(0,n.useRef)(null),Ue=(0,n.useState)(!0),q=(0,s.Z)(Ue,2),S=q[0],E=q[1],Y=(0,n.useState)(!1),Qe=(0,s.Z)(Y,2),T=Qe[0],A=Qe[1],Xe=(0,n.useState)([]),$=(0,s.Z)(Xe,2),fe=$[0],We=$[1],Oe=(0,n.useState)([]),Rt=(0,s.Z)(Oe,2),Ve=Rt[0],tt=Rt[1],xt=(0,n.useState)({}),De=(0,s.Z)(xt,2),mt=De[0],qe=De[1],F=(0,n.useState)([]),f=(0,s.Z)(F,2),b=f[0],O=f[1],we=(0,n.useState)({}),se=(0,s.Z)(we,2),ie=se[0],ht=se[1],ot=(0,n.useState)(!1),Bt=(0,s.Z)(ot,2),Wt=Bt[0],hn=Bt[1],tn=(0,n.useState)(!1),ye=(0,s.Z)(tn,2),ee=ye[0],rt=ye[1],Le=(0,n.useState)([]),Se=(0,s.Z)(Le,2),nn=Se[0],an=Se[1],cn=(0,n.useState)(!1),rn=(0,s.Z)(cn,2),U=rn[0],w=rn[1],be=(0,n.useState)(!1),te=(0,s.Z)(be,2),pe=te[0],Rn=te[1],Sn=function(v){var i=v.target.checked;if(rt(i),w(!1),hn(!1),qe({}),i){var o=c.map(function(d){return d.id+""});We(o),an(o)}else We([])},st=function(v){j(c.filter(function(i){return i.id!==v}),L)},bn=function(v){var i=c.filter(function(o){var d=o.test_case_list.filter(function(y){if(v!==y.id)return y});if(d.length>0){var g=o;return g.test_case_list=d,g}});j(i,L)},Hn=function(v,i){var o;return(o=Me.current)===null||o===void 0?void 0:o.show("suite",i)},kn=function(v,i){var o;return(o=Me.current)===null||o===void 0?void 0:o.show("case",i)},On=[{title:"Test Conf",dataIndex:"title",ellipsis:{shwoTitle:!1},fixed:"left",render:function(v){return(0,e.jsx)($n.K,{ellipsis:{tooltip:!0},children:v||"-"})}},{title:(0,e.jsx)(r._H,{id:"select.suite.the.server"}),ellipsis:{shwoTitle:!1},key:"server",width:150,render:function(v,i){var o=G({id:"select.suite.random"}),d=i.server_tag_id,g=i.ip,y=i.customer_server;if(d&&d.length>0){var Z=g?g.split(",").map(function(Ee){return(0,e.jsx)(ut.Z,{children:Ee},Ee)}):o;return(0,e.jsx)($n.K,{ellipsis:{tooltip:!0},children:Z})}if((0,u.isNull)(g)&&y&&JSON.stringify(y)!=="{}")return(0,e.jsx)($n.K,{ellipsis:{tooltip:!0},children:(y==null?void 0:y.custom_ip)||""});var J=g&&!["\u968F\u673A"].includes(g)?g:o;return(0,e.jsx)($n.K,{ellipsis:{tooltip:!0},children:J||"-"})}},{title:"Repeat",dataIndex:"repeat",width:80},T&&"reboot"in h&&{title:(0,e.jsx)(r._H,{id:"select.suite.restart"}),dataIndex:"reboot",render:function(v,i){return G({id:"operation.".concat(i.need_reboot?"yes":"no")})},width:80},T&&"script"in h&&{title:(0,e.jsx)(r._H,{id:"select.suite.script"}),width:100,dataIndex:"script",render:function(v,i){var o=G({id:"select.suite.before.restart"}),d=G({id:"select.suite.after.restart"});return i.setup_info||i.cleanup_info?(0,e.jsx)($n.K,{ellipsis:{tooltip:!0},children:"".concat(o,":").concat(i.setup_info||"-","\uFF0C").concat(d,":").concat(i.cleanup_info||"-")}):"-"}},T&&"variable"in h&&{title:(0,e.jsx)(r._H,{id:"select.suite.variable"}),dataIndex:"variable",width:150,render:function(v,i){if(i.env_info&&i.env_info.length>0){var o=i.env_info.map(function(d){return d.name?"".concat(d.name||"","=").concat(d.val||"",";"):"-"});return(0,e.jsx)($n.K,{ellipsis:{tooltip:!0},children:o})}return"-"}},{title:(0,e.jsx)(r._H,{id:"select.suite.priority"}),dataIndex:"priority",width:80},{title:(0,e.jsx)(r._H,{id:"Table.columns.operation"}),dataIndex:"operation",width:Xn,fixed:"right",render:function(v,i,o){return!p&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(B.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return kn(o,i)},children:(0,e.jsx)(r._H,{id:"select.suite.config"})}),(0,e.jsx)(Qn.Z,{className:M().remove,onClick:function(){return bn(i.id)}})]})}}],zn=[{title:"Test Suite",dataIndex:"title",fixed:"left",ellipsis:{shwoTitle:!1},render:function(v){return(0,e.jsx)($n.K,{ellipsis:{tooltip:!0},children:v||"-"})}},T&&"reboot"in h&&{title:G({id:"select.suite.restart"}),dataIndex:"reboot",width:80,render:function(v,i){return G({id:"operation.".concat(i.need_reboot?"yes":"no")})}},T&&"script"in h&&{title:G({id:"select.suite.script"}),dataIndex:"script",width:150,render:function(v,i){var o=i.setup_info,d=i.cleanup_info,g=G({id:"select.suite.before.restart"}),y=G({id:"select.suite.after.restart"});return o||d?(0,e.jsx)($n.K,{ellipsis:{tooltip:!0},children:"".concat(g,":").concat(o||"-","\uFF0C").concat(y,":").concat(d||"-")}):"-"}},T&&{title:G({id:"select.suite.priority"}),width:80,dataIndex:"priority"},{title:G({id:"Table.columns.operation"}),width:Xn,dataIndex:"operation",fixed:"right",render:function(v,i,o){return!p&&(0,e.jsxs)(e.Fragment,{children:[T&&(0,e.jsx)(B.Z,{type:"link",style:{padding:0,height:"auto"},onClick:function(){return Hn(o,i)},children:(0,e.jsx)(r._H,{id:"select.suite.config"})}),(0,e.jsx)(Qn.Z,{className:M().remove,style:T?{marginTop:6,padding:0}:{margin:0,paddingRight:6,width:60,textAlign:"right"},onClick:function(){return st(i.id)}})]})}}];(0,n.useEffect)(function(){c.map(function(x){x.isAdvancedConfig&&A(!0)})},[c]);var lt={selectedRowKeys:fe,onChange:function(v){We(v),hn(!!v.length&&v.length<c.length),rt(v.length==c.length)},getCheckboxProps:function(){return{disabled:Ve.length>0}}},le=function(v){var i=C().cloneDeep(mt)||{};i=(0,m.Z)((0,m.Z)({},i),v),qe(i)};(0,n.useEffect)(function(){var x=[];Object.values(mt).forEach(function(i){x=x.concat(i)});var v=b.length;Rn(!!x.length&&x.length<v),w(x.length==v),tt(x)},[mt]),(0,n.useEffect)(function(){var x={};Object.keys(mt).forEach(function(v){if(ie[v]){var i=mt[v].filter(function(o){if(b.indexOf(o)>-1)return o});x[v]=i}}),qe(x)},[b]);var k=function(v){var i=v.target.checked;rt(!1),We([]),i?(qe(ie),an(c.map(function(o){return o.id+""}))):qe({})},Lt=function(){var v,i=[];c.map(function(o){Ve.map(function(d){i=i.concat(o.test_case_list.filter(function(g){return g.id==d}))})}),(v=Me.current)===null||v===void 0||v.show("case",i)},Pt=function(){var v,i=[];c.forEach(function(o){fe.map(function(d){o.id==d&&i.push(o)})}),(v=Me.current)===null||v===void 0||v.show("suite",i)};(0,n.useEffect)(function(){var x=[],v={};c.forEach(function(i){x=x.concat(i.test_case_list.map(function(o){return o.id+""})),v[i.id]=i.test_case_list.map(function(o){return o.id+""})}),O(x),ht(v)},[_,p,c]);var At=function(v){A(v)},Ft=function(){if(fe.length===0&&Ve.length===0){E(!1);return}return fe.length>0&&Pt(),Ve.length>0&&Lt(),E(!0)},sn=function(v,i,o,d){var g=i.id+"";an(v?nn.filter(function(y){return y!==g}):nn.concat([g])),d(i,o)},ze=function(){E(!0)},yt=(0,n.useMemo)(function(){return On.reduce(function(x,v){return x+(v==null?void 0:v.width)},0)},[On]),dn=function(){qe({}),We([]),rt(!1),w(!1),hn(!1)},un=n.useState((0,ve.Z)()),Nt=(0,s.Z)(un,2),Pn=Nt[0],Kn=Nt[1];return(0,e.jsxs)("div",{style:L==="standalone"?{marginBottom:10,position:"relative"}:{position:"relative"},children:[(0,e.jsxs)(re.Z,{justify:"space-between",align:"middle",children:[(0,e.jsx)("span",{className:M().title,children:L==="standalone"?(0,e.jsx)(r._H,{id:"select.suite.standalone"}):(0,e.jsx)(r._H,{id:"select.suite.cluster"})}),c.length>0&&!p&&(0,e.jsxs)(N.Z,{style:{height:"32px"},children:[(0,e.jsx)("span",{className:M().title,children:(0,e.jsx)(r._H,{id:"select.suite.advanced.config"})}),(0,e.jsx)(Dt.Z,{size:"small",checked:T,onChange:At})]})]}),!p&&(0,e.jsxs)(re.Z,{justify:"space-between",align:"middle",className:M().batch_setting_table_bar,children:[(0,e.jsxs)(N.Z,{children:[(0,e.jsx)(a.Z,{indeterminate:Wt,checked:ee,onChange:Sn,disabled:!T,children:(0,e.jsx)(r._H,{id:"select.suite.selectAll.suites"})}),(0,e.jsx)(a.Z,{indeterminate:pe,checked:U,onChange:k,children:(0,e.jsx)(r._H,{id:"select.suite.selectAll.conf"})})]}),(0,e.jsx)(Ot.Z,{title:(0,e.jsx)("span",{onClick:function(){return E(!0)},style:{cursor:"pointer"},children:(0,e.jsx)(r._H,{id:"select.suite.select.suite/conf"})}),open:!S,children:(0,e.jsx)(B.Z,{size:"small",type:"primary",onClick:Ft,onMouseLeave:ze,children:(0,e.jsx)(r._H,{id:"select.suite.batch.config"})})})]}),(0,e.jsx)(St.Z,{bodyStyle:{width:"100%"},children:(0,e.jsx)(X.Z,{style:{width:_-2},rowSelection:T?lt:void 0,showHeader:T,columns:zn.filter(Boolean),pagination:!1,className:M().suite_table_loading,scroll:T?{x:yt}:void 0,size:"small",rowKey:function(v){return v.id+""},dataSource:c,rowClassName:function(v,i){return i%2==0?"outter outter-odd":"outter outter-even"},expandable:{expandedRowKeys:nn,columnWidth:22,expandedRowRender:function(v){return(0,e.jsx)(ua,{styleObj:{width:_-14},scroll:T?{x:yt}:void 0,record:v,refreshDeps:[T,h,p,Pn,c],disabled:p,selectedCaseObj:mt,columnsInner:On.filter(Boolean),checked:T,contrl:h,columnsChange:Pn,onColumnsChange:function(){return Kn((0,ve.Z)())},selectedSuiteKeys:fe,setSelectedCaseKeysFn:le})},expandIcon:function(v){var i=v.expanded,o=v.onExpand,d=v.record;return i?(0,e.jsx)(la.Z,{onClick:function(y){return sn(i,d,y,o)}}):(0,e.jsx)(oa.Z,{onClick:function(y){return sn(i,d,y,o)}})}}})}),(0,e.jsx)(ia,{ref:Me,test_type:xe,server_type:Pe,run_mode:L,contrl:ue,checked:T,onDataSourceChange:j,testSuiteData:c,onOk:dn})]})},qn=fa,ea,va=(0,Be.ZP)(W.Z)(ea||(ea=(0,gt.Z)([`
    display: flex !important;
    align-items: start !important;
    & .anticon.anticon-exclamation-circle.ant-alert-icon {
        margin-top: 4px;
    }
    & .ant-alert-close-icon {
        margin-top: 5px;
    }
`]))),ma=function(l,c){return["ips","instance_name"].includes(l)?c==null?void 0:c.map(function(j){var _=j.ip,p=j.sn;return"".concat(_,"/").concat(p)}):c==null?void 0:c.map(function(j){var _=j.name;return _})},pa=function(l){var c=l.sources,j=l.isDelete,_=(0,r.YB)();return c?JSON.stringify(c)==="{}"?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)(e.Fragment,{children:Object.keys(c).map(function(p){return(p==null?void 0:p.length)>0&&(0,e.jsx)(va,{showIcon:!0,type:"warning",closable:!0,message:(0,e.jsxs)(N.Z,{wrap:!0,children:[ma(p,c[p]).map(function(L){return(0,e.jsx)(R.Z.Text,{children:L},(0,ve.Z)())}),(0,e.jsx)(R.Z.Text,{children:_.formatMessage({id:"select.suite.".concat(j?"removed":"existent")})})]})},(0,ve.Z)())}).filter(Boolean)}):(0,e.jsx)(e.Fragment,{})},ta=pa,_a=function(l){var c=l.handleData,j=l.contrl,_=l.test_type,p=l.business_type,L=l.template,h=L===void 0?{}:L,ue=l.disabled,Pe=ue===void 0?!1:ue,xe=l.onRef,He=l.server_type,G=l.setPageLoading,Me=l.caseDataRef,Ue=(0,r.YB)(),q=Ue.formatMessage,S=(0,H.UO)(),E=S.ws_id,Y=(0,n.useRef)(null),Qe=(0,n.useRef)(null),T=(0,n.useState)(!0),A=(0,s.Z)(T,2),Xe=A[0],$=A[1],fe=(0,n.useState)([]),We=(0,s.Z)(fe,2),Oe=We[0],Rt=We[1],Ve=(0,n.useState)(0),tt=(0,s.Z)(Ve,2),xt=tt[0],De=tt[1],mt=(0,n.useState)([]),qe=(0,s.Z)(mt,2),F=qe[0],f=qe[1],b=(0,n.useState)([]),O=(0,s.Z)(b,2),we=O[0],se=O[1],ie=n.useState(!1),ht=(0,s.Z)(ie,2),ot=ht[0],Bt=ht[1],Wt=(0,n.useState)([]),hn=(0,s.Z)(Wt,2),tn=hn[0],ye=hn[1],ee=(0,n.useState)([]),rt=(0,s.Z)(ee,2),Le=rt[0],Se=rt[1],nn=(0,n.useState)(!1),an=(0,s.Z)(nn,2),cn=an[0],rn=an[1],U=(0,n.useState)(!0),w=(0,s.Z)(U,2),be=w[0],te=w[1];(0,n.useImperativeHandle)(xe,function(){return{setChecked:console.log,reset:function(){return f([])},setVal:function(le){var k=bn(C().isArray(le)?le:[]);return f(k),k}}});var pe=(0,n.useMemo)(function(){var lt=0;return F.map(function(le){C().isArray(C().get(le,"test_case_list"))&&(lt+=le.test_case_list.length)}),lt},[F]),Rn=function(){var le;(le=Qe.current)===null||le===void 0||le.openDrawer({test_config:F})},Sn=function(){var lt=(0,ge.Z)((0,Fe.Z)().mark(function le(){var k,Lt,Pt,At,Ft;return(0,Fe.Z)().wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:return be&&G(!0),$(!0),Rt([]),k={test_type:_,ws_id:E},Lt=_==="business"?{business_type:p}:{},ze.next=7,(0,je.Zu)((0,m.Z)((0,m.Z)((0,m.Z)({},k),Lt),{},{page_size:200}));case 7:if(ze.t0=ze.sent,ze.t0){ze.next=10;break}ze.t0={};case 10:Pt=ze.t0,At=Pt.data,Ft=At===void 0?[]:At,Ft.map(function(yt,dn){var un;return yt.key=dn+"",yt.title=yt.name,yt.children=(un=yt.test_case_list)===null||un===void 0?void 0:un.map(function(Nt,Pn){return Nt.parentId=yt.id,Nt.key=dn+"-"+Pn,Nt.title=Nt.name,Nt.ip=Nt.ip||"\u968F\u673A",Nt}),yt}),Me&&(Me.current=Ft),Rt(Ft),$(!1),rn(!0),te(!1);case 19:case"end":return ze.stop()}},le)}));return function(){return lt.apply(this,arguments)}}();(0,n.useEffect)(function(){Sn()},[]);var st=function(le,k){var Lt=le.var,Pt=le.title,At=le.name,Ft=k.server_is_deleted,sn=k.test_case_id,ze=k.repeat,yt=k.need_reboot,dn=k.is_instance,un=k.priority,Nt=k.console,Pn=k.monitor_info,Kn=[];Lt&&(Kn=JSON.parse(Lt));var x=k.env_info,v=x?Object.keys(x).map(function(K){return{name:K,val:x[K]}}):[],i=k.setup_info==="[]"?"":k.setup_info,o=k.cleanup_info==="[]"?"":k.cleanup_info,d=v.length>0?v:Kn,g={setup_info:i,cleanup_info:o,env_info:d,title:Pt,name:At,id:sn,repeat:ze,need_reboot:yt,is_instance:dn,priority:un,console:Nt,monitor_info:Pn,server_is_deleted:Ft,server_object_id:null,custom_channel:null,custom_ip:null,server_tag_id:[],ip:null};if(Ft)return g;var y=k.customer_server,Z=k.server_tag_id,J=k.ip,Ee=k.server_object_id,nt=void 0,Ae=void 0;y&&(nt=y.custom_channel,Ae=y.custom_ip);var ke=J;!ke&&Ae&&(ke=Ae);var he=(0,m.Z)((0,m.Z)((0,m.Z)({},k),g),{},{custom_channel:nt,custom_ip:Ae,ip:ke,server_object_id:Ee});return Z?C().isArray(Z)?he.server_tag_id=C().filter(Z):typeof Z=="string"&&Z.indexOf(",")>-1?he.server_tag_id=Z.split(",").map(function(K){return K-0}):he.server_tag_id=[]:he.server_tag_id=[],he},bn=function(le){var k=le==null?void 0:le.reduce(function(Lt,Pt){var At=Pt.test_suite_id,Ft=Pt.cases,sn=Pt.setup_info,ze=Oe.findIndex(function(dn){var un=dn.id;return un===At});if(~ze){var yt=Ft==null?void 0:Ft.reduce(function(dn,un){var Nt=Oe[ze].test_case_list,Pn=un||{},Kn=Pn.test_case_id,x=Nt.findIndex(function(i){var o=i.id;return o===Kn});if(~x){var v=Nt[x];return dn.concat(st(v,un))}return dn},[]);return yt.length>0?Lt.concat((0,m.Z)((0,m.Z)({},Pt),{},{id:At,title:Oe[ze].name,run_mode:Oe[ze].run_mode,setup_info:sn==="[]"?"":sn,test_case_list:yt})):Lt}return Lt},[]);return je.Zu.length>k&&Bt(!0),k};(0,n.useEffect)(function(){if(cn&&Oe.length>0&&JSON.stringify(h)!=="{}"){var lt=bn(h.test_config);f(lt)}},[h,cn]);var Hn=function(){return De(Y.current.clientWidth)};(0,n.useEffect)(function(){return Hn(),window.addEventListener("resize",Hn),function(){window.removeEventListener("resize",Hn)}},[]),(0,n.useEffect)(function(){var lt=[];Object.keys(j).map(function(le){j[le].config_index==3&&lt.push(j[le].name)}),se(lt)},[j]),(0,n.useEffect)(function(){c(F);var lt=[],le=[];F.forEach(function(k){k.run_mode==="cluster"?le.push(k):lt.push(k)}),ye(lt),Se(le)},[F]);var kn=function(le){if(le.length===0)return f([]);var k=[];le.forEach(function(Lt){var Pt=F.findIndex(function(sn){return sn.id===Lt.id});if(Pt===-1)k.push(Lt);else{var At=[],Ft=F[Pt].test_case_list;Lt.test_case_list.forEach(function(sn){var ze=Ft.findIndex(function(yt){return yt.id===sn.id});ze===-1?At.push(sn):At.push(Ft[ze])}),k.push((0,m.Z)((0,m.Z)({},F[Pt]),{},{test_case_list:At}))}}),f(k)},On=function(le,k){f(k==="cluster"?tn.concat(le):Le.concat(le))},zn={disabled:Pe,width:xt,test_type:_,server_type:He,contrl:j,control:we,loading:Xe,ws_id:E,onDataSourceChange:On};return(0,e.jsx)("div",{className:M().suite,ref:Y,style:{position:"relative",width:"100%"},children:(0,e.jsxs)(it.Z,{spinning:Xe,children:[(0,e.jsxs)("div",{children:[(0,e.jsx)(B.Z,{disabled:Pe,type:"primary",size:"small",onClick:Rn,style:{marginBottom:"12px"},children:(0,e.jsx)(r._H,{id:"select.suite.select.case"})}),F.length>0&&(0,e.jsx)("span",{style:{paddingLeft:8},children:(0,e.jsxs)(N.Z,{children:[(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(R.Z.Text,{style:{color:"rgba(0,0,0,.65)"},children:(0,e.jsx)(r._H,{id:"select.suite.selected"})}),(0,e.jsx)(I.Z,{style:{backgroundColor:"rgba(140,140,140,0.10)",color:"rgba(0,0,0,.65)"},count:F.length,overflowCount:999999})]}),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(R.Z.Text,{style:{color:"rgba(0,0,0,.65)"},children:"Test Conf"}),(0,e.jsx)(I.Z,{style:{backgroundColor:"rgba(140,140,140,0.10)",color:"rgba(0,0,0,.65)"},count:pe,overflowCount:999999})]})]})})]}),(0,e.jsxs)(N.Z,{direction:"vertical",size:6,style:{width:"100%"},children:[ot&&(0,e.jsx)(W.Z,{message:q({id:"select.suite.table.is_delete.alart",defaultMessage:"\u6240\u9009\u7528\u4F8B\u5DF2\u4E0D\u5B58\u5728"}),type:"warning",showIcon:!0,closable:!0}),(0,e.jsx)(ta,{sources:h==null?void 0:h.server_deleted,isDelete:!0}),(0,e.jsx)(ta,{sources:h==null?void 0:h.server_no_allocated}),_==="business"?(0,e.jsx)(Ct,{testType:_,onRef:Qe,handleSelect:kn,control:we,treeData:Oe,loading:Xe}):(0,e.jsx)(En,{testType:_,onRef:Qe,handleSelect:kn,control:we,treeData:Oe,loading:Xe}),tn.length===0&&Le.length===0&&(0,e.jsx)(St.Z,{bodyStyle:{width:xt||"100%"},children:(0,e.jsx)(Ke.Z,{image:Ke.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsx)(r._H,{id:"select.suite.please.select.case"})})}),tn.length>0&&(0,e.jsx)(qn,(0,m.Z)((0,m.Z)({},zn),{},{dataSource:tn,run_mode:"standalone"})),Le.length>0&&(0,e.jsx)(qn,(0,m.Z)((0,m.Z)({},zn),{},{dataSource:Le,run_mode:"cluster"}))]})]})})},ha=_a},93354:function(zt,Jt,t){"use strict";t.d(Jt,{Zu:function(){return St},ge:function(){return Ke}});var gn=t(35832),it=t(32326),Ht=t(22812),St=function(){var I=(0,it.Z)((0,gn.Z)().mark(function fn(R){return(0,gn.Z)().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.abrupt("return",(0,Ht.WY)("/api/case/workspace/case/",{params:R}));case 1:case"end":return B.stop()}},fn)}));return function(R){return I.apply(this,arguments)}}(),Mt=null;function Ke(){return(0,Ht.WY)("/api/case/test_domain/")}function Dn(I){return request("/api/server/server_tag/",{params:I})}function W(I){return request("/api/server/test_server/channel/check/",{params:I})}function ct(I){return request("/api/server/test_cluster/",{params:I})}function N(I){return request("/api/server/cloud_server/",{params:I})}function kt(I){return request("/api/server/test_cluster/",{params:I})}},83396:function(zt,Jt,t){"use strict";t.d(Jt,{Z:function(){return ge}});var gn=t(29700),it=t(77335),Ht=t(57556),St=t(68591),Mt=t.n(St),Ke=t(85628),Dn=t(10929),W=t(22374),ct=t(41140),N=t(39448),kt=W.forwardRef(function(s,n){var u,C=s.prefixCls,ne=C===void 0?"rc-switch":C,bt=s.className,P=s.checked,Yt=s.defaultChecked,V=s.disabled,a=s.loadingIcon,Qt=s.checkedChildren,Q=s.unCheckedChildren,ae=s.onClick,Zt=s.onChange,r=s.onKeyDown,H=(0,Dn.Z)(s,["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"]),je=(0,ct.Z)(!1,{value:P,defaultValue:Yt}),Je=(0,Ke.Z)(je,2),oe=Je[0],ve=Je[1];function e(M,me){var re=oe;return V||(re=M,ve(re),Zt==null||Zt(re,me)),re}function z(M){M.which===N.Z.LEFT?e(!1,M):M.which===N.Z.RIGHT&&e(!0,M),r==null||r(M)}function Ct(M){var me=e(!oe,M);ae==null||ae(me,M)}var Xt=Mt()(ne,bt,(u={},(0,it.Z)(u,"".concat(ne,"-checked"),oe),(0,it.Z)(u,"".concat(ne,"-disabled"),V),u));return W.createElement("button",Object.assign({},H,{type:"button",role:"switch","aria-checked":oe,disabled:V,className:Xt,ref:n,onKeyDown:z,onClick:Ct}),a,W.createElement("span",{className:"".concat(ne,"-inner")},oe?Qt:Q))});kt.displayName="Switch";var I=kt,fn=t(53532),R=t(4631),Gt=t(19245),B=t(65526),Fe=function(s,n){var u={};for(var C in s)Object.prototype.hasOwnProperty.call(s,C)&&n.indexOf(C)<0&&(u[C]=s[C]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ne=0,C=Object.getOwnPropertySymbols(s);ne<C.length;ne++)n.indexOf(C[ne])<0&&Object.prototype.propertyIsEnumerable.call(s,C[ne])&&(u[C[ne]]=s[C[ne]]);return u},m=W.forwardRef(function(s,n){var u,C=s.prefixCls,ne=s.size,bt=s.disabled,P=s.loading,Yt=s.className,V=Yt===void 0?"":Yt,a=Fe(s,["prefixCls","size","disabled","loading","className"]),Qt=W.useContext(fn.E_),Q=Qt.getPrefixCls,ae=Qt.direction,Zt=W.useContext(Gt.Z),r=W.useContext(R.Z),H=(bt!=null?bt:r)||P,je=Q("switch",C),Je=W.createElement("div",{className:"".concat(je,"-handle")},P&&W.createElement(Ht.Z,{className:"".concat(je,"-loading-icon")})),oe=Mt()((u={},(0,it.Z)(u,"".concat(je,"-small"),(ne||Zt)==="small"),(0,it.Z)(u,"".concat(je,"-loading"),P),(0,it.Z)(u,"".concat(je,"-rtl"),ae==="rtl"),u),V);return W.createElement(B.Z,{insertExtraNode:!0},W.createElement(I,(0,gn.Z)({},a,{prefixCls:je,className:oe,disabled:H,ref:n,loadingIcon:Je})))});m.__ANT_SWITCH=!0;var ge=m}}]);
